{"version":3,"file":"index.js","sources":["../src/components/icons/ToolIcon.tsx","../src/context/DrmPlaybackWarningContext.tsx","../src/hooks/useClient.ts","../src/util/createSearchFilter.ts","../src/hooks/useAssets.ts","../src/hooks/useDialogState.ts","../src/actions/secrets.ts","../src/hooks/useSaveSecrets.ts","../src/util/constants.ts","../src/hooks/useSecretsDocumentValues.ts","../src/hooks/useSecretsFormState.ts","../src/util/readSecrets.ts","../src/components/MuxLogo.tsx","../src/components/ConfigureApi.styled.tsx","../src/components/FormField.tsx","../src/components/ConfigureApi.tsx","../src/util/assetTitlePlaceholder.ts","../src/util/parsers.ts","../src/actions/assets.ts","../src/hooks/useMuxAssets.ts","../src/hooks/useImportMuxAssets.ts","../src/hooks/useInView.ts","../src/util/getPlaybackPolicy.ts","../src/util/generateJwt.ts","../src/util/createUrlParamsObject.ts","../src/util/getAnimatedPosterSrc.ts","../src/util/getPosterSrc.ts","../src/util/tryWithSuspend.ts","../src/components/VideoThumbnail.tsx","../src/components/ImportVideosFromMux.tsx","../src/components/PageSelector.tsx","../src/util/addKeysToMuxData.ts","../src/hooks/useResyncMuxMetadata.ts","../src/components/ResyncMetadata.tsx","../src/components/SelectSortOptions.tsx","../src/components/SpinnerBox.tsx","../src/actions/download.ts","../src/context/DialogStateContext.tsx","../src/util/mimeExtGraph.ts","../src/util/downloadFile.ts","../src/components/DownloadAssetDialog.tsx","../src/components/IconInfo.tsx","../src/components/icons/Resolution.tsx","../src/components/icons/StopWatch.tsx","../src/hooks/useResyncAsset.ts","../src/util/textTracks.ts","../src/util/types.ts","../src/components/AddCaptionDialog.tsx","../src/components/EditCaptionDialog.tsx","../src/components/TextTracksManager.tsx","../src/util/getVideoSrc.ts","../src/components/CaptionsDialog.tsx","../node_modules/use-device-pixel-ratio/dist/index.module.js","../src/util/formatSeconds.ts","../src/components/EditThumbnailDialog.tsx","../src/components/icons/Audio.tsx","../src/components/VideoPlayer.tsx","../src/components/documentPreview/MissingSchemaType.tsx","../src/components/documentPreview/TimeAgo.tsx","../src/components/documentPreview/DraftStatus.tsx","../src/components/documentPreview/PublishedStatus.tsx","../src/components/documentPreview/PaneItemPreview.tsx","../src/components/documentPreview/DocumentPreview.tsx","../src/components/VideoDetails/VideoReferences.tsx","../src/components/VideoDetails/DeleteDialog.tsx","../src/hooks/useDocReferences.ts","../src/util/getVideoMetadata.ts","../src/components/VideoDetails/useVideoDetails.ts","../src/components/VideoDetails/VideoDetails.tsx","../src/components/VideoMetadata.tsx","../src/components/VideoInBrowser.tsx","../src/components/VideosBrowser.tsx","../src/components/StudioTool.tsx","../src/hooks/useAccessControl.ts","../src/hooks/useAssetDocumentValues.ts","../src/hooks/useMuxPolling.ts","../node_modules/use-error-boundary/lib/index.module.js","../src/components/ErrorBoundaryCard.tsx","../src/components/Input.styled.tsx","../src/components/Onboard.tsx","../src/clients/upChunkObservable.ts","../src/util/formatDriveShareLink.ts","../src/actions/upload.ts","../src/util/asserters.ts","../src/util/extractFiles.ts","../src/util/watchAssetUpdates.ts","../src/components/SelectAsset.tsx","../src/components/InputBrowser.tsx","../src/hooks/useCancelUpload.ts","../src/components/Player.styled.tsx","../src/components/UploadProgress.tsx","../src/components/Player.tsx","../src/components/withFocusRing/helpers.ts","../src/components/FileInputMenuItem.styled.tsx","../src/components/FileInputMenuItem.tsx","../src/components/PlayerActionsMenu.tsx","../src/hooks/useFetchFileSize.ts","../src/hooks/useMediaMetadata.ts","../src/util/formatBytes.ts","../src/components/TextTracksEditor.tsx","../src/components/uploadConfiguration/PlaybackPolicyOption.tsx","../src/components/uploadConfiguration/PlaybackPolicyWarning.tsx","../src/components/uploadConfiguration/PlaybackPolicy.tsx","../src/components/uploadConfiguration/ResolutionTierSelector.tsx","../src/components/uploadConfiguration/StaticRenditionSelector.tsx","../src/components/UploadConfiguration.tsx","../src/components/withFocusRing/withFocusRing.ts","../src/components/Uploader.styled.tsx","../src/components/FileInputButton.tsx","../src/components/UploadPlaceholder.tsx","../src/components/Uploader.tsx","../src/components/Input.tsx","../src/plugin.tsx","../src/schema.ts","../src/_exports/index.ts"],"sourcesContent":["/**\r\n * Icon of a monitor with a play button.\r\n * Credits: material design icons & react-icons\r\n */\r\nconst ToolIcon = () => (\r\n  <svg\r\n    stroke=\"currentColor\"\r\n    fill=\"currentColor\"\r\n    strokeWidth=\"0\"\r\n    viewBox=\"0 0 24 24\"\r\n    height=\"1em\"\r\n    width=\"1em\"\r\n    xmlns=\"http://www.w3.org/2000/svg\"\r\n  >\r\n    <path d=\"M21 3H3c-1.11 0-2 .89-2 2v12c0 1.1.89 2 2 2h5v2h8v-2h5c1.1 0 1.99-.9 1.99-2L23 5c0-1.11-.9-2-2-2zm0 14H3V5h18v12zm-5-6l-7 4V7z\" />\r\n  </svg>\r\n)\r\n\r\nexport default ToolIcon\r\n","import {Button, Card, Dialog, Stack, Text} from '@sanity/ui'\r\nimport React, {createContext, useContext, useState} from 'react'\r\n\r\nimport {PluginConfig} from '../util/types'\r\n\r\nconst LOCAL_STORAGE_HAS_SHOWN_WARNING_KEY = 'mux-plugin-has-shown-drm-playback-warning'\r\n\r\ntype DrmPlaybackWarningContextContextProps = {\r\n  hasShownWarning: boolean\r\n  setHasWarnedAboutDrmPlayback: (b: boolean) => void\r\n}\r\n\r\nconst DrmPlaybackWarningContext = createContext<DrmPlaybackWarningContextContextProps>({\r\n  hasShownWarning: false,\r\n  setHasWarnedAboutDrmPlayback: () => {\r\n    return null\r\n  },\r\n})\r\n\r\ninterface DrmPlaybackWarningContextProviderProps {\r\n  config?: PluginConfig\r\n  children: React.ReactNode\r\n}\r\n\r\nexport const DrmPlaybackWarningContextProvider = ({\r\n  config,\r\n  children,\r\n}: DrmPlaybackWarningContextProviderProps) => {\r\n  const warningDisabled = config?.disableDrmPlaybackWarning ?? false\r\n  const hasWarned: boolean =\r\n    warningDisabled || window.localStorage.getItem(LOCAL_STORAGE_HAS_SHOWN_WARNING_KEY) === 'true'\r\n  const [hasWarnedAboutDrmPlayback, setHasWarnedAboutDrmPlayback] = useState(hasWarned)\r\n\r\n  const setHasShownWarning = (b: boolean) => {\r\n    window.localStorage.setItem(LOCAL_STORAGE_HAS_SHOWN_WARNING_KEY, b.toString())\r\n    setHasWarnedAboutDrmPlayback(b)\r\n  }\r\n  return (\r\n    <DrmPlaybackWarningContext.Provider\r\n      value={{\r\n        hasShownWarning: hasWarnedAboutDrmPlayback,\r\n        setHasWarnedAboutDrmPlayback: setHasShownWarning,\r\n      }}\r\n    >\r\n      {children}\r\n    </DrmPlaybackWarningContext.Provider>\r\n  )\r\n}\r\n\r\nexport const useDrmPlaybackWarningContext = () => {\r\n  const context = useContext(DrmPlaybackWarningContext)\r\n  return context\r\n}\r\n\r\nexport const DRMWarningDialog = ({onClose}: {onClose: () => void}) => {\r\n  const {setHasWarnedAboutDrmPlayback} = useDrmPlaybackWarningContext()\r\n  const _onClose = () => {\r\n    setHasWarnedAboutDrmPlayback(true)\r\n    onClose()\r\n  }\r\n  return (\r\n    <Dialog\r\n      open\r\n      id=\"drm-playback-warn\"\r\n      onClose={_onClose}\r\n      header=\"DRM Playback Warning\"\r\n      footer={\r\n        <Stack padding={3}>\r\n          <Button mode=\"ghost\" tone=\"primary\" onClick={_onClose} text=\"Ok\" />\r\n        </Stack>\r\n      }\r\n    >\r\n      <Stack space={3} padding={3}>\r\n        <Card padding={[3, 3, 3]} radius={2}>\r\n          <Stack space={3}>\r\n            <Text size={1} weight=\"semibold\">\r\n              DRM-protected playback will generate a license with a small associated cost. The\r\n              plugin will attempt to play signed or public playback IDs instead whenever possible.\r\n            </Text>\r\n          </Stack>\r\n        </Card>\r\n        <Card padding={[3, 3, 3]} radius={2} tone=\"suggest\">\r\n          <Stack space={3}>\r\n            <Text size={1} weight=\"semibold\">\r\n              This is a one time warning. If it persists, you can disable it from your plugin\r\n              configuration.\r\n            </Text>\r\n          </Stack>\r\n        </Card>\r\n      </Stack>\r\n    </Dialog>\r\n  )\r\n}\r\n","// As it's required to specify the API Version this custom hook ensures it's all using the same version\r\nimport {useClient as useSanityClient} from 'sanity'\r\n\r\nexport const SANITY_API_VERSION = '2024-03-05'\r\n\r\nexport function useClient() {\r\n  return useSanityClient({apiVersion: SANITY_API_VERSION})\r\n}\r\n","// Adaptation of Sanity's createSearchQuery for our limited use case:\r\n// https://github.com/sanity-io/sanity/blob/next/packages/sanity/src/core/search/weighted/createSearchQuery.ts\r\nimport {compact, toLower, trim, uniq, words} from 'lodash'\r\n\r\nconst SPECIAL_CHARS = /([^!@#$%^&*(),\\\\/?\";:{}|[\\]+<>\\s-])+/g\r\nconst STRIP_EDGE_CHARS = /(^[.]+)|([.]+$)/\r\n\r\nfunction tokenize(string: string): string[] {\r\n  return (string.match(SPECIAL_CHARS) || []).map((token) => token.replace(STRIP_EDGE_CHARS, ''))\r\n}\r\n\r\nfunction toGroqParams(terms: string[]): Record<string, string> {\r\n  const params: Record<string, string> = {}\r\n  return terms.reduce((acc, term, i) => {\r\n    acc[`t${i}`] = `*${term}*` // \"t\" is short for term\r\n    return acc\r\n  }, params)\r\n}\r\n\r\n/**\r\n * Convert a string into an array of tokenized terms.\r\n *\r\n * Any (multi word) text wrapped in double quotes will be treated as \"phrases\", or separate tokens that\r\n * will not have its special characters removed.\r\n * E.g.`\"the\" \"fantastic mr\" fox fox book` =\\> [\"the\", `\"fantastic mr\"`, \"fox\", \"book\"]\r\n *\r\n * Phrases wrapped in quotes are assigned relevance scoring differently from regular words.\r\n *\r\n * @internal\r\n */\r\nfunction extractTermsFromQuery(query: string): string[] {\r\n  const quotedQueries = [] as string[]\r\n  const unquotedQuery = query.replace(/(\"[^\"]*\")/g, (match) => {\r\n    if (words(match).length > 1) {\r\n      quotedQueries.push(match)\r\n      return ''\r\n    }\r\n    return match\r\n  })\r\n\r\n  // Lowercase and trim quoted queries\r\n  const quotedTerms = quotedQueries.map((str) => trim(toLower(str)))\r\n\r\n  /**\r\n   * Convert (remaining) search query into an array of deduped, sanitized tokens.\r\n   * All white space and special characters are removed.\r\n   * e.g. \"The saint of Saint-Germain-des-PrÃ©s\" =\\> ['the', 'saint', 'of', 'germain', 'des', 'pres']\r\n   */\r\n  const remainingTerms = uniq(compact(tokenize(toLower(unquotedQuery))))\r\n\r\n  return [...quotedTerms, ...remainingTerms]\r\n}\r\n\r\n/**\r\n * Create GROQ constraints, given search terms and the full spec of available document types and fields.\r\n * Essentially a large list of all possible fields (joined by logical OR) to match our search terms against.\r\n */\r\nfunction createConstraints(terms: string[], includeAssetId: boolean) {\r\n  const searchPaths = includeAssetId ? ['filename', 'assetId'] : ['filename']\r\n  const constraints = terms\r\n    .map((_term, i) => searchPaths.map((joinedPath) => `${joinedPath} match $t${i}`))\r\n    .filter((constraint) => constraint.length > 0)\r\n\r\n  return constraints.map((constraint) => `(${constraint.join(' || ')})`)\r\n}\r\n\r\nexport function createSearchFilter(query: string) {\r\n  const terms = extractTermsFromQuery(query)\r\n\r\n  return {\r\n    filter: createConstraints(terms, query.length >= 8), // if the search is big enough, include the assetId (mux id) in the results\r\n    params: {\r\n      ...toGroqParams(terms),\r\n    },\r\n  }\r\n}\r\n","import {useMemo, useState} from 'react'\r\nimport {collate, createHookFromObservableFactory, DocumentStore, useDocumentStore} from 'sanity'\r\n\r\nimport {SANITY_API_VERSION} from '../hooks/useClient'\r\nimport {createSearchFilter} from '../util/createSearchFilter'\r\nimport type {VideoAssetDocument} from '../util/types'\r\n\r\nexport const ASSET_SORT_OPTIONS = {\r\n  createdDesc: {groq: '_createdAt desc', label: 'Newest first'},\r\n  createdAsc: {groq: '_createdAt asc', label: 'First created (oldest)'},\r\n  filenameAsc: {groq: 'filename asc', label: 'By filename (A-Z)'},\r\n  filenameDesc: {groq: 'filename desc', label: 'By filename (Z-A)'},\r\n}\r\n\r\nexport type SortOption = keyof typeof ASSET_SORT_OPTIONS\r\n\r\nconst useAssetDocuments = createHookFromObservableFactory<\r\n  VideoAssetDocument[],\r\n  {\r\n    documentStore: DocumentStore\r\n    sort: SortOption\r\n    searchQuery: string\r\n  }\r\n>(({documentStore, sort, searchQuery}) => {\r\n  const search = createSearchFilter(searchQuery)\r\n  const filter = [`_type == \"mux.videoAsset\"`, \"defined(playbackId)\", ...search.filter].filter(Boolean).join(' && ')\r\n\r\n  const sortFragment = ASSET_SORT_OPTIONS[sort].groq\r\n  return documentStore.listenQuery(\r\n    /* groq */ `*[${filter}] | order(${sortFragment})`,\r\n    search.params,\r\n    {\r\n      apiVersion: SANITY_API_VERSION,\r\n    }\r\n  )\r\n})\r\n\r\nexport default function useAssets() {\r\n  const documentStore = useDocumentStore()\r\n  const [sort, setSort] = useState<SortOption>('createdDesc')\r\n  const [searchQuery, setSearchQuery] = useState('')\r\n\r\n  const [assetDocuments = [], isLoading] = useAssetDocuments(\r\n    useMemo(() => ({documentStore, sort, searchQuery}), [documentStore, sort, searchQuery])\r\n  )\r\n\r\n  const assets = useMemo(\r\n    () =>\r\n      // Avoid displaying both drafts & published assets by collating them together and giving preference to drafts\r\n      collate<VideoAssetDocument>(assetDocuments).map(\r\n        (collated) =>\r\n          ({\r\n            ...(collated.draft || collated.published || {}),\r\n            _id: collated.id,\r\n          }) as VideoAssetDocument\r\n      ),\r\n    [assetDocuments]\r\n  )\r\n\r\n  return {\r\n    assets,\r\n    isLoading,\r\n    sort,\r\n    searchQuery,\r\n    setSort,\r\n    setSearchQuery,\r\n  }\r\n}\r\n","// Handy little state machine to simplify managing which root level dialog to open\r\n\r\nimport {useState} from 'react'\r\n\r\nexport type DialogState = 'secrets' | 'download-asset' | 'select-video' | 'edit-thumbnail' | 'edit-captions' | false\r\n\r\nexport function useDialogState() {\r\n  return useState<DialogState>(false)\r\n}\r\n\r\nexport type SetDialogState = ReturnType<typeof useDialogState>[1]\r\n","import {defer} from 'rxjs'\r\nimport type {SanityClient} from 'sanity'\r\n\r\ninterface SecretsDocument {\r\n  _id: 'secrets.mux'\r\n  _type: 'mux.apiKey'\r\n  token: string\r\n  secretKey: string\r\n  enableSignedUrls: boolean\r\n  signingKeyId: string\r\n  signingKeyPrivate: string\r\n  drmConfigId: string\r\n}\r\n// eslint-disable-next-line max-params\r\nexport function saveSecrets(\r\n  client: SanityClient,\r\n  token: string,\r\n  secretKey: string,\r\n  enableSignedUrls: boolean,\r\n  signingKeyId: string,\r\n  signingKeyPrivate: string,\r\n  drmConfigId: string\r\n): Promise<SecretsDocument> {\r\n  const doc: SecretsDocument = {\r\n    _id: 'secrets.mux',\r\n    _type: 'mux.apiKey',\r\n    token,\r\n    secretKey,\r\n    enableSignedUrls,\r\n    signingKeyId,\r\n    signingKeyPrivate,\r\n    drmConfigId,\r\n  }\r\n  doc.signingKeyId = enableSignedUrls ? signingKeyId : ''\r\n  doc.signingKeyPrivate = enableSignedUrls ? signingKeyPrivate : ''\r\n\r\n  return client.createOrReplace(doc)\r\n}\r\n\r\nexport async function createSigningKeys(client: SanityClient) {\r\n  try {\r\n    const {dataset} = client.config()\r\n    const res = await client.request<{\r\n      data: {private_key: string; id: string; created_at: string}\r\n    }>({\r\n      url: `/addons/mux/signing-keys/${dataset}`,\r\n      withCredentials: true,\r\n      method: 'POST',\r\n    })\r\n    return res\r\n  } catch (error: any) {\r\n    console.error('Error creating signing keys', error)\r\n    const message =\r\n      error.response?.statusCode === 401\r\n        ? 'Unauthorized - Failed to create the Signing Key. Please ensure that the token has \"System\" permissions'\r\n        : error.message\r\n    throw new Error(message)\r\n  }\r\n}\r\n\r\nexport function testSecrets(client: SanityClient) {\r\n  const {dataset} = client.config()\r\n  return client.request<{status: boolean}>({\r\n    url: `/addons/mux/secrets/${dataset}/test`,\r\n    withCredentials: true,\r\n    method: 'GET',\r\n  })\r\n}\r\n\r\nexport async function haveValidSigningKeys(\r\n  client: SanityClient,\r\n  signingKeyId: string,\r\n  signingKeyPrivate: string\r\n) {\r\n  if (!(signingKeyId && signingKeyPrivate)) {\r\n    return false\r\n  }\r\n\r\n  const {dataset} = client.config()\r\n  try {\r\n    const res = await client.request<{data: {id: string; created_at: string}}>({\r\n      url: `/addons/mux/signing-keys/${dataset}/${signingKeyId}`,\r\n      withCredentials: true,\r\n      method: 'GET',\r\n    })\r\n    //\r\n    // if this signing key is valid it will return { data: { id: 'xxxx' } }\r\n    //\r\n    return !!(res.data && res.data.id)\r\n  } catch (e) {\r\n    console.error('Error fetching signingKeyId', signingKeyId, 'assuming it is not valid')\r\n    return false\r\n  }\r\n}\r\n\r\nexport function testSecretsObservable(client: SanityClient) {\r\n  const {dataset} = client.config()\r\n  return defer(() =>\r\n    client.observable.request<{status: boolean}>({\r\n      url: `/addons/mux/secrets/${dataset}/test`,\r\n      withCredentials: true,\r\n      method: 'GET',\r\n    })\r\n  )\r\n}\r\n","import {useCallback} from 'react'\r\nimport type {SanityClient} from 'sanity'\r\n\r\nimport {createSigningKeys, haveValidSigningKeys, saveSecrets, testSecrets} from '../actions/secrets'\r\nimport type {Secrets} from '../util/types'\r\n\r\nexport const useSaveSecrets = (client: SanityClient, secrets: Secrets) => {\r\n  return useCallback(\r\n    async ({\r\n      token,\r\n      secretKey,\r\n      enableSignedUrls,\r\n      drmConfigId,\r\n    }: Pick<\r\n      Secrets,\r\n      'token' | 'secretKey' | 'enableSignedUrls' | 'drmConfigId'\r\n    >): Promise<Secrets> => {\r\n      let {signingKeyId, signingKeyPrivate} = secrets\r\n\r\n      try {\r\n        await saveSecrets(\r\n          client,\r\n          token!,\r\n          secretKey!,\r\n          enableSignedUrls,\r\n          signingKeyId!,\r\n          signingKeyPrivate!,\r\n          drmConfigId!\r\n        )\r\n        const valid = await testSecrets(client)\r\n        if (!valid?.status && token && secretKey) {\r\n          throw new Error('Invalid secrets')\r\n        }\r\n      } catch (err) {\r\n        console.error('Error while trying to save secrets:', err)\r\n        throw err\r\n      }\r\n\r\n      if (enableSignedUrls) {\r\n        const hasValidSigningKeys = await haveValidSigningKeys(\r\n          client,\r\n          signingKeyId!,\r\n          signingKeyPrivate!\r\n        )\r\n\r\n        if (!hasValidSigningKeys) {\r\n          try {\r\n            const {data} = await createSigningKeys(client)\r\n            signingKeyId = data.id\r\n            signingKeyPrivate = data.private_key\r\n            await saveSecrets(\r\n              client,\r\n              token!,\r\n              secretKey!,\r\n              enableSignedUrls,\r\n              signingKeyId,\r\n              signingKeyPrivate,\r\n              drmConfigId ?? ''\r\n            )\r\n          } catch (err: any) {\r\n            // eslint-disable-next-line no-console\r\n            console.log('Error while creating and saving signing key:', err?.message)\r\n            throw err\r\n          }\r\n        }\r\n      }\r\n      return {\r\n        token,\r\n        secretKey,\r\n        enableSignedUrls,\r\n        signingKeyId,\r\n        signingKeyPrivate,\r\n        drmConfigId,\r\n      }\r\n    },\r\n    [client, secrets]\r\n  )\r\n}\r\n","export const name = 'mux-input' as const\r\n\r\n// Caching namespace, as suspend-react might be in use by other components on the page we must ensure we don't collide\r\nexport const cacheNs = 'sanity-plugin-mux-input' as const\r\n\r\nexport const muxSecretsDocumentId = 'secrets.mux' as const\r\n\r\nexport const DIALOGS_Z_INDEX = 60_000\r\n\r\nexport const THUMBNAIL_ASPECT_RATIO = 16 / 9\r\n\r\n/** To prevent excessive height, thumbnails and input should not go beyond to this aspect ratio. */\r\nexport const MIN_ASPECT_RATIO = 5 / 4\r\n\r\nexport const AUDIO_ASPECT_RATIO = 5 / 1\r\n","import {useMemo} from 'react'\r\nimport {useDocumentValues} from 'sanity'\r\n\r\nimport {muxSecretsDocumentId} from '../util/constants'\r\nimport type {Secrets} from '../util/types'\r\n\r\nconst path = [\r\n  'token',\r\n  'secretKey',\r\n  'enableSignedUrls',\r\n  'signingKeyId',\r\n  'signingKeyPrivate',\r\n  'drmConfigId',\r\n]\r\nexport const useSecretsDocumentValues = () => {\r\n  const {error, isLoading, value} = useDocumentValues<Partial<Secrets> | null | undefined>(\r\n    muxSecretsDocumentId,\r\n    path\r\n  )\r\n  const cache = useMemo(() => {\r\n    const exists = Boolean(value)\r\n    const secrets: Secrets = {\r\n      token: value?.token || null,\r\n      secretKey: value?.secretKey || null,\r\n      enableSignedUrls: value?.enableSignedUrls || false,\r\n      signingKeyId: value?.signingKeyId || null,\r\n      signingKeyPrivate: value?.signingKeyPrivate || null,\r\n      drmConfigId: value?.drmConfigId || null,\r\n    }\r\n    return {\r\n      isInitialSetup: !exists,\r\n      needsSetup: !secrets?.token || !secrets?.secretKey,\r\n      secrets,\r\n    }\r\n  }, [value])\r\n\r\n  return {error, isLoading, value: cache}\r\n}\r\n","import {useReducer} from 'react'\r\n\r\nimport type {Secrets} from '../util/types'\r\n\r\nexport interface State\r\n  extends Pick<Secrets, 'token' | 'secretKey' | 'enableSignedUrls' | 'drmConfigId'> {\r\n  submitting: boolean\r\n  error: string | null\r\n}\r\nexport type Action =\r\n  | {type: 'submit'}\r\n  | {type: 'error'; payload: string}\r\n  | {type: 'reset'; payload: Secrets}\r\n  | {type: 'change'; payload: {name: 'token'; value: string}}\r\n  | {type: 'change'; payload: {name: 'secretKey'; value: string}}\r\n  | {type: 'change'; payload: {name: 'enableSignedUrls'; value: boolean}}\r\n  | {type: 'change'; payload: {name: 'drmConfigId'; value: string}}\r\nfunction init({token, secretKey, enableSignedUrls, drmConfigId}: Secrets): State {\r\n  return {\r\n    submitting: false,\r\n    error: null,\r\n    // Form inputs don't set the state back to null when clearing a field, but uses empty strings\r\n    // This ensures the `dirty` check works correctly\r\n    token: token ?? '',\r\n    secretKey: secretKey ?? '',\r\n    enableSignedUrls: enableSignedUrls ?? false,\r\n    drmConfigId: drmConfigId ?? '',\r\n  }\r\n}\r\nfunction reducer(state: State, action: Action) {\r\n  switch (action?.type) {\r\n    case 'submit':\r\n      return {...state, submitting: true, error: null}\r\n    case 'error':\r\n      return {...state, submitting: false, error: action.payload}\r\n    case 'reset':\r\n      return init(action.payload)\r\n    case 'change':\r\n      return {...state, [action.payload.name]: action.payload.value}\r\n    default:\r\n      throw new Error(`Unknown action type: ${(action as unknown as Action)?.type}`)\r\n  }\r\n}\r\n\r\nexport const useSecretsFormState = (secrets: Secrets) => useReducer(reducer, secrets, init)\r\n","// Utils with a readName prefix are suspendable and should only be called in the render body\r\n// Not inside event callbacks or a useEffect.\r\n// They may be called dynamically, unlike useEffect\r\n\r\n// @TODO rename to readSigningPair\r\n\r\nimport type {SanityClient} from 'sanity'\r\nimport {suspend} from 'suspend-react'\r\n\r\nimport {cacheNs} from '../util/constants'\r\nimport {type Secrets} from '../util/types'\r\n\r\nexport const _id = 'secrets.mux' as const\r\n\r\nexport function readSecrets(client: SanityClient): Secrets {\r\n  const {projectId, dataset} = client.config()\r\n  return suspend(async () => {\r\n    const data = await client.fetch(\r\n      /* groq */ `*[_id == $_id][0]{\r\n        token,\r\n        secretKey,\r\n        enableSignedUrls,\r\n        signingKeyId,\r\n        signingKeyPrivate,\r\n        drmConfigId\r\n      }`,\r\n      {_id}\r\n    )\r\n    return {\r\n      token: data?.token || null,\r\n      secretKey: data?.secretKey || null,\r\n      enableSignedUrls: Boolean(data?.enableSignedUrls) || false,\r\n      signingKeyId: data?.signingKeyId || null,\r\n      signingKeyPrivate: data?.signingKeyPrivate || null,\r\n      drmConfigId: data?.drmConfigId || null,\r\n    }\r\n  }, [cacheNs, _id, projectId, dataset])\r\n}\r\n","import {useTheme_v2} from '@sanity/ui'\r\nimport {CSSProperties, useId, useMemo} from 'react'\r\n\r\nexport interface Props {\r\n  height?: number\r\n}\r\nexport default function MuxLogo({height = 26}: Props) {\r\n  const id = useId()\r\n  const theme = useTheme_v2()\r\n  const fillColor = theme.color._dark ? 'white' : 'black'\r\n  const titleId = useMemo(() => `${id}-title`, [id])\r\n\r\n  const pathStyle: CSSProperties = {\r\n    fillRule: 'nonzero',\r\n  }\r\n\r\n  return (\r\n    <svg\r\n      aria-labelledby={titleId}\r\n      style={{height: `${height}px`}}\r\n      viewBox=\"0 0 1600 500\"\r\n      version=\"1.1\"\r\n      xmlns=\"http://www.w3.org/2000/svg\"\r\n      xmlSpace=\"preserve\"\r\n    >\r\n      <g id=\"Layer-1\" fill={fillColor}>\r\n        <path\r\n          d=\"M994.287,93.486c-17.121,-0 -31,-13.879 -31,-31c0,-17.121 13.879,-31 31,-31c17.121,-0 31,13.879 31,31c0,17.121 -13.879,31 -31,31m0,-93.486c-34.509,-0 -62.484,27.976 -62.484,62.486l0,187.511c0,68.943 -56.09,125.033 -125.032,125.033c-68.942,-0 -125.03,-56.09 -125.03,-125.033l0,-187.511c0,-34.51 -27.976,-62.486 -62.485,-62.486c-34.509,-0 -62.484,27.976 -62.484,62.486l0,187.511c0,137.853 112.149,250.003 249.999,250.003c137.851,-0 250.001,-112.15 250.001,-250.003l0,-187.511c0,-34.51 -27.976,-62.486 -62.485,-62.486\"\r\n          style={pathStyle}\r\n        />\r\n        <path\r\n          d=\"M1537.51,468.511c-17.121,-0 -31,-13.879 -31,-31c0,-17.121 13.879,-31 31,-31c17.121,-0 31,13.879 31,31c0,17.121 -13.879,31 -31,31m-275.883,-218.509l-143.33,143.329c-24.402,24.402 -24.402,63.966 0,88.368c24.402,24.402 63.967,24.402 88.369,-0l143.33,-143.329l143.328,143.329c24.402,24.4 63.967,24.402 88.369,-0c24.403,-24.402 24.403,-63.966 0.001,-88.368l-143.33,-143.329l0.001,-0.004l143.329,-143.329c24.402,-24.402 24.402,-63.965 0,-88.367c-24.402,-24.402 -63.967,-24.402 -88.369,-0l-143.329,143.328l-143.329,-143.328c-24.402,-24.401 -63.967,-24.402 -88.369,-0c-24.402,24.402 -24.402,63.965 0,88.367l143.329,143.329l0,0.004Z\"\r\n          style={pathStyle}\r\n        />\r\n        <path\r\n          d=\"M437.511,468.521c-17.121,-0 -31,-13.879 -31,-31c0,-17.121 13.879,-31 31,-31c17.121,-0 31,13.879 31,31c0,17.121 -13.879,31 -31,31m23.915,-463.762c-23.348,-9.672 -50.226,-4.327 -68.096,13.544l-143.331,143.329l-143.33,-143.329c-17.871,-17.871 -44.747,-23.216 -68.096,-13.544c-23.349,9.671 -38.574,32.455 -38.574,57.729l0,375.026c0,34.51 27.977,62.486 62.487,62.486c34.51,-0 62.486,-27.976 62.486,-62.486l0,-224.173l80.843,80.844c24.404,24.402 63.965,24.402 88.369,-0l80.843,-80.844l0,224.173c0,34.51 27.976,62.486 62.486,62.486c34.51,-0 62.486,-27.976 62.486,-62.486l0,-375.026c0,-25.274 -15.224,-48.058 -38.573,-57.729\"\r\n          style={pathStyle}\r\n        />\r\n      </g>\r\n    </svg>\r\n  )\r\n}\r\n","import {styled} from 'styled-components'\r\n\r\nimport MuxLogo from './MuxLogo'\r\n\r\nconst Logo = styled.span`\r\n  display: inline-block;\r\n  height: 0.8em;\r\n  margin-right: 1em;\r\n  transform: translate(0.3em, -0.2em);\r\n`\r\n\r\nexport const Header = () => (\r\n  <>\r\n    <Logo>\r\n      <MuxLogo height={13} />\r\n    </Logo>\r\n    API Credentials\r\n  </>\r\n)\r\n","import {Box, Flex, Stack, Text} from '@sanity/ui'\r\nimport React, {memo} from 'react'\r\n\r\n// @TODO: get rid of this once v3 core is stable\r\n\r\nexport interface Props {\r\n  children: React.ReactNode\r\n  title: React.ReactNode\r\n  description?: React.ReactNode\r\n  inputId: string\r\n}\r\n\r\nfunction FormField(props: Props) {\r\n  const {children, title, description, inputId} = props\r\n\r\n  return (\r\n    <Stack space={1}>\r\n      <Flex align=\"flex-end\">\r\n        <Box flex={1} paddingY={2}>\r\n          <Stack space={2}>\r\n            <Text as=\"label\" htmlFor={inputId} weight=\"semibold\" size={1}>\r\n              {title || <em>Untitled</em>}\r\n            </Text>\r\n\r\n            {description && (\r\n              <Text muted size={1}>\r\n                {description}\r\n              </Text>\r\n            )}\r\n          </Stack>\r\n        </Box>\r\n      </Flex>\r\n      <div>{children}</div>\r\n    </Stack>\r\n  )\r\n}\r\n\r\nexport default memo(FormField)\r\n","import {\r\n  Box,\r\n  Button,\r\n  Card,\r\n  Checkbox,\r\n  Code,\r\n  Dialog,\r\n  Flex,\r\n  Inline,\r\n  Stack,\r\n  Text,\r\n  TextInput,\r\n} from '@sanity/ui'\r\nimport {useCallback, useEffect, useId, useMemo, useRef} from 'react'\r\nimport {clear, preload} from 'suspend-react'\r\n\r\nimport {useClient} from '../hooks/useClient'\r\nimport type {SetDialogState} from '../hooks/useDialogState'\r\nimport {useDialogState} from '../hooks/useDialogState'\r\nimport {useSaveSecrets} from '../hooks/useSaveSecrets'\r\nimport {useSecretsDocumentValues} from '../hooks/useSecretsDocumentValues'\r\nimport {useSecretsFormState} from '../hooks/useSecretsFormState'\r\nimport {cacheNs, DIALOGS_Z_INDEX} from '../util/constants'\r\nimport {_id as secretsId} from '../util/readSecrets'\r\nimport type {Secrets} from '../util/types'\r\nimport {Header} from './ConfigureApi.styled'\r\nimport FormField from './FormField'\r\n\r\n// Props for the dialog component when used with external state management\r\nexport interface ConfigureApiDialogProps {\r\n  setDialogState: SetDialogState\r\n  secrets: Secrets\r\n}\r\n\r\nconst fieldNames = ['token', 'secretKey', 'enableSignedUrls', 'drmConfigId'] as const\r\n\r\n// Internal dialog component that can be used with external state\r\nexport function ConfigureApiDialog({secrets, setDialogState}: ConfigureApiDialogProps) {\r\n  const client = useClient()\r\n  const [state, dispatch] = useSecretsFormState(secrets)\r\n  const hasSecretsInitially = useMemo(() => secrets.token && secrets.secretKey, [secrets])\r\n  const handleClose = useCallback(() => setDialogState(false), [setDialogState])\r\n  const dirty = useMemo(\r\n    () =>\r\n      secrets.token !== state.token ||\r\n      secrets.secretKey !== state.secretKey ||\r\n      secrets.enableSignedUrls !== state.enableSignedUrls ||\r\n      secrets.drmConfigId !== state.drmConfigId,\r\n    [secrets, state]\r\n  )\r\n  const id = `ConfigureApi${useId()}`\r\n  const [tokenId, secretKeyId, enableSignedUrlsId, drmConfigIdId] = useMemo<typeof fieldNames>(\r\n    () => fieldNames.map((field) => `${id}-${field}`) as unknown as typeof fieldNames,\r\n    [id]\r\n  )\r\n  const firstField = useRef<HTMLInputElement>(null)\r\n  const handleSaveSecrets = useSaveSecrets(client, secrets)\r\n  const saving = useRef(false)\r\n\r\n  const handleSubmit = useCallback(\r\n    (event: React.FormEvent<HTMLFormElement>) => {\r\n      event.preventDefault()\r\n\r\n      if (!saving.current && event.currentTarget.reportValidity()) {\r\n        saving.current = true\r\n        dispatch({type: 'submit'})\r\n        const {token, secretKey, enableSignedUrls, drmConfigId} = state\r\n        handleSaveSecrets({token, secretKey, enableSignedUrls, drmConfigId})\r\n          .then((savedSecrets) => {\r\n            const {projectId, dataset} = client.config()\r\n            clear([cacheNs, secretsId, projectId, dataset])\r\n            preload(() => Promise.resolve(savedSecrets), [cacheNs, secretsId, projectId, dataset])\r\n            setDialogState(false)\r\n          })\r\n          .catch((err) => dispatch({type: 'error', payload: err.message}))\r\n          .finally(() => {\r\n            saving.current = false\r\n          })\r\n      }\r\n    },\r\n    [client, dispatch, handleSaveSecrets, setDialogState, state]\r\n  )\r\n  const handleChangeToken = useCallback(\r\n    (event: React.FormEvent<HTMLInputElement>) => {\r\n      dispatch({\r\n        type: 'change',\r\n        payload: {name: 'token', value: event.currentTarget.value},\r\n      })\r\n    },\r\n    [dispatch]\r\n  )\r\n  const handleChangeSecretKey = useCallback(\r\n    (event: React.FormEvent<HTMLInputElement>) => {\r\n      dispatch({\r\n        type: 'change',\r\n        payload: {name: 'secretKey', value: event.currentTarget.value},\r\n      })\r\n    },\r\n    [dispatch]\r\n  )\r\n  const handleChangeEnableSignedUrls = useCallback(\r\n    (event: React.FormEvent<HTMLInputElement>) => {\r\n      dispatch({\r\n        type: 'change',\r\n        payload: {name: 'enableSignedUrls', value: event.currentTarget.checked},\r\n      })\r\n    },\r\n    [dispatch]\r\n  )\r\n  const handleChangeDrmConfigId = useCallback(\r\n    (event: React.FormEvent<HTMLInputElement>) => {\r\n      dispatch({\r\n        type: 'change',\r\n        payload: {name: 'drmConfigId', value: event.currentTarget.value},\r\n      })\r\n    },\r\n    [dispatch]\r\n  )\r\n\r\n  useEffect(() => {\r\n    if (firstField.current) {\r\n      firstField.current.focus()\r\n    }\r\n  }, [firstField])\r\n\r\n  return (\r\n    <Dialog\r\n      animate\r\n      id={id}\r\n      onClose={handleClose}\r\n      onClickOutside={handleClose}\r\n      header={<Header />}\r\n      zOffset={DIALOGS_Z_INDEX}\r\n      position=\"fixed\"\r\n      width={1}\r\n    >\r\n      <Box padding={3}>\r\n        <form onSubmit={handleSubmit} noValidate>\r\n          <Stack space={4}>\r\n            {!hasSecretsInitially && (\r\n              <Card padding={[3, 3, 3]} radius={2} shadow={1} tone=\"primary\">\r\n                <Stack space={3}>\r\n                  <Text size={1}>\r\n                    To set up a new access token, go to your{' '}\r\n                    <a\r\n                      href=\"https://dashboard.mux.com/settings/access-tokens\"\r\n                      target=\"_blank\"\r\n                      rel=\"noreferrer noopener\"\r\n                    >\r\n                      account on mux.com\r\n                    </a>\r\n                    .\r\n                  </Text>\r\n                  <Text size={1}>\r\n                    The access token needs permissions: <strong>Mux Video </strong>\r\n                    (Full Access) and <strong>Mux Data</strong> (Read)\r\n                    <br />\r\n                    To use Signed URLs, the token must also have System permissions.\r\n                    <br />\r\n                    The credentials will be stored safely in a hidden document only available to\r\n                    editors.\r\n                  </Text>\r\n                </Stack>\r\n              </Card>\r\n            )}\r\n            <FormField title=\"Access Token\" inputId={tokenId}>\r\n              <TextInput\r\n                id={tokenId}\r\n                ref={firstField}\r\n                onChange={handleChangeToken}\r\n                type=\"text\"\r\n                value={state.token ?? ''}\r\n                required={!!state.secretKey || state.enableSignedUrls}\r\n              />\r\n            </FormField>\r\n            <FormField title=\"Secret Key\" inputId={secretKeyId}>\r\n              <TextInput\r\n                id={secretKeyId}\r\n                onChange={handleChangeSecretKey}\r\n                type=\"text\"\r\n                value={state.secretKey ?? ''}\r\n                required={!!state.token || state.enableSignedUrls}\r\n              />\r\n            </FormField>\r\n\r\n            <Stack space={4}>\r\n              <Flex align=\"center\">\r\n                <Checkbox\r\n                  id={enableSignedUrlsId}\r\n                  onChange={handleChangeEnableSignedUrls}\r\n                  checked={state.enableSignedUrls}\r\n                  style={{display: 'block'}}\r\n                />\r\n                <Box flex={1} paddingLeft={3}>\r\n                  <Text>\r\n                    <label htmlFor={enableSignedUrlsId}>Enable Signed Urls</label>\r\n                  </Text>\r\n                </Box>\r\n              </Flex>\r\n              {secrets.signingKeyId && state.enableSignedUrls ? (\r\n                <Card padding={[3, 3, 3]} radius={2} shadow={1} tone=\"caution\">\r\n                  <Stack space={3}>\r\n                    <Text size={1}>The signing key ID that Sanity will use is:</Text>\r\n                    <Code size={1}>{secrets.signingKeyId}</Code>\r\n                    <Text size={1}>\r\n                      This key is only used for previewing content in the Sanity UI.\r\n                      <br />\r\n                      You should generate a different key to use in your application server.\r\n                    </Text>\r\n                  </Stack>\r\n                </Card>\r\n              ) : null}\r\n            </Stack>\r\n\r\n            <FormField title=\"DRM Configuration ID\" inputId={drmConfigIdId}>\r\n              <TextInput\r\n                id={drmConfigIdId}\r\n                onChange={handleChangeDrmConfigId}\r\n                type=\"text\"\r\n                value={state.drmConfigId ?? ''}\r\n                required={false}\r\n              />\r\n            </FormField>\r\n            <Card padding={[3, 3, 3]} radius={2} shadow={1} tone=\"neutral\">\r\n              <Stack space={3}>\r\n                <Text size={1}>\r\n                  DRM (Digital Rights Management) provides an extra layer of content security for\r\n                  video content streamed from Mux. For additional information check out our{' '}\r\n                  <a\r\n                    href=\"https://www.mux.com/docs/guides/protect-videos-with-drm#play-drm-protected-videos\"\r\n                    target=\"_blank\"\r\n                    rel=\"noopener noreferrer\"\r\n                  >\r\n                    DRM Guide\r\n                  </a>\r\n                  .\r\n                </Text>\r\n                <Text size={1}>\r\n                  <a\r\n                    href=\"https://www.mux.com/support/human\"\r\n                    target=\"_blank\"\r\n                    rel=\"noopener noreferrer\"\r\n                  >\r\n                    Contact us\r\n                  </a>{' '}\r\n                  to get started using DRM.\r\n                </Text>\r\n              </Stack>\r\n            </Card>\r\n\r\n            <Inline space={2}>\r\n              <Button\r\n                text=\"Save\"\r\n                disabled={!dirty}\r\n                loading={state.submitting}\r\n                tone=\"primary\"\r\n                mode=\"default\"\r\n                type=\"submit\"\r\n              />\r\n              <Button\r\n                disabled={state.submitting}\r\n                text=\"Cancel\"\r\n                mode=\"bleed\"\r\n                onClick={handleClose}\r\n              />\r\n            </Inline>\r\n            {state.error && (\r\n              <Card padding={[3, 3, 3]} radius={2} shadow={1} tone=\"critical\">\r\n                <Text>{state.error}</Text>\r\n              </Card>\r\n            )}\r\n          </Stack>\r\n        </form>\r\n      </Box>\r\n    </Dialog>\r\n  )\r\n}\r\n\r\n// Wrapper component that manages its own dialog state (used in VideosBrowser)\r\nexport default function ConfigureApi() {\r\n  const [dialogOpen, setDialogOpen] = useDialogState()\r\n  const secretDocumentValues = useSecretsDocumentValues()\r\n\r\n  const openDialog = useCallback(() => setDialogOpen('secrets'), [setDialogOpen])\r\n\r\n  if (dialogOpen === 'secrets') {\r\n    return (\r\n      <ConfigureApiDialog\r\n        secrets={secretDocumentValues.value.secrets}\r\n        setDialogState={setDialogOpen}\r\n      />\r\n    )\r\n  }\r\n\r\n  return <Button mode=\"bleed\" text=\"Configure plugin\" onClick={openDialog} />\r\n}\r\n","import {truncateString} from 'sanity'\r\n\r\n/**\r\n * Generates a placeholder title for a Mux asset when no title is available.\r\n * This format is used when importing assets that don't have a title in Mux.\r\n *\r\n * @param assetId - The Mux asset ID\r\n * @returns A placeholder title in the format \"Asset #[truncated-id]\"\r\n */\r\nexport function generateAssetPlaceholder(assetId: string): string {\r\n  return `Asset #${truncateString(assetId, 15)}`\r\n}\r\n\r\n/**\r\n * Checks if a filename is empty or has the placeholder format.\r\n * This is used to determine if a video title should be updated during metadata sync.\r\n *\r\n * @param filename - The current filename/title of the video\r\n * @param assetId - The Mux asset ID to check against\r\n * @returns true if the filename is empty or matches the placeholder format\r\n */\r\nexport function isEmptyOrPlaceholderTitle(filename: string | undefined, assetId: string): boolean {\r\n  // Check if filename is empty/undefined\r\n  if (!filename || filename.trim() === '') {\r\n    return true\r\n  }\r\n\r\n  // Check if filename matches the placeholder format for this asset\r\n  const placeholder = generateAssetPlaceholder(assetId)\r\n  return filename === placeholder\r\n}\r\n","import type {MuxAsset} from './types'\r\n\r\nexport function parseMuxDate(date: MuxAsset['created_at']): Date {\r\n  return new Date(Number(date) * 1000)\r\n}\r\n","import type {SanityClient} from 'sanity'\r\n\r\nimport type {MuxAsset, VideoAssetDocument} from '../util/types'\r\n\r\nexport function deleteAssetOnMux(client: SanityClient, assetId: string) {\r\n  const {dataset} = client.config()\r\n  return client.request<void>({\r\n    url: `/addons/mux/assets/${dataset}/${assetId}`,\r\n    withCredentials: true,\r\n    method: 'DELETE',\r\n  })\r\n}\r\n\r\nexport async function deleteAsset({\r\n  client,\r\n  asset,\r\n  deleteOnMux,\r\n}: {\r\n  client: SanityClient\r\n  asset: VideoAssetDocument\r\n  deleteOnMux: boolean\r\n}) {\r\n  if (!asset?._id) return true\r\n\r\n  try {\r\n    await client.delete(asset._id)\r\n  } catch (error) {\r\n    return 'failed-sanity'\r\n  }\r\n\r\n  if (deleteOnMux && asset?.assetId) {\r\n    try {\r\n      await deleteAssetOnMux(client, asset.assetId)\r\n    } catch (error) {\r\n      return 'failed-mux'\r\n    }\r\n  }\r\n\r\n  return true\r\n}\r\n\r\nexport function getAsset(client: SanityClient, assetId: string) {\r\n  const {dataset} = client.config()\r\n  return client.request<{data: MuxAsset}>({\r\n    url: `/addons/mux/assets/${dataset}/data/${assetId}`,\r\n    withCredentials: true,\r\n    method: 'GET',\r\n  })\r\n}\r\n\r\nexport function listAssets(\r\n  client: SanityClient,\r\n  options: {limit?: number; cursor?: string | null}\r\n) {\r\n  const {dataset} = client.config()\r\n  const query: {limit?: string; cursor?: string} = {}\r\n\r\n  if (options.limit) {\r\n    query.limit = options.limit.toString()\r\n  }\r\n  if (options.cursor) {\r\n    query.cursor = options.cursor\r\n  }\r\n\r\n  return client.request<{data: MuxAsset[]; next_cursor?: string | null}>({\r\n    url: `/addons/mux/assets/${dataset}/data/list`,\r\n    withCredentials: true,\r\n    method: 'GET',\r\n    query,\r\n  })\r\n}\r\n\r\n/**\r\n * Adds a new text track to an existing asset using a VTT file URL\r\n */\r\nexport function addTextTrackFromUrl(\r\n  client: SanityClient,\r\n  assetId: string,\r\n  vttUrl: string,\r\n  options: {\r\n    language_code: string\r\n    name: string\r\n    text_type?: 'subtitles'\r\n  }\r\n) {\r\n  const {dataset} = client.config()\r\n\r\n  return client.request<{data: MuxAsset}>({\r\n    url: `/addons/mux/assets/${dataset}/${assetId}/tracks`,\r\n    withCredentials: true,\r\n    method: 'POST',\r\n    body: {\r\n      url: vttUrl,\r\n      type: 'text',\r\n      language_code: options.language_code,\r\n      name: options.name,\r\n      text_type: options.text_type || 'subtitles',\r\n    },\r\n    headers: {\r\n      'Content-Type': 'application/json',\r\n    },\r\n  })\r\n}\r\n\r\n/**\r\n * Generates subtitles automatically for an audio track\r\n */\r\nexport function generateSubtitles(\r\n  client: SanityClient,\r\n  assetId: string,\r\n  audioTrackId: string,\r\n  options: {\r\n    language_code: string\r\n    name: string\r\n  }\r\n) {\r\n  const {dataset} = client.config()\r\n  return client.request<{data: MuxAsset}>({\r\n    url: `/addons/mux/assets/${dataset}/${assetId}/tracks/${audioTrackId}/generate-subtitles`,\r\n    withCredentials: true,\r\n    method: 'POST',\r\n    body: {\r\n      generated_subtitles: [\r\n        {\r\n          language_code: options.language_code,\r\n          name: options.name,\r\n        },\r\n      ],\r\n    },\r\n    headers: {\r\n      'Content-Type': 'application/json',\r\n    },\r\n  })\r\n}\r\n\r\n/**\r\n * Deletes a text track from an asset\r\n */\r\nexport function deleteTextTrack(client: SanityClient, assetId: string, trackId: string) {\r\n  const {dataset} = client.config()\r\n  return client.request<{data: MuxAsset}>({\r\n    url: `/addons/mux/assets/${dataset}/${assetId}/tracks/${trackId}`,\r\n    withCredentials: true,\r\n    method: 'DELETE',\r\n  })\r\n}\r\n\r\n/**\r\n * Updates master access on a Mux asset.\r\n */\r\nexport async function updateMasterAccess(\r\n  client: SanityClient,\r\n  assetId: string,\r\n  masterAccess: 'temporary' | 'none'\r\n) {\r\n  const fpCredentials = await client.fetch<{fpMuxProxyUrl: string, fpMuxProxyApiKey: string}>(`*[_id == \"secrets.fullphysio\"][0]`)\r\n  return fetch(fpCredentials.fpMuxProxyUrl, {\r\n    method: 'PUT',\r\n    headers: {\r\n      'Content-Type': 'application/json',\r\n      'x-api-key': fpCredentials.fpMuxProxyApiKey,\r\n    },\r\n    body: JSON.stringify({\r\n      asset_id: assetId,\r\n      master_access: masterAccess,\r\n    }),\r\n  });\r\n}","import {useEffect, useState} from 'react'\r\nimport {defer, of, timer} from 'rxjs'\r\nimport {concatMap, expand, tap} from 'rxjs/operators'\r\nimport type {SanityClient} from 'sanity'\r\n\r\nimport {listAssets} from '../actions/assets'\r\nimport type {MuxAsset} from '../util/types'\r\n\r\nconst ASSETS_PER_PAGE = 100\r\n\r\ntype MuxAssetsState = {\r\n  cursor: string | null\r\n  loading: boolean\r\n  data?: MuxAsset[]\r\n  error?: FetchError\r\n  hasSkippedAssetsWithoutPlayback?: boolean\r\n}\r\n\r\ntype FetchError =\r\n  | {\r\n      _tag: 'FetchError'\r\n    }\r\n  | {_tag: 'MuxError'; error: unknown}\r\n\r\ntype PageResult = (\r\n  | {\r\n      data: MuxAsset[]\r\n      next_cursor: string | null\r\n    }\r\n  | {\r\n      error: FetchError\r\n    }\r\n) & {\r\n  cursor: string | null\r\n}\r\n\r\n/**\r\n * @docs {@link https://docs.mux.com/api-reference#video/operation/list-assets}\r\n */\r\nasync function fetchMuxAssetsPage(\r\n  client: SanityClient,\r\n  cursor: string | null\r\n): Promise<PageResult> {\r\n  try {\r\n    const response = await listAssets(client, {\r\n      limit: ASSETS_PER_PAGE,\r\n      cursor,\r\n    })\r\n\r\n    return {\r\n      cursor,\r\n      data: response.data as MuxAsset[],\r\n      next_cursor: response.next_cursor || null,\r\n    }\r\n  } catch (error) {\r\n    return {\r\n      cursor,\r\n      error: {_tag: 'FetchError'},\r\n    }\r\n  }\r\n}\r\n\r\nfunction accumulateIntermediateState(\r\n  currentState: MuxAssetsState,\r\n  pageResult: PageResult\r\n): MuxAssetsState {\r\n  const currentData = ('data' in currentState && currentState.data) || []\r\n  const newAssets = ('data' in pageResult && pageResult.data) || []\r\n\r\n  // Filter assets and check for skipped items\r\n  const {validAssets, skippedInThisPage} = newAssets.reduce<{\r\n    validAssets: MuxAsset[]\r\n    skippedInThisPage: boolean\r\n  }>(\r\n    (acc, asset) => {\r\n      const hasPlaybackIds = asset.playback_ids && asset.playback_ids.length > 0\r\n      const isDuplicate = currentData.some((a) => a.id === asset.id)\r\n\r\n      if (!hasPlaybackIds) {\r\n        acc.skippedInThisPage = true\r\n      }\r\n\r\n      if (hasPlaybackIds && !isDuplicate) {\r\n        acc.validAssets.push(asset)\r\n      }\r\n\r\n      return acc\r\n    },\r\n    {validAssets: [], skippedInThisPage: false}\r\n  )\r\n\r\n  return {\r\n    ...currentState,\r\n    data: [...currentData, ...validAssets],\r\n    error:\r\n      'error' in pageResult\r\n        ? pageResult.error\r\n        : // Reset error if current page is successful\r\n          undefined,\r\n    cursor: 'next_cursor' in pageResult ? pageResult.next_cursor : pageResult.cursor,\r\n    loading: true,\r\n    hasSkippedAssetsWithoutPlayback:\r\n      currentState.hasSkippedAssetsWithoutPlayback || skippedInThisPage,\r\n  }\r\n}\r\n\r\nfunction hasMorePages(pageResult: PageResult) {\r\n  return (\r\n    typeof pageResult === 'object' && 'next_cursor' in pageResult && pageResult.next_cursor !== null\r\n  )\r\n}\r\n\r\n/**\r\n * Fetches all assets from a Mux environment. Rules:\r\n * - One page at a time\r\n * - Uses cursor-based pagination\r\n *   - We've finished fetching when `next_cursor` is null\r\n * - Rate limiting to one request per 2 seconds\r\n * - Update state while still fetching to give feedback to users\r\n */\r\nexport default function useMuxAssets({client, enabled}: {client: SanityClient; enabled: boolean}) {\r\n  const [state, setState] = useState<MuxAssetsState>({loading: true, cursor: null})\r\n\r\n  useEffect(() => {\r\n    if (!enabled) return\r\n\r\n    const subscription = defer(() =>\r\n      fetchMuxAssetsPage(\r\n        client,\r\n        // When we've already successfully loaded before (fully or partially), we start from the next cursor to avoid re-fetching\r\n        'data' in state && state.data && state.data.length > 0 && !state.error ? state.cursor : null\r\n      )\r\n    )\r\n      .pipe(\r\n        // Here we use \"expand\" to recursively fetch next pages\r\n        expand((pageResult) => {\r\n          // if fetched page has next_cursor, we continue emitting, requesting the next page\r\n          // after 2s to avoid rate limiting\r\n          if (hasMorePages(pageResult)) {\r\n            return timer(2000).pipe(\r\n              concatMap(() =>\r\n                // eslint-disable-next-line max-nested-callbacks\r\n                defer(() =>\r\n                  fetchMuxAssetsPage(\r\n                    client,\r\n                    'next_cursor' in pageResult ? pageResult.next_cursor : null\r\n                  )\r\n                )\r\n              )\r\n            )\r\n          }\r\n\r\n          // Else, we stop emitting\r\n          return of()\r\n        }),\r\n\r\n        // On each iteration, persist intermediate states to give feedback to users\r\n        tap((pageResult) =>\r\n          setState((prevState) => accumulateIntermediateState(prevState, pageResult))\r\n        )\r\n      )\r\n      .subscribe({\r\n        // Once done, let the user know we've stopped loading\r\n        complete: () => {\r\n          setState((prev) => ({\r\n            ...prev,\r\n            loading: false,\r\n          }))\r\n        },\r\n      })\r\n\r\n    // Unsubscribe on component unmount to prevent memory leaks or fetching unnecessarily\r\n    // eslint-disable-next-line consistent-return\r\n    return () => subscription.unsubscribe()\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [enabled])\r\n\r\n  return state\r\n}\r\n","import {uuid} from '@sanity/uuid'\r\nimport {useMemo, useState} from 'react'\r\nimport {\r\n  createHookFromObservableFactory,\r\n  type DocumentStore,\r\n  useClient,\r\n  useDocumentStore,\r\n} from 'sanity'\r\n\r\nimport {generateAssetPlaceholder} from '../util/assetTitlePlaceholder'\r\nimport {parseMuxDate} from '../util/parsers'\r\nimport type {MuxAsset, VideoAssetDocument} from '../util/types'\r\nimport {SANITY_API_VERSION} from './useClient'\r\nimport useMuxAssets from './useMuxAssets'\r\nimport {useSecretsDocumentValues} from './useSecretsDocumentValues'\r\n\r\ntype ImportState = 'closed' | 'idle' | 'importing' | 'done' | 'error'\r\n\r\nexport type AssetInSanity = {\r\n  uploadId: string\r\n  assetId: string\r\n}\r\n\r\nexport default function useImportMuxAssets() {\r\n  const documentStore = useDocumentStore()\r\n  const client = useClient({\r\n    apiVersion: SANITY_API_VERSION,\r\n  })\r\n\r\n  const [assetsInSanity, assetsInSanityLoading] = useAssetsInSanity(documentStore)\r\n\r\n  const secretDocumentValues = useSecretsDocumentValues()\r\n  const hasSecrets = !!secretDocumentValues.value.secrets?.secretKey\r\n\r\n  const [importError, setImportError] = useState<unknown>()\r\n  const [importState, setImportState] = useState<ImportState>('closed')\r\n  const dialogOpen = importState !== 'closed'\r\n\r\n  const muxAssets = useMuxAssets({\r\n    client,\r\n    enabled: hasSecrets && dialogOpen,\r\n  })\r\n\r\n  const missingAssets = useMemo(() => {\r\n    return assetsInSanity && muxAssets.data\r\n      ? muxAssets.data.filter((a) => !assetExistsInSanity(a, assetsInSanity))\r\n      : undefined\r\n  }, [assetsInSanity, muxAssets.data])\r\n\r\n  const [selectedAssets, setSelectedAssets] = useState<MuxAsset[]>([])\r\n\r\n  const closeDialog = () => {\r\n    if (importState !== 'importing') setImportState('closed')\r\n  }\r\n  const openDialog = () => {\r\n    if (importState === 'closed') setImportState('idle')\r\n  }\r\n\r\n  async function importAssets() {\r\n    setImportState('importing')\r\n    const documents = selectedAssets.flatMap((asset) => muxAssetToSanityDocument(asset) || [])\r\n\r\n    const tx = client.transaction()\r\n    documents.forEach((doc) => tx.create(doc))\r\n\r\n    try {\r\n      await tx.commit({returnDocuments: false})\r\n      setSelectedAssets([])\r\n      setImportState('done')\r\n    } catch (error) {\r\n      setImportState('error')\r\n      setImportError(error)\r\n    }\r\n  }\r\n\r\n  return {\r\n    assetsInSanityLoading,\r\n    closeDialog,\r\n    dialogOpen,\r\n    importState,\r\n    importError,\r\n    hasSecrets,\r\n    importAssets,\r\n    missingAssets,\r\n    muxAssets,\r\n    openDialog,\r\n    selectedAssets,\r\n    setSelectedAssets,\r\n  }\r\n}\r\n\r\nfunction muxAssetToSanityDocument(asset: MuxAsset): VideoAssetDocument | undefined {\r\n  const playbackId = (asset.playback_ids || []).find((p) => p.id)?.id\r\n\r\n  if (!playbackId) return undefined\r\n\r\n  return {\r\n    _id: uuid(),\r\n    _type: 'mux.videoAsset',\r\n    _updatedAt: new Date().toISOString(),\r\n    _createdAt: parseMuxDate(asset.created_at).toISOString(),\r\n    assetId: asset.id,\r\n    playbackId,\r\n    filename: asset.meta?.title ?? generateAssetPlaceholder(asset.id),\r\n    status: asset.status,\r\n    data: asset,\r\n  }\r\n}\r\n\r\nconst useAssetsInSanity = createHookFromObservableFactory<AssetInSanity[], DocumentStore>(\r\n  (documentStore) => {\r\n    return documentStore.listenQuery(\r\n      /* groq */ `*[_type == \"mux.videoAsset\"] {\r\n      \"uploadId\": coalesce(uploadId, data.upload_id),\r\n      \"assetId\": coalesce(assetId, data.id),\r\n    }`,\r\n      {},\r\n      {\r\n        apiVersion: SANITY_API_VERSION,\r\n      }\r\n    )\r\n  }\r\n)\r\n\r\nfunction assetExistsInSanity(asset: MuxAsset, existingAssets: AssetInSanity[]) {\r\n  // Don't allow importing assets that are not ready\r\n  if (asset.status !== 'ready') return false\r\n\r\n  return existingAssets.some(\r\n    (existing) => existing.assetId === asset.id || existing.uploadId === asset.upload_id\r\n  )\r\n}\r\n","import {useEffect, useState} from 'react'\r\n\r\ntype IntersectionOptions = {\r\n  root?: Element | null\r\n  rootMargin?: string\r\n  threshold?: number\r\n  onChange?: (inView: boolean) => void\r\n}\r\n\r\nexport function useInView(\r\n  ref: React.RefObject<HTMLDivElement | null>,\r\n  options: IntersectionOptions = {}\r\n) {\r\n  const [inView, setInView] = useState(false)\r\n\r\n  useEffect(() => {\r\n    if (!ref.current) return\r\n\r\n    const observer = new IntersectionObserver(([entry], obs) => {\r\n      // ==== from react-intersection-observer ====\r\n      // While it would be nice if you could just look at isIntersecting to determine if the component is inside the viewport, browsers can't agree on how to use it.\r\n      // -Firefox ignores `threshold` when considering `isIntersecting`, so it will never be false again if `threshold` is > 0\r\n      const nowInView =\r\n        entry.isIntersecting &&\r\n        obs.thresholds.some((threshold) => entry.intersectionRatio >= threshold)\r\n\r\n      // Update our state when observer callback fires\r\n      setInView(nowInView)\r\n      options?.onChange?.(nowInView)\r\n    }, options)\r\n\r\n    const toObserve = ref.current\r\n    observer.observe(toObserve)\r\n\r\n    // eslint-disable-next-line\r\n    return () => {\r\n      if (toObserve) observer.unobserve(toObserve)\r\n    }\r\n  }, [options, ref])\r\n\r\n  return inView\r\n}\r\n","import type {\r\n  AdvancedPlaybackPolicy,\r\n  MuxPlaybackId,\r\n  PlaybackPolicy,\r\n  VideoAssetDocument,\r\n} from './types'\r\n\r\n/* - Returns the playback id of the asset based on the specified priority.\r\n  By default chooses the \"strongest\" policy\r\n   - Otherwise, returns the first playback id in the array.\r\n   */\r\nexport function getPlaybackId(\r\n  asset: Pick<VideoAssetDocument, 'data'>,\r\n  priority: string[] = ['drm', 'signed', 'public']\r\n): string {\r\n  try {\r\n    if (!asset) {\r\n      throw new TypeError('Tried to get playback Id with no asset')\r\n    }\r\n\r\n    const playbackIds = asset.data?.playback_ids\r\n    if (playbackIds && playbackIds.length > 0) {\r\n      for (const policy of priority) {\r\n        const match = playbackIds.find((entry) => entry.policy === policy)\r\n        if (match) {\r\n          return match.id\r\n        }\r\n      }\r\n\r\n      return playbackIds[0].id\r\n    }\r\n\r\n    throw new TypeError('Missing playbackId')\r\n  } catch (e) {\r\n    console.error('Asset is missing a playbackId', {asset}, e)\r\n    throw e\r\n  }\r\n}\r\n\r\nexport function getPlaybackPolicy(\r\n  asset: Pick<VideoAssetDocument, 'data' | 'playbackId'>\r\n): MuxPlaybackId | undefined {\r\n  return (\r\n    asset.data?.playback_ids?.find(\r\n      (playbackId) => getPlaybackId(asset, ['drm', 'signed', 'public']) === playbackId.id\r\n    ) ?? {id: '', policy: 'public'}\r\n  )\r\n}\r\n\r\nexport function getPlaybackPolicyById(\r\n  asset: Pick<VideoAssetDocument, 'data'>,\r\n  playbackId: string\r\n): MuxPlaybackId | undefined {\r\n  return asset.data?.playback_ids?.find((entry) => playbackId === entry.id)\r\n}\r\n\r\nexport function hasPlaybackPolicy(\r\n  data: Partial<{\r\n    playback_policy?: PlaybackPolicy[]\r\n    advanced_playback_policies: AdvancedPlaybackPolicy[]\r\n  }>,\r\n  policy: PlaybackPolicy\r\n) {\r\n  return (\r\n    (data.advanced_playback_policies &&\r\n      data.advanced_playback_policies.find((p) => p.policy === policy)) ||\r\n    data.playback_policy?.find((p) => p === policy)\r\n  )\r\n}\r\n","import type {SanityClient} from 'sanity'\r\nimport {suspend} from 'suspend-react'\r\n\r\nimport {readSecrets} from './readSecrets'\r\nimport type {AnimatedThumbnailOptions, ThumbnailOptions} from './types'\r\n\r\nexport type Audience = 'g' | 's' | 't' | 'v' | 'd'\r\n\r\nexport type Payload<T extends Audience> = T extends 'g'\r\n  ? AnimatedThumbnailOptions\r\n  : T extends 's'\r\n    ? never\r\n    : T extends 't'\r\n      ? ThumbnailOptions\r\n      : T extends 'v'\r\n        ? never\r\n        : T extends 'd'\r\n          ? never\r\n          : never\r\n\r\n/**\r\n * Uses suspend. Call this with {@link tryWithSuspend} or rethrow the Promise\r\n */\r\nexport function generateJwt<T extends Audience>(\r\n  client: SanityClient,\r\n  playbackId: string,\r\n  aud: T,\r\n  payload?: Payload<T>\r\n): string {\r\n  const {signingKeyId, signingKeyPrivate} = readSecrets(client)\r\n  if (!signingKeyId) {\r\n    throw new TypeError(\"Missing `signingKeyId`.\\n Check your plugin's configuration\")\r\n  }\r\n  if (!signingKeyPrivate) {\r\n    throw new TypeError(\"Missing `signingKeyPrivate`.\\n Check your plugin's configuration\")\r\n  }\r\n\r\n  /* Using suspend means we need to use Suspense on parent components. \r\n  Also, this will throw a Promise under the hood (apparently common in React), \r\n  so if we want to catch errors we have to take this into account in catch blocks\r\n  and rethrow promises. */\r\n  // @ts-expect-error - handle missing typings for this package\r\n  const {default: sign} = suspend(() => import('jsonwebtoken-esm/sign'), ['jsonwebtoken-esm/sign'])\r\n\r\n  return sign(\r\n    payload ? JSON.parse(JSON.stringify(payload, (_, v) => v ?? undefined)) : {},\r\n    atob(signingKeyPrivate),\r\n    {\r\n      algorithm: 'RS256',\r\n      keyid: signingKeyId,\r\n      audience: aud,\r\n      subject: playbackId,\r\n      noTimestamp: true,\r\n      expiresIn: '12h',\r\n    }\r\n  )\r\n}\r\n","import type {SanityClient} from 'sanity'\r\n\r\nimport {getPlaybackId} from '../util/getPlaybackPolicy'\r\nimport {Audience, generateJwt} from './generateJwt'\r\nimport {getPlaybackPolicyById} from './getPlaybackPolicy'\r\nimport type {AssetThumbnailOptions} from './types'\r\n\r\n/**\r\n * May throw a Promise. Call this with {@link tryWithSuspend} or rethrow the Promise\r\n */\r\nexport function createUrlParamsObject(\r\n  client: SanityClient,\r\n  asset: AssetThumbnailOptions['asset'],\r\n  params: object,\r\n  audience: Audience\r\n) {\r\n  const playbackId = getPlaybackId(asset)\r\n\r\n  let searchParams = new URLSearchParams(\r\n    JSON.parse(JSON.stringify(params, (_, v) => v ?? undefined))\r\n  )\r\n  const playbackPolicy = getPlaybackPolicyById(asset, playbackId)?.policy\r\n  if (playbackPolicy === 'signed' || playbackPolicy === 'drm') {\r\n    const token = generateJwt(client, playbackId, audience, params)\r\n    searchParams = new URLSearchParams({token})\r\n  }\r\n\r\n  return {playbackId, searchParams}\r\n}\r\n","import type {SanityClient} from 'sanity'\r\n\r\nimport {createUrlParamsObject} from './createUrlParamsObject'\r\nimport type {AnimatedThumbnailOptions, MuxAnimatedThumbnailUrl} from './types'\r\nimport {AssetThumbnailOptions} from './types'\r\n\r\nexport interface AnimatedPosterSrcOptions extends AnimatedThumbnailOptions {\r\n  asset: AssetThumbnailOptions['asset']\r\n  client: SanityClient\r\n}\r\n\r\nexport function getAnimatedPosterSrc({\r\n  asset,\r\n  client,\r\n  height,\r\n  width,\r\n  start = asset.thumbTime ? Math.max(0, asset.thumbTime - 2.5) : 0,\r\n  end = start + 5,\r\n  fps = 15,\r\n}: AnimatedPosterSrcOptions): MuxAnimatedThumbnailUrl {\r\n  const params = {height, width, start, end, fps}\r\n\r\n  const {playbackId, searchParams} = createUrlParamsObject(client, asset, params, 'g')\r\n\r\n  return `https://image.mux.com/${playbackId}/animated.gif?${searchParams}`\r\n}\r\n","import type {SanityClient} from 'sanity'\r\n\r\nimport {createUrlParamsObject} from './createUrlParamsObject'\r\nimport type {MuxThumbnailUrl, ThumbnailOptions} from './types'\r\nimport {AssetThumbnailOptions} from './types'\r\n\r\nexport interface PosterSrcOptions extends ThumbnailOptions {\r\n  asset: AssetThumbnailOptions['asset']\r\n  client: SanityClient\r\n}\r\n\r\nexport function getPosterSrc({\r\n  asset,\r\n  client,\r\n  fit_mode,\r\n  height,\r\n  time = asset.thumbTime ?? undefined,\r\n  width,\r\n}: PosterSrcOptions): MuxThumbnailUrl {\r\n  const params = {fit_mode, height, width}\r\n  if (time !== undefined) {\r\n    ;(params as any).time = time\r\n  }\r\n\r\n  const {playbackId, searchParams} = createUrlParamsObject(client, asset, params, 't')\r\n\r\n  return `https://image.mux.com/${playbackId}/thumbnail.png?${searchParams}`\r\n}\r\n","/**\r\n * When running `suspend()` from react-suspend a function may throw a Promise\r\n * causing unexpected behavior when catching.\r\n * @param block Your block of code that uses suspend\r\n * @param onError (optional) How to handle a regular Error\r\n * @returns Whatever is returned by the block if it succeeds, otherwise whatever is resolved by onError if defined\r\n * @throws rethrows the caught Promise to comply with Suspense logic\r\n */\r\nexport function tryWithSuspend<T, E>(\r\n  block: () => T,\r\n  onError?: (error: Error) => E\r\n): T | E | undefined {\r\n  try {\r\n    return block()\r\n  } catch (errorOrPromise) {\r\n    if (errorOrPromise instanceof Promise) {\r\n      // react-suspend will throw a Promise\r\n      throw errorOrPromise\r\n    }\r\n    return onError ? onError(errorOrPromise as Error) : undefined\r\n  }\r\n}\r\n","import {ErrorOutlineIcon} from '@sanity/icons'\r\nimport {Box, Card, CardTone, Spinner, Stack, Text} from '@sanity/ui'\r\nimport {Suspense, useMemo, useRef, useState} from 'react'\r\nimport {styled} from 'styled-components'\r\n\r\nimport {useClient} from '../hooks/useClient'\r\nimport {useInView} from '../hooks/useInView'\r\nimport {THUMBNAIL_ASPECT_RATIO} from '../util/constants'\r\nimport {getAnimatedPosterSrc} from '../util/getAnimatedPosterSrc'\r\nimport {getPosterSrc} from '../util/getPosterSrc'\r\nimport {tryWithSuspend} from '../util/tryWithSuspend'\r\nimport {AssetThumbnailOptions, MuxAnimatedThumbnailUrl, MuxThumbnailUrl} from '../util/types'\r\n\r\nconst Image = styled.img`\r\n  transition: opacity 0.175s ease-out 0s;\r\n  display: block;\r\n  width: 100%;\r\n  height: 100%;\r\n  object-fit: contain;\r\n  object-position: center center;\r\n`\r\n\r\ntype ImageStatus = 'loading' | 'error' | 'loaded'\r\n\r\nconst STATUS_TO_TONE: Record<ImageStatus, CardTone> = {\r\n  loading: 'transparent',\r\n  error: 'critical',\r\n  loaded: 'default',\r\n}\r\n\r\nexport default function VideoThumbnail({\r\n  asset,\r\n  width,\r\n  staticImage = false,\r\n}: {\r\n  asset: AssetThumbnailOptions['asset']\r\n  width?: number\r\n  staticImage?: boolean\r\n}) {\r\n  const posterWidth = width || 250\r\n  const client = useClient()\r\n  const ref = useRef<HTMLDivElement | null>(null)\r\n  const inView = useInView(ref)\r\n\r\n  const [status, setStatus] = useState<ImageStatus>('loading')\r\n  const [error, setError] = useState<string | null>(null)\r\n\r\n  const thumbnailSrc = useMemo(() => {\r\n    return tryWithSuspend(\r\n      () => {\r\n        let thumbnail: MuxAnimatedThumbnailUrl | MuxThumbnailUrl | undefined\r\n\r\n        if (staticImage) thumbnail = getPosterSrc({asset, client, width: posterWidth})\r\n        else thumbnail = getAnimatedPosterSrc({asset, client, width: posterWidth})\r\n        return thumbnail\r\n      },\r\n      (err: Error) => {\r\n        handleError(err.message)\r\n        return undefined\r\n      }\r\n    )\r\n  }, [asset, client, posterWidth, staticImage])\r\n\r\n  function handleLoad() {\r\n    setStatus('loaded')\r\n  }\r\n\r\n  function handleError(err?: string) {\r\n    setStatus('error')\r\n    if (err) {\r\n      setError(err)\r\n    } else {\r\n      setError('Failed loading thumbnail')\r\n    }\r\n  }\r\n\r\n  return (\r\n    <Suspense fallback={<span>Preparing thumbnail</span>}>\r\n      <Card\r\n        style={{\r\n          aspectRatio: THUMBNAIL_ASPECT_RATIO,\r\n          position: 'relative',\r\n          maxWidth: width ? `${width}px` : undefined,\r\n          width: '100%',\r\n          flex: 1,\r\n        }}\r\n        border\r\n        radius={2}\r\n        ref={ref}\r\n        tone={STATUS_TO_TONE[status]}\r\n      >\r\n        {inView ? (\r\n          <>\r\n            {status === 'loading' && (\r\n              <Box\r\n                style={{\r\n                  position: 'absolute',\r\n                  left: '50%',\r\n                  top: '50%',\r\n                  transform: 'translate(-50%, -50%)',\r\n                }}\r\n              >\r\n                <Spinner />\r\n              </Box>\r\n            )}\r\n            {status === 'error' && (\r\n              <Stack\r\n                space={4}\r\n                style={{\r\n                  position: 'absolute',\r\n                  width: '100%',\r\n                  left: 0,\r\n                  top: '50%',\r\n                  transform: 'translateY(-50%)',\r\n                  justifyItems: 'center',\r\n                }}\r\n              >\r\n                <Text size={4} muted>\r\n                  <ErrorOutlineIcon style={{fontSize: '1.75em'}} />\r\n                </Text>\r\n                <Text muted align=\"center\">\r\n                  {error}\r\n                </Text>\r\n              </Stack>\r\n            )}\r\n            <Image\r\n              src={thumbnailSrc ?? undefined}\r\n              alt={`Preview for ${staticImage ? 'image' : 'video'} ${asset.filename || asset.assetId}`}\r\n              onLoad={handleLoad}\r\n              onError={() => handleError()}\r\n              style={{opacity: status === 'loaded' ? 1 : 0}}\r\n            />\r\n          </>\r\n        ) : null}\r\n      </Card>\r\n    </Suspense>\r\n  )\r\n}\r\n","import {\r\n  CheckmarkCircleIcon,\r\n  ErrorOutlineIcon,\r\n  InfoOutlineIcon,\r\n  RetrieveIcon,\r\n  RetryIcon,\r\n} from '@sanity/icons'\r\nimport {\r\n  Box,\r\n  Button,\r\n  Card,\r\n  Checkbox,\r\n  Code,\r\n  Dialog,\r\n  Flex,\r\n  Heading,\r\n  Spinner,\r\n  Stack,\r\n  Text,\r\n} from '@sanity/ui'\r\nimport {truncateString, useFormattedDuration} from 'sanity'\r\nimport {styled} from 'styled-components'\r\n\r\nimport useImportMuxAssets from '../hooks/useImportMuxAssets'\r\nimport {DIALOGS_Z_INDEX} from '../util/constants'\r\nimport type {MuxAsset} from '../util/types'\r\nimport VideoThumbnail from './VideoThumbnail'\r\n\r\nconst MissingAssetCheckbox = styled(Checkbox)`\r\n  position: static !important;\r\n\r\n  input::after {\r\n    content: '';\r\n    position: absolute;\r\n    inset: 0;\r\n    display: block;\r\n    cursor: pointer;\r\n    z-index: 1000;\r\n  }\r\n`\r\n\r\nfunction MissingAsset({\r\n  asset,\r\n  selectAsset,\r\n  selected,\r\n}: {\r\n  asset: MuxAsset\r\n  selectAsset: (selected: boolean) => void\r\n  selected: boolean\r\n}) {\r\n  const duration = useFormattedDuration(asset.duration * 1000)\r\n\r\n  return (\r\n    <Card\r\n      key={asset.id}\r\n      tone={selected ? 'positive' : undefined}\r\n      border\r\n      paddingX={2}\r\n      paddingY={3}\r\n      style={{position: 'relative'}}\r\n      radius={1}\r\n    >\r\n      <Flex align=\"center\" gap={2}>\r\n        <MissingAssetCheckbox\r\n          checked={selected}\r\n          onChange={(e) => {\r\n            selectAsset(e.currentTarget.checked)\r\n          }}\r\n          aria-label={selected ? `Import video ${asset.id}` : `Skip import of video ${asset.id}`}\r\n        />\r\n        <VideoThumbnail\r\n          asset={{\r\n            assetId: asset.id,\r\n            data: asset,\r\n            filename: asset.id,\r\n            playbackId: asset.playback_ids.find((p) => p.id)?.id,\r\n          }}\r\n          width={150}\r\n        />\r\n        <Stack space={2}>\r\n          <Flex align=\"center\" gap={1}>\r\n            <Code size={2}>{truncateString(asset.id, 15)}</Code>{' '}\r\n            <Text muted size={2}>\r\n              ({duration.formatted})\r\n            </Text>\r\n          </Flex>\r\n          <Text size={1}>\r\n            Uploaded at{' '}\r\n            {new Date(Number(asset.created_at) * 1000).toLocaleDateString('en', {\r\n              year: 'numeric',\r\n              day: '2-digit',\r\n              month: '2-digit',\r\n            })}\r\n          </Text>\r\n        </Stack>\r\n      </Flex>\r\n    </Card>\r\n  )\r\n}\r\n\r\n// eslint-disable-next-line complexity\r\nfunction ImportVideosDialog(props: ReturnType<typeof useImportMuxAssets>) {\r\n  const {importState} = props\r\n\r\n  const canTriggerImport =\r\n    (importState === 'idle' || importState === 'error') && props.selectedAssets.length > 0\r\n  const isImporting = importState === 'importing'\r\n  const noAssetsToImport =\r\n    props.missingAssets?.length === 0 && !props.muxAssets.loading && !props.assetsInSanityLoading\r\n\r\n  return (\r\n    <Dialog\r\n      animate\r\n      header={'Import videos from Mux'}\r\n      zOffset={DIALOGS_Z_INDEX}\r\n      id=\"video-details-dialog\"\r\n      onClose={props.closeDialog}\r\n      onClickOutside={props.closeDialog}\r\n      width={1}\r\n      position=\"fixed\"\r\n      footer={\r\n        importState !== 'done' &&\r\n        !noAssetsToImport && (\r\n          <Card padding={3}>\r\n            <Flex justify=\"space-between\" align=\"center\">\r\n              <Button\r\n                fontSize={2}\r\n                padding={3}\r\n                mode=\"ghost\"\r\n                text=\"Cancel\"\r\n                tone=\"critical\"\r\n                onClick={props.closeDialog}\r\n                disabled={isImporting}\r\n              />\r\n              {props.missingAssets && (\r\n                <Button\r\n                  icon={RetrieveIcon}\r\n                  fontSize={2}\r\n                  padding={3}\r\n                  mode=\"ghost\"\r\n                  text={\r\n                    props.selectedAssets?.length > 0\r\n                      ? `Import ${props.selectedAssets.length} video(s)`\r\n                      : 'No video(s) selected'\r\n                  }\r\n                  tone=\"positive\"\r\n                  onClick={props.importAssets}\r\n                  iconRight={isImporting && Spinner}\r\n                  disabled={!canTriggerImport}\r\n                />\r\n              )}\r\n            </Flex>\r\n          </Card>\r\n        )\r\n      }\r\n    >\r\n      <Box padding={3}>\r\n        {/* WARNING: SKIPPED ASSETS WITHOUT PLAYBACK */}\r\n        {props.muxAssets.hasSkippedAssetsWithoutPlayback && (\r\n          <Card tone=\"caution\" marginBottom={5} padding={3} border>\r\n            <Flex align=\"center\" gap={2}>\r\n              <InfoOutlineIcon fontSize={36} />\r\n              <Stack space={2}>\r\n                <Text size={2} weight=\"semibold\">\r\n                  Some videos were skipped\r\n                </Text>\r\n                <Text size={1}>\r\n                  Videos without playback IDs cannot be imported and have been excluded from the\r\n                  list.\r\n                </Text>\r\n              </Stack>\r\n            </Flex>\r\n          </Card>\r\n        )}\r\n\r\n        {/* LOADING ASSETS STATE */}\r\n        {(props.muxAssets.loading || props.assetsInSanityLoading) && (\r\n          <Card tone=\"primary\" marginBottom={5} padding={3} border>\r\n            <Flex align=\"center\" gap={4}>\r\n              <Spinner muted size={4} />\r\n              <Stack space={2}>\r\n                <Text size={2} weight=\"semibold\">\r\n                  Loading assets from Mux\r\n                </Text>\r\n                <Text size={1}>\r\n                  This may take a while.\r\n                  {props.missingAssets &&\r\n                    props.missingAssets.length > 0 &&\r\n                    ` There are at least ${props.missingAssets.length} video${props.missingAssets.length > 1 ? 's' : ''} currently not in Sanity...`}\r\n                </Text>\r\n              </Stack>\r\n            </Flex>\r\n          </Card>\r\n        )}\r\n\r\n        {/* ERROR LOADING MUX */}\r\n        {props.muxAssets.error && (\r\n          <Card tone=\"critical\" marginBottom={5} padding={3} border>\r\n            <Flex align=\"center\" gap={2}>\r\n              <ErrorOutlineIcon fontSize={36} />\r\n              <Stack space={2}>\r\n                <Text size={2} weight=\"semibold\">\r\n                  There was an error getting all data from Mux\r\n                </Text>\r\n                <Text size={1}>\r\n                  {props.missingAssets\r\n                    ? `But we've found ${props.missingAssets.length} video${props.missingAssets.length > 1 ? 's' : ''} not in Sanity, which you can start importing now.`\r\n                    : 'Please try again or contact a developer for help.'}\r\n                </Text>\r\n              </Stack>\r\n            </Flex>\r\n          </Card>\r\n        )}\r\n\r\n        {/* IMPORTING STATE */}\r\n        {importState === 'importing' && (\r\n          <Card tone=\"primary\" marginBottom={5} padding={3} border>\r\n            <Flex align=\"center\" gap={4}>\r\n              <Spinner muted size={4} />\r\n              <Stack space={2}>\r\n                <Text size={2} weight=\"semibold\">\r\n                  Importing {props.selectedAssets.length} video\r\n                  {props.selectedAssets.length > 1 && 's'} from Mux\r\n                </Text>\r\n              </Stack>\r\n            </Flex>\r\n          </Card>\r\n        )}\r\n\r\n        {/* ERROR IMPORTING */}\r\n        {importState === 'error' && (\r\n          <Card tone=\"critical\" marginBottom={5} padding={3} border>\r\n            <Flex align=\"center\" gap={2}>\r\n              <ErrorOutlineIcon fontSize={36} />\r\n              <Stack space={2}>\r\n                <Text size={2} weight=\"semibold\">\r\n                  There was an error importing videos\r\n                </Text>\r\n                <Text size={1}>\r\n                  {props.importError\r\n                    ? `Error: ${props.importError}`\r\n                    : 'Please try again or contact a developer for help.'}\r\n                </Text>\r\n                <Box marginTop={1}>\r\n                  <Button\r\n                    icon={RetryIcon}\r\n                    text=\"Retry\"\r\n                    tone=\"primary\"\r\n                    onClick={props.importAssets}\r\n                  />\r\n                </Box>\r\n              </Stack>\r\n            </Flex>\r\n          </Card>\r\n        )}\r\n\r\n        {/* NO ASSETS TO IMPORT or SUCESS STATE */}\r\n        {(noAssetsToImport || importState === 'done') && (\r\n          <Stack paddingY={5} marginBottom={4} space={3} style={{textAlign: 'center'}}>\r\n            <Box>\r\n              <CheckmarkCircleIcon fontSize={48} />\r\n            </Box>\r\n            <Heading size={2}>\r\n              {importState === 'done'\r\n                ? `Videos imported successfully`\r\n                : 'There are no Mux videos to import'}\r\n            </Heading>\r\n            <Text size={2}>\r\n              {importState === 'done'\r\n                ? 'You can now use them in your Sanity content.'\r\n                : \"They're all in Sanity and ready to be used in your content.\"}\r\n            </Text>\r\n          </Stack>\r\n        )}\r\n\r\n        {/* MISSING ASSETS SELECTOR */}\r\n        {props.missingAssets &&\r\n          props.missingAssets.length > 0 &&\r\n          (importState === 'idle' || importState === 'error') && (\r\n            <Stack space={4}>\r\n              <Heading size={1}>\r\n                There are {props.missingAssets.length}\r\n                {props.muxAssets.loading && '+'} Mux video{props.missingAssets.length > 1 && 's'}{' '}\r\n                not in Sanity\r\n              </Heading>\r\n              {!props.muxAssets.loading && (\r\n                <Flex align=\"center\" paddingX={2}>\r\n                  <Checkbox\r\n                    id=\"import-all\"\r\n                    style={{display: 'block'}}\r\n                    onClick={(e) => {\r\n                      const selectAll = e.currentTarget.checked\r\n                      if (selectAll) {\r\n                        // eslint-disable-next-line no-unused-expressions\r\n                        props.missingAssets && props.setSelectedAssets(props.missingAssets)\r\n                      } else {\r\n                        props.setSelectedAssets([])\r\n                      }\r\n                    }}\r\n                    checked={props.selectedAssets.length === props.missingAssets.length}\r\n                  />\r\n                  <Box flex={1} paddingLeft={3} as=\"label\" htmlFor=\"import-all\">\r\n                    <Text>Import all</Text>\r\n                  </Box>\r\n                </Flex>\r\n              )}\r\n              {props.missingAssets.map((asset) => (\r\n                <MissingAsset\r\n                  key={asset.id}\r\n                  asset={asset}\r\n                  selectAsset={(selected) => {\r\n                    if (selected) {\r\n                      props.setSelectedAssets([...props.selectedAssets, asset])\r\n                    } else {\r\n                      props.setSelectedAssets(props.selectedAssets.filter((a) => a.id !== asset.id))\r\n                    }\r\n                  }}\r\n                  selected={props.selectedAssets.some((a) => a.id === asset.id)}\r\n                />\r\n              ))}\r\n            </Stack>\r\n          )}\r\n      </Box>\r\n    </Dialog>\r\n  )\r\n}\r\n\r\nexport default function ImportVideosFromMux() {\r\n  const importAssets = useImportMuxAssets()\r\n\r\n  if (!importAssets.hasSecrets) {\r\n    return\r\n  }\r\n\r\n  if (importAssets.dialogOpen) {\r\n    // eslint-disable-next-line consistent-return\r\n    return <ImportVideosDialog {...importAssets} />\r\n  }\r\n\r\n  // eslint-disable-next-line consistent-return\r\n  return <Button mode=\"bleed\" text=\"Import from Mux\" onClick={importAssets.openDialog} />\r\n}\r\n","import {ChevronLeftIcon, ChevronRightIcon} from '@sanity/icons'\r\nimport {Button, Label} from '@sanity/ui'\r\nimport {Dispatch, SetStateAction, useEffect} from 'react'\r\n\r\nconst PageSelector = (props: {\r\n  page: number\r\n  setPage: Dispatch<SetStateAction<number>>\r\n  total: number\r\n}) => {\r\n  const page = props.page\r\n  const setPage = props.setPage\r\n\r\n  useEffect(() => {\r\n    // Constraint in bounds.\r\n    const clamped = Math.min(props.total - 1, Math.max(0, page))\r\n    if (page !== clamped) {\r\n      setPage(clamped)\r\n    }\r\n  }, [page, props.total, setPage])\r\n\r\n  return (\r\n    <>\r\n      <Button\r\n        icon={ChevronLeftIcon}\r\n        mode=\"bleed\"\r\n        padding={3}\r\n        style={{cursor: 'pointer'}}\r\n        disabled={page <= 0}\r\n        onClick={() => {\r\n          setPage((p) => {\r\n            return Math.min(props.total - 1, Math.max(0, p - 1))\r\n          })\r\n        }}\r\n      />\r\n      <Label muted>\r\n        Page {page + 1}/{props.total}\r\n      </Label>\r\n      <Button\r\n        icon={ChevronRightIcon}\r\n        mode=\"bleed\"\r\n        padding={3}\r\n        style={{cursor: 'pointer'}}\r\n        disabled={page >= props.total - 1}\r\n        onClick={() => {\r\n          setPage((p) => {\r\n            return Math.min(props.total - 1, Math.max(0, p + 1))\r\n          })\r\n        }}\r\n      />\r\n    </>\r\n  )\r\n}\r\n\r\nexport default PageSelector\r\n","import {uuid} from '@sanity/uuid'\r\n\r\nimport type {MuxAsset} from './types'\r\n\r\n/**\r\n * Adds _key to array items in MuxAsset data for Sanity compatibility.\r\n * Sanity requires _key on array items for proper editing support.\r\n */\r\nexport function addKeysToMuxData(data: MuxAsset): MuxAsset {\r\n  return {\r\n    ...data,\r\n    tracks: data.tracks?.map((track) => ({\r\n      ...track,\r\n      _key: uuid(),\r\n    })),\r\n    playback_ids: data.playback_ids?.map((playbackId) => ({\r\n      ...playbackId,\r\n      _key: uuid(),\r\n    })),\r\n    static_renditions: data.static_renditions\r\n      ? {\r\n          ...data.static_renditions,\r\n          files: data.static_renditions.files?.map((file) => ({\r\n            ...file,\r\n            _key: uuid(),\r\n          })),\r\n        }\r\n      : undefined,\r\n  }\r\n}\r\n","import {useMemo, useState} from 'react'\r\nimport {\r\n  createHookFromObservableFactory,\r\n  type DocumentStore,\r\n  useClient,\r\n  useDocumentStore,\r\n} from 'sanity'\r\n\r\nimport {addKeysToMuxData} from '../util/addKeysToMuxData'\r\nimport {isEmptyOrPlaceholderTitle} from '../util/assetTitlePlaceholder'\r\nimport type {MuxAsset, VideoAssetDocument} from '../util/types'\r\nimport {SANITY_API_VERSION} from './useClient'\r\nimport useMuxAssets from './useMuxAssets'\r\nimport {useSecretsDocumentValues} from './useSecretsDocumentValues'\r\n\r\ntype ResyncState = 'closed' | 'idle' | 'syncing' | 'done' | 'error'\r\n\r\nexport type MatchedAsset = {\r\n  sanityDoc: VideoAssetDocument\r\n  muxAsset: MuxAsset | undefined\r\n  muxTitle: string | undefined\r\n  currentTitle: string | undefined\r\n}\r\n\r\nexport default function useResyncMuxMetadata() {\r\n  const documentStore = useDocumentStore()\r\n  const client = useClient({\r\n    apiVersion: SANITY_API_VERSION,\r\n  })\r\n\r\n  const [sanityAssets, sanityAssetsLoading] = useSanityAssets(documentStore)\r\n\r\n  const secretDocumentValues = useSecretsDocumentValues()\r\n  const hasSecrets = !!secretDocumentValues.value.secrets?.secretKey\r\n\r\n  const [resyncError, setResyncError] = useState<unknown>()\r\n  const [resyncState, setResyncState] = useState<ResyncState>('closed')\r\n  const dialogOpen = resyncState !== 'closed'\r\n\r\n  const muxAssets = useMuxAssets({\r\n    client,\r\n    enabled: hasSecrets && dialogOpen,\r\n  })\r\n\r\n  const matchedAssets = useMemo(() => {\r\n    return sanityAssets && muxAssets.data\r\n      ? sanityAssets.map((sanityDoc) => {\r\n          const muxAsset = muxAssets.data?.find(\r\n            (m) => m.id === sanityDoc.assetId || m.id === sanityDoc.data?.id\r\n          )\r\n          return {\r\n            sanityDoc,\r\n            muxAsset,\r\n            muxTitle: muxAsset?.meta?.title,\r\n            currentTitle: sanityDoc.filename,\r\n          }\r\n        })\r\n      : undefined\r\n  }, [sanityAssets, muxAssets.data])\r\n\r\n  const closeDialog = () => {\r\n    if (resyncState !== 'syncing') setResyncState('closed')\r\n  }\r\n\r\n  const openDialog = () => {\r\n    if (resyncState === 'closed') setResyncState('idle')\r\n  }\r\n\r\n  async function syncAllVideos() {\r\n    if (!matchedAssets) return\r\n\r\n    setResyncState('syncing')\r\n\r\n    try {\r\n      const tx = client.transaction()\r\n\r\n      matchedAssets.forEach((matched) => {\r\n        // Update all videos with the Mux title, even if it's undefined/empty\r\n        const newTitle = matched.muxTitle || ''\r\n        tx.patch(matched.sanityDoc._id, {set: {filename: newTitle}})\r\n      })\r\n\r\n      await tx.commit({returnDocuments: false})\r\n      setResyncState('done')\r\n    } catch (error) {\r\n      setResyncState('error')\r\n      setResyncError(error)\r\n    }\r\n  }\r\n\r\n  async function syncOnlyEmpty() {\r\n    if (!matchedAssets) return\r\n\r\n    setResyncState('syncing')\r\n\r\n    try {\r\n      const tx = client.transaction()\r\n\r\n      matchedAssets.forEach((matched) => {\r\n        // Only update if the current title is empty or has the placeholder format\r\n        // AND there's a new title available from Mux\r\n        if (\r\n          matched.muxAsset &&\r\n          matched.muxTitle &&\r\n          isEmptyOrPlaceholderTitle(matched.currentTitle, matched.muxAsset.id)\r\n        ) {\r\n          tx.patch(matched.sanityDoc._id, {set: {filename: matched.muxTitle}})\r\n        }\r\n      })\r\n\r\n      await tx.commit({returnDocuments: false})\r\n      setResyncState('done')\r\n    } catch (error) {\r\n      setResyncState('error')\r\n      setResyncError(error)\r\n    }\r\n  }\r\n\r\n  async function syncFullData() {\r\n    if (!matchedAssets) return\r\n\r\n    setResyncState('syncing')\r\n\r\n    try {\r\n      const tx = client.transaction()\r\n\r\n      matchedAssets.forEach((matched) => {\r\n        if (!matched.muxAsset) return\r\n\r\n        const dataWithKeys = addKeysToMuxData(matched.muxAsset)\r\n\r\n        // Update all fields: filename, status, and full data from Mux\r\n        tx.patch(matched.sanityDoc._id, {\r\n          set: {\r\n            filename: matched.muxTitle || matched.currentTitle || '',\r\n            status: matched.muxAsset.status,\r\n            data: dataWithKeys,\r\n          },\r\n        })\r\n      })\r\n\r\n      await tx.commit({returnDocuments: false})\r\n      setResyncState('done')\r\n    } catch (error) {\r\n      setResyncState('error')\r\n      setResyncError(error)\r\n    }\r\n  }\r\n\r\n  return {\r\n    sanityAssetsLoading,\r\n    closeDialog,\r\n    dialogOpen,\r\n    resyncState,\r\n    resyncError,\r\n    hasSecrets,\r\n    syncAllVideos,\r\n    syncOnlyEmpty,\r\n    syncFullData,\r\n    matchedAssets,\r\n    muxAssets,\r\n    openDialog,\r\n  }\r\n}\r\n\r\nconst useSanityAssets = createHookFromObservableFactory<VideoAssetDocument[], DocumentStore>(\r\n  (documentStore) => {\r\n    return documentStore.listenQuery(\r\n      /* groq */ `*[_type == \"mux.videoAsset\"]`,\r\n      {},\r\n      {\r\n        apiVersion: SANITY_API_VERSION,\r\n      }\r\n    )\r\n  }\r\n)\r\n","import {CheckmarkCircleIcon, ErrorOutlineIcon, SyncIcon} from '@sanity/icons'\r\nimport {Box, Button, Card, Dialog, Flex, Heading, Radio, Spinner, Stack, Text} from '@sanity/ui'\r\nimport {useState} from 'react'\r\n\r\nimport useResyncMuxMetadata from '../hooks/useResyncMuxMetadata'\r\nimport {isEmptyOrPlaceholderTitle} from '../util/assetTitlePlaceholder'\r\nimport {DIALOGS_Z_INDEX} from '../util/constants'\r\n\r\ntype SyncOption = 'fillEmpty' | 'syncTitles' | 'fullResync'\r\n\r\ninterface OptionCardProps {\r\n  id: SyncOption\r\n  selected: boolean\r\n  onSelect: (id: SyncOption) => void\r\n  title: string\r\n  count: number\r\n  description: string\r\n  disabled?: boolean\r\n}\r\n\r\nfunction OptionCard({\r\n  id,\r\n  selected,\r\n  onSelect,\r\n  title,\r\n  count,\r\n  description,\r\n  disabled,\r\n}: OptionCardProps) {\r\n  return (\r\n    <Card\r\n      as=\"label\"\r\n      padding={3}\r\n      radius={2}\r\n      border\r\n      tone={selected ? 'primary' : 'default'}\r\n      style={{\r\n        cursor: disabled ? 'not-allowed' : 'pointer',\r\n        opacity: disabled ? 0.5 : 1,\r\n      }}\r\n    >\r\n      <Flex gap={3} align=\"flex-start\">\r\n        <Box paddingTop={1}>\r\n          <Radio\r\n            checked={selected}\r\n            onChange={() => onSelect(id)}\r\n            disabled={disabled}\r\n            name=\"sync-option\"\r\n          />\r\n        </Box>\r\n        <Stack space={2} flex={1}>\r\n          <Flex align=\"center\" gap={2}>\r\n            <Text size={2} weight=\"semibold\">\r\n              {title} ({count})\r\n            </Text>\r\n          </Flex>\r\n          <Text size={1} muted>\r\n            {description}\r\n          </Text>\r\n        </Stack>\r\n      </Flex>\r\n    </Card>\r\n  )\r\n}\r\n\r\nfunction ResyncMetadataDialog(props: ReturnType<typeof useResyncMuxMetadata>) {\r\n  const {resyncState} = props\r\n\r\n  const videosToUpdate = props.matchedAssets?.filter((m) => m.muxAsset).length || 0\r\n  const videosWithEmptyOrPlaceholder =\r\n    props.matchedAssets?.filter(\r\n      (m) => m.muxAsset && m.muxTitle && isEmptyOrPlaceholderTitle(m.currentTitle, m.muxAsset.id)\r\n    ).length || 0\r\n\r\n  const hasEmptyTitles = videosWithEmptyOrPlaceholder > 0\r\n  const defaultOption: SyncOption = hasEmptyTitles ? 'fillEmpty' : 'syncTitles'\r\n  const [selectedOption, setSelectedOption] = useState<SyncOption>(defaultOption)\r\n\r\n  const canTriggerResync = resyncState === 'idle' || resyncState === 'error'\r\n  const isResyncing = resyncState === 'syncing'\r\n  const isDone = resyncState === 'done'\r\n  const isLoading = props.muxAssets.loading || props.sanityAssetsLoading\r\n\r\n  const handleSync = () => {\r\n    switch (selectedOption) {\r\n      case 'fillEmpty':\r\n        props.syncOnlyEmpty()\r\n        break\r\n      case 'syncTitles':\r\n        props.syncAllVideos()\r\n        break\r\n      case 'fullResync':\r\n        props.syncFullData()\r\n        break\r\n      default:\r\n        break\r\n    }\r\n  }\r\n\r\n  return (\r\n    <Dialog\r\n      animate\r\n      header=\"Sync with Mux\"\r\n      zOffset={DIALOGS_Z_INDEX}\r\n      id=\"resync-metadata-dialog\"\r\n      onClose={props.closeDialog}\r\n      onClickOutside={props.closeDialog}\r\n      width={1}\r\n      position=\"fixed\"\r\n      footer={\r\n        !isDone && (\r\n          <Card padding={3}>\r\n            <Flex justify=\"flex-end\" gap={2}>\r\n              <Button\r\n                fontSize={2}\r\n                padding={3}\r\n                mode=\"ghost\"\r\n                text=\"Cancel\"\r\n                onClick={props.closeDialog}\r\n                disabled={isResyncing}\r\n              />\r\n              <Button\r\n                icon={SyncIcon}\r\n                fontSize={2}\r\n                padding={3}\r\n                text=\"Run sync\"\r\n                tone=\"primary\"\r\n                onClick={handleSync}\r\n                iconRight={isResyncing && Spinner}\r\n                disabled={!canTriggerResync || isLoading}\r\n              />\r\n            </Flex>\r\n          </Card>\r\n        )\r\n      }\r\n    >\r\n      <Box padding={4}>\r\n        {/* LOADING ASSETS STATE */}\r\n        {isLoading && (\r\n          <Card tone=\"primary\" marginBottom={4} padding={3} border radius={2}>\r\n            <Flex align=\"center\" gap={4}>\r\n              <Spinner muted size={4} />\r\n              <Stack space={2}>\r\n                <Text size={2} weight=\"semibold\">\r\n                  Loading assets from Mux\r\n                </Text>\r\n                <Text size={1} muted>\r\n                  This may take a while.\r\n                </Text>\r\n              </Stack>\r\n            </Flex>\r\n          </Card>\r\n        )}\r\n\r\n        {/* ERROR LOADING MUX */}\r\n        {props.muxAssets.error && (\r\n          <Card tone=\"critical\" marginBottom={4} padding={3} border radius={2}>\r\n            <Flex align=\"center\" gap={2}>\r\n              <ErrorOutlineIcon fontSize={36} />\r\n              <Stack space={2}>\r\n                <Text size={2} weight=\"semibold\">\r\n                  There was an error getting data from Mux\r\n                </Text>\r\n                <Text size={1}>Please try again or contact a developer for help.</Text>\r\n              </Stack>\r\n            </Flex>\r\n          </Card>\r\n        )}\r\n\r\n        {/* SYNCING STATE */}\r\n        {resyncState === 'syncing' && (\r\n          <Card tone=\"primary\" marginBottom={4} padding={3} border radius={2}>\r\n            <Flex align=\"center\" gap={4}>\r\n              <Spinner muted size={4} />\r\n              <Stack space={2}>\r\n                <Text size={2} weight=\"semibold\">\r\n                  Syncing metadata\r\n                </Text>\r\n                <Text size={1} muted>\r\n                  Updating videos from Mux...\r\n                </Text>\r\n              </Stack>\r\n            </Flex>\r\n          </Card>\r\n        )}\r\n\r\n        {/* ERROR SYNCING */}\r\n        {resyncState === 'error' && (\r\n          <Card tone=\"critical\" marginBottom={4} padding={3} border radius={2}>\r\n            <Flex align=\"center\" gap={2}>\r\n              <ErrorOutlineIcon fontSize={36} />\r\n              <Stack space={2}>\r\n                <Text size={2} weight=\"semibold\">\r\n                  There was an error syncing metadata\r\n                </Text>\r\n                <Text size={1}>\r\n                  {props.resyncError\r\n                    ? `Error: ${props.resyncError}`\r\n                    : 'Please try again or contact a developer for help.'}\r\n                </Text>\r\n              </Stack>\r\n            </Flex>\r\n          </Card>\r\n        )}\r\n\r\n        {/* SUCCESS STATE */}\r\n        {resyncState === 'done' && (\r\n          <Stack paddingY={5} space={3} style={{textAlign: 'center'}}>\r\n            <Box>\r\n              <CheckmarkCircleIcon fontSize={48} />\r\n            </Box>\r\n            <Heading size={2}>Sync completed</Heading>\r\n            <Text size={2} muted>\r\n              Videos have been updated from Mux.\r\n            </Text>\r\n          </Stack>\r\n        )}\r\n\r\n        {/* OPTIONS */}\r\n        {!isDone && !isLoading && !props.muxAssets.error && (\r\n          <Stack space={4}>\r\n            <Text size={1} muted>\r\n              Found {videosToUpdate} video{videosToUpdate === 1 ? '' : 's'} linked to Mux.\r\n            </Text>\r\n\r\n            <Stack space={3}>\r\n              {hasEmptyTitles && (\r\n                <OptionCard\r\n                  id=\"fillEmpty\"\r\n                  selected={selectedOption === 'fillEmpty'}\r\n                  onSelect={setSelectedOption}\r\n                  title=\"Fill missing titles only\"\r\n                  count={videosWithEmptyOrPlaceholder}\r\n                  description=\"Updates only videos without a title or with placeholder titles (e.g., 'Asset #123') using the title from Mux.\"\r\n                  disabled={isResyncing}\r\n                />\r\n              )}\r\n\r\n              <OptionCard\r\n                id=\"syncTitles\"\r\n                selected={selectedOption === 'syncTitles'}\r\n                onSelect={setSelectedOption}\r\n                title=\"Sync all titles\"\r\n                count={videosToUpdate}\r\n                description=\"Replaces the title in Sanity with the title from Mux for all videos.\"\r\n                disabled={isResyncing}\r\n              />\r\n\r\n              <OptionCard\r\n                id=\"fullResync\"\r\n                selected={selectedOption === 'fullResync'}\r\n                onSelect={setSelectedOption}\r\n                title=\"Full resync\"\r\n                count={videosToUpdate}\r\n                description=\"Updates all fields from Mux including status, duration, tracks, captions, and renditions.\"\r\n                disabled={isResyncing}\r\n              />\r\n            </Stack>\r\n          </Stack>\r\n        )}\r\n      </Box>\r\n    </Dialog>\r\n  )\r\n}\r\n\r\nexport default function ResyncMetadata() {\r\n  const resyncMetadata = useResyncMuxMetadata()\r\n\r\n  if (!resyncMetadata.hasSecrets) {\r\n    return\r\n  }\r\n\r\n  if (resyncMetadata.dialogOpen) {\r\n    // eslint-disable-next-line consistent-return\r\n    return <ResyncMetadataDialog {...resyncMetadata} />\r\n  }\r\n\r\n  // eslint-disable-next-line consistent-return\r\n  return <Button mode=\"bleed\" text=\"Sync with Mux\" onClick={resyncMetadata.openDialog} />\r\n}\r\n","import {SortIcon} from '@sanity/icons'\r\nimport {Button, Menu, MenuButton, MenuItem, PopoverProps} from '@sanity/ui'\r\nimport {useId} from 'react'\r\n\r\nimport {ASSET_SORT_OPTIONS, SortOption} from '../hooks/useAssets'\r\n\r\nexport const CONTEXT_MENU_POPOVER_PROPS: PopoverProps = {\r\n  constrainSize: true,\r\n  placement: 'bottom',\r\n  portal: true,\r\n  width: 0,\r\n}\r\n\r\n/**\r\n * @sanity/ui components adapted from:\r\n * https://github.com/sanity-io/sanity/blob/next/packages/sanity/src/desk/components/pane/PaneContextMenuButton.tsx#L19\r\n */\r\nexport function SelectSortOptions(props: {sort: SortOption; setSort: (s: SortOption) => void}) {\r\n  const id = useId()\r\n\r\n  return (\r\n    <MenuButton\r\n      button={\r\n        <Button text=\"Sort\" icon={SortIcon} mode=\"bleed\" padding={3} style={{cursor: 'pointer'}} />\r\n      }\r\n      id={id}\r\n      menu={\r\n        <Menu>\r\n          {Object.entries(ASSET_SORT_OPTIONS).map(([type, {label}]) => (\r\n            <MenuItem\r\n              key={type}\r\n              data-as=\"button\"\r\n              onClick={() => props.setSort(type as SortOption)}\r\n              padding={3}\r\n              tone=\"default\"\r\n              text={label}\r\n              pressed={type === props.sort}\r\n            />\r\n          ))}\r\n        </Menu>\r\n      }\r\n      popover={CONTEXT_MENU_POPOVER_PROPS}\r\n    />\r\n  )\r\n}\r\n","import {Box, Spinner} from '@sanity/ui'\r\n\r\nconst SpinnerBox: React.FC = () => (\r\n  <Box\r\n    style={{\r\n      display: 'flex',\r\n      alignItems: 'center',\r\n      justifyContent: 'center',\r\n      minHeight: '150px',\r\n    }}\r\n  >\r\n    <Spinner />\r\n  </Box>\r\n)\r\n\r\nexport default SpinnerBox\r\n","import type {SanityClient} from 'sanity'\r\n\r\nimport {getAsset, updateMasterAccess} from './assets'\r\nimport {testSecrets} from './secrets'\r\n\r\n/**\r\n * This function enables master access on a remote mux asset.\r\n * @param client Sanity client (uses addon credentials).\r\n * @param assetId The target mux asset ID.\r\n * @return Return true on success.\r\n */\r\nexport async function enableMasterAccess(\r\n    client: SanityClient,\r\n    assetId: string\r\n): Promise<boolean> {\r\n    try {\r\n        const secretsValid = await testSecrets(client)\r\n        if (!secretsValid?.status) return false\r\n\r\n        await updateMasterAccess(client, assetId, 'temporary')\r\n        return true\r\n\r\n    } catch {\r\n        return false\r\n    }\r\n}\r\n\r\n/**\r\n * This function disables master access on a remote mux asset.\r\n * @param client Sanity client (uses addon credentials).\r\n * @param assetId The target mux asset ID.\r\n * @return Return true on success.\r\n */\r\nexport async function disableMasterAccess(\r\n    client: SanityClient,\r\n    assetId: string\r\n): Promise<boolean> {\r\n    try {\r\n        const secretsValid = await testSecrets(client)\r\n        if (!secretsValid?.status) return false\r\n\r\n        await updateMasterAccess(client, assetId, 'none')\r\n        return true\r\n\r\n    } catch {\r\n        return false\r\n    }\r\n}\r\n\r\n/**\r\n * This function checks if master access is enabled and available on a remote mux asset.\r\n * @param client Sanity client (uses addon credentials).\r\n * @param assetId The target mux asset ID.\r\n * @return Return the master access link if available.\r\n */\r\nexport async function pollMasterAccess(\r\n    client: SanityClient,\r\n    assetId: string\r\n): Promise<string> {\r\n    try {\r\n        const res = await getAsset(client, assetId)\r\n\r\n        const status = res.data?.master?.status ?? 'errored'\r\n        const url = res.data?.master?.url ?? ''\r\n        if (status === 'ready') return url\r\n        return ''\r\n\r\n    } catch {\r\n        return ''\r\n    }\r\n}\r\n\r\n/**\r\n * This function waits for master access to be enabled and available on a remote mux asset.\r\n * @param client Sanity client (uses addon credentials).\r\n * @param assetId The target mux asset ID.\r\n * @param timeout The timeout in seconds before dropping.\r\n * @param interval The interval in seconds between tries.\r\n * @return Return the master access link if available.\r\n */\r\nexport async function waitForMasterAccess(\r\n    client: SanityClient,\r\n    assetId: string,\r\n    timeout = 30,\r\n    interval = 2\r\n): Promise<string> {\r\n\r\n    const limit = Date.now() + timeout * 1000\r\n    while (Date.now() < limit) {\r\n\r\n        const url = await pollMasterAccess(client, assetId)\r\n        if (url) return url\r\n\r\n        await new Promise((resolve) => setTimeout(resolve, interval * 1000))\r\n    }\r\n\r\n    return ''\r\n}","import React, {createContext, useContext} from 'react'\r\n\r\nimport {type DialogState, type SetDialogState} from '../hooks/useDialogState'\r\n\r\ntype DialogStateContextProps = {\r\n  dialogState: DialogState\r\n  setDialogState: SetDialogState\r\n}\r\n\r\nconst DialogStateContext = createContext<DialogStateContextProps>({\r\n  dialogState: false,\r\n  setDialogState: () => {\r\n    return null\r\n  },\r\n})\r\n\r\ninterface DialogStateProviderProps extends DialogStateContextProps {\r\n  children: React.ReactNode\r\n}\r\n\r\nexport const DialogStateProvider = ({\r\n  dialogState,\r\n  setDialogState,\r\n  children,\r\n}: DialogStateProviderProps) => {\r\n  return (\r\n    <DialogStateContext.Provider value={{dialogState, setDialogState}}>\r\n      {children}\r\n    </DialogStateContext.Provider>\r\n  )\r\n}\r\n\r\nexport const useDialogStateContext = () => {\r\n  const context = useContext(DialogStateContext)\r\n  return context\r\n}\r\n","const mimeExtGraph: Array<[string, string]> = [\r\n    /* Audio */\r\n    ['audio/x-aiff', 'aif'],\r\n    ['audio/x-aiff', 'aiff'],\r\n    ['audio/basic', 'au'],\r\n    ['audio/basic', 'snd'],\r\n    ['audio/x-mpegurl', 'm3u'],\r\n    ['audio/midi', 'midi'],\r\n    ['audio/midi', 'mid'],\r\n    ['audio/m4a', 'mp3'],\r\n    ['audio/mpeg', 'mp3'],\r\n    ['audio/x-pn-realaudio', 'ra'],\r\n    ['audio/x-pn-realaudio', 'ram'],\r\n    ['audio/x-wav', 'wav'],\r\n    ['audio/x-ms-wma', 'wma'],\r\n\r\n    /* Video */\r\n    ['video/3gpp', '3gp'],\r\n    ['video/x-ms-wmv', 'wmv'],\r\n    ['video/x-ms-wmx', 'wmx'],\r\n    ['video/mp4', 'mp4'],\r\n    ['video/mp4', 'm4v'],\r\n    ['video/mp4', 'mp4v'],\r\n    ['video/mpeg', 'mpeg'],\r\n    ['video/mpeg', 'mpg'],\r\n    ['video/quicktime', 'mov'],\r\n    ['video/quicktime', 'qt'],\r\n    ['video/x-mng', 'mng'],\r\n    ['video/x-msvideo', 'avi'],\r\n    ['video/x-flv', 'flv'],\r\n    ['video/x-ms-asf', 'asf'],\r\n    ['video/x-ms-asf', 'asx'],\r\n\r\n    /* Subtitles */\r\n    ['application/x-subrip', 'srt'],\r\n    ['text/vtt', 'vtt'],\r\n    ['text/x-ssa', 'ssa'],\r\n    ['text/x-ass', 'ass'],\r\n    ['application/x-sami', 'sami'],\r\n    ['application/x-sami', 'smi'],\r\n    ['text/x-microdvd', 'sub'],\r\n    ['text/x-microdvd', 'vobsub'],\r\n    ['text/x-mpl2', 'mpl2'],\r\n]\r\n\r\nexport function mimeToExt(mime: string): string | undefined {\r\n    const formattedMime = mime.trim().toLowerCase()\r\n    for (const [_mime, _ext] of mimeExtGraph) {\r\n        if (_mime === formattedMime) {\r\n            return _ext\r\n        }\r\n    }\r\n}\r\n\r\nexport function extToMime(ext: string): string | undefined {\r\n    const formattedExt = ext.trim().toLowerCase()\r\n    for (const [_mime, _ext] of mimeExtGraph) {\r\n        if (_ext === formattedExt) {\r\n            return _mime\r\n        }\r\n    }\r\n}","import {mimeToExt} from \"./mimeExtGraph\"\r\n\r\n/**\r\n * This function triggers a browser download for a remote file.\r\n * @param url The target remote file URL.\r\n * @param name The name of the downloaded file.\r\n */\r\nexport async function downloadFile(url: string, name = 'untitled', extension = ''): Promise<void> {\r\n\r\n    if (typeof window === 'undefined') // Should never happen here.\r\n        throw new Error('downloadFile() can only be called in a browser environment.')\r\n\r\n    const response = await fetch(url, { mode: 'cors' })\r\n    if (!response.ok)\r\n        throw new Error(`downloadFile() failed to fetch file: ${response.status} ${response.statusText}`)\r\n\r\n    // Precedence: Provided extension > mimeExtGraph.ts > 'Content-Disposition' header.\r\n    const mime = response.headers.get('Content-Type') ?? ''\r\n    let fileExt = extension.trim() || mimeToExt(mime) || ''\r\n    if (fileExt) fileExt = `.${fileExt}`\r\n\r\n    let fileName = name.trim() || 'untitled'\r\n    if (fileExt.length && !fileName.endsWith(fileExt))\r\n        fileName += fileExt\r\n\r\n    const blob = await response.blob()\r\n    const objectUrl = URL.createObjectURL(blob)\r\n\r\n    try {\r\n        const anchor = document.createElement('a')\r\n        anchor.download = fileName\r\n        anchor.href = objectUrl\r\n        document.body.appendChild(anchor)\r\n        anchor.click()\r\n        document.body.removeChild(anchor)\r\n\r\n    } finally {\r\n        URL.revokeObjectURL(objectUrl)\r\n    }\r\n}","import {Button, Dialog, Stack, Text} from '@sanity/ui'\r\nimport {DownloadIcon, ResetIcon} from '@sanity/icons'\r\nimport React, {useEffect, useId, useState} from 'react'\r\nimport {getAsset} from '../actions/assets'\r\n\r\nimport {enableMasterAccess, waitForMasterAccess} from '../actions/download'\r\nimport {useDialogStateContext} from '../context/DialogStateContext'\r\nimport {useClient} from '../hooks/useClient'\r\nimport {DIALOGS_Z_INDEX} from '../util/constants'\r\nimport {downloadFile} from '../util/downloadFile'\r\nimport type {VideoAssetDocument} from '../util/types'\r\n\r\ntype MuxMasterAccessStatus = 'idle' | 'preparing' | 'success' | 'error'\r\n\r\nexport interface Props {\r\n  asset: VideoAssetDocument\r\n  onClose?: (() => void)\r\n  absolute?: boolean\r\n}\r\n\r\nexport default function DownloadAssetDialog({asset, onClose, absolute}: Props) {\r\n\r\n  const client = useClient()\r\n\r\n  const [status, setStatus] = useState<MuxMasterAccessStatus>('idle')\r\n\r\n  const {setDialogState} = useDialogStateContext()\r\n  const dialogId = `DownloadAssetDialog${useId()}`\r\n\r\n  const timeout = 120\r\n  const interval = 2\r\n\r\n  const prepareDownload = async () => {\r\n    const assetId = asset.assetId ?? ''\r\n    setStatus('preparing')\r\n    enableMasterAccess(client, assetId)\r\n      .then(() => {\r\n        waitForMasterAccess(client, assetId, timeout, interval)\r\n          .then((link) => {\r\n            setStatus((link.length > 0) ? 'success' : 'error')\r\n          }\r\n        )\r\n      }\r\n    )\r\n  }\r\n\r\n  const handleDownload = async () => {\r\n    const assetId = asset.assetId ?? ''\r\n    const assetName = asset.filename ?? 'untitled'\r\n    getAsset(client, assetId)\r\n      .then((res) => {\r\n        closing()\r\n        const url = res.data?.master?.url ?? ''\r\n        downloadFile(url, assetName)\r\n      }\r\n    )\r\n  }\r\n\r\n  const closing = () => {\r\n    if (onClose) onClose()\r\n    setDialogState(false)\r\n  }\r\n\r\n  const behavior = {\r\n    icon: (status === 'success') ? DownloadIcon : ResetIcon,\r\n    text: (status === 'success') ? 'Download' : 'Retry',\r\n    tone: (status === 'success') ? 'positive' : 'critical' as 'positive' | 'critical',\r\n    onClick: (status === 'success') ? handleDownload : prepareDownload,\r\n  }\r\n\r\n  useEffect(() => { if (status === 'idle') prepareDownload() });\r\n\r\n  return (\r\n    <Dialog\r\n      id={dialogId}\r\n      header={`Download ${'asset'} (source)`}\r\n      onClose={closing}\r\n      position={absolute ? 'fixed' : undefined}\r\n      zOffset={DIALOGS_Z_INDEX}\r\n      footer={\r\n        <Stack padding={3}>\r\n          <Button\r\n            icon={behavior.icon}\r\n            key='download'\r\n            disabled={status === 'preparing'}\r\n            mode='ghost'\r\n            tone={behavior.tone}\r\n            loading={status === 'preparing'}\r\n            onClick={behavior.onClick}\r\n            text={behavior.text}\r\n          />\r\n        </Stack>\r\n      }\r\n    >\r\n      <Stack paddingX={5} paddingY={3}>\r\n        <Text hidden={(status !== 'preparing')} align={'center'}>Your download file is being preparedâ¦</Text>\r\n        <Text hidden={(status !== 'success')} align={'center'}>Your download file is ready.</Text>\r\n        <Text hidden={(status !== 'error')} align={'center'}>Something went wrong during preparation :/</Text>\r\n      </Stack>\r\n    </Dialog>\r\n  )\r\n}\r\n","import {Flex, Text} from '@sanity/ui'\r\n\r\nconst IconInfo: React.FC<{\r\n  text: string\r\n  icon: React.FC\r\n  size?: number\r\n  muted?: boolean\r\n}> = (props) => {\r\n  const Icon = props.icon\r\n  return (\r\n    <Flex gap={2} align=\"center\" padding={1}>\r\n      <Text size={(props.size || 1) + 1} muted>\r\n        <Icon />\r\n      </Text>\r\n      <Text size={props.size || 1} muted={props.muted}>\r\n        {props.text}\r\n      </Text>\r\n    </Flex>\r\n  )\r\n}\r\n\r\nexport default IconInfo\r\n","import type {SVGProps} from 'react'\r\n\r\nexport function ResolutionIcon(props: SVGProps<SVGSVGElement>) {\r\n  return (\r\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"1em\" height=\"1em\" viewBox=\"0 0 24 24\" {...props}>\r\n      <path\r\n        fill=\"currentColor\"\r\n        d=\"M20 9V6h-3V4h5v5h-2ZM2 9V4h5v2H4v3H2Zm15 11v-2h3v-3h2v5h-5ZM2 20v-5h2v3h3v2H2Zm4-4V8h12v8H6Zm2-2h8v-4H8v4Zm0 0v-4v4Z\"\r\n      />\r\n    </svg>\r\n  )\r\n}\r\n","import type {SVGProps} from 'react'\r\n\r\nexport function StopWatchIcon(props: SVGProps<SVGSVGElement>) {\r\n  return (\r\n    <svg\r\n      xmlns=\"http://www.w3.org/2000/svg\"\r\n      width=\"1em\"\r\n      height=\"1em\"\r\n      viewBox=\"0 0 512 512\"\r\n      {...props}\r\n    >\r\n      <path d=\"M232 306.667h48V176h-48v130.667z\" fill=\"currentColor\" />\r\n      <path\r\n        d=\"M407.67 170.271l30.786-30.786-33.942-33.941-30.785 30.786C341.217 111.057 300.369 96 256 96 149.961 96 64 181.961 64 288s85.961 192 192 192 192-85.961 192-192c0-44.369-15.057-85.217-40.33-117.729zm-45.604 223.795C333.734 422.398 296.066 438 256 438s-77.735-15.602-106.066-43.934C121.602 365.735 106 328.066 106 288s15.602-77.735 43.934-106.066C178.265 153.602 215.934 138 256 138s77.734 15.602 106.066 43.934C390.398 210.265 406 247.934 406 288s-15.602 77.735-43.934 106.066z\"\r\n        fill=\"currentColor\"\r\n      />\r\n      <path d=\"M192 32h128v48H192z\" fill=\"currentColor\" />\r\n    </svg>\r\n  )\r\n}\r\n","import {useToast} from '@sanity/ui'\r\nimport {useCallback, useState} from 'react'\r\n\r\nimport {getAsset} from '../actions/assets'\r\nimport {addKeysToMuxData} from '../util/addKeysToMuxData'\r\nimport type {MuxAsset, VideoAssetDocument} from '../util/types'\r\nimport {useClient} from './useClient'\r\n\r\ntype ResyncAssetState = 'idle' | 'syncing' | 'success' | 'error'\r\n\r\ninterface UseResyncAssetOptions {\r\n  showToast?: boolean\r\n  onSuccess?: (updatedData: MuxAsset) => void\r\n  onError?: (error: unknown) => void\r\n}\r\n\r\ninterface UseResyncAssetReturn {\r\n  resyncState: ResyncAssetState\r\n  resyncError: unknown\r\n  resyncAsset: (asset: VideoAssetDocument) => Promise<MuxAsset | undefined>\r\n  isResyncing: boolean\r\n}\r\n\r\nexport function useResyncAsset(options?: UseResyncAssetOptions): UseResyncAssetReturn {\r\n  const client = useClient()\r\n  const toast = useToast()\r\n  const [resyncState, setResyncState] = useState<ResyncAssetState>('idle')\r\n  const [resyncError, setResyncError] = useState<unknown>(null)\r\n\r\n  const showToast = options?.showToast ?? false\r\n\r\n  const resyncAsset = useCallback(\r\n    async (asset: VideoAssetDocument) => {\r\n      if (!asset.assetId) {\r\n        if (showToast) {\r\n          toast.push({\r\n            title: 'Cannot resync',\r\n            description: 'Asset has no Mux ID',\r\n            status: 'error',\r\n          })\r\n        }\r\n        options?.onError?.(new Error('Asset has no Mux ID'))\r\n        return undefined\r\n      }\r\n\r\n      if (!asset._id) {\r\n        if (showToast) {\r\n          toast.push({\r\n            title: 'Cannot resync',\r\n            description: 'Asset has no document ID',\r\n            status: 'error',\r\n          })\r\n        }\r\n        options?.onError?.(new Error('Asset has no document ID'))\r\n        return undefined\r\n      }\r\n\r\n      setResyncState('syncing')\r\n      setResyncError(null)\r\n\r\n      try {\r\n        const response = await getAsset(client, asset.assetId)\r\n        const muxData = response.data\r\n        const dataWithKeys = addKeysToMuxData(muxData)\r\n\r\n        await client\r\n          .patch(asset._id)\r\n          .set({\r\n            status: muxData.status,\r\n            data: dataWithKeys,\r\n            ...(muxData.meta?.title && {filename: muxData.meta.title}),\r\n          })\r\n          .commit({returnDocuments: false})\r\n\r\n        setResyncState('success')\r\n        if (showToast) {\r\n          toast.push({\r\n            title: 'Asset synced',\r\n            description: 'Data has been updated from Mux',\r\n            status: 'success',\r\n          })\r\n        }\r\n\r\n        options?.onSuccess?.(muxData)\r\n        return muxData\r\n      } catch (error) {\r\n        setResyncState('error')\r\n        setResyncError(error)\r\n        console.error('Failed to refresh asset data:', error)\r\n        if (showToast) {\r\n          toast.push({\r\n            title: 'Sync failed',\r\n            description: 'Could not sync asset from Mux',\r\n            status: 'error',\r\n          })\r\n        }\r\n        options?.onError?.(error)\r\n        return undefined\r\n      }\r\n    },\r\n    [client, toast, options, showToast]\r\n  )\r\n\r\n  return {\r\n    resyncState,\r\n    resyncError,\r\n    resyncAsset,\r\n    isResyncing: resyncState === 'syncing',\r\n  }\r\n}\r\n","import type {SanityClient} from '@sanity/client'\r\n\r\nimport {getAsset} from '../actions/assets'\r\nimport {generateJwt} from './generateJwt'\r\nimport {getPlaybackId} from './getPlaybackPolicy'\r\nimport {getPlaybackPolicy} from './getPlaybackPolicy'\r\nimport type {MuxTextTrack, VideoAssetDocument} from './types'\r\n\r\nexport function extractErrorMessage(\r\n  error: unknown,\r\n  defaultMessage = 'Failed to process request'\r\n): string {\r\n  let message = ''\r\n\r\n  if (error && typeof error === 'object') {\r\n    const err = error as {response?: {body?: {message?: string}}; message?: string}\r\n    message = err.response?.body?.message || err.message || ''\r\n  } else if (typeof error === 'string') {\r\n    message = error\r\n  }\r\n\r\n  if (!message) {\r\n    return defaultMessage\r\n  }\r\n\r\n  const match = message.match(/\\(([^)]+)\\)/)\r\n  if (match && match[1]) {\r\n    return match[1]\r\n  }\r\n\r\n  if (message.includes('responded with')) {\r\n    const parts = message.split('(')\r\n    if (parts.length > 1) {\r\n      return parts[parts.length - 1].replace(')', '').trim()\r\n    }\r\n  }\r\n\r\n  return message\r\n}\r\n\r\nexport interface PollTrackStatusOptions {\r\n  client: SanityClient\r\n  assetId: string\r\n  trackName: string\r\n  trackLanguageCode: string\r\n  maxAttempts?: number\r\n  onTrackFound?: (track: MuxTextTrack) => void\r\n  onTrackErrored?: (track: MuxTextTrack) => void\r\n  onTrackReady?: (track: MuxTextTrack) => void\r\n}\r\n\r\nexport interface PollTrackStatusResult {\r\n  track: MuxTextTrack | undefined\r\n  found: boolean\r\n  status: 'ready' | 'preparing' | 'errored' | 'not-found'\r\n}\r\n\r\n/**\r\n * Polls Mux API to find and track the status of a newly added text track.\r\n * The track may be in \"preparing\" state initially, then become \"ready\" or \"errored\".\r\n *\r\n * @param options - Configuration options for polling\r\n * @returns Promise resolving to the poll result\r\n */\r\nexport async function pollTrackStatus(\r\n  options: PollTrackStatusOptions\r\n): Promise<PollTrackStatusResult> {\r\n  const {\r\n    client,\r\n    assetId,\r\n    trackName,\r\n    trackLanguageCode,\r\n    maxAttempts = 10,\r\n    onTrackFound,\r\n    onTrackErrored,\r\n    onTrackReady,\r\n  } = options\r\n\r\n  const trimmedName = trackName.trim()\r\n  const trimmedLanguageCode = trackLanguageCode.trim()\r\n  let newTrack: MuxTextTrack | undefined\r\n  let attempts = 0\r\n  let trackFound = false\r\n\r\n  const findTrack = (textTracks: MuxTextTrack[]): MuxTextTrack | undefined => {\r\n    let foundTrack = textTracks.find(\r\n      (track) => track.name === trimmedName && track.language_code === trimmedLanguageCode\r\n    )\r\n\r\n    if (!foundTrack) {\r\n      foundTrack = textTracks.find((track) => track.language_code === trimmedLanguageCode)\r\n    }\r\n\r\n    if (!foundTrack && textTracks.length > 0) {\r\n      foundTrack = textTracks[textTracks.length - 1]\r\n    }\r\n\r\n    return foundTrack\r\n  }\r\n\r\n  while (attempts < maxAttempts) {\r\n    try {\r\n      if (attempts > 0) {\r\n        await new Promise((resolve) => setTimeout(resolve, 1000))\r\n      }\r\n\r\n      const assetData = await getAsset(client, assetId)\r\n      const textTracks =\r\n        assetData.data.tracks?.filter((track): track is MuxTextTrack => track.type === 'text') || []\r\n\r\n      const foundTrack = findTrack(textTracks)\r\n\r\n      if (!foundTrack) {\r\n        attempts++\r\n        continue\r\n      }\r\n\r\n      trackFound = true\r\n      newTrack = foundTrack\r\n\r\n      if (onTrackFound) {\r\n        onTrackFound(foundTrack)\r\n      }\r\n\r\n      if (foundTrack.status === 'ready') {\r\n        if (onTrackReady) {\r\n          onTrackReady(foundTrack)\r\n        }\r\n        break\r\n      }\r\n\r\n      if (foundTrack.status === 'errored') {\r\n        if (onTrackErrored) {\r\n          onTrackErrored(foundTrack)\r\n        }\r\n        return {\r\n          track: foundTrack,\r\n          found: true,\r\n          status: 'errored',\r\n        }\r\n      }\r\n    } catch (error) {\r\n      console.error('Failed to fetch updated asset:', error)\r\n    }\r\n\r\n    attempts++\r\n  }\r\n\r\n  if (!newTrack || !trackFound) {\r\n    return {\r\n      track: undefined,\r\n      found: false,\r\n      status: 'not-found',\r\n    }\r\n  }\r\n\r\n  if (newTrack.status === 'preparing') {\r\n    return {\r\n      track: newTrack,\r\n      found: true,\r\n      status: 'preparing',\r\n    }\r\n  }\r\n\r\n  return {\r\n    track: newTrack,\r\n    found: true,\r\n    status: 'ready',\r\n  }\r\n}\r\n\r\n/**\r\n * May throw a Promise. Call this with {@link tryWithSuspend} or rethrow the Promise\r\n */\r\nexport async function downloadVttFile(\r\n  client: SanityClient,\r\n  asset: VideoAssetDocument,\r\n  track: MuxTextTrack\r\n): Promise<void> {\r\n  if (!track.id) {\r\n    throw new Error('Track ID is missing')\r\n  }\r\n\r\n  if (track.status !== 'ready') {\r\n    throw new Error(`Track is not ready yet. Status: ${track.status}`)\r\n  }\r\n\r\n  if (!asset.assetId) {\r\n    throw new Error('Asset ID is required')\r\n  }\r\n\r\n  const playbackId = getPlaybackId(asset)\r\n  if (!playbackId) {\r\n    throw new Error('Playback ID is required')\r\n  }\r\n\r\n  const playbackPolicy = getPlaybackPolicy(asset)?.policy\r\n\r\n  let downloadUrl = `https://stream.mux.com/${playbackId}/text/${track.id}.vtt`\r\n\r\n  if (playbackPolicy === 'signed' || playbackPolicy === 'drm') {\r\n    const token = generateJwt(client, playbackId, 'v')\r\n    downloadUrl += `?token=${token}`\r\n  }\r\n\r\n  const response = await fetch(downloadUrl)\r\n  if (!response.ok) {\r\n    throw new Error(`Failed to download file: ${response.statusText}`)\r\n  }\r\n\r\n  const blob = await response.blob()\r\n  const blobUrl = URL.createObjectURL(blob)\r\n\r\n  const link = document.createElement('a')\r\n  link.href = blobUrl\r\n  link.download = `${asset.filename || 'captions'}-${track.language_code || 'en'}.vtt`\r\n  document.body.appendChild(link)\r\n  link.click()\r\n  document.body.removeChild(link)\r\n\r\n  URL.revokeObjectURL(blobUrl)\r\n}\r\n","import type MuxPlayerElement from '@mux/mux-player'\r\nimport type {ObjectInputProps, PreviewLayoutKey, PreviewProps, SchemaType} from 'sanity'\r\nimport type {PartialDeep} from 'type-fest'\r\n\r\n/**\r\n * Standard static rendition options available for plugin configuration defaults\r\n */\r\nexport type StandardRendition = 'highest' | 'audio-only'\r\n\r\n/**\r\n * All static rendition resolution options supported by Mux\r\n */\r\nexport type StaticRenditionResolution =\r\n  | 'highest'\r\n  | 'audio-only'\r\n  | '270p'\r\n  | '360p'\r\n  | '480p'\r\n  | '540p'\r\n  | '720p'\r\n  | '1080p'\r\n  | '1440p'\r\n  | '2160p'\r\n\r\nexport interface MuxInputConfig {\r\n  /**\r\n   * Enable static renditions by default. Can be overwritten on a per-asset basis.\r\n   * Supports:\r\n   * - Standard mode: 'highest' (up to 4K MP4) and/or 'audio-only' (M4A)\r\n   * - Advanced mode: Specific resolutions ('270p', '360p', '480p', '540p', '720p', '1080p', '1440p', '2160p') and/or 'audio-only'\r\n   *\r\n   * **Important**: 'highest' cannot be mixed with specific resolutions. If both are provided, only 'highest' will be used.\r\n   *\r\n   * @see {@link https://docs.mux.com/guides/video/enable-static-mp4-renditions}\r\n   * @defaultValue []\r\n   */\r\n  static_renditions: StaticRenditionResolution[]\r\n\r\n  /**\r\n   * @deprecated Use `static_renditions` instead. This field is kept for backward compatibility.\r\n   * Enable static renditions by setting this to 'standard'. Can be overwritten on a per-asset basis.\r\n   * Requires `\"video_quality\": \"plus\"`\r\n   * @see {@link https://docs.mux.com/guides/video/enable-static-mp4-renditions#why-enable-mp4-support}\r\n   * @defaultValue 'none'\r\n   */\r\n  mp4_support: 'none' | 'standard'\r\n\r\n  /**\r\n   * Max resolution tier can be used to control the maximum resolution_tier your asset is encoded, stored, and streamed at.\r\n   * Requires `\"video_quality\": \"plus\"`\r\n   * @see {@link https://docs.mux.com/guides/stream-videos-in-4k}\r\n   * @defaultValue '1080p'\r\n   */\r\n  max_resolution_tier: '2160p' | '1440p' | '1080p'\r\n\r\n  /**\r\n   * @deprecated Use {@link video_quality}\r\n   * <br>\r\n   * The encoding tier informs the cost, quality, and available platform features for the asset.\r\n   * @see {@link https://docs.mux.com/guides/use-encoding-tiers}\r\n   * @defaultValue 'smart'\r\n   */\r\n  encoding_tier?: 'baseline' | 'smart'\r\n\r\n  /**\r\n   * The video quality level informs the cost, quality, and available platform features for the asset.\r\n   * @see {@link https://www.mux.com/docs/guides/use-video-quality-levels}\r\n   * @defaultValue 'plus'\r\n   */\r\n  video_quality: 'basic' | 'plus' | 'premium'\r\n\r\n  /**\r\n   * Normalize the audio track loudness level.\r\n   * @see {@link https://docs.mux.com/guides/adjust-audio-levels#how-to-turn-on-audio-normalization}\r\n   * @defaultValue false\r\n   */\r\n  normalize_audio: boolean\r\n\r\n  /**\r\n   * Enables signed URLs by default, if you configured them with your API token.\r\n   * @see {@link https://docs.mux.com/guides/secure-video-playback}\r\n   * @defaultValue false\r\n   */\r\n  defaultSigned?: boolean\r\n\r\n  /**\r\n   * Enables public URLs by default.\r\n   * @defaultValue true\r\n   */\r\n  defaultPublic?: boolean\r\n\r\n  /**\r\n   * Enables DRM Protection by default, if you configured your DRM Configuration Id.\r\n   * @see {@link https://www.mux.com/docs/guides/protect-videos-with-drm}\r\n   * @defaultValue true\r\n   */\r\n  defaultDrm?: boolean\r\n\r\n  /**\r\n   * Attach an inline copy of an asset's metadata along with its reference.\r\n   * Please note that this copy can become stale if the asset is edited after upload/selection.\r\n   * @defaultValue false\r\n   */\r\n  inlineAssetMetadata?: boolean\r\n\r\n  /**\r\n   * Auto-generate captions for these languages by default.\r\n   * Requires `\"video_quality\": \"plus\"`\r\n   *\r\n   * @see {@link https://docs.mux.com/guides/add-autogenerated-captions-and-use-transcripts}\r\n   * @deprecated use `defaultAutogeneratedSubtitleLang` instead. Only a single autogenerated\r\n   */\r\n  defaultAutogeneratedSubtitleLangs?: SupportedMuxLanguage[]\r\n\r\n  /**\r\n   * Auto-generate captions for this language by default. Users can still\r\n   * Requires `\"video_quality\": \"plus\"`\r\n   *\r\n   * @see {@link https://docs.mux.com/guides/add-autogenerated-captions-and-use-transcripts}\r\n   */\r\n  defaultAutogeneratedSubtitleLang?: SupportedMuxLanguage\r\n\r\n  /**\r\n   * Whether or not to allow content editors to override asset upload\r\n   * configuration settings when uploading a video to Mux.\r\n   *\r\n   * @see {@link https://docs.mux.com/guides/secure-video-playback}\r\n   * @defaultValue false\r\n   */\r\n  disableUploadConfig?: boolean\r\n\r\n  /**\r\n   * Whether or not to allow content editors to add text tracks alongside their\r\n   * asset when uploading a video to Mux.\r\n   *\r\n   * @see {@link https://docs.mux.com/guides/secure-video-playback}\r\n   * @defaultValue false\r\n   */\r\n  disableTextTrackConfig?: boolean\r\n\r\n  /**\r\n   * Whether or not to show the playback warning when trying to watch DRM content for the first time.\r\n   *\r\n   * @defaultValue false\r\n   */\r\n  disableDrmPlaybackWarning?: boolean\r\n\r\n  /**\r\n   * The mime types that are accepted by the input.\r\n   *\r\n    * @see {@link https://developer.mozilla.org/en-US/docs/Web/HTML/Reference/Attributes/accept}\r\n   * @defaultValue ['video/*','audio/*']\r\n\r\n   */\r\n  acceptedMimeTypes?: ('audio/*' | 'video/*')[]\r\n\r\n  /**\r\n   * Maximum file size allowed for video uploads in bytes.\r\n   * If not specified, no file size validation will be performed.\r\n   *\r\n   * @example 1024 * 1024 * 1024 // 1 GB\r\n   * @defaultValue undefined\r\n   */\r\n  maxAssetFileSize?: number\r\n\r\n  /**\r\n   * Maximum video duration allowed in seconds.\r\n   * If not specified, no duration validation will be performed.\r\n   *\r\n   * @example 2 * 60 * 60 // 2 hours\r\n   * @defaultValue undefined\r\n   */\r\n  maxAssetDuration?: number\r\n\r\n  /**\r\n   * HLS.js configuration options to be passed to the Mux Player.\r\n   * These options allow you to customize the underlying HLS.js playback engine behavior.\r\n   *\r\n   * @see {@link https://github.com/video-dev/hls.js/blob/master/docs/API.md#fine-tuning}\r\n   * @defaultValue undefined\r\n   * @example\r\n   * ```ts\r\n   * {\r\n   *   maxBufferLength: 30,\r\n   *   lowLatencyMode: true,\r\n   *   capLevelToPlayerSize: true\r\n   * }\r\n   * ```\r\n   */\r\n  hlsConfig?: MuxPlayerElement['_hlsConfig']\r\n\r\n  /**\r\n   * Whether or not to allow content editors to edit the name of the\r\n   * asset when uploading a video to Mux.\r\n   *\r\n   * @defaultValue false\r\n   */\r\n  disableAssetNameConfig?: boolean\r\n}\r\n\r\nexport interface PluginConfig extends MuxInputConfig {\r\n  /**\r\n   * How the videos browser should appear as a studio tool in Sanity's top navigation\r\n   *\r\n   * Pass `false` if you want to disable it.\r\n   * @defaultValue {title: 'Videos', icon: VideoIcon}\r\n   **/\r\n  tool:\r\n    | false\r\n    | {\r\n        title?: string\r\n        icon?: React.ComponentType\r\n      }\r\n\r\n  /**\r\n   * The roles that are allowed to configure the plugin.\r\n   *\r\n   * If not set, all roles will be allowed to configure the plugin.\r\n   * @defaultValue []\r\n   */\r\n  allowedRolesForConfiguration: string[]\r\n}\r\n\r\nexport const SUPPORTED_MUX_LANGUAGES = [\r\n  {label: 'English', code: 'en', state: 'Stable'},\r\n  {label: 'Spanish', code: 'es', state: 'Stable'},\r\n  {label: 'Italian', code: 'it', state: 'Stable'},\r\n  {label: 'Portuguese', code: 'pt', state: 'Stable'},\r\n  {label: 'German', code: 'de', state: 'Stable'},\r\n  {label: 'French', code: 'fr', state: 'Stable'},\r\n  {label: 'Polish', code: 'pl', state: 'Beta'},\r\n  {label: 'Russian', code: 'ru', state: 'Beta'},\r\n  {label: 'Dutch', code: 'nl', state: 'Beta'},\r\n  {label: 'Catalan', code: 'ca', state: 'Beta'},\r\n  {label: 'Turkish', code: 'tr', state: 'Beta'},\r\n  {label: 'Swedish', code: 'sv', state: 'Beta'},\r\n  {label: 'Ukrainian', code: 'uk', state: 'Beta'},\r\n  {label: 'Norwegian', code: 'no', state: 'Beta'},\r\n  {label: 'Finnish', code: 'fi', state: 'Beta'},\r\n  {label: 'Slovak', code: 'sk', state: 'Beta'},\r\n  {label: 'Greek', code: 'el', state: 'Beta'},\r\n  {label: 'Czech', code: 'cs', state: 'Beta'},\r\n  {label: 'Croatian', code: 'hr', state: 'Beta'},\r\n  {label: 'Danish', code: 'da', state: 'Beta'},\r\n  {label: 'Romanian', code: 'ro', state: 'Beta'},\r\n  {label: 'Bulgarian', code: 'bg', state: 'Beta'},\r\n] as const\r\n\r\nexport const VIDEO_QUALITY_LEVELS = [\r\n  {label: 'Basic', value: 'basic'},\r\n  {label: 'Plus', value: 'plus'},\r\n  {label: 'Premium', value: 'premium'},\r\n] as const\r\n\r\nexport const SUPPORTED_MUX_LANGUAGES_VALUES = SUPPORTED_MUX_LANGUAGES.map((l) => l.code)\r\n\r\nexport type SupportedMuxLanguage = (typeof SUPPORTED_MUX_LANGUAGES_VALUES)[number]\r\n\r\nexport interface TextTrack {\r\n  _id: string\r\n  name: string\r\n}\r\n\r\nexport interface AutogeneratedTextTrack extends TextTrack {\r\n  type: 'autogenerated'\r\n  language_code: SupportedMuxLanguage\r\n}\r\n\r\nexport interface CustomTextTrack extends TextTrack {\r\n  type: 'subtitles' | 'captions'\r\n  language_code: string\r\n  file: {\r\n    contents: string\r\n    type: string\r\n    name: string\r\n    size: number\r\n  }\r\n}\r\n\r\nexport function isCustomTextTrack(track: Partial<UploadTextTrack>): track is CustomTextTrack {\r\n  return track.type !== 'autogenerated'\r\n}\r\n\r\nexport function isAutogeneratedTrack(\r\n  track: Partial<UploadTextTrack>\r\n): track is AutogeneratedTextTrack {\r\n  return track.type === 'autogenerated'\r\n}\r\n\r\nexport type UploadTextTrack = AutogeneratedTextTrack | CustomTextTrack\r\n\r\nexport interface UploadConfig\r\n  extends Pick<MuxInputConfig, 'max_resolution_tier' | 'normalize_audio' | 'video_quality'> {\r\n  static_renditions: StaticRenditionResolution[]\r\n  text_tracks: UploadTextTrack[]\r\n  signed_policy: boolean\r\n  public_policy: boolean\r\n  drm_policy: boolean\r\n  asset_name?: string\r\n} \r\n\r\n/**\r\n * Data sent to Mux to create a new asset.\r\n * @docs {@link https://docs.mux.com/api-reference#video/operation/create-direct-upload}\r\n */\r\nexport interface MuxNewAssetSettings\r\n  extends Pick<MuxInputConfig, 'max_resolution_tier' | 'normalize_audio' | 'video_quality'> {\r\n  /** Static renditions configuration for downloadable files */\r\n  static_renditions?: {resolution: StaticRenditionResolution}[]\r\n  /** An array of objects that each describe an input file to be used to create the asset.*/\r\n  input?: {\r\n    /** The URL of the file that Mux should download and use. */\r\n    url?: string\r\n    /** Generate subtitle tracks using automatic speech recognition with this configuration. This may only be provided for the first input object (the main input file).  */\r\n    generated_subtitles?: {\r\n      /** A name for this subtitle track. */\r\n      name: string\r\n      /** Arbitrary metadata set for the subtitle track. Max 255 characters. */\r\n      passthrough?: string\r\n      /** The language to generate subtitles in. */\r\n      language_code: SupportedMuxLanguage\r\n    }[]\r\n    /** The time offset in seconds from the beginning of the video indicating the clip's starting marker. */\r\n    start_time?: number\r\n    /** The time offset in seconds from the beginning of the video indicating the clip's ending marker. */\r\n    end_time?: number\r\n    /** This parameter is required for text type tracks. */\r\n    type: 'video' | 'audio' | 'text'\r\n    /** Type of text track. This parameter only supports subtitles value. */\r\n    text_type?: 'subtitles'\r\n    /** The language code value must be a valid BCP 47 specification compliant value. */\r\n    language_code?: string\r\n    /** The name of the track containing a human-readable description. This value must be unique within each group of text or audio track types. */\r\n    name?: string\r\n    /** Indicates the track provides Subtitles for the Deaf or Hard-of-hearing (SDH). */\r\n    closed_captions?: boolean\r\n    /** This optional parameter should be used tracks with type of text and text_type set to subtitles. */\r\n    passthrough?: string\r\n  }[]\r\n\r\n  /** An array of playback policy names that you want applied to this asset and available through playback_ids. */\r\n  playback_policy?: PlaybackPolicy[]\r\n\r\n  /** An array of playback policy objects that you want applied to this asset and available through playback_ids. advanced_playback_policies must be used instead of playback_policies when creating a DRM playback ID. */\r\n  advanced_playback_policies: AdvancedPlaybackPolicy[]\r\n\r\n  /** Arbitrary user-supplied metadata that will be included in the asset details and related webhooks.  */\r\n  passthrough?: string\r\n}\r\n\r\n/** Used by advanced_playback_policies, allows to define DRM config. */\r\nexport type AdvancedPlaybackPolicy = {\r\n  policy: PlaybackPolicy\r\n  drm_configuration_id?: string\r\n}\r\n\r\nexport interface Secrets {\r\n  token: string | null\r\n  secretKey: string | null\r\n  enableSignedUrls: boolean\r\n  signingKeyId: string | null\r\n  signingKeyPrivate: string | null\r\n  drmConfigId: string | null\r\n}\r\n\r\n// This narrowed type indicates that there may be assets that are signed, and we have the secrets to access them\r\n// enabledSignedUrls might be false but that's only relevant for future uploads and their playback policy\r\nexport interface SignableSecrets extends Omit<Secrets, 'signingKeyId' | 'signingKeyPrivate'> {\r\n  signingKeyId: string\r\n  signingKeyPrivate: string\r\n}\r\n\r\nexport type MuxImageOrigin = `https://image.mux.com`\r\nexport type MuxThumbnailUrl = `${MuxImageOrigin}/${string}/thumbnail.png?${string}`\r\nexport type MuxAnimatedThumbnailUrl = `${MuxImageOrigin}/${string}/animated.gif?${string}`\r\nexport type MuxStoryboardUrl = `${MuxImageOrigin}/${string}/storyboard.vtt?${string}`\r\nexport type MuxVideoOrigin = `https://stream.mux.com`\r\nexport type MuxVideoUrl = `${MuxVideoOrigin}/${string}.m3u8?${string}`\r\nexport type MuxApiUrl = MuxThumbnailUrl | MuxAnimatedThumbnailUrl | MuxStoryboardUrl | MuxVideoUrl\r\n\r\n// 'preserve' by default\r\n// @url: https://docs.mux.com/guides/video/get-images-from-a-video#thumbnail-query-string-parameters\r\nexport type FitMode = 'preserve' | 'crop' | 'smartcrop' | 'pad'\r\n\r\nexport interface ThumbnailOptions {\r\n  fit_mode?: FitMode\r\n  height?: number\r\n  time?: number\r\n  width?: number\r\n}\r\n\r\nexport interface AnimatedThumbnailOptions {\r\n  // Starting time code for the animation, if no end is set it'll have a 5s duration\r\n  // The start and end timecodes uses `asset.thumbTime` to create an iOS `Live Photo` effect by showing you the 5 secodnds before, and after, the thumb time`\r\n  start?: number\r\n  // End code, can't be longer than 10s after the start code\r\n  end?: number\r\n  // Max 640px, 320px by default\r\n  width?: number\r\n  // Preserves aspect ratio, like width, you can't set both the height and width, max 640\r\n  height?: number\r\n  // The fps is 15 by default, but can go up to 30\r\n  fps?: number\r\n}\r\n\r\nexport interface AssetThumbnailOptions {\r\n  asset: Pick<VideoAssetDocument, 'playbackId' | 'data' | 'thumbTime' | 'filename' | 'assetId'>\r\n}\r\n\r\nexport type PlaybackPolicy = 'signed' | 'public' | 'drm'\r\n\r\nexport interface MuxErrors {\r\n  type: string\r\n  messages: string[]\r\n}\r\n\r\nexport interface MuxPlaybackId {\r\n  id: string\r\n  policy: PlaybackPolicy\r\n}\r\n\r\nexport interface MuxVideoTrack {\r\n  type: 'video'\r\n  id: string\r\n  max_width: number\r\n  max_height: number\r\n  // if the fps can't be reliably determined, this will be -1\r\n  max_frame_rate: -1 | number\r\n  // top-level duration is always set, while track level duration is not\r\n  duration?: number\r\n}\r\nexport interface MuxAudioTrack {\r\n  type: 'audio'\r\n  id: string\r\n  duration?: number\r\n  max_channels: number\r\n  max_channel_layout: 'stereo' | string\r\n}\r\nexport interface MuxTextTrack {\r\n  type: 'text'\r\n  id: string\r\n  text_type?: 'subtitles'\r\n  // https://docs.mux.com/api-reference/video#operation/list-assets:~:text=text%20type%20tracks.-,tracks%5B%5D.,text_source,-string\r\n  text_source?:\r\n    | 'uploaded'\r\n    | 'embedded'\r\n    | 'generated_live'\r\n    | 'generated_live_final'\r\n    | 'generated_vod'\r\n  // BCP 47 language code\r\n  language_code?: 'en' | 'en-US' | string\r\n  // The name of the track containing a human-readable description. The hls manifest will associate a subtitle text track with this value\r\n  name?: 'English' | string\r\n  closed_captions?: boolean\r\n  //  Max 255 characters\r\n  passthrough?: string\r\n  status: 'preparing' | 'ready' | 'errored'\r\n  error?: {\r\n    type: string\r\n    messages?: string[]\r\n  }\r\n}\r\nexport type MuxTrack = MuxVideoTrack | MuxAudioTrack | MuxTextTrack\r\n// Typings lifted from https://docs.mux.com/api-reference/video#tag/assets\r\nexport interface MuxAsset {\r\n  id: string\r\n  /** In seconds (instead of JS's default milliseconds) */\r\n  created_at: string\r\n  status: 'preparing' | 'ready' | 'errored'\r\n  duration: number\r\n  max_stored_resolution: 'Audio only' | 'SD' | 'HD' | 'FHD' | 'UHD'\r\n  // if the fps can't be reliably determined, this will be -1\r\n  max_stored_frame_rate: -1 | number\r\n  // The aspect ratio of the asset in the form of width:height, for example 16:9\r\n  aspect_ratio: `${number}:${number}`\r\n  playback_ids: MuxPlaybackId[]\r\n  tracks: MuxTrack[]\r\n  errors?: MuxErrors\r\n  upload_id: string\r\n  is_live?: boolean\r\n  // We use passthrough to set the mux.videoAsset._id of the asset that originally uploaded the video\r\n  passthrough: string\r\n  live_stream_id?: string\r\n  master?: {\r\n    status: 'ready' | 'preparing' | 'errored'\r\n    // Temporary URL to master MP4, expires after 24 hours\r\n    url: string\r\n  }\r\n  master_access: 'temporary' | 'none'\r\n  mp4_support: 'standard' | 'none'\r\n  // Asset Identifier of the video used as the source for creating the clip.\r\n  source_asset_id?: string\r\n  // Normalize the audio track loudness level. This parameter is only applicable to on-demand (not live) assets., default false\r\n  normalize_audio?: boolean\r\n  // The object does not exist if no static renditions have been requested\r\n  static_renditions?: {\r\n    status: 'ready' | 'preparing' | 'disabled' | 'errored'\r\n    files: {\r\n      name: string\r\n      ext: 'mp4' | 'm4a'\r\n      height: number\r\n      width: number\r\n      bitrate: number\r\n      filesize: string\r\n      type: 'standard' | 'advanced'\r\n      status: 'ready' | 'preparing' | 'skipped' | 'errored'\r\n      resolution_tier?: string\r\n      resolution?: string\r\n      id: string\r\n      passthrough?: string\r\n    }[]\r\n  }\r\n  recording_times?: {\r\n    started_at: string\r\n    duration: number\r\n    type: 'content' | 'slate'\r\n  }[]\r\n  // https://docs.mux.com/guides/video/minimize-processing-time\r\n  non_standard_input_reasons?: {\r\n    video_codec?: string\r\n    audio_codec?: string\r\n    video_gop_size?: 'high'\r\n    video_frame_rate?: string\r\n    video_resolution?: string\r\n    video_bitrate?: 'high'\r\n    pixel_aspect_ratio?: string\r\n    video_edit_list?: 'non-standard'\r\n    audio_edit_list?: 'non-standard'\r\n    unexpected_media_file_parameters?: 'non-standard'\r\n    test?: boolean\r\n  }\r\n  meta?: {\r\n    title?: string\r\n  }\r\n}\r\n\r\nexport interface VideoAssetDocument {\r\n  _id: string\r\n  _type: 'mux.videoAsset'\r\n  _createdAt: string\r\n  _updatedAt?: string\r\n  status?: string\r\n  assetId?: string\r\n  playbackId?: string\r\n  filename?: string\r\n  thumbTime?: number\r\n  // Docs for what goes in `data` https://docs.mux.com/api-reference/video#tag/assets\r\n  data?: PartialDeep<MuxAsset>\r\n}\r\n\r\nexport type Reference = {_type: 'reference'; _ref: string}\r\n\r\n// @TODO add Reference, and ReferenceSchemaType in the generic\r\nexport type MuxInputProps = ObjectInputProps<{\r\n  asset?: Reference\r\n}>\r\n\r\nexport interface MuxInputPreviewProps extends Omit<PreviewProps<PreviewLayoutKey>, 'value'> {\r\n  schemaType: SchemaType\r\n  value?: {\r\n    asset?: Reference\r\n  } | null\r\n}\r\n\r\n/** Whether the VideosBrowser was opened from a field in a document, or from the standalone studio tool */\r\nexport type PluginPlacement = 'input' | 'tool'\r\n","import {TranslateIcon, UploadIcon} from '@sanity/icons'\r\nimport {\r\n  Autocomplete,\r\n  Button,\r\n  Card,\r\n  Checkbox,\r\n  Dialog,\r\n  Flex,\r\n  Label,\r\n  Spinner,\r\n  Stack,\r\n  Text,\r\n  TextInput,\r\n  useToast,\r\n} from '@sanity/ui'\r\nimport LanguagesList from 'iso-639-1'\r\nimport {useId, useRef, useState} from 'react'\r\n\r\nimport {addTextTrackFromUrl, generateSubtitles, getAsset} from '../actions/assets'\r\nimport {useClient} from '../hooks/useClient'\r\nimport {extractErrorMessage, pollTrackStatus} from '../util/textTracks'\r\nimport {type MuxTextTrack, SUPPORTED_MUX_LANGUAGES, type VideoAssetDocument} from '../util/types'\r\n\r\nconst LANGUAGE_OPTIONS = LanguagesList.getAllCodes().map((code) => ({\r\n  value: code,\r\n  label: LanguagesList.getNativeName(code),\r\n}))\r\n\r\nconst MUX_LANGUAGE_OPTIONS = SUPPORTED_MUX_LANGUAGES.map((lang) => ({\r\n  value: lang.code,\r\n  label: lang.label,\r\n}))\r\n\r\nexport interface Props {\r\n  asset: VideoAssetDocument\r\n  onAdd: (track: MuxTextTrack) => void\r\n  onClose: () => void\r\n}\r\n\r\nexport default function AddCaptionDialog({asset, onAdd, onClose}: Props) {\r\n  const client = useClient()\r\n  const toast = useToast()\r\n  const dialogId = `AddCaptionDialog${useId()}`\r\n\r\n  const [isAutogenerated, setIsAutogenerated] = useState(false)\r\n  const [vttUrl, setVttUrl] = useState('')\r\n  const [languageCode, setLanguageCode] = useState('')\r\n  const [selectedLanguage, setSelectedLanguage] = useState<{value: string; label: string} | null>(\r\n    null\r\n  )\r\n  const [name, setName] = useState('')\r\n  const [isSubmitting, setIsSubmitting] = useState(false)\r\n  const [selectedFile, setSelectedFile] = useState<File | null>(null)\r\n  const fileInputRef = useRef<HTMLInputElement>(null)\r\n\r\n  const uploadVttFile = async (file: File): Promise<string> => {\r\n    const assetDocument = await client.assets.upload('file', file, {\r\n      filename: file.name,\r\n    })\r\n    return assetDocument.url\r\n  }\r\n\r\n  const handleAddTrackFromUrl = async () => {\r\n    if (!asset.assetId) {\r\n      throw new Error('Asset ID is required')\r\n    }\r\n\r\n    const trimmedName = name.trim()\r\n    const trimmedLanguageCode = languageCode.trim()\r\n\r\n    let vttUrlToUse = vttUrl.trim()\r\n\r\n    if (selectedFile) {\r\n      try {\r\n        vttUrlToUse = await uploadVttFile(selectedFile)\r\n      } catch (uploadError) {\r\n        toast.push({\r\n          title: 'Failed to upload VTT file',\r\n          status: 'error',\r\n          description: 'Could not upload the VTT file to Sanity. Please try again.',\r\n        })\r\n        setIsSubmitting(false)\r\n        throw uploadError\r\n      }\r\n    }\r\n\r\n    await addTextTrackFromUrl(client, asset.assetId, vttUrlToUse, {\r\n      language_code: trimmedLanguageCode,\r\n      name: trimmedName,\r\n      text_type: 'subtitles',\r\n    })\r\n\r\n    const result = await pollTrackStatus({\r\n      client,\r\n      assetId: asset.assetId,\r\n      trackName: trimmedName,\r\n      trackLanguageCode: trimmedLanguageCode,\r\n      onTrackErrored: (track) => {\r\n        const errorMessage =\r\n          track.error?.messages?.[0] ||\r\n          track.error?.type ||\r\n          'The track failed to download from the provided URL'\r\n        toast.push({\r\n          title: 'Caption track failed',\r\n          status: 'error',\r\n          description: errorMessage,\r\n        })\r\n        onAdd(track)\r\n        onClose()\r\n      },\r\n    })\r\n\r\n    if (!result.found || !result.track) {\r\n      toast.push({\r\n        title: 'Caption track may have been added',\r\n        status: 'warning',\r\n        description:\r\n          'The track was created but its status could not be determined. It may still be processing. Please refresh the page to see if it appears.',\r\n      })\r\n      onClose()\r\n      return\r\n    }\r\n\r\n    if (result.status === 'errored') {\r\n      return\r\n    }\r\n\r\n    if (result.status === 'preparing') {\r\n      toast.push({\r\n        title: 'Caption track is processing',\r\n        status: 'info',\r\n        description:\r\n          'The track was created and is being processed. It will appear in the list shortly.',\r\n      })\r\n      onAdd(result.track)\r\n      onClose()\r\n      return\r\n    }\r\n\r\n    toast.push({\r\n      title: 'Caption track added',\r\n      status: 'success',\r\n      description: 'Caption track added successfully',\r\n    })\r\n\r\n    onAdd(result.track)\r\n    onClose()\r\n  }\r\n\r\n  const handleGenerateSubtitles = async () => {\r\n    if (!asset.assetId) {\r\n      throw new Error('Asset ID is required')\r\n    }\r\n\r\n    const assetData = await getAsset(client, asset.assetId)\r\n    const audioTrack = assetData.data.tracks?.find((track) => track.type === 'audio')\r\n\r\n    if (!audioTrack || !audioTrack.id) {\r\n      toast.push({\r\n        title: 'No audio track found',\r\n        status: 'error',\r\n        description:\r\n          'The asset does not have an audio track. Auto-generated subtitles require an audio track.',\r\n      })\r\n      throw new Error('No audio track found')\r\n    }\r\n\r\n    await generateSubtitles(client, asset.assetId, audioTrack.id, {\r\n      language_code: languageCode.trim(),\r\n      name: name.trim(),\r\n    })\r\n\r\n    const mockTrackId = `generating-${Date.now()}-${Math.random().toString(36).slice(2, 11)}`\r\n    const mockTrack: MuxTextTrack = {\r\n      type: 'text',\r\n      id: mockTrackId,\r\n      text_type: 'subtitles',\r\n      text_source: 'generated_live',\r\n      language_code: languageCode.trim(),\r\n      name: name.trim(),\r\n      status: 'preparing',\r\n    }\r\n\r\n    toast.push({\r\n      title: 'Generating subtitles',\r\n      status: 'success',\r\n      description: 'This may take a few minutes',\r\n    })\r\n\r\n    onAdd(mockTrack)\r\n    onClose()\r\n  }\r\n\r\n  const handleSubmit = async () => {\r\n    if (!isAutogenerated) {\r\n      if (!selectedFile && !vttUrl.trim()) {\r\n        toast.push({\r\n          title: 'VTT file or URL required',\r\n          status: 'error',\r\n          description: 'Please select a VTT file or enter a VTT file URL',\r\n        })\r\n        return\r\n      }\r\n\r\n      if (vttUrl.trim() && !selectedFile) {\r\n        try {\r\n          void new URL(vttUrl.trim())\r\n        } catch {\r\n          toast.push({\r\n            title: 'Invalid URL',\r\n            status: 'error',\r\n            description: 'Please enter a valid URL (e.g., https://example.com/subtitles.vtt)',\r\n          })\r\n          return\r\n        }\r\n      }\r\n    }\r\n\r\n    if (!name.trim()) {\r\n      toast.push({\r\n        title: 'Audio name required',\r\n        status: 'error',\r\n        description: 'Please enter an audio name for this caption track',\r\n      })\r\n      return\r\n    }\r\n\r\n    if (!languageCode.trim()) {\r\n      toast.push({\r\n        title: 'Language code required',\r\n        status: 'error',\r\n        description: 'Please enter a language code (e.g., en, es, fr)',\r\n      })\r\n      return\r\n    }\r\n\r\n    setIsSubmitting(true)\r\n\r\n    try {\r\n      if (isAutogenerated) {\r\n        await handleGenerateSubtitles()\r\n      } else {\r\n        await handleAddTrackFromUrl()\r\n      }\r\n    } catch (error) {\r\n      toast.push({\r\n        title: 'Failed to add caption track',\r\n        status: 'error',\r\n        description: extractErrorMessage(error, 'Failed to add caption track'),\r\n      })\r\n    } finally {\r\n      setIsSubmitting(false)\r\n    }\r\n  }\r\n\r\n  return (\r\n    <Dialog\r\n      id={dialogId}\r\n      header=\"Add Caption Track\"\r\n      onClose={onClose}\r\n      width={1}\r\n      onClickOutside={onClose}\r\n    >\r\n      <Stack padding={4} space={4}>\r\n        <Stack space={2}>\r\n          <Flex align=\"center\" marginBottom={3}>\r\n            <Checkbox\r\n              id=\"autogenerated-checkbox\"\r\n              style={{display: 'block'}}\r\n              checked={isAutogenerated}\r\n              onChange={(e) => {\r\n                setIsAutogenerated(e.currentTarget.checked)\r\n                if (e.currentTarget.checked) {\r\n                  setVttUrl('')\r\n                }\r\n              }}\r\n              disabled={isSubmitting}\r\n            />\r\n            <Flex flex={1} paddingLeft={2}>\r\n              <Text>\r\n                <label htmlFor=\"autogenerated-checkbox\">Generate captions</label>\r\n              </Text>\r\n            </Flex>\r\n          </Flex>\r\n          {!isAutogenerated && (\r\n            <Stack space={2}>\r\n              <Card padding={3} marginBottom={2} tone=\"transparent\" border radius={2}>\r\n                <Flex align=\"center\" justify=\"space-between\">\r\n                  <Text size={1} muted>\r\n                    {selectedFile ? `Selected: ${selectedFile.name}` : 'No file selected'}\r\n                  </Text>\r\n                  <Button\r\n                    icon={UploadIcon}\r\n                    text=\"Select File\"\r\n                    mode=\"ghost\"\r\n                    tone=\"primary\"\r\n                    fontSize={1}\r\n                    padding={2}\r\n                    onClick={() => fileInputRef.current?.click()}\r\n                    disabled={isSubmitting}\r\n                  />\r\n                </Flex>\r\n                <input\r\n                  ref={fileInputRef}\r\n                  type=\"file\"\r\n                  accept=\".vtt,text/vtt\"\r\n                  style={{display: 'none'}}\r\n                  onChange={(e) => {\r\n                    if (e.target.files && e.target.files.length > 0 && !isSubmitting) {\r\n                      setSelectedFile(e.target.files[0])\r\n                      setVttUrl('')\r\n                    }\r\n                  }}\r\n                />\r\n              </Card>\r\n              <Text size={1} muted style={{textAlign: 'center'}}>\r\n                Or enter the VTT file URL\r\n              </Text>\r\n              <Stack space={2}>\r\n                <Label htmlFor=\"vtt-url\">VTT File URL</Label>\r\n                <TextInput\r\n                  id=\"vtt-url\"\r\n                  placeholder=\"https://example.com/subtitles.vtt\"\r\n                  value={vttUrl}\r\n                  onChange={(e) => {\r\n                    setVttUrl(e.currentTarget.value)\r\n                    setSelectedFile(null)\r\n                  }}\r\n                  disabled={isSubmitting}\r\n                />\r\n              </Stack>\r\n            </Stack>\r\n          )}\r\n        </Stack>\r\n\r\n        <Stack space={2}>\r\n          <Label htmlFor=\"caption-name\">Audio name</Label>\r\n          <Autocomplete\r\n            id=\"caption-name\"\r\n            value={selectedLanguage?.value || ''}\r\n            onChange={(newValue) => {\r\n              const options = isAutogenerated ? MUX_LANGUAGE_OPTIONS : LANGUAGE_OPTIONS\r\n              const selected = options.find((opt) => opt.value === newValue)\r\n              if (selected) {\r\n                setSelectedLanguage(selected)\r\n                setLanguageCode(selected.value)\r\n                setName(selected.label)\r\n              }\r\n            }}\r\n            options={isAutogenerated ? MUX_LANGUAGE_OPTIONS : LANGUAGE_OPTIONS}\r\n            icon={TranslateIcon}\r\n            placeholder=\"Select language\"\r\n            filterOption={(query, option) =>\r\n              option.label.toLowerCase().indexOf(query.toLowerCase()) > -1 ||\r\n              option.value.toLowerCase().indexOf(query.toLowerCase()) > -1\r\n            }\r\n            openButton\r\n            renderValue={(value) =>\r\n              (isAutogenerated ? MUX_LANGUAGE_OPTIONS : LANGUAGE_OPTIONS).find(\r\n                (l) => l.value === value\r\n              )?.label || value\r\n            }\r\n            renderOption={(option) => (\r\n              <Card data-as=\"button\" padding={3} radius={2} tone=\"inherit\">\r\n                <Text size={2} textOverflow=\"ellipsis\">\r\n                  {option.label} ({option.value})\r\n                </Text>\r\n              </Card>\r\n            )}\r\n            disabled={isSubmitting}\r\n          />\r\n        </Stack>\r\n\r\n        <Stack space={2}>\r\n          <Label htmlFor=\"caption-language\">Language Code</Label>\r\n          <TextInput\r\n            id=\"caption-language\"\r\n            placeholder=\"en-US\"\r\n            value={languageCode}\r\n            onChange={(e) => {\r\n              setLanguageCode(e.currentTarget.value)\r\n              if (selectedLanguage && selectedLanguage.value !== e.currentTarget.value) {\r\n                setSelectedLanguage(null)\r\n                if (!name || name === selectedLanguage.label) {\r\n                  setName('')\r\n                }\r\n              }\r\n            }}\r\n            disabled={isSubmitting}\r\n          />\r\n        </Stack>\r\n\r\n        <Flex gap={2} justify=\"flex-end\" marginTop={2}>\r\n          <Button text=\"Cancel\" mode=\"ghost\" onClick={onClose} disabled={isSubmitting} />\r\n          <Button\r\n            text=\"Add Caption Track\"\r\n            tone=\"primary\"\r\n            icon={\r\n              isSubmitting ? (\r\n                <Spinner\r\n                  style={{\r\n                    verticalAlign: 'middle',\r\n                    display: 'inline-block',\r\n                    marginBottom: '-3px',\r\n                    width: '1em',\r\n                    height: '1em',\r\n                    marginRight: '-6px',\r\n                  }}\r\n                />\r\n              ) : (\r\n                <UploadIcon />\r\n              )\r\n            }\r\n            onClick={handleSubmit}\r\n            disabled={isSubmitting}\r\n          />\r\n        </Flex>\r\n      </Stack>\r\n    </Dialog>\r\n  )\r\n}\r\n","import {DownloadIcon, TranslateIcon, UploadIcon} from '@sanity/icons'\r\nimport {\r\n  Autocomplete,\r\n  Button,\r\n  Card,\r\n  Dialog,\r\n  Flex,\r\n  Label,\r\n  Spinner,\r\n  Stack,\r\n  Text,\r\n  TextInput,\r\n  useToast,\r\n} from '@sanity/ui'\r\nimport LanguagesList from 'iso-639-1'\r\nimport {useEffect, useId, useRef, useState} from 'react'\r\n\r\nimport {addTextTrackFromUrl, deleteTextTrack, getAsset} from '../actions/assets'\r\nimport {useClient} from '../hooks/useClient'\r\nimport {generateJwt} from '../util/generateJwt'\r\nimport {getPlaybackId} from '../util/getPlaybackPolicy'\r\nimport {getPlaybackPolicy} from '../util/getPlaybackPolicy'\r\nimport {downloadVttFile, extractErrorMessage, pollTrackStatus} from '../util/textTracks'\r\nimport type {MuxTextTrack, VideoAssetDocument} from '../util/types'\r\n\r\nconst LANGUAGE_OPTIONS = LanguagesList.getAllCodes().map((code) => ({\r\n  value: code,\r\n  label: LanguagesList.getNativeName(code),\r\n}))\r\n\r\nexport interface Props {\r\n  asset: VideoAssetDocument\r\n  track: MuxTextTrack\r\n  onUpdate: (track: MuxTextTrack, oldTrackId?: string) => void\r\n  onClose: () => void\r\n}\r\n\r\nexport default function EditCaptionDialog({asset, track, onUpdate, onClose}: Props) {\r\n  const client = useClient()\r\n  const toast = useToast()\r\n  const dialogId = `EditCaptionDialog${useId()}`\r\n\r\n  const isAutogenerated =\r\n    track.text_source === 'generated_live' ||\r\n    track.text_source === 'generated_live_final' ||\r\n    track.text_source === 'generated_vod'\r\n\r\n  const [vttUrl, setVttUrl] = useState('')\r\n  const [languageCode, setLanguageCode] = useState(track.language_code || '')\r\n  const [selectedLanguage, setSelectedLanguage] = useState<{value: string; label: string} | null>(\r\n    () => {\r\n      const baseCode = track.language_code?.split('-')[0]\r\n      const found = LANGUAGE_OPTIONS.find(\r\n        (opt) => opt.value === track.language_code || opt.value === baseCode\r\n      )\r\n      if (found) return found\r\n      if (track.name) {\r\n        const foundByName = LANGUAGE_OPTIONS.find((opt) => opt.label === track.name)\r\n        if (foundByName) return foundByName\r\n      }\r\n      return null\r\n    }\r\n  )\r\n  const [name, setName] = useState(track.name || '')\r\n  const [isSubmitting, setIsSubmitting] = useState(false)\r\n  const [downloading, setDownloading] = useState(false)\r\n  const [selectedFile, setSelectedFile] = useState<File | null>(null)\r\n  const fileInputRef = useRef<HTMLInputElement>(null)\r\n\r\n  useEffect(() => {\r\n    setLanguageCode(track.language_code || '')\r\n    setName(track.name || '')\r\n    setVttUrl('')\r\n    const baseCode = track.language_code?.split('-')[0]\r\n    const foundByCode = LANGUAGE_OPTIONS.find(\r\n      (opt) => opt.value === track.language_code || opt.value === baseCode\r\n    )\r\n    const foundByName = track.name ? LANGUAGE_OPTIONS.find((opt) => opt.label === track.name) : null\r\n    setSelectedLanguage(foundByCode || foundByName || null)\r\n  }, [track, asset, client])\r\n\r\n  const handleDownloadCurrentFile = async () => {\r\n    setDownloading(true)\r\n    try {\r\n      await downloadVttFile(client, asset, track)\r\n    } catch (error) {\r\n      let errorMessage = 'Please try again'\r\n      let title = 'Failed to download VTT file'\r\n\r\n      if (error instanceof Error) {\r\n        errorMessage = error.message\r\n        if (error.message.includes('Track')) {\r\n          title = 'Cannot download'\r\n        }\r\n      } else if (error === 'Track ID is missing' || error === 'Track is not ready yet') {\r\n        errorMessage = String(error)\r\n        title = 'Cannot download'\r\n      }\r\n\r\n      toast.push({\r\n        title,\r\n        status: 'error',\r\n        description: errorMessage,\r\n      })\r\n    } finally {\r\n      setDownloading(false)\r\n    }\r\n  }\r\n\r\n  const getCurrentFileName = () => {\r\n    if (track.id && asset.filename) {\r\n      return `${asset.filename}-${track.language_code || 'en'}.vtt`\r\n    }\r\n    return `captions-${track.language_code || 'en'}.vtt`\r\n  }\r\n\r\n  const uploadVttFile = async (file: File): Promise<string> => {\r\n    const assetDocument = await client.assets.upload('file', file, {\r\n      filename: file.name,\r\n    })\r\n    return assetDocument.url\r\n  }\r\n\r\n  const refreshAssetData = async () => {\r\n    if (!asset._id || !asset.assetId) return\r\n    try {\r\n      const latestAssetData = await getAsset(client, asset.assetId)\r\n      await client\r\n        .patch(asset._id)\r\n        .set({data: latestAssetData.data, status: latestAssetData.data.status})\r\n        .commit()\r\n    } catch (refreshError) {\r\n      console.error('Failed to refresh asset data:', refreshError)\r\n    }\r\n  }\r\n\r\n  const handleUpdateTrackWithNewUrl = async () => {\r\n    if (!asset.assetId) {\r\n      throw new Error('Asset ID is required')\r\n    }\r\n\r\n    const trimmedName = name.trim()\r\n    const trimmedLanguageCode = languageCode.trim()\r\n\r\n    const oldTrackId = track.id\r\n\r\n    try {\r\n      await deleteTextTrack(client, asset.assetId, oldTrackId)\r\n    } catch (deleteError) {\r\n      toast.push({\r\n        title: 'Failed to delete old track',\r\n        status: 'error',\r\n        description: 'Could not delete the old track. Please try again or delete it manually.',\r\n      })\r\n      setIsSubmitting(false)\r\n      throw deleteError\r\n    }\r\n\r\n    let vttUrlToUse = vttUrl.trim()\r\n\r\n    if (selectedFile) {\r\n      try {\r\n        vttUrlToUse = await uploadVttFile(selectedFile)\r\n      } catch (uploadError) {\r\n        toast.push({\r\n          title: 'Failed to upload VTT file',\r\n          status: 'error',\r\n          description: 'Could not upload the VTT file to Sanity. Please try again.',\r\n        })\r\n        setIsSubmitting(false)\r\n        throw uploadError\r\n      }\r\n    }\r\n\r\n    try {\r\n      await addTextTrackFromUrl(client, asset.assetId, vttUrlToUse, {\r\n        language_code: trimmedLanguageCode,\r\n        name: trimmedName,\r\n        text_type: 'subtitles',\r\n      })\r\n    } catch (error: unknown) {\r\n      toast.push({\r\n        title: 'Failed to update caption track',\r\n        status: 'error',\r\n        description: extractErrorMessage(error, 'Failed to update caption track'),\r\n      })\r\n      setIsSubmitting(false)\r\n      throw error\r\n    }\r\n\r\n    const result = await pollTrackStatus({\r\n      client,\r\n      assetId: asset.assetId,\r\n      trackName: trimmedName,\r\n      trackLanguageCode: trimmedLanguageCode,\r\n      onTrackErrored: async (erroredTrack) => {\r\n        const errorMessage =\r\n          erroredTrack.error?.messages?.[0] ||\r\n          erroredTrack.error?.type ||\r\n          'The track failed to download from the provided URL'\r\n        toast.push({\r\n          title: 'Caption track failed',\r\n          status: 'error',\r\n          description: errorMessage,\r\n        })\r\n        await refreshAssetData()\r\n        onUpdate(erroredTrack, oldTrackId)\r\n        setIsSubmitting(false)\r\n      },\r\n    })\r\n\r\n    if (!result.found || !result.track) {\r\n      toast.push({\r\n        title: 'Caption track may have been updated',\r\n        status: 'warning',\r\n        description:\r\n          'The track was updated but its status could not be determined. It may still be processing. Please refresh the page to see if it appears.',\r\n      })\r\n      setIsSubmitting(false)\r\n      return\r\n    }\r\n\r\n    if (result.status === 'errored') {\r\n      return\r\n    }\r\n\r\n    await refreshAssetData()\r\n\r\n    if (result.status === 'preparing') {\r\n      toast.push({\r\n        title: 'Caption track is processing',\r\n        status: 'info',\r\n        description:\r\n          'The track was updated and is being processed. It will appear in the list shortly.',\r\n      })\r\n    } else {\r\n      toast.push({\r\n        title: 'Caption track updated',\r\n        status: 'success',\r\n        description: 'Caption track updated successfully',\r\n      })\r\n    }\r\n\r\n    onUpdate(result.track, oldTrackId)\r\n    setIsSubmitting(false)\r\n  }\r\n\r\n  const handleSubmit = async () => {\r\n    if (!name.trim()) {\r\n      toast.push({\r\n        title: 'Audio name required',\r\n        status: 'error',\r\n        description: 'Please enter an audio name for this caption track',\r\n      })\r\n      return\r\n    }\r\n\r\n    if (!languageCode.trim()) {\r\n      toast.push({\r\n        title: 'Language code required',\r\n        status: 'error',\r\n        description: 'Please enter a language code (e.g., en, es, fr)',\r\n      })\r\n      return\r\n    }\r\n\r\n    setIsSubmitting(true)\r\n\r\n    try {\r\n      if (!asset.assetId) {\r\n        throw new Error('Asset ID is required')\r\n      }\r\n\r\n      const originalVttUrl = (() => {\r\n        if (isAutogenerated || !track.id) return ''\r\n        const playbackId = getPlaybackId(asset)\r\n        if (!playbackId) return ''\r\n        let url = `https://stream.mux.com/${playbackId}/text/${track.id}.vtt`\r\n        if (getPlaybackPolicy(asset)?.policy === 'signed') {\r\n          const token = generateJwt(client, playbackId, 'v')\r\n          url += `?token=${token}`\r\n        }\r\n        return url\r\n      })()\r\n\r\n      const urlChanged =\r\n        selectedFile !== null || (vttUrl.trim() && vttUrl.trim() !== originalVttUrl)\r\n\r\n      if (!urlChanged) {\r\n        toast.push({\r\n          title: 'No changes',\r\n          status: 'info',\r\n          description:\r\n            'Please provide a new VTT file or URL using the \"Replace\" button or URL field to update the track.',\r\n        })\r\n        setIsSubmitting(false)\r\n        return\r\n      }\r\n\r\n      if (urlChanged) {\r\n        if (!selectedFile && vttUrl.trim()) {\r\n          try {\r\n            void new URL(vttUrl.trim())\r\n          } catch {\r\n            toast.push({\r\n              title: 'Invalid URL',\r\n              status: 'error',\r\n              description: 'Please enter a valid URL (e.g., https://example.com/subtitles.vtt)',\r\n            })\r\n            setIsSubmitting(false)\r\n            return\r\n          }\r\n        }\r\n\r\n        if (!selectedFile && !vttUrl.trim()) {\r\n          toast.push({\r\n            title: 'VTT file or URL required',\r\n            status: 'error',\r\n            description: 'Please select a VTT file or enter a VTT file URL',\r\n          })\r\n          setIsSubmitting(false)\r\n          return\r\n        }\r\n\r\n        await handleUpdateTrackWithNewUrl()\r\n      }\r\n\r\n      onClose()\r\n    } catch (error) {\r\n      toast.push({\r\n        title: 'Failed to update caption track',\r\n        status: 'error',\r\n        description: error instanceof Error ? error.message : 'Please try again',\r\n      })\r\n    } finally {\r\n      setIsSubmitting(false)\r\n    }\r\n  }\r\n\r\n  return (\r\n    <Dialog\r\n      id={dialogId}\r\n      header=\"Edit Caption Track\"\r\n      onClose={onClose}\r\n      width={1}\r\n      onClickOutside={onClose}\r\n    >\r\n      <Stack padding={4} space={4}>\r\n        <Stack space={2}>\r\n          <Card padding={3} marginBottom={2} tone=\"transparent\" border radius={2}>\r\n            <Flex align=\"center\" justify=\"space-between\">\r\n              <Text>{getCurrentFileName()}</Text>\r\n              <Flex gap={2}>\r\n                {track.status !== 'errored' && (\r\n                  <Button\r\n                    icon={\r\n                      downloading ? (\r\n                        <Spinner\r\n                          style={{\r\n                            verticalAlign: 'middle',\r\n                            display: 'inline-block',\r\n                            marginTop: '-2px',\r\n                            width: '0.5em',\r\n                            height: '0.5em',\r\n                          }}\r\n                        />\r\n                      ) : (\r\n                        <DownloadIcon />\r\n                      )\r\n                    }\r\n                    text=\"Download\"\r\n                    mode=\"ghost\"\r\n                    tone=\"primary\"\r\n                    fontSize={1}\r\n                    padding={2}\r\n                    onClick={handleDownloadCurrentFile}\r\n                    disabled={downloading || isSubmitting}\r\n                  />\r\n                )}\r\n                <Button\r\n                  icon={UploadIcon}\r\n                  text=\"Replace\"\r\n                  mode=\"ghost\"\r\n                  tone=\"primary\"\r\n                  fontSize={1}\r\n                  padding={2}\r\n                  onClick={() => fileInputRef.current?.click()}\r\n                  disabled={isSubmitting}\r\n                />\r\n              </Flex>\r\n            </Flex>\r\n            <input\r\n              ref={fileInputRef}\r\n              type=\"file\"\r\n              accept=\".vtt,text/vtt\"\r\n              style={{display: 'none'}}\r\n              onChange={(e) => {\r\n                if (e.target.files && e.target.files.length > 0 && !isSubmitting) {\r\n                  setSelectedFile(e.target.files[0])\r\n                  setVttUrl('')\r\n                }\r\n              }}\r\n            />\r\n            {selectedFile && (\r\n              <Text size={1} muted style={{marginTop: 8}}>\r\n                Selected: {selectedFile.name}\r\n              </Text>\r\n            )}\r\n          </Card>\r\n          <Stack space={2}>\r\n            <Label htmlFor=\"vtt-url\">VTT File URL</Label>\r\n            <TextInput\r\n              id=\"vtt-url\"\r\n              placeholder=\"https://example.com/subtitles.vtt\"\r\n              value={vttUrl}\r\n              onChange={(e) => {\r\n                setVttUrl(e.currentTarget.value)\r\n                setSelectedFile(null)\r\n              }}\r\n              disabled={isSubmitting}\r\n            />\r\n            <Text size={1} muted>\r\n              Add a URL to replace the existing VTT file with a new one\r\n            </Text>\r\n          </Stack>\r\n        </Stack>\r\n\r\n        <Stack space={2}>\r\n          <Label htmlFor=\"caption-name\">Audio name</Label>\r\n          <Autocomplete\r\n            id=\"caption-name\"\r\n            value={selectedLanguage?.value || ''}\r\n            onChange={(newValue) => {\r\n              const selected = LANGUAGE_OPTIONS.find((opt) => opt.value === newValue)\r\n              if (selected) {\r\n                setSelectedLanguage(selected)\r\n                setLanguageCode(selected.value)\r\n                setName(selected.label)\r\n              }\r\n            }}\r\n            options={LANGUAGE_OPTIONS}\r\n            icon={TranslateIcon}\r\n            placeholder=\"Select language\"\r\n            filterOption={(query, option) =>\r\n              option.label.toLowerCase().indexOf(query.toLowerCase()) > -1 ||\r\n              option.value.toLowerCase().indexOf(query.toLowerCase()) > -1\r\n            }\r\n            openButton\r\n            renderValue={(value) => LANGUAGE_OPTIONS.find((l) => l.value === value)?.label || value}\r\n            renderOption={(option) => (\r\n              <Card data-as=\"button\" padding={3} radius={2} tone=\"inherit\">\r\n                <Text size={2} textOverflow=\"ellipsis\">\r\n                  {option.label} ({option.value})\r\n                </Text>\r\n              </Card>\r\n            )}\r\n            disabled={isSubmitting}\r\n          />\r\n        </Stack>\r\n\r\n        <Stack space={2}>\r\n          <Label htmlFor=\"caption-language\">Language Code</Label>\r\n          <TextInput\r\n            id=\"caption-language\"\r\n            placeholder=\"en-US\"\r\n            value={languageCode}\r\n            onChange={(e) => {\r\n              setLanguageCode(e.currentTarget.value)\r\n              if (selectedLanguage && selectedLanguage.value !== e.currentTarget.value) {\r\n                setSelectedLanguage(null)\r\n                if (!name || name === selectedLanguage.label) {\r\n                  setName('')\r\n                }\r\n              }\r\n            }}\r\n            disabled={isSubmitting}\r\n          />\r\n        </Stack>\r\n\r\n        <Flex gap={2} justify=\"flex-end\" marginTop={2}>\r\n          <Button text=\"Cancel\" mode=\"ghost\" onClick={onClose} disabled={isSubmitting} />\r\n          <Button\r\n            text=\"Update Caption Track\"\r\n            tone=\"primary\"\r\n            icon={\r\n              isSubmitting ? (\r\n                <Spinner\r\n                  style={{\r\n                    verticalAlign: 'middle',\r\n                    display: 'inline-block',\r\n                    marginBottom: '-3px',\r\n                    width: '1em',\r\n                    height: '1em',\r\n                    marginRight: '-6px',\r\n                  }}\r\n                />\r\n              ) : (\r\n                UploadIcon\r\n              )\r\n            }\r\n            onClick={handleSubmit}\r\n            disabled={isSubmitting}\r\n          />\r\n        </Flex>\r\n      </Stack>\r\n    </Dialog>\r\n  )\r\n}\r\n","import {\r\n  AddIcon,\r\n  ChevronDownIcon,\r\n  ChevronUpIcon,\r\n  DownloadIcon,\r\n  EditIcon,\r\n  ErrorOutlineIcon,\r\n  TrashIcon,\r\n} from '@sanity/icons'\r\nimport {Box, Button, Card, Dialog, Flex, Heading, Spinner, Stack, Text, useToast} from '@sanity/ui'\r\nimport {useEffect, useId, useMemo, useState} from 'react'\r\n\r\nimport {deleteTextTrack} from '../actions/assets'\r\nimport {useClient} from '../hooks/useClient'\r\nimport {useResyncAsset} from '../hooks/useResyncAsset'\r\nimport {downloadVttFile} from '../util/textTracks'\r\nimport type {MuxTextTrack, VideoAssetDocument} from '../util/types'\r\nimport AddCaptionDialog from './AddCaptionDialog'\r\nimport EditCaptionDialog from './EditCaptionDialog'\r\n\r\ninterface TrackCardProps {\r\n  track: MuxTextTrack\r\n  iconOnly: boolean\r\n  downloadingTrackId: string | null\r\n  deletingTrackId: string | null\r\n  trackToEdit: MuxTextTrack | null\r\n  getTrackSourceLabel: (track: MuxTextTrack) => string\r\n  handleDownload: (track: MuxTextTrack) => void\r\n  setTrackToEdit: (track: MuxTextTrack) => void\r\n  setTrackToDelete: (track: MuxTextTrack) => void\r\n}\r\n\r\nfunction TrackCard({\r\n  track,\r\n  iconOnly,\r\n  downloadingTrackId,\r\n  deletingTrackId,\r\n  trackToEdit,\r\n  getTrackSourceLabel,\r\n  handleDownload,\r\n  setTrackToEdit,\r\n  setTrackToDelete,\r\n}: TrackCardProps) {\r\n  const isDisabled = (action: 'download' | 'edit' | 'delete') => {\r\n    if (action === 'download') {\r\n      return (\r\n        downloadingTrackId !== null || deletingTrackId === track.id || trackToEdit?.id === track.id\r\n      )\r\n    }\r\n    if (action === 'edit') {\r\n      return (\r\n        downloadingTrackId === track.id ||\r\n        deletingTrackId === track.id ||\r\n        trackToEdit?.id === track.id\r\n      )\r\n    }\r\n    return (\r\n      downloadingTrackId === track.id || deletingTrackId !== null || trackToEdit?.id === track.id\r\n    )\r\n  }\r\n\r\n  const renderActionButtons = () => {\r\n    if (track.status === 'preparing') {\r\n      return (\r\n        <Flex align=\"center\" gap={2}>\r\n          <Spinner\r\n            muted\r\n            style={{\r\n              width: '0.75em',\r\n              height: '0.75em',\r\n              verticalAlign: 'middle',\r\n              display: 'inline-block',\r\n              marginBottom: '-2px',\r\n            }}\r\n          />\r\n          <Text size={1} muted>\r\n            Processing...\r\n          </Text>\r\n        </Flex>\r\n      )\r\n    }\r\n\r\n    return (\r\n      <Flex gap={2}>\r\n        {track.status !== 'errored' && (\r\n          <Button\r\n            icon={\r\n              downloadingTrackId === track.id ? (\r\n                <Spinner\r\n                  style={{\r\n                    verticalAlign: 'middle',\r\n                    display: 'inline-block',\r\n                    marginTop: '-2px',\r\n                    width: '0.5em',\r\n                    height: '0.5em',\r\n                  }}\r\n                />\r\n              ) : (\r\n                <DownloadIcon />\r\n              )\r\n            }\r\n            text={iconOnly ? undefined : 'Download'}\r\n            mode=\"ghost\"\r\n            tone=\"primary\"\r\n            fontSize={1}\r\n            padding={2}\r\n            onClick={() => handleDownload(track)}\r\n            disabled={isDisabled('download')}\r\n            title=\"Download\"\r\n          />\r\n        )}\r\n        <Button\r\n          icon={<EditIcon />}\r\n          text={iconOnly ? undefined : 'Edit'}\r\n          mode=\"ghost\"\r\n          tone=\"primary\"\r\n          fontSize={1}\r\n          padding={2}\r\n          disabled={isDisabled('edit')}\r\n          onClick={() => setTrackToEdit(track)}\r\n          title=\"Edit\"\r\n        />\r\n        <Button\r\n          icon={\r\n            deletingTrackId === track.id ? (\r\n              <Spinner\r\n                style={{\r\n                  verticalAlign: 'middle',\r\n                  display: 'inline-block',\r\n                  marginTop: '-2px',\r\n                  width: '0.5em',\r\n                  height: '0.5em',\r\n                }}\r\n              />\r\n            ) : (\r\n              <TrashIcon />\r\n            )\r\n          }\r\n          text={iconOnly ? undefined : 'Delete'}\r\n          mode=\"ghost\"\r\n          tone=\"critical\"\r\n          fontSize={1}\r\n          padding={2}\r\n          disabled={isDisabled('delete')}\r\n          onClick={() => setTrackToDelete(track)}\r\n          title=\"Delete\"\r\n        />\r\n      </Flex>\r\n    )\r\n  }\r\n\r\n  return (\r\n    <Card\r\n      padding={3}\r\n      radius={2}\r\n      tone={track.status === 'errored' ? 'caution' : 'transparent'}\r\n      border\r\n    >\r\n      <Flex align=\"center\" justify=\"space-between\" gap={3}>\r\n        <Stack space={2} flex={1}>\r\n          <Flex align=\"center\" gap={2}>\r\n            <Text weight=\"semibold\">{track.name || 'Untitled'}</Text>\r\n            <Text size={1} muted>\r\n              ({getTrackSourceLabel(track)})\r\n            </Text>\r\n            {track.status === 'errored' && (\r\n              <ErrorOutlineIcon\r\n                style={{color: 'var(--card-critical-color)'}}\r\n                aria-label=\"Error\"\r\n                fontSize={20}\r\n              />\r\n            )}\r\n          </Flex>\r\n          {track.language_code && (\r\n            <Text size={1} muted>\r\n              Language: {track.language_code}\r\n            </Text>\r\n          )}\r\n          {track.status === 'errored' && track.error && (\r\n            <Text size={1} style={{color: 'var(--card-critical-color)'}}>\r\n              {track.error.messages?.[0] || track.error.type || 'Failed to process track'}\r\n            </Text>\r\n          )}\r\n        </Stack>\r\n        {renderActionButtons()}\r\n      </Flex>\r\n    </Card>\r\n  )\r\n}\r\n\r\ninterface TextTracksManagerProps {\r\n  asset: VideoAssetDocument\r\n  iconOnly?: boolean\r\n  tracks?: MuxTextTrack[]\r\n  collapseTracks?: boolean\r\n}\r\n\r\nexport default function TextTracksManager({\r\n  asset,\r\n  iconOnly = false,\r\n  tracks: propTracks,\r\n  collapseTracks = false,\r\n}: TextTracksManagerProps) {\r\n  const client = useClient()\r\n  const toast = useToast()\r\n  const dialogId = `DeleteCaptionDialog${useId()}`\r\n  const {resyncAsset} = useResyncAsset()\r\n  const [downloadingTrackId, setDownloadingTrackId] = useState<string | null>(null)\r\n  const [deletingTrackId, setDeletingTrackId] = useState<string | null>(null)\r\n  const [addedTracks, setAddedTracks] = useState<MuxTextTrack[]>([])\r\n  const [updatedTracks, setUpdatedTracks] = useState<Map<string, MuxTextTrack>>(new Map())\r\n  const [trackActivityOrder, setTrackActivityOrder] = useState<Map<string, number>>(new Map())\r\n  const [autogeneratedTrackIds, setAutogeneratedTrackIds] = useState<Set<string>>(new Set())\r\n  const [trackToDelete, setTrackToDelete] = useState<MuxTextTrack | null>(null)\r\n  const [trackToEdit, setTrackToEdit] = useState<MuxTextTrack | null>(null)\r\n  const [showAddDialog, setShowAddDialog] = useState(false)\r\n  const [isExpanded, setIsExpanded] = useState(false)\r\n\r\n  const MAX_VISIBLE_TRACKS = 4\r\n\r\n  const realTracks: MuxTextTrack[] = propTracks\r\n    ? propTracks\r\n    : asset.data?.tracks?.filter((track): track is MuxTextTrack => track.type === 'text') || []\r\n\r\n  const activeTracks = realTracks.filter(\r\n    (track) =>\r\n      track.id &&\r\n      (track.status === 'ready' || track.status === 'preparing' || track.status === 'errored')\r\n  )\r\n\r\n  const allTracks = useMemo(() => {\r\n    const tracksWithUpdates = activeTracks.map((track) => {\r\n      const updated = updatedTracks.get(track.id)\r\n      return updated || track\r\n    })\r\n\r\n    const isMockTrackReplaced = (mockTrack: MuxTextTrack, realTracksList: MuxTextTrack[]) => {\r\n      if (!mockTrack.id || !mockTrack.id.startsWith('generating-')) {\r\n        return false\r\n      }\r\n      return realTracksList.some((realTrack) => {\r\n        const nameMatches = realTrack.name === mockTrack.name\r\n        const languageMatches = realTrack.language_code === mockTrack.language_code\r\n        if (!nameMatches || !languageMatches) {\r\n          return false\r\n        }\r\n        if (realTrack.status === 'ready') {\r\n          const isGenerated =\r\n            realTrack.text_source === 'generated_live' ||\r\n            realTrack.text_source === 'generated_live_final' ||\r\n            realTrack.text_source === 'generated_vod'\r\n          return isGenerated\r\n        }\r\n        if (realTrack.status === 'preparing') {\r\n          return true\r\n        }\r\n        return false\r\n      })\r\n    }\r\n\r\n    const isTrackAlreadyInRealTracks = (\r\n      addedTrack: MuxTextTrack,\r\n      realTracksList: MuxTextTrack[]\r\n    ) => {\r\n      if (!addedTrack.id) return false\r\n      if (addedTrack.id.startsWith('generating-')) {\r\n        return isMockTrackReplaced(addedTrack, realTracksList)\r\n      }\r\n      return realTracksList.some((realTrack) => realTrack.id === addedTrack.id)\r\n    }\r\n\r\n    const tracksToKeep = addedTracks.filter((addedTrack) => {\r\n      if (addedTrack.id && addedTrack.id.startsWith('generating-')) {\r\n        return !isMockTrackReplaced(addedTrack, tracksWithUpdates)\r\n      }\r\n      return !isTrackAlreadyInRealTracks(addedTrack, tracksWithUpdates)\r\n    })\r\n\r\n    return [...tracksWithUpdates, ...tracksToKeep]\r\n  }, [activeTracks, addedTracks, updatedTracks])\r\n\r\n  useEffect(() => {\r\n    const newAutogeneratedIds = new Set<string>()\r\n\r\n    activeTracks.forEach((track) => {\r\n      if (\r\n        track.id &&\r\n        (track.text_source === 'generated_live' ||\r\n          track.text_source === 'generated_live_final' ||\r\n          track.text_source === 'generated_vod')\r\n      ) {\r\n        newAutogeneratedIds.add(track.id)\r\n      }\r\n    })\r\n\r\n    addedTracks.forEach((mockTrack) => {\r\n      if (mockTrack.id && mockTrack.id.startsWith('generating-')) {\r\n        const realTrack = activeTracks.find((rt) => {\r\n          const nameMatches = rt.name === mockTrack.name\r\n          const languageMatches = rt.language_code === mockTrack.language_code\r\n          return nameMatches && languageMatches\r\n        })\r\n        if (realTrack?.id) {\r\n          newAutogeneratedIds.add(realTrack.id)\r\n        }\r\n      }\r\n    })\r\n\r\n    setAutogeneratedTrackIds((prev) => {\r\n      let hasNew = false\r\n      const updated = new Set(prev)\r\n      newAutogeneratedIds.forEach((id) => {\r\n        if (!prev.has(id)) {\r\n          updated.add(id)\r\n          hasNew = true\r\n        }\r\n      })\r\n      return hasNew ? updated : prev\r\n    })\r\n  }, [activeTracks, addedTracks])\r\n\r\n  useEffect(() => {\r\n    const preparingTracks = allTracks.filter((track) => track.status === 'preparing')\r\n    if (preparingTracks.length === 0 || !asset.assetId || !asset._id) {\r\n      return undefined\r\n    }\r\n\r\n    const interval = setInterval(async () => {\r\n      try {\r\n        const muxData = await resyncAsset(asset)\r\n        if (!muxData) return\r\n\r\n        const fetchedTracks =\r\n          muxData.tracks?.filter((track): track is MuxTextTrack => track.type === 'text') || []\r\n\r\n        const isMockTrackReplaced = (\r\n          mockTrack: MuxTextTrack,\r\n          fetchedTracksList: MuxTextTrack[]\r\n        ) => {\r\n          if (!mockTrack.id || !mockTrack.id.startsWith('generating-')) {\r\n            return false\r\n          }\r\n          return fetchedTracksList.some((realTrack) => {\r\n            const nameMatches = realTrack.name === mockTrack.name\r\n            const languageMatches = realTrack.language_code === mockTrack.language_code\r\n            if (!nameMatches || !languageMatches) {\r\n              return false\r\n            }\r\n            if (realTrack.status === 'ready') {\r\n              const isGenerated =\r\n                realTrack.text_source === 'generated_live' ||\r\n                realTrack.text_source === 'generated_live_final' ||\r\n                realTrack.text_source === 'generated_vod'\r\n              return isGenerated\r\n            }\r\n            if (realTrack.status === 'preparing') {\r\n              return true\r\n            }\r\n            return false\r\n          })\r\n        }\r\n\r\n        const newAutogeneratedIds = new Set<string>()\r\n        fetchedTracks.forEach((track) => {\r\n          if (\r\n            track.id &&\r\n            (track.text_source === 'generated_live' ||\r\n              track.text_source === 'generated_live_final' ||\r\n              track.text_source === 'generated_vod')\r\n          ) {\r\n            newAutogeneratedIds.add(track.id)\r\n          }\r\n        })\r\n\r\n        const findMatchingRealTrack = (mockTrack: MuxTextTrack, tracksList: MuxTextTrack[]) => {\r\n          return tracksList.find((rt) => {\r\n            const nameMatches = rt.name === mockTrack.name\r\n            const languageMatches = rt.language_code === mockTrack.language_code\r\n            return nameMatches && languageMatches\r\n          })\r\n        }\r\n\r\n        setAddedTracks((prev) => {\r\n          return prev.filter((mockTrack) => {\r\n            if (mockTrack.id && mockTrack.id.startsWith('generating-')) {\r\n              const replaced = isMockTrackReplaced(mockTrack, fetchedTracks)\r\n              if (replaced) {\r\n                const realTrack = findMatchingRealTrack(mockTrack, fetchedTracks)\r\n                if (realTrack?.id) {\r\n                  newAutogeneratedIds.add(realTrack.id)\r\n                  setTrackActivityOrder((prevOrder) => {\r\n                    const mockOrder = prevOrder.get(mockTrack.id)\r\n                    if (mockOrder) {\r\n                      const newMap = new Map(prevOrder)\r\n                      newMap.set(realTrack.id, mockOrder)\r\n                      return newMap\r\n                    }\r\n                    return prevOrder\r\n                  })\r\n                }\r\n              }\r\n              return !replaced\r\n            }\r\n            return true\r\n          })\r\n        })\r\n\r\n        if (newAutogeneratedIds.size > 0) {\r\n          setAutogeneratedTrackIds((prevIds) => {\r\n            const updated = new Set(prevIds)\r\n            newAutogeneratedIds.forEach((id) => updated.add(id))\r\n            return updated\r\n          })\r\n        }\r\n      } catch (error) {\r\n        console.error('Failed to refresh asset data:', error)\r\n      }\r\n    }, 3000) // Poll every 3 seconds\r\n\r\n    return () => clearInterval(interval)\r\n  }, [allTracks, asset, resyncAsset])\r\n\r\n  const visibleTracks = allTracks\r\n    .filter(\r\n      (track) =>\r\n        track.status === 'ready' || track.status === 'preparing' || track.status === 'errored'\r\n    )\r\n    .sort((a, b) => {\r\n      const orderA = trackActivityOrder.get(a.id) || 0\r\n      const orderB = trackActivityOrder.get(b.id) || 0\r\n\r\n      if (orderA > 0 && orderB > 0) {\r\n        return orderB - orderA\r\n      }\r\n\r\n      if (orderA > 0) return -1\r\n      if (orderB > 0) return 1\r\n\r\n      const aIsPreparing = a.status === 'preparing'\r\n      const bIsPreparing = b.status === 'preparing'\r\n      if (aIsPreparing && !bIsPreparing) return -1\r\n      if (!aIsPreparing && bIsPreparing) return 1\r\n\r\n      const aIsAutogenerated =\r\n        (a.id && a.id.startsWith('generating-')) || (a.id && autogeneratedTrackIds.has(a.id))\r\n      const bIsAutogenerated =\r\n        (b.id && b.id.startsWith('generating-')) || (b.id && autogeneratedTrackIds.has(b.id))\r\n      if (aIsAutogenerated && !bIsAutogenerated) return -1\r\n      if (!aIsAutogenerated && bIsAutogenerated) return 1\r\n\r\n      return 0\r\n    })\r\n\r\n  const handleDownload = async (track: MuxTextTrack) => {\r\n    if (!track.id) return\r\n\r\n    setDownloadingTrackId(track.id)\r\n    try {\r\n      await downloadVttFile(client, asset, track)\r\n    } catch (error) {\r\n      toast.push({\r\n        title: 'Failed to download VTT file',\r\n        status: 'error',\r\n        description: error instanceof Error ? error.message : 'Please try again',\r\n      })\r\n    } finally {\r\n      setDownloadingTrackId(null)\r\n    }\r\n  }\r\n\r\n  const confirmDelete = async () => {\r\n    if (!trackToDelete || !trackToDelete.id) return\r\n\r\n    const track = trackToDelete\r\n    setTrackToDelete(null)\r\n    setDeletingTrackId(track.id)\r\n    try {\r\n      if (!asset.assetId) {\r\n        throw new Error('Asset ID is required')\r\n      }\r\n      await deleteTextTrack(client, asset.assetId, track.id)\r\n\r\n      // Refresh asset data after deletion\r\n      await resyncAsset(asset)\r\n\r\n      toast.push({\r\n        title: 'Successfully deleted caption track',\r\n        status: 'success',\r\n      })\r\n\r\n      setAddedTracks((prev) => prev.filter((t) => t.id !== track.id))\r\n      setUpdatedTracks((prev) => {\r\n        const newMap = new Map(prev)\r\n        newMap.delete(track.id)\r\n        return newMap\r\n      })\r\n      setTrackActivityOrder((prev) => {\r\n        const newMap = new Map(prev)\r\n        newMap.delete(track.id)\r\n        return newMap\r\n      })\r\n      setAutogeneratedTrackIds((prev) => {\r\n        const updated = new Set(prev)\r\n        updated.delete(track.id)\r\n        return updated\r\n      })\r\n    } catch (error) {\r\n      toast.push({\r\n        title: 'Failed to delete caption track',\r\n        status: 'error',\r\n        description: error instanceof Error ? error.message : 'Please try again',\r\n      })\r\n    } finally {\r\n      setDeletingTrackId(null)\r\n    }\r\n  }\r\n\r\n  const handleAddTrack = (track: MuxTextTrack) => {\r\n    setAddedTracks((prev) => [...prev, track])\r\n    setTrackActivityOrder((prev) => {\r\n      const newMap = new Map(prev)\r\n      newMap.set(track.id, prev.size + 1)\r\n      return newMap\r\n    })\r\n    setShowAddDialog(false)\r\n  }\r\n\r\n  const handleUpdateTrack = async (updatedTrack: MuxTextTrack, oldTrackId?: string) => {\r\n    if (oldTrackId) {\r\n      setAddedTracks((prev) => prev.filter((t) => t.id !== oldTrackId))\r\n      setUpdatedTracks((prev) => {\r\n        const newMap = new Map(prev)\r\n        newMap.delete(oldTrackId)\r\n        return newMap\r\n      })\r\n      setTrackActivityOrder((prev) => {\r\n        const newMap = new Map(prev)\r\n        newMap.delete(oldTrackId)\r\n        return newMap\r\n      })\r\n      setAutogeneratedTrackIds((prev) => {\r\n        const updated = new Set(prev)\r\n        updated.delete(oldTrackId)\r\n        return updated\r\n      })\r\n    }\r\n\r\n    const isAddedTrack = addedTracks.some((t) => t.id === updatedTrack.id)\r\n\r\n    if (isAddedTrack) {\r\n      setAddedTracks((prev) => prev.map((t) => (t.id === updatedTrack.id ? updatedTrack : t)))\r\n    } else {\r\n      setUpdatedTracks((prev) => {\r\n        const newMap = new Map(prev)\r\n        newMap.set(updatedTrack.id, updatedTrack)\r\n        return newMap\r\n      })\r\n    }\r\n\r\n    setTrackActivityOrder((prev) => {\r\n      const newMap = new Map(prev)\r\n      newMap.set(updatedTrack.id, prev.size + 1)\r\n      return newMap\r\n    })\r\n\r\n    setTrackToEdit(null)\r\n\r\n    // Refresh asset data after update\r\n    await resyncAsset(asset)\r\n  }\r\n\r\n  const getTrackSourceLabel = (track: MuxTextTrack) => {\r\n    if (track.id && track.id.startsWith('generating-')) {\r\n      return 'Auto-generated'\r\n    }\r\n    if (track.id && autogeneratedTrackIds.has(track.id)) {\r\n      return 'Auto-generated'\r\n    }\r\n    if (\r\n      track.text_source === 'generated_live_final' ||\r\n      track.text_source === 'generated_live' ||\r\n      track.text_source === 'generated_vod'\r\n    ) {\r\n      return 'Auto-generated'\r\n    }\r\n    if (track.text_source === 'uploaded') {\r\n      return 'Uploaded'\r\n    }\r\n    return 'Custom'\r\n  }\r\n\r\n  if (visibleTracks.length === 0 && !showAddDialog) {\r\n    return (\r\n      <Stack space={3}>\r\n        <Flex justify=\"flex-end\">\r\n          <Button\r\n            icon={AddIcon}\r\n            text=\"Add Caption\"\r\n            tone=\"primary\"\r\n            onClick={() => setShowAddDialog(true)}\r\n          />\r\n        </Flex>\r\n        <Card padding={4} radius={2} tone=\"transparent\" border>\r\n          <Text size={1} muted>\r\n            No captions available. Add captions when uploading a video or add them manually.\r\n          </Text>\r\n        </Card>\r\n        {showAddDialog && (\r\n          <AddCaptionDialog\r\n            asset={asset}\r\n            onAdd={handleAddTrack}\r\n            onClose={() => setShowAddDialog(false)}\r\n          />\r\n        )}\r\n      </Stack>\r\n    )\r\n  }\r\n\r\n  const displayedTracks =\r\n    collapseTracks && !isExpanded ? visibleTracks.slice(0, MAX_VISIBLE_TRACKS) : visibleTracks\r\n  const hasMoreTracks = collapseTracks && visibleTracks.length > MAX_VISIBLE_TRACKS\r\n\r\n  return (\r\n    <Stack space={3}>\r\n      <Flex justify=\"flex-end\">\r\n        <Button\r\n          icon={AddIcon}\r\n          text=\"Add Caption\"\r\n          tone=\"primary\"\r\n          onClick={() => setShowAddDialog(true)}\r\n        />\r\n      </Flex>\r\n\r\n      {displayedTracks.map((track) => (\r\n        <TrackCard\r\n          key={track.id}\r\n          track={track}\r\n          iconOnly={iconOnly}\r\n          downloadingTrackId={downloadingTrackId}\r\n          deletingTrackId={deletingTrackId}\r\n          trackToEdit={trackToEdit}\r\n          getTrackSourceLabel={getTrackSourceLabel}\r\n          handleDownload={handleDownload}\r\n          setTrackToEdit={setTrackToEdit}\r\n          setTrackToDelete={setTrackToDelete}\r\n        />\r\n      ))}\r\n\r\n      {hasMoreTracks && (\r\n        <Flex justify=\"center\">\r\n          <Button\r\n            icon={isExpanded ? ChevronUpIcon : ChevronDownIcon}\r\n            text={\r\n              isExpanded ? 'Show less' : `Show ${visibleTracks.length - MAX_VISIBLE_TRACKS} more`\r\n            }\r\n            mode=\"ghost\"\r\n            tone=\"primary\"\r\n            onClick={() => setIsExpanded(!isExpanded)}\r\n          />\r\n        </Flex>\r\n      )}\r\n\r\n      {trackToDelete && (\r\n        <Dialog\r\n          animate\r\n          id={dialogId}\r\n          header=\"Delete track\"\r\n          onClose={() => setTrackToDelete(null)}\r\n          onClickOutside={() => setTrackToDelete(null)}\r\n          width={1}\r\n        >\r\n          <Card\r\n            padding={3}\r\n            style={{\r\n              minHeight: '150px',\r\n              display: 'flex',\r\n              alignItems: 'center',\r\n              justifyContent: 'center',\r\n            }}\r\n          >\r\n            <Stack space={3}>\r\n              <Heading size={2}>\r\n                Are you sure you want to delete &quot;\r\n                {trackToDelete.name || trackToDelete.language_code || 'Untitled'}&quot;?\r\n              </Heading>\r\n              <Text size={2}>This action is irreversible</Text>\r\n              <Stack space={4} marginY={4}>\r\n                <Box>\r\n                  <Button\r\n                    icon={\r\n                      deletingTrackId === trackToDelete.id ? (\r\n                        <Spinner\r\n                          style={{\r\n                            verticalAlign: 'middle',\r\n                            display: 'inline-block',\r\n                            marginTop: '-2px',\r\n                            width: '0.5em',\r\n                            height: '0.5em',\r\n                          }}\r\n                        />\r\n                      ) : (\r\n                        <TrashIcon />\r\n                      )\r\n                    }\r\n                    fontSize={2}\r\n                    padding={3}\r\n                    text=\"Delete track\"\r\n                    tone=\"critical\"\r\n                    onClick={confirmDelete}\r\n                    disabled={deletingTrackId !== null}\r\n                  />\r\n                </Box>\r\n              </Stack>\r\n            </Stack>\r\n          </Card>\r\n        </Dialog>\r\n      )}\r\n\r\n      {showAddDialog && (\r\n        <AddCaptionDialog\r\n          asset={asset}\r\n          onAdd={handleAddTrack}\r\n          onClose={() => setShowAddDialog(false)}\r\n        />\r\n      )}\r\n\r\n      {trackToEdit && (\r\n        <EditCaptionDialog\r\n          asset={asset}\r\n          track={trackToEdit}\r\n          onUpdate={handleUpdateTrack}\r\n          onClose={() => setTrackToEdit(null)}\r\n        />\r\n      )}\r\n    </Stack>\r\n  )\r\n}\r\n","import type {SanityClient} from 'sanity'\r\n\r\nimport {generateJwt} from './generateJwt'\r\nimport type {MuxPlaybackId, MuxVideoUrl} from './types'\r\n\r\ninterface VideoSrcOptions {\r\n  muxPlaybackId: MuxPlaybackId\r\n  client: SanityClient\r\n}\r\n\r\n/**\r\n * May throw a Promise. Call this with {@link tryWithSuspend} or rethrow the Promise\r\n */\r\nexport function getVideoSrc({client, muxPlaybackId}: VideoSrcOptions): MuxVideoUrl {\r\n  const searchParams = new URLSearchParams()\r\n\r\n  if (muxPlaybackId.policy === 'signed' || muxPlaybackId.policy === 'drm') {\r\n    const token = generateJwt(client, muxPlaybackId.id, 'v')\r\n    searchParams.set('token', token)\r\n  }\r\n\r\n  return `https://stream.mux.com/${muxPlaybackId.id}.m3u8?${searchParams}`\r\n}\r\n","import {Dialog, Stack} from '@sanity/ui'\r\nimport {useId} from 'react'\r\n\r\nimport {useDialogStateContext} from '../context/DialogStateContext'\r\nimport type {VideoAssetDocument} from '../util/types'\r\nimport TextTracksManager from './TextTracksManager'\r\n\r\nexport interface Props {\r\n  asset: VideoAssetDocument\r\n}\r\n\r\nexport default function CaptionsDialog({asset}: Props) {\r\n  const {setDialogState} = useDialogStateContext()\r\n  const dialogId = `CaptionsDialog${useId()}`\r\n\r\n  return (\r\n    <Dialog id={dialogId} header=\"Edit Captions\" onClose={() => setDialogState(false)} width={1}>\r\n      <Stack padding={4}>\r\n        <TextTracksManager asset={asset} />\r\n      </Stack>\r\n    </Dialog>\r\n  )\r\n}\r\n","import { useState, useEffect } from 'react';\n\n/**\r\n * Get the device pixel ratio, potentially rounded and capped.\r\n * Will emit new values if it changes.\r\n *\r\n * @param options\r\n * @returns The current device pixel ratio, or the default if none can be resolved\r\n */\n\nfunction useDevicePixelRatio(options) {\n  const dpr = getDevicePixelRatio(options);\n  const [currentDpr, setCurrentDpr] = useState(dpr);\n  const {\n    defaultDpr,\n    maxDpr,\n    round\n  } = options || {};\n  useEffect(() => {\n    const canListen = typeof window !== 'undefined' && 'matchMedia' in window;\n\n    if (!canListen) {\n      return;\n    }\n\n    const updateDpr = () => setCurrentDpr(getDevicePixelRatio({\n      defaultDpr,\n      maxDpr,\n      round\n    }));\n\n    const mediaMatcher = window.matchMedia(`screen and (resolution: ${currentDpr}dppx)`); // Safari 13.1 does not have `addEventListener`, but does have `addListener`\n\n    if (mediaMatcher.addEventListener) {\n      mediaMatcher.addEventListener('change', updateDpr);\n    } else {\n      mediaMatcher.addListener(updateDpr);\n    }\n\n    return () => {\n      if (mediaMatcher.removeEventListener) {\n        mediaMatcher.removeEventListener('change', updateDpr);\n      } else {\n        mediaMatcher.removeListener(updateDpr);\n      }\n    };\n  }, [currentDpr, defaultDpr, maxDpr, round]);\n  return currentDpr;\n}\n/**\r\n * Returns the current device pixel ratio (DPR) given the passed options\r\n *\r\n * @param options\r\n * @returns current device pixel ratio\r\n */\n\nfunction getDevicePixelRatio(options) {\n  const {\n    defaultDpr = 1,\n    maxDpr = 3,\n    round = true\n  } = options || {};\n  const hasDprProp = typeof window !== 'undefined' && typeof window.devicePixelRatio === 'number';\n  const dpr = hasDprProp ? window.devicePixelRatio : defaultDpr;\n  const rounded = Math.min(Math.max(1, round ? Math.floor(dpr) : dpr), maxDpr);\n  return rounded;\n}\n\nexport { getDevicePixelRatio, useDevicePixelRatio };\n//# sourceMappingURL=index.module.js.map\n","/* eslint-disable */\r\n// From: https://stackoverflow.com/a/11486026/10433647\r\nexport function formatSeconds(seconds: number): string {\r\n  if (typeof seconds !== 'number' || Number.isNaN(seconds)) {\r\n    return ''\r\n  }\r\n  // Hours, minutes and seconds\r\n  const hrs = ~~(seconds / 3600)\r\n  const mins = ~~((seconds % 3600) / 60)\r\n  const secs = ~~seconds % 60\r\n\r\n  // Output like \"1:01\" or \"4:03:59\" or \"123:03:59\"\r\n  let ret = ''\r\n\r\n  if (hrs > 0) {\r\n    ret += '' + hrs + ':' + (mins < 10 ? '0' : '')\r\n  }\r\n\r\n  ret += '' + mins + ':' + (secs < 10 ? '0' : '')\r\n  ret += '' + secs\r\n  return ret\r\n}\r\n\r\n// Output like \"05:14:01\"\r\nexport function formatSecondsToHHMMSS(seconds: number): string {\r\n  const hrs = Math.floor(seconds / 3600)\r\n    .toString()\r\n    .padStart(2, '0')\r\n  const mins = Math.floor((seconds % 3600) / 60)\r\n    .toString()\r\n    .padStart(2, '0')\r\n  const secs = Math.floor(seconds % 60)\r\n    .toString()\r\n    .padStart(2, '0')\r\n\r\n  return `${hrs}:${mins}:${secs}`\r\n}\r\n\r\n// Checks if time has a HH:MM:SS format like \"05:14:01\"\r\nexport function isValidTimeFormat(time: string) {\r\n  const regex = /^([0-1]?[0-9]|2[0-3]):([0-5]?[0-9]):([0-5]?[0-9])$/\r\n  return regex.test(time) || time === ''\r\n}\r\n\r\n// Converts a time like \"05:14:01\" to seconds\r\nexport function getSecondsFromTimeFormat(time: string): number {\r\n  const [hh = 0, mm = 0, ss = 0] = time.split(':').map(Number)\r\n  return hh * 3600 + mm * 60 + ss\r\n}\r\n","import {Button, Dialog, Flex, Stack, Text, TextInput} from '@sanity/ui'\r\nimport React, {useId, useMemo, useState} from 'react'\r\nimport {getDevicePixelRatio} from 'use-device-pixel-ratio'\r\n\r\nimport {useDialogStateContext} from '../context/DialogStateContext'\r\nimport {useClient} from '../hooks/useClient'\r\nimport {\r\n  formatSecondsToHHMMSS,\r\n  getSecondsFromTimeFormat,\r\n  isValidTimeFormat,\r\n} from '../util/formatSeconds'\r\nimport type {VideoAssetDocument} from '../util/types'\r\nimport VideoThumbnail from './VideoThumbnail'\r\n\r\nexport interface Props {\r\n  asset: VideoAssetDocument\r\n  currentTime?: number\r\n}\r\n\r\nexport default function EditThumbnailDialog({asset, currentTime = 0}: Props) {\r\n  const client = useClient()\r\n\r\n  const {setDialogState} = useDialogStateContext()\r\n  const dialogId = `EditThumbnailDialog${useId()}`\r\n\r\n  const [timeFormatted, setTimeFormatted] = useState<string>(() =>\r\n    formatSecondsToHHMMSS(currentTime)\r\n  )\r\n  const [nextTime, setNextTime] = useState<number>(currentTime)\r\n  const [inputError, setInputError] = useState<string>('')\r\n\r\n  const assetWithNewThumbnail = useMemo(() => ({...asset, thumbTime: nextTime}), [asset, nextTime])\r\n  const [saving, setSaving] = useState(false)\r\n  const [saveThumbnailError, setSaveThumbnailError] = useState<Error | null>(null)\r\n  const handleSave = () => {\r\n    setSaving(true)\r\n    client\r\n      .patch(asset._id!)\r\n      .set({thumbTime: nextTime})\r\n      .commit({returnDocuments: false})\r\n      .then(() => void setDialogState(false))\r\n      .catch(setSaveThumbnailError)\r\n      .finally(() => void setSaving(false))\r\n  }\r\n  const width = 300 * getDevicePixelRatio({maxDpr: 2})\r\n\r\n  if (saveThumbnailError) {\r\n    // eslint-disable-next-line no-warning-comments\r\n    // @TODO handle errors more gracefully\r\n    throw saveThumbnailError\r\n  }\r\n\r\n  const handleInputChange = (event: React.FormEvent<HTMLInputElement>) => {\r\n    const value = event.currentTarget.value\r\n    setTimeFormatted(value)\r\n\r\n    if (isValidTimeFormat(value)) {\r\n      setInputError('')\r\n      const totalSeconds = getSecondsFromTimeFormat(value)\r\n      setNextTime(totalSeconds)\r\n    } else {\r\n      setInputError('Invalid time format')\r\n    }\r\n  }\r\n\r\n  return (\r\n    <Dialog\r\n      id={dialogId}\r\n      header=\"Edit thumbnail\"\r\n      onClose={() => setDialogState(false)}\r\n      footer={\r\n        <Stack padding={3}>\r\n          <Button\r\n            key=\"thumbnail\"\r\n            disabled={inputError !== ''}\r\n            mode=\"ghost\"\r\n            tone=\"primary\"\r\n            loading={saving}\r\n            onClick={handleSave}\r\n            text=\"Set new thumbnail\"\r\n          />\r\n        </Stack>\r\n      }\r\n    >\r\n      <Stack space={3} padding={3}>\r\n        <Stack space={2}>\r\n          <Text size={1} weight=\"semibold\">\r\n            Current:\r\n          </Text>\r\n          <VideoThumbnail asset={asset} width={width} staticImage />\r\n        </Stack>\r\n        <Stack space={2}>\r\n          <Text size={1} weight=\"semibold\">\r\n            New:\r\n          </Text>\r\n          <VideoThumbnail asset={assetWithNewThumbnail} width={width} staticImage />\r\n        </Stack>\r\n\r\n        <Stack space={2}>\r\n          <Flex align={'center'} justify={'center'}>\r\n            <Text size={5} weight=\"semibold\">\r\n              Or\r\n            </Text>\r\n          </Flex>\r\n        </Stack>\r\n\r\n        <Stack space={2}>\r\n          <Text size={1} weight=\"semibold\">\r\n            Selected time for thumbnail (hh:mm:ss):\r\n          </Text>\r\n          <TextInput\r\n            size={1}\r\n            value={timeFormatted}\r\n            placeholder=\"hh:mm:ss\"\r\n            onChange={handleInputChange}\r\n            customValidity={inputError}\r\n          />\r\n        </Stack>\r\n      </Stack>\r\n    </Dialog>\r\n  )\r\n}\r\n","import type {SVGProps} from 'react'\r\n\r\nexport function AudioIcon(props: SVGProps<SVGSVGElement>) {\r\n  return (\r\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"1em\" height=\"1em\" viewBox=\"0 0 24 24\" {...props}>\r\n      <path\r\n        fill=\"currentColor\"\r\n        style={{opacity: '0.65'}}\r\n        d=\"M10.75 19q.95 0 1.6-.65t.65-1.6V13h3v-2h-4v3.875q-.275-.2-.587-.288t-.663-.087q-.95 0-1.6.65t-.65 1.6t.65 1.6t1.6.65M6 22q-.825 0-1.412-.587T4 20V4q0-.825.588-1.412T6 2h8l6 6v12q0 .825-.587 1.413T18 22zm7-13V4H6v16h12V9zM6 4v5zv16z\"\r\n      />\r\n    </svg>\r\n  )\r\n}\r\n","import {type MuxPlayerProps, type MuxPlayerRefAttributes} from '@mux/mux-player-react'\r\nimport MuxPlayer from '@mux/mux-player-react/lazy'\r\nimport {ErrorOutlineIcon} from '@sanity/icons'\r\nimport {Card, Text} from '@sanity/ui'\r\nimport {type PropsWithChildren, Suspense, useMemo, useRef, useState} from 'react'\r\n\r\nimport {useDialogStateContext} from '../context/DialogStateContext'\r\nimport {useClient} from '../hooks/useClient'\r\nimport {AUDIO_ASPECT_RATIO, MIN_ASPECT_RATIO} from '../util/constants'\r\nimport {generateJwt} from '../util/generateJwt'\r\nimport {getPlaybackId} from '../util/getPlaybackPolicy'\r\nimport {getPlaybackPolicyById} from '../util/getPlaybackPolicy'\r\nimport {getPosterSrc} from '../util/getPosterSrc'\r\nimport {getVideoSrc} from '../util/getVideoSrc'\r\nimport {tryWithSuspend} from '../util/tryWithSuspend'\r\nimport type {VideoAssetDocument} from '../util/types'\r\nimport CaptionsDialog from './CaptionsDialog'\r\nimport DownloadAssetDialog from './DownloadAssetDialog'\r\nimport EditThumbnailDialog from './EditThumbnailDialog'\r\nimport {AudioIcon} from './icons/Audio'\r\n\r\nexport default function VideoPlayer({\r\n  asset,\r\n  thumbnailWidth = 250,\r\n  children,\r\n  hlsConfig,\r\n  ...props\r\n}: PropsWithChildren<\r\n  {\r\n    asset: VideoAssetDocument\r\n    thumbnailWidth?: number\r\n    forceAspectRatio?: number\r\n    hlsConfig?: MuxPlayerProps['_hlsConfig']\r\n  } & Partial<Pick<MuxPlayerProps, 'autoPlay'>>\r\n>) {\r\n  const client = useClient()\r\n  const {dialogState} = useDialogStateContext()\r\n\r\n  const isAudio = assetIsAudio(asset)\r\n  const muxPlayer = useRef<MuxPlayerRefAttributes>(null)\r\n  const [error, setError] = useState<Error>()\r\n\r\n  /* Playback ID that will be used to play the video */\r\n  const playbackId = useMemo(() => {\r\n    try {\r\n      return getPlaybackId(asset, ['public', 'signed', 'drm'])\r\n    } catch (e) {\r\n      setError(new TypeError('Asset has no playback ID'))\r\n      return undefined\r\n    }\r\n  }, [asset])\r\n\r\n  const muxPlaybackId = useMemo(() => {\r\n    if (!playbackId) return undefined\r\n    return getPlaybackPolicyById(asset, playbackId)\r\n  }, [asset, playbackId])\r\n\r\n  const src = useMemo(() => {\r\n    if (!playbackId) return undefined\r\n    if (!muxPlaybackId) return undefined\r\n    return tryWithSuspend(\r\n      () => getVideoSrc({muxPlaybackId, client}),\r\n      (e: Error) => {\r\n        setError(e)\r\n        return undefined\r\n      }\r\n    )\r\n  }, [muxPlaybackId, playbackId, client])\r\n\r\n  const poster = useMemo(() => {\r\n    return tryWithSuspend(\r\n      () => getPosterSrc({asset, client, width: thumbnailWidth}),\r\n      (e: Error) => {\r\n        setError(e)\r\n        return undefined\r\n      }\r\n    )\r\n  }, [asset, client, thumbnailWidth])\r\n\r\n  const signedToken = useMemo(() => {\r\n    try {\r\n      const url = new URL(src!)\r\n      return url.searchParams.get('token')\r\n    } catch {\r\n      return undefined\r\n    }\r\n  }, [src])\r\n  const drmToken = useMemo(() => {\r\n    if (!playbackId) return undefined\r\n    if (muxPlaybackId?.policy !== 'drm') return undefined\r\n\r\n    return tryWithSuspend(\r\n      () => generateJwt(client, playbackId, 'd'),\r\n      (e: Error) => {\r\n        setError(e)\r\n        return undefined\r\n      }\r\n    )\r\n  }, [client, muxPlaybackId?.policy, playbackId])\r\n  const tokens:\r\n    | Partial<{\r\n        playback?: string\r\n        thumbnail?: string\r\n        storyboard?: string\r\n        drm?: string\r\n      }>\r\n    | undefined = useMemo(() => {\r\n    try {\r\n      const partialTokens: {\r\n        playback?: string\r\n        thumbnail?: string\r\n        storyboard?: string\r\n        drm?: string\r\n      } = {\r\n        playback: undefined,\r\n        thumbnail: undefined,\r\n        storyboard: undefined,\r\n        drm: undefined,\r\n      }\r\n\r\n      if (signedToken) {\r\n        partialTokens.playback = signedToken\r\n        partialTokens.thumbnail = signedToken\r\n        partialTokens.storyboard = signedToken\r\n      }\r\n\r\n      if (drmToken) {\r\n        partialTokens.drm = drmToken\r\n      }\r\n\r\n      return {...partialTokens}\r\n    } catch {\r\n      return undefined\r\n    }\r\n  }, [signedToken, drmToken])\r\n\r\n  const [width, height] = (asset?.data?.aspect_ratio ?? '16:9').split(':').map(Number)\r\n  const targetAspectRatio =\r\n    props.forceAspectRatio || (Number.isNaN(width) ? 16 / 9 : width / height)\r\n  let aspectRatio = Math.max(MIN_ASPECT_RATIO, targetAspectRatio)\r\n  if (isAudio) {\r\n    aspectRatio = props.forceAspectRatio\r\n      ? // Make it wider when forcing aspect ratio to balance with videos' rendering height (audio players overflow a bit)\r\n        props.forceAspectRatio * 1.2\r\n      : AUDIO_ASPECT_RATIO\r\n  }\r\n\r\n  /* We use Suspense here because `generateJwt` and related functions use suspend()\r\n   under the hood */\r\n  return (\r\n    <>\r\n      <Card\r\n        tone=\"transparent\"\r\n        style={{\r\n          aspectRatio: aspectRatio,\r\n          position: 'relative',\r\n          ...(isAudio && {display: 'flex', alignItems: 'flex-end'}),\r\n        }}\r\n      >\r\n        {src && poster && (\r\n          <>\r\n            {isAudio && (\r\n              <AudioIcon\r\n                style={{\r\n                  padding: '0.5em',\r\n                  width: '2.2em',\r\n                  height: '2.2em',\r\n                  position: 'absolute',\r\n                  top: 0,\r\n                  left: 0,\r\n                  zIndex: 1,\r\n                }}\r\n              />\r\n            )}\r\n            <Suspense fallback={null}>\r\n              <MuxPlayer\r\n                poster={isAudio ? undefined : poster}\r\n                ref={muxPlayer}\r\n                {...props}\r\n                playsInline\r\n                playbackId={playbackId}\r\n                tokens={tokens}\r\n                preload=\"metadata\"\r\n                crossOrigin=\"anonymous\"\r\n                metadata={{\r\n                  player_name: 'Sanity Admin Dashboard',\r\n                  player_version: process.env.PKG_VERSION,\r\n                  page_type: 'Preview Player',\r\n                }}\r\n                audio={isAudio}\r\n                _hlsConfig={hlsConfig}\r\n                style={{\r\n                  ...(!isAudio && {height: '100%'}),\r\n                  width: '100%',\r\n                  display: 'block',\r\n                  objectFit: 'contain',\r\n                  ...(isAudio && {alignSelf: 'end'}),\r\n                }}\r\n              />\r\n              {children}\r\n            </Suspense>\r\n          </>\r\n        )}\r\n        {error ? (\r\n          <div\r\n            style={{\r\n              position: 'absolute',\r\n              top: '50%',\r\n              left: '50%',\r\n              transform: 'translate(-50%, -50%)',\r\n            }}\r\n          >\r\n            <Text muted>\r\n              <ErrorOutlineIcon style={{marginRight: '0.15em'}} />\r\n              {typeof error === 'object' && 'message' in error && typeof error.message === 'string'\r\n                ? error.message\r\n                : 'Error loading video'}\r\n            </Text>\r\n          </div>\r\n        ) : null}\r\n        {children}\r\n      </Card>\r\n\r\n      {dialogState === 'edit-thumbnail' && (\r\n        <EditThumbnailDialog asset={asset} currentTime={muxPlayer?.current?.currentTime} />\r\n      )}\r\n      {dialogState === 'edit-captions' && <CaptionsDialog asset={asset} />}\r\n      {dialogState === 'download-asset' && <DownloadAssetDialog asset={asset} />}\r\n    </>\r\n  )\r\n}\r\n\r\nexport function assetIsAudio(asset: VideoAssetDocument) {\r\n  return asset.data?.max_stored_resolution === 'Audio only'\r\n}\r\n","// Adapted from https://github.com/sanity-io/sanity/blob/next/packages/sanity/src/desk/components/MissingSchemaType.tsx\r\nimport {WarningOutlineIcon} from '@sanity/icons'\r\nimport type {SanityDocument} from 'sanity'\r\nimport type {GeneralPreviewLayoutKey} from 'sanity'\r\nimport {SanityDefaultPreview} from 'sanity'\r\n\r\nexport interface MissingSchemaTypeProps {\r\n  layout?: GeneralPreviewLayoutKey\r\n  value: SanityDocument\r\n}\r\n\r\nconst getUnknownTypeFallback = (id: string, typeName: string) => ({\r\n  title: (\r\n    <em>\r\n      No schema found for type <code>{typeName}</code>\r\n    </em>\r\n  ),\r\n  subtitle: (\r\n    <em>\r\n      Document: <code>{id}</code>\r\n    </em>\r\n  ),\r\n  media: () => <WarningOutlineIcon />,\r\n})\r\n\r\nexport function MissingSchemaType(props: MissingSchemaTypeProps) {\r\n  const {layout, value} = props\r\n\r\n  return (\r\n    <SanityDefaultPreview {...getUnknownTypeFallback(value._id, value._type)} layout={layout} />\r\n  )\r\n}\r\n","// Adapted from https://github.com/sanity-io/sanity/blob/next/packages/sanity/src/desk/components/TimeAgo.tsx\r\nimport {useTimeAgo} from 'sanity'\r\n\r\nexport interface TimeAgoProps {\r\n  time: string | Date\r\n}\r\n\r\nexport function TimeAgo({time}: TimeAgoProps) {\r\n  const timeAgo = useTimeAgo(time)\r\n\r\n  return <span title={timeAgo}>{timeAgo} ago</span>\r\n}\r\n","// Adapted from https://github.com/sanity-io/sanity/blob/next/packages/sanity/src/desk/components/DraftStatus.tsx\r\nimport {EditIcon} from '@sanity/icons'\r\nimport {Box, Text, Tooltip} from '@sanity/ui'\r\nimport type {PreviewValue, SanityDocument} from 'sanity'\r\nimport {TextWithTone} from 'sanity'\r\n\r\nimport {TimeAgo} from './TimeAgo'\r\n\r\nexport function DraftStatus(props: {document?: PreviewValue | Partial<SanityDocument> | null}) {\r\n  const {document} = props\r\n  const updatedAt = document && '_updatedAt' in document && document._updatedAt\r\n\r\n  return (\r\n    <Tooltip\r\n      animate\r\n      portal\r\n      content={\r\n        <Box padding={2}>\r\n          <Text size={1}>\r\n            {document ? (\r\n              <>Edited {updatedAt && <TimeAgo time={updatedAt} />}</>\r\n            ) : (\r\n              <>No unpublished edits</>\r\n            )}\r\n          </Text>\r\n        </Box>\r\n      }\r\n    >\r\n      <TextWithTone tone=\"caution\" dimmed={!document} muted={!document} size={1}>\r\n        <EditIcon />\r\n      </TextWithTone>\r\n    </Tooltip>\r\n  )\r\n}\r\n","// Adapted from https://github.com/sanity-io/sanity/blob/next/packages/sanity/src/desk/components/PublishedStatus.tsx\r\n\r\nimport {PublishIcon} from '@sanity/icons'\r\nimport {Box, Text, Tooltip} from '@sanity/ui'\r\nimport type {PreviewValue, SanityDocument} from 'sanity'\r\nimport {TextWithTone} from 'sanity'\r\n\r\nimport {TimeAgo} from './TimeAgo'\r\n\r\nexport function PublishedStatus(props: {document?: PreviewValue | Partial<SanityDocument> | null}) {\r\n  const {document} = props\r\n  const updatedAt = document && '_updatedAt' in document && document._updatedAt\r\n\r\n  return (\r\n    <Tooltip\r\n      animate\r\n      portal\r\n      content={\r\n        <Box padding={2}>\r\n          <Text size={1}>\r\n            {document ? (\r\n              <>Published {updatedAt && <TimeAgo time={updatedAt} />}</>\r\n            ) : (\r\n              <>Not published</>\r\n            )}\r\n          </Text>\r\n        </Box>\r\n      }\r\n    >\r\n      <TextWithTone tone=\"positive\" dimmed={!document} muted={!document} size={1}>\r\n        <PublishIcon />\r\n      </TextWithTone>\r\n    </Tooltip>\r\n  )\r\n}\r\n","// Adapted from:\r\n// https://github.com/sanity-io/sanity/blob/next/packages/sanity/src/desk/components/paneItem/PaneItemPreview.tsx\r\nimport {Inline} from '@sanity/ui'\r\nimport {isNumber, isString} from 'lodash'\r\nimport {isValidElement, useMemo} from 'react'\r\nimport {useObservable} from 'react-rx'\r\nimport type {SanityDocument, SchemaType} from 'sanity'\r\nimport type {PreviewValue} from 'sanity'\r\nimport {\r\n  type DocumentPresence,\r\n  DocumentPreviewPresence,\r\n  type DocumentPreviewStore,\r\n  type GeneralPreviewLayoutKey,\r\n  getPreviewStateObservable,\r\n  getPreviewValueWithFallback,\r\n  isRecord,\r\n  SanityDefaultPreview,\r\n} from 'sanity'\r\n\r\nimport {DraftStatus} from './DraftStatus'\r\nimport {PublishedStatus} from './PublishedStatus'\r\n\r\nexport interface PaneItemPreviewState {\r\n  isLoading?: boolean\r\n  draft?: PreviewValue | Partial<SanityDocument> | null\r\n  published?: PreviewValue | Partial<SanityDocument> | null\r\n}\r\n\r\nexport interface PaneItemPreviewProps {\r\n  documentPreviewStore: DocumentPreviewStore\r\n  icon: React.ComponentType | false\r\n  layout: GeneralPreviewLayoutKey\r\n  presence?: DocumentPresence[]\r\n  schemaType: SchemaType\r\n  value: SanityDocument\r\n}\r\n\r\nexport function PaneItemPreview(props: PaneItemPreviewProps) {\r\n  const {icon, layout, presence, schemaType, value} = props\r\n  const title =\r\n    (isRecord(value.title) && isValidElement(value.title)) ||\r\n    isString(value.title) ||\r\n    isNumber(value.title)\r\n      ? value.title\r\n      : null\r\n\r\n  const observable = useMemo(\r\n    () => getPreviewStateObservable(props.documentPreviewStore, schemaType, value._id),\r\n    [props.documentPreviewStore, schemaType, value._id]\r\n  )\r\n  const {snapshot, original, isLoading} = useObservable(observable, {\r\n    isLoading: true,\r\n    snapshot: null,\r\n    original: null,\r\n  })\r\n\r\n  const status = isLoading ? null : (\r\n    <Inline space={4}>\r\n      {presence && presence.length > 0 && <DocumentPreviewPresence presence={presence} />}\r\n      <PublishedStatus document={original} />\r\n      <DraftStatus document={snapshot} />\r\n    </Inline>\r\n  )\r\n\r\n  return (\r\n    <SanityDefaultPreview\r\n      {...(getPreviewValueWithFallback({snapshot, original, fallback: {title}}) as any)}\r\n      isPlaceholder={isLoading}\r\n      icon={icon}\r\n      layout={layout}\r\n      status={status}\r\n    />\r\n  )\r\n}\r\n","// Adapted from https://github.com/sanity-io/sanity/blob/next/packages/sanity/src/desk/components/paneItem/PaneItem.tsx\r\n\r\nimport {DocumentIcon} from '@sanity/icons'\r\nimport type {PropsWithChildren} from 'react'\r\nimport React, {useMemo} from 'react'\r\nimport type {CollatedHit, FIXME, SanityDocument, SchemaType} from 'sanity'\r\nimport {PreviewCard, useDocumentPresence, useDocumentPreviewStore, useSchema} from 'sanity'\r\nimport {IntentLink} from 'sanity/router'\r\n\r\nimport {MissingSchemaType} from './MissingSchemaType'\r\nimport {PaneItemPreview} from './PaneItemPreview'\r\n\r\ninterface DocumentPreviewProps {\r\n  schemaType?: SchemaType\r\n  documentPair: CollatedHit<SanityDocument>\r\n}\r\n\r\n/**\r\n * Return `false` if we explicitly disable the icon.\r\n * Otherwise return the passed icon or the schema type icon as a backup.\r\n */\r\nexport function getIconWithFallback(\r\n  icon: React.ComponentType<any> | false | undefined,\r\n  schemaType: SchemaType | undefined,\r\n  defaultIcon: React.ComponentType<any>\r\n): React.ComponentType<any> | false {\r\n  if (icon === false) {\r\n    return false\r\n  }\r\n\r\n  return icon || ((schemaType && schemaType.icon) as any) || defaultIcon || false\r\n}\r\n\r\nfunction DocumentPreviewLink(props: DocumentPreviewProps) {\r\n  return (linkProps: PropsWithChildren) => (\r\n    <IntentLink intent=\"edit\" params={{id: props.documentPair.id}}>\r\n      {linkProps.children}\r\n    </IntentLink>\r\n  )\r\n}\r\n\r\nexport function DocumentPreview(props: DocumentPreviewProps) {\r\n  const {schemaType, documentPair} = props\r\n  const doc = documentPair?.draft || documentPair?.published\r\n  const id = documentPair.id || ''\r\n  const documentPreviewStore = useDocumentPreviewStore()\r\n  const schema = useSchema()\r\n  const documentPresence = useDocumentPresence(id)\r\n  const hasSchemaType = Boolean(schemaType && schemaType.name && schema.get(schemaType.name))\r\n\r\n  const PreviewComponent = useMemo(() => {\r\n    if (!doc) return null\r\n\r\n    if (!schemaType || !hasSchemaType) {\r\n      return <MissingSchemaType value={doc as SanityDocument} />\r\n    }\r\n\r\n    return (\r\n      <PaneItemPreview\r\n        documentPreviewStore={documentPreviewStore}\r\n        icon={getIconWithFallback(undefined, schemaType, DocumentIcon)}\r\n        schemaType={schemaType}\r\n        layout=\"default\"\r\n        value={doc}\r\n        presence={documentPresence}\r\n      />\r\n    )\r\n  }, [hasSchemaType, schemaType, documentPresence, doc, documentPreviewStore])\r\n\r\n  return (\r\n    <PreviewCard\r\n      __unstable_focusRing\r\n      as={DocumentPreviewLink(props) as FIXME}\r\n      data-as=\"a\"\r\n      data-ui=\"PaneItem\"\r\n      padding={2}\r\n      radius={2}\r\n      tone=\"inherit\"\r\n    >\r\n      {PreviewComponent}\r\n    </PreviewCard>\r\n  )\r\n}\r\n","import type {SanityDocument} from '@sanity/client'\r\nimport {Box, Card, Text} from '@sanity/ui'\r\nimport {collate, useSchema} from 'sanity'\r\nimport {styled} from 'styled-components'\r\n\r\nimport {DocumentPreview} from '../documentPreview/DocumentPreview'\r\nimport SpinnerBox from '../SpinnerBox'\r\n\r\nconst Container = styled(Box)`\r\n  * {\r\n    color: ${(props: any) => props.theme.sanity.color.base.fg};\r\n  }\r\n  a {\r\n    text-decoration: none;\r\n  }\r\n  h2 {\r\n    font-size: ${(props: any) => props.theme.sanity.fonts.text.sizes[1]};\r\n  }\r\n`\r\n\r\nconst VideoReferences: React.FC<{\r\n  references?: SanityDocument[]\r\n  isLoaded: boolean\r\n}> = (props) => {\r\n  const schema = useSchema()\r\n  if (!props.isLoaded) {\r\n    return <SpinnerBox />\r\n  }\r\n\r\n  if (!props.references?.length) {\r\n    return (\r\n      <Card border radius={3} padding={3}>\r\n        <Text size={2}>No documents are using this video</Text>\r\n      </Card>\r\n    )\r\n  }\r\n\r\n  const documentPairs = collate(props.references || [])\r\n  return (\r\n    <Container>\r\n      {documentPairs?.map((documentPair) => {\r\n        const schemaType = schema.get(documentPair.type)\r\n\r\n        return (\r\n          <Card\r\n            key={documentPair.id}\r\n            marginBottom={2}\r\n            padding={2}\r\n            radius={2}\r\n            shadow={1}\r\n            style={{overflow: 'hidden'}}\r\n          >\r\n            <Box>\r\n              <DocumentPreview documentPair={documentPair} schemaType={schemaType} />\r\n            </Box>\r\n          </Card>\r\n        )\r\n      })}\r\n    </Container>\r\n  )\r\n}\r\n\r\nexport default VideoReferences\r\n","import {TrashIcon} from '@sanity/icons'\r\nimport {Box, Button, Card, Checkbox, Dialog, Flex, Heading, Stack, Text, useToast} from '@sanity/ui'\r\nimport {useEffect, useState} from 'react'\r\nimport type {SanityDocument} from 'sanity'\r\n\r\nimport {deleteAsset} from '../../actions/assets'\r\nimport {useClient} from '../../hooks/useClient'\r\nimport {DIALOGS_Z_INDEX} from '../../util/constants'\r\nimport type {VideoAssetDocument} from '../../util/types'\r\nimport SpinnerBox from '../SpinnerBox'\r\nimport VideoReferences from './VideoReferences'\r\n\r\nexport default function DeleteDialog({\r\n  asset,\r\n  references,\r\n  referencesLoading,\r\n  cancelDelete,\r\n  succeededDeleting,\r\n}: {\r\n  asset: VideoAssetDocument\r\n  references?: SanityDocument[]\r\n  referencesLoading: boolean\r\n  cancelDelete: () => void\r\n  succeededDeleting: () => void\r\n}) {\r\n  const client = useClient()\r\n  const [state, setState] = useState<\r\n    'processing_deletion' | 'checkingReferences' | 'error_deleting' | 'cantDelete' | 'confirm'\r\n  >('checkingReferences')\r\n  const [deleteOnMux, setDeleteOnMux] = useState(true)\r\n  const toast = useToast()\r\n\r\n  useEffect(() => {\r\n    if (state !== 'checkingReferences' || referencesLoading) return\r\n\r\n    setState(references?.length ? 'cantDelete' : 'confirm')\r\n  }, [state, references, referencesLoading])\r\n\r\n  async function confirmDelete() {\r\n    if (state !== 'confirm') return\r\n\r\n    setState('processing_deletion')\r\n    const worked = await deleteAsset({client, asset, deleteOnMux})\r\n    if (worked === true) {\r\n      toast.push({title: 'Successfully deleted video', status: 'success'})\r\n      succeededDeleting()\r\n    } else if (worked === 'failed-mux') {\r\n      toast.push({\r\n        title: 'Deleted video in Sanity',\r\n        description: \"But it wasn't deleted in Mux\",\r\n        status: 'warning',\r\n      })\r\n      succeededDeleting()\r\n    } else {\r\n      toast.push({title: 'Failed deleting video', status: 'error'})\r\n\r\n      setState('error_deleting')\r\n    }\r\n  }\r\n\r\n  return (\r\n    <Dialog\r\n      animate\r\n      header={'Delete video'}\r\n      zOffset={DIALOGS_Z_INDEX}\r\n      id=\"deleting-video-details-dialog\"\r\n      onClose={cancelDelete}\r\n      onClickOutside={cancelDelete}\r\n      width={1}\r\n      position=\"fixed\"\r\n    >\r\n      <Card\r\n        padding={3}\r\n        style={{\r\n          minHeight: '150px',\r\n          display: 'flex',\r\n          alignItems: 'center',\r\n          justifyContent: 'center',\r\n        }}\r\n      >\r\n        <Stack space={3}>\r\n          {state === 'checkingReferences' && (\r\n            <>\r\n              <Heading size={2}>Checking if video can be deleted</Heading>\r\n              <SpinnerBox />\r\n            </>\r\n          )}\r\n          {state === 'cantDelete' && (\r\n            <>\r\n              <Heading size={2}>Video can&apos;t be deleted</Heading>\r\n              <Text size={2} style={{marginBottom: '2rem'}}>\r\n                There are {references?.length} document{references && references.length > 0 && 's'}{' '}\r\n                pointing to this video. Remove their references to this file or delete them before\r\n                proceeding.\r\n              </Text>\r\n              <VideoReferences references={references} isLoaded={!referencesLoading} />\r\n            </>\r\n          )}\r\n          {state === 'confirm' && (\r\n            <>\r\n              <Heading size={2}>Are you sure you want to delete this video?</Heading>\r\n              <Text size={2}>This action is irreversible</Text>\r\n              <Stack space={4} marginY={4}>\r\n                <Flex align=\"center\" as=\"label\">\r\n                  <Checkbox\r\n                    checked={deleteOnMux}\r\n                    onChange={() => setDeleteOnMux((prev) => !prev)}\r\n                  />\r\n                  <Text style={{margin: '0 10px'}}>Delete asset on Mux</Text>\r\n                </Flex>\r\n                <Flex align=\"center\" as=\"label\">\r\n                  <Checkbox disabled checked />\r\n                  <Text style={{margin: '0 10px'}}>Delete video from dataset</Text>\r\n                </Flex>\r\n                <Box>\r\n                  <Button\r\n                    icon={TrashIcon}\r\n                    fontSize={2}\r\n                    padding={3}\r\n                    text=\"Delete video\"\r\n                    tone=\"critical\"\r\n                    onClick={confirmDelete}\r\n                    disabled={['processing_deletion', 'checkingReferences', 'cantDelete'].some(\r\n                      (s) => s === state\r\n                    )}\r\n                  />\r\n                </Box>\r\n              </Stack>\r\n            </>\r\n          )}\r\n          {state === 'processing_deletion' && (\r\n            <>\r\n              <Heading size={2}>Deleting video...</Heading>\r\n              <SpinnerBox />\r\n            </>\r\n          )}\r\n          {state === 'error_deleting' && (\r\n            <>\r\n              <Heading size={2}>Something went wrong!</Heading>\r\n              <Text size={2}>Try deleting the video again by clicking the button below</Text>\r\n            </>\r\n          )}\r\n        </Stack>\r\n      </Card>\r\n    </Dialog>\r\n  )\r\n}\r\n","import {createHookFromObservableFactory, DocumentStore, SanityDocument} from 'sanity'\r\n\r\nimport {SANITY_API_VERSION} from './useClient'\r\n\r\nconst useDocReferences = createHookFromObservableFactory<\r\n  SanityDocument[],\r\n  {\r\n    documentStore: DocumentStore\r\n    id: string\r\n  }\r\n>(({documentStore, id}) => {\r\n  return documentStore.listenQuery(\r\n    /* groq */ '*[references($id)]{_id, _type, _rev, _updatedAt, _createdAt}',\r\n    {id},\r\n    {\r\n      apiVersion: SANITY_API_VERSION,\r\n    }\r\n  )\r\n})\r\n\r\nexport default useDocReferences\r\n","import {formatSeconds} from './formatSeconds'\r\nimport type {MuxTextTrack, VideoAssetDocument} from './types'\r\n\r\nexport default function getVideoMetadata(doc: VideoAssetDocument) {\r\n  const id = doc.assetId || doc._id || ''\r\n  const date = doc.data?.created_at\r\n    ? new Date(Number(doc.data.created_at) * 1000)\r\n    : new Date(doc._createdAt || doc._updatedAt || Date.now())\r\n\r\n  return {\r\n    title: doc.filename || id.slice(0, 12),\r\n    id: id,\r\n    playbackId: doc.playbackId,\r\n    createdAt: date,\r\n    duration: doc.data?.duration ? formatSeconds(doc.data?.duration) : undefined,\r\n    playback_ids: doc.data?.playback_ids,\r\n    aspect_ratio: doc.data?.aspect_ratio,\r\n    max_stored_resolution: doc.data?.max_stored_resolution,\r\n    max_stored_frame_rate: doc.data?.max_stored_frame_rate,\r\n    text_tracks:\r\n      doc.data?.tracks?.filter((track): track is MuxTextTrack => track.type === 'text') || [],\r\n  }\r\n}\r\n","import {useToast} from '@sanity/ui'\r\nimport {useMemo, useState} from 'react'\r\nimport {useDocumentStore} from 'sanity'\r\n\r\nimport {useClient} from '../../hooks/useClient'\r\nimport useDocReferences from '../../hooks/useDocReferences'\r\nimport {useResyncAsset} from '../../hooks/useResyncAsset'\r\nimport getVideoMetadata from '../../util/getVideoMetadata'\r\nimport {VideoAssetDocument} from '../../util/types'\r\n\r\ntype VideoDetailsState = 'idle' | 'saving' | 'deleting' | 'closing' | 'resyncing' | 'downloading'\r\n\r\nexport interface VideoDetailsProps {\r\n  closeDialog: () => void\r\n  asset: VideoAssetDocument & {autoPlay?: boolean}\r\n}\r\n\r\nexport default function useVideoDetails(props: VideoDetailsProps) {\r\n  const documentStore = useDocumentStore()\r\n  const toast = useToast()\r\n  const client = useClient()\r\n\r\n  const [references, referencesLoading] = useDocReferences(\r\n    useMemo(() => ({documentStore, id: props.asset._id}), [documentStore, props.asset._id])\r\n  )\r\n\r\n  const [originalAsset, setOriginalAsset] = useState(() => props.asset)\r\n  const [filename, setFilename] = useState(props.asset.filename)\r\n  const modified = filename !== originalAsset.filename\r\n\r\n  const displayInfo = getVideoMetadata({...props.asset, filename})\r\n\r\n  const [state, setState] = useState<VideoDetailsState>('idle')\r\n\r\n  const {resyncAsset, isResyncing} = useResyncAsset({showToast: true})\r\n\r\n  async function handleResync() {\r\n    if (state !== 'idle') return\r\n    setState('resyncing')\r\n    await resyncAsset(props.asset)\r\n    setState('idle')\r\n  }\r\n\r\n  function handleClose() {\r\n    if (state !== 'idle') return\r\n\r\n    if (modified) {\r\n      setState('closing')\r\n      return\r\n    }\r\n\r\n    props.closeDialog()\r\n  }\r\n\r\n  function confirmClose(shouldClose: boolean) {\r\n    if (state !== 'closing') return\r\n\r\n    if (shouldClose) props.closeDialog()\r\n\r\n    setState('idle')\r\n  }\r\n\r\n  async function saveChanges() {\r\n    if (state !== 'idle') return\r\n    setState('saving')\r\n\r\n    try {\r\n      await client.patch(props.asset._id).set({filename}).commit()\r\n      setOriginalAsset((prev) => ({...prev, filename}))\r\n      toast.push({\r\n        title: 'Video title updated',\r\n        description: `New title: ${filename}`,\r\n        status: 'success',\r\n      })\r\n      props.closeDialog()\r\n    } catch (error) {\r\n      toast.push({\r\n        title: 'Failed updating file name',\r\n        status: 'error',\r\n        description: typeof error === 'string' ? error : 'Please try again',\r\n      })\r\n      setFilename(originalAsset.filename)\r\n    }\r\n\r\n    setState('idle')\r\n  }\r\n\r\n  return {\r\n    references,\r\n    referencesLoading,\r\n    modified,\r\n    filename,\r\n    setFilename,\r\n    displayInfo,\r\n    state,\r\n    setState,\r\n    handleClose,\r\n    confirmClose,\r\n    saveChanges,\r\n    handleResync,\r\n    isResyncing,\r\n  }\r\n}\r\n","import {\r\n  CalendarIcon,\r\n  CheckmarkIcon,\r\n  ClockIcon,\r\n  CropIcon,\r\n  DownloadIcon,\r\n  EditIcon,\r\n  ErrorOutlineIcon,\r\n  RevertIcon,\r\n  SearchIcon,\r\n  SyncIcon,\r\n  TagIcon,\r\n  TrashIcon,\r\n} from '@sanity/icons'\r\nimport {\r\n  Button,\r\n  Card,\r\n  Dialog,\r\n  Flex,\r\n  Heading,\r\n  Spinner,\r\n  Stack,\r\n  Tab,\r\n  TabList,\r\n  TabPanel,\r\n  Text,\r\n  TextInput,\r\n} from '@sanity/ui'\r\nimport React, {useEffect, useState} from 'react'\r\n\r\nimport {DIALOGS_Z_INDEX} from '../../util/constants'\r\nimport {MuxPlaybackId, MuxTextTrack, PlaybackPolicy} from '../../util/types'\r\nimport DownloadAssetDialog from '../DownloadAssetDialog'\r\nimport FormField from '../FormField'\r\nimport IconInfo from '../IconInfo'\r\nimport {ResolutionIcon} from '../icons/Resolution'\r\nimport {StopWatchIcon} from '../icons/StopWatch'\r\nimport TextTracksManager from '../TextTracksManager'\r\nimport VideoPlayer from '../VideoPlayer'\r\nimport DeleteDialog from './DeleteDialog'\r\nimport useVideoDetails, {VideoDetailsProps} from './useVideoDetails'\r\nimport VideoReferences from './VideoReferences'\r\n\r\nconst AssetInput: React.FC<{\r\n  label: string\r\n  description?: string\r\n  placeholder?: string\r\n  value: string\r\n  onInput: (e: React.FormEvent<HTMLInputElement>) => void\r\n  disabled?: boolean\r\n}> = (props) => (\r\n  <FormField title={props.label} description={props.description} inputId={props.label}>\r\n    <TextInput\r\n      id={props.label}\r\n      value={props.value}\r\n      placeholder={props.placeholder}\r\n      onInput={props.onInput}\r\n      disabled={props.disabled}\r\n    />\r\n  </FormField>\r\n)\r\n\r\nconst VideoDetails: React.FC<VideoDetailsProps> = (props) => {\r\n  const [tab, setTab] = useState<'details' | 'references'>('details')\r\n  const {\r\n    displayInfo,\r\n    filename,\r\n    modified,\r\n    references,\r\n    referencesLoading,\r\n    setFilename,\r\n    state,\r\n    setState,\r\n    handleClose,\r\n    confirmClose,\r\n    saveChanges,\r\n    handleResync,\r\n    isResyncing,\r\n  } = useVideoDetails(props)\r\n\r\n  const isSaving = state === 'saving'\r\n\r\n  // Avoid layout shifts in large screens' 2-column dialog by setting their `minHeight` to the container's\r\n  const [containerHeight, setContainerHeight] = useState<number | null>(null)\r\n  const contentsRef = React.useRef<HTMLDivElement>(null)\r\n  useEffect(() => {\r\n    if (!contentsRef.current || !('getBoundingClientRect' in contentsRef.current)) return\r\n\r\n    setContainerHeight(contentsRef.current.getBoundingClientRect().height)\r\n  }, [])\r\n\r\n  return (\r\n    <Dialog\r\n      animate\r\n      header={displayInfo.title}\r\n      zOffset={DIALOGS_Z_INDEX}\r\n      id=\"video-details-dialog\"\r\n      onClose={handleClose}\r\n      onClickOutside={handleClose}\r\n      width={2}\r\n      position=\"fixed\"\r\n      footer={\r\n        <Card padding={3}>\r\n          <Flex justify=\"space-between\" align=\"center\">\r\n            <Flex gap={2}>\r\n              <Button\r\n                icon={TrashIcon}\r\n                fontSize={2}\r\n                padding={3}\r\n                mode=\"bleed\"\r\n                text=\"Delete\"\r\n                tone=\"critical\"\r\n                onClick={() => setState('deleting')}\r\n                disabled={isSaving || isResyncing}\r\n              />\r\n              <Button\r\n                icon={SyncIcon}\r\n                fontSize={2}\r\n                padding={3}\r\n                mode=\"bleed\"\r\n                text=\"Resync\"\r\n                tone=\"primary\"\r\n                onClick={handleResync}\r\n                disabled={isSaving || isResyncing}\r\n                iconRight={isResyncing && Spinner}\r\n              />\r\n            </Flex>\r\n            <Flex gap={2}>\r\n              <Button\r\n                icon={DownloadIcon}\r\n                fontSize={2}\r\n                padding={3}\r\n                mode=\"bleed\"\r\n                text=\"Download\"\r\n                tone=\"default\"\r\n                onClick={() => setState('downloading')}\r\n                disabled={isSaving}\r\n              />\r\n              {modified && (\r\n                <Button\r\n                  icon={CheckmarkIcon}\r\n                  fontSize={2}\r\n                  padding={3}\r\n                  mode=\"ghost\"\r\n                  text=\"Save and close\"\r\n                  tone=\"positive\"\r\n                  onClick={saveChanges}\r\n                  iconRight={isSaving && Spinner}\r\n                  disabled={isSaving || isResyncing}\r\n                />\r\n              )}\r\n            </Flex>\r\n          </Flex>\r\n        </Card>\r\n      }\r\n    >\r\n      {/* DELETION DIALOG */}\r\n      {state === 'deleting' && (\r\n        <DeleteDialog\r\n          asset={props.asset}\r\n          cancelDelete={() => setState('idle')}\r\n          referencesLoading={referencesLoading}\r\n          references={references}\r\n          succeededDeleting={() => {\r\n            props.closeDialog()\r\n          }}\r\n        />\r\n      )}\r\n\r\n      {/* DOWNLOAD DIALOG */}\r\n      {state === 'downloading' && (\r\n        <DownloadAssetDialog\r\n          asset={props.asset}\r\n          onClose={() => setState('idle')}\r\n          absolute={true}\r\n        />\r\n      )}\r\n\r\n      {/* CONFIRM CLOSING DIALOG */}\r\n      {state === 'closing' && (\r\n        <Dialog\r\n          animate\r\n          header={'You have unsaved changes'}\r\n          zOffset={DIALOGS_Z_INDEX}\r\n          id=\"closing-video-details-dialog\"\r\n          onClose={() => confirmClose(false)}\r\n          onClickOutside={() => confirmClose(false)}\r\n          width={1}\r\n          position=\"fixed\"\r\n          footer={\r\n            <Card padding={3}>\r\n              <Flex justify=\"space-between\" align=\"center\">\r\n                <Button\r\n                  icon={ErrorOutlineIcon}\r\n                  fontSize={2}\r\n                  padding={3}\r\n                  text=\"Discard changes\"\r\n                  tone=\"critical\"\r\n                  onClick={() => confirmClose(true)}\r\n                />\r\n                {modified && (\r\n                  <Button\r\n                    icon={RevertIcon}\r\n                    fontSize={2}\r\n                    padding={3}\r\n                    mode=\"ghost\"\r\n                    text=\"Keep editing\"\r\n                    tone=\"primary\"\r\n                    onClick={() => confirmClose(false)}\r\n                  />\r\n                )}\r\n              </Flex>\r\n            </Card>\r\n          }\r\n        >\r\n          <Card padding={5}>\r\n            <Stack style={{textAlign: 'center'}} space={3}>\r\n              <Heading size={2}>Unsaved changes will be lost</Heading>\r\n              <Text size={2}>Are you sure you want to discard them?</Text>\r\n            </Stack>\r\n          </Card>\r\n        </Dialog>\r\n      )}\r\n      <Card\r\n        padding={4}\r\n        sizing=\"border\"\r\n        style={{\r\n          containerType: 'inline-size',\r\n        }}\r\n      >\r\n        <Flex\r\n          sizing=\"border\"\r\n          gap={4}\r\n          direction={['column', 'column', 'row']}\r\n          align=\"flex-start\"\r\n          ref={contentsRef}\r\n          style={\r\n            typeof containerHeight === 'number'\r\n              ? {\r\n                  minHeight: containerHeight,\r\n                }\r\n              : undefined\r\n          }\r\n        >\r\n          <Stack space={4} flex={1} sizing=\"border\">\r\n            <VideoPlayer asset={props.asset} autoPlay={props.asset.autoPlay || false} />\r\n            {tab === 'details' && (\r\n              <TextTracksManager\r\n                asset={props.asset}\r\n                iconOnly\r\n                collapseTracks\r\n                tracks={\r\n                  displayInfo?.text_tracks ||\r\n                  props.asset.data?.tracks?.filter(\r\n                    (track): track is MuxTextTrack => track.type === 'text'\r\n                  ) ||\r\n                  []\r\n                }\r\n              />\r\n            )}\r\n          </Stack>\r\n          <Stack space={4} flex={1} sizing=\"border\">\r\n            <TabList space={2}>\r\n              <Tab\r\n                aria-controls=\"details-panel\"\r\n                icon={EditIcon}\r\n                id=\"details-tab\"\r\n                label=\"Details\"\r\n                onClick={() => setTab('details')}\r\n                selected={tab === 'details'}\r\n              />\r\n              <Tab\r\n                aria-controls=\"references-panel\"\r\n                icon={SearchIcon}\r\n                id=\"references-tab\"\r\n                label={`Used by ${references ? `(${references.length})` : ''}`}\r\n                onClick={() => setTab('references')}\r\n                selected={tab === 'references'}\r\n              />\r\n            </TabList>\r\n            <TabPanel\r\n              aria-labelledby=\"details-tab\"\r\n              id=\"details-panel\"\r\n              hidden={tab !== 'details'}\r\n              style={{wordBreak: 'break-word'}}\r\n            >\r\n              <Stack space={4}>\r\n                <AssetInput\r\n                  label=\"Video title or file name\"\r\n                  description=\"Not visible to users. Useful for finding videos later.\"\r\n                  value={filename || ''}\r\n                  onInput={(e) => setFilename(e.currentTarget.value)}\r\n                  disabled={state !== 'idle'}\r\n                />\r\n                <Stack space={3}>\r\n                  {displayInfo?.duration && (\r\n                    <IconInfo\r\n                      text={`Duration: ${displayInfo.duration}`}\r\n                      icon={ClockIcon}\r\n                      size={2}\r\n                    />\r\n                  )}\r\n                  {displayInfo?.max_stored_resolution && (\r\n                    <IconInfo\r\n                      text={`Max Resolution: ${displayInfo.max_stored_resolution}`}\r\n                      icon={ResolutionIcon}\r\n                      size={2}\r\n                    />\r\n                  )}\r\n                  {displayInfo?.max_stored_frame_rate && (\r\n                    <IconInfo\r\n                      text={`Frame rate: ${displayInfo.max_stored_frame_rate}`}\r\n                      icon={StopWatchIcon}\r\n                      size={2}\r\n                    />\r\n                  )}\r\n                  {displayInfo?.aspect_ratio && (\r\n                    <IconInfo\r\n                      text={`Aspect Ratio: ${displayInfo.aspect_ratio}`}\r\n                      icon={CropIcon}\r\n                      size={2}\r\n                    />\r\n                  )}\r\n                  <IconInfo\r\n                    text={`Uploaded on: ${displayInfo.createdAt.toLocaleDateString('en', {\r\n                      year: 'numeric',\r\n                      month: '2-digit',\r\n                      day: '2-digit',\r\n                      hour: '2-digit',\r\n                      minute: '2-digit',\r\n                      hour12: true,\r\n                    })}`}\r\n                    icon={CalendarIcon}\r\n                    size={2}\r\n                  />\r\n                  <IconInfo text={`Mux ID: \\n${displayInfo.id}`} icon={TagIcon} size={2} />\r\n                  <PlaybackIds playback_ids={displayInfo.playback_ids} />\r\n                </Stack>\r\n              </Stack>\r\n            </TabPanel>\r\n            <TabPanel\r\n              aria-labelledby=\"references-tab\"\r\n              id=\"references-panel\"\r\n              hidden={tab !== 'references'}\r\n            >\r\n              <VideoReferences references={references} isLoaded={!referencesLoading} />\r\n            </TabPanel>\r\n          </Stack>\r\n        </Flex>\r\n      </Card>\r\n    </Dialog>\r\n  )\r\n}\r\n\r\nconst PlaybackIds = ({playback_ids}: {playback_ids?: MuxPlaybackId[]}) => {\r\n  if (playback_ids) {\r\n    return playback_ids.map((entry) => (\r\n      <IconInfo\r\n        key={entry.id}\r\n        text={`Playback ID [${policyToText(entry.policy)}]: ${entry.id}`}\r\n        icon={TagIcon}\r\n        size={2}\r\n      />\r\n    ))\r\n  }\r\n  return <IconInfo text={'No Playback ID'} icon={TagIcon} size={2} />\r\n}\r\n\r\nconst policyToText = (policy: PlaybackPolicy) => {\r\n  switch (policy) {\r\n    case 'drm':\r\n      return 'DRM'\r\n    case 'signed':\r\n      return 'Signed'\r\n    case 'public':\r\n      return 'Public'\r\n    default:\r\n      return policy\r\n  }\r\n}\r\nexport default VideoDetails\r\n","import {CalendarIcon, ClockIcon, TagIcon} from '@sanity/icons'\r\nimport {Inline, Stack, Text} from '@sanity/ui'\r\n\r\nimport getVideoMetadata from '../util/getVideoMetadata'\r\nimport type {VideoAssetDocument} from '../util/types'\r\nimport IconInfo from './IconInfo'\r\n\r\nconst VideoMetadata = (props: {asset: VideoAssetDocument}) => {\r\n  if (!props.asset) {\r\n    return null\r\n  }\r\n\r\n  const displayInfo = getVideoMetadata(props.asset)\r\n  return (\r\n    <Stack space={2}>\r\n      {displayInfo.title && (\r\n        <Text\r\n          size={1}\r\n          weight=\"semibold\"\r\n          style={{\r\n            wordWrap: 'break-word',\r\n          }}\r\n        >\r\n          {displayInfo.title}\r\n        </Text>\r\n      )}\r\n      <Inline space={3}>\r\n        {displayInfo?.duration && (\r\n          <IconInfo text={displayInfo.duration} icon={ClockIcon} size={1} muted />\r\n        )}\r\n        <IconInfo\r\n          text={displayInfo.createdAt.toISOString().split('T')[0]}\r\n          icon={CalendarIcon}\r\n          size={1}\r\n          muted\r\n        />\r\n        {displayInfo.title != displayInfo.id.slice(0, 12) && (\r\n          <IconInfo text={displayInfo.id.slice(0, 12)} icon={TagIcon} size={1} muted />\r\n        )}\r\n      </Inline>\r\n    </Stack>\r\n  )\r\n}\r\n\r\nexport default VideoMetadata\r\n","import {CheckmarkIcon, EditIcon, LockIcon, PlayIcon} from '@sanity/icons'\r\nimport {Button, Card, Stack, Text, Tooltip} from '@sanity/ui'\r\nimport React, {useState} from 'react'\r\nimport {styled} from 'styled-components'\r\n\r\nimport {DRMWarningDialog, useDrmPlaybackWarningContext} from '../context/DrmPlaybackWarningContext'\r\nimport {THUMBNAIL_ASPECT_RATIO} from '../util/constants'\r\nimport {getPlaybackPolicy} from '../util/getPlaybackPolicy'\r\nimport {VideoAssetDocument} from '../util/types'\r\nimport IconInfo from './IconInfo'\r\nimport {AudioIcon} from './icons/Audio'\r\nimport VideoMetadata from './VideoMetadata'\r\nimport VideoPlayer, {assetIsAudio} from './VideoPlayer'\r\nimport VideoThumbnail from './VideoThumbnail'\r\n\r\nconst PlayButton = styled.button`\r\n  display: block;\r\n  padding: 0;\r\n  margin: 0;\r\n  border: none;\r\n  border-radius: 0.1875rem;\r\n  position: relative;\r\n  cursor: pointer;\r\n\r\n  &::after {\r\n    content: '';\r\n    background: var(--card-fg-color);\r\n    opacity: 0;\r\n    display: block;\r\n    position: absolute;\r\n    inset: 0;\r\n    z-index: 10;\r\n    transition: 0.15s ease-out;\r\n    border-radius: inherit;\r\n  }\r\n\r\n  > div[data-play] {\r\n    z-index: 11;\r\n    opacity: 0;\r\n    transition: 0.15s 0.05s ease-out;\r\n    position: absolute;\r\n    left: 50%;\r\n    top: 50%;\r\n    transform: translate(-50%, -50%);\r\n    color: var(--card-fg-color);\r\n    background: var(--card-bg-color);\r\n    width: auto;\r\n    height: 30%;\r\n    aspect-ratio: 1;\r\n    border-radius: 100%;\r\n    display: flex;\r\n    justify-content: center;\r\n    align-items: center;\r\n    box-sizing: border-box;\r\n    > svg {\r\n      display: block;\r\n      width: 70%;\r\n      height: auto;\r\n      // Visual balance to center-align the icon\r\n      transform: translateX(5%);\r\n    }\r\n  }\r\n\r\n  &:hover,\r\n  &:focus {\r\n    &::after {\r\n      opacity: 0.3;\r\n    }\r\n    > div[data-play] {\r\n      opacity: 1;\r\n    }\r\n  }\r\n`\r\n\r\ntype RenderState = 'render-video' | 'pre-render-warn' | false\r\n\r\nexport default function VideoInBrowser({\r\n  onSelect,\r\n  onEdit,\r\n  asset,\r\n}: {\r\n  onSelect?: (asset: VideoAssetDocument) => void\r\n  onEdit?: (asset: VideoAssetDocument) => void\r\n  asset: VideoAssetDocument\r\n}) {\r\n  const [renderVideo, setRenderVideo] = useState<RenderState>(false)\r\n  const select = React.useCallback(() => onSelect?.(asset), [onSelect, asset])\r\n  const edit = React.useCallback(() => onEdit?.(asset), [onEdit, asset])\r\n  const {hasShownWarning} = useDrmPlaybackWarningContext()\r\n\r\n  if (!asset) {\r\n    return null\r\n  }\r\n\r\n  const playbackPolicy = getPlaybackPolicy(asset)\r\n  const onClickPlay = () => {\r\n    if (playbackPolicy?.policy === 'drm' && !hasShownWarning) {\r\n      setRenderVideo('pre-render-warn')\r\n    } else {\r\n      setRenderVideo('render-video')\r\n    }\r\n  }\r\n  return (\r\n    <Card\r\n      border\r\n      padding={2}\r\n      sizing=\"border\"\r\n      radius={2}\r\n      style={{\r\n        position: 'relative',\r\n      }}\r\n    >\r\n      {playbackPolicy?.policy === 'signed' && (\r\n        <Tooltip\r\n          animate\r\n          content={\r\n            <Card padding={2} radius={2}>\r\n              <IconInfo icon={LockIcon} text=\"Signed playback policy\" size={2} />\r\n            </Card>\r\n          }\r\n          placement=\"right\"\r\n          fallbackPlacements={['top', 'bottom']}\r\n          portal\r\n        >\r\n          <Card\r\n            tone=\"caution\"\r\n            style={{\r\n              borderRadius: '100%',\r\n              position: 'absolute',\r\n              left: '1em',\r\n              top: '1em',\r\n              zIndex: 11,\r\n            }}\r\n            padding={2}\r\n            border\r\n          >\r\n            <Text muted size={1}>\r\n              <LockIcon />\r\n            </Text>\r\n          </Card>\r\n        </Tooltip>\r\n      )}\r\n      {playbackPolicy?.policy === 'drm' && (\r\n        <Tooltip\r\n          animate\r\n          content={\r\n            <Card padding={2} radius={2}>\r\n              <IconInfo icon={LockIcon} text=\"DRM playback policy\" size={2} />\r\n            </Card>\r\n          }\r\n          placement=\"right\"\r\n          fallbackPlacements={['top', 'bottom']}\r\n          portal\r\n        >\r\n          <Card\r\n            tone=\"caution\"\r\n            style={{\r\n              borderRadius: '0.25rem',\r\n              position: 'absolute',\r\n              left: '1em',\r\n              top: '1em',\r\n              zIndex: 11,\r\n            }}\r\n            padding={2}\r\n            border\r\n          >\r\n            <Text muted size={1} weight=\"semibold\" style={{color: 'var(--card-icon-color)'}}>\r\n              DRM\r\n            </Text>\r\n          </Card>\r\n        </Tooltip>\r\n      )}\r\n      <Stack\r\n        space={3}\r\n        height=\"fill\"\r\n        style={{\r\n          gridTemplateRows: 'min-content min-content 1fr',\r\n        }}\r\n      >\r\n        {renderVideo === 'pre-render-warn' && (\r\n          <DRMWarningDialog\r\n            onClose={() => {\r\n              setRenderVideo('render-video')\r\n            }}\r\n          />\r\n        )}\r\n        {renderVideo === 'render-video' ? (\r\n          <VideoPlayer asset={asset} autoPlay forceAspectRatio={THUMBNAIL_ASPECT_RATIO} />\r\n        ) : (\r\n          <PlayButton onClick={onClickPlay}>\r\n            <div data-play>\r\n              <PlayIcon />\r\n            </div>\r\n            {assetIsAudio(asset) ? (\r\n              <div\r\n                style={{\r\n                  aspectRatio: THUMBNAIL_ASPECT_RATIO,\r\n                  display: 'flex',\r\n                  alignItems: 'center',\r\n                  justifyContent: 'center',\r\n                }}\r\n              >\r\n                <AudioIcon width=\"3em\" height=\"3em\" />\r\n              </div>\r\n            ) : (\r\n              <VideoThumbnail asset={asset} />\r\n            )}\r\n          </PlayButton>\r\n        )}\r\n        <VideoMetadata asset={asset} />\r\n        <div\r\n          style={{\r\n            display: 'flex',\r\n            width: '100%',\r\n            alignItems: 'flex-end',\r\n            justifyContent: 'flex-start',\r\n            gap: '.35rem',\r\n          }}\r\n        >\r\n          {onSelect && (\r\n            <Button\r\n              icon={CheckmarkIcon}\r\n              fontSize={2}\r\n              padding={2}\r\n              mode=\"ghost\"\r\n              text=\"Select\"\r\n              style={{flex: 1}}\r\n              tone=\"positive\"\r\n              onClick={select}\r\n            />\r\n          )}\r\n          <Button\r\n            icon={EditIcon}\r\n            fontSize={2}\r\n            padding={2}\r\n            mode=\"ghost\"\r\n            text=\"Details\"\r\n            style={{flex: 1}}\r\n            onClick={edit}\r\n          />\r\n        </div>\r\n      </Stack>\r\n    </Card>\r\n  )\r\n}\r\n","import {SearchIcon} from '@sanity/icons'\r\nimport {Card, Flex, Grid, Inline, Label, Stack, Text, TextInput} from '@sanity/ui'\r\nimport {useMemo, useState} from 'react'\r\n\r\nimport {DrmPlaybackWarningContextProvider} from '../context/DrmPlaybackWarningContext'\r\nimport useAssets from '../hooks/useAssets'\r\nimport type {PluginConfig, VideoAssetDocument} from '../util/types'\r\nimport ConfigureApi from './ConfigureApi'\r\nimport ImportVideosFromMux from './ImportVideosFromMux'\r\nimport PageSelector from './PageSelector'\r\nimport ResyncMetadata from './ResyncMetadata'\r\nimport {SelectSortOptions} from './SelectSortOptions'\r\nimport SpinnerBox from './SpinnerBox'\r\nimport type {VideoDetailsProps} from './VideoDetails/useVideoDetails'\r\nimport VideoDetails from './VideoDetails/VideoDetails'\r\nimport VideoInBrowser from './VideoInBrowser'\r\n\r\nexport interface VideosBrowserProps {\r\n  config: PluginConfig\r\n  onSelect?: (asset: VideoAssetDocument) => void\r\n}\r\n\r\nexport default function VideosBrowser({onSelect, config}: VideosBrowserProps) {\r\n  const {assets, isLoading, searchQuery, setSearchQuery, setSort, sort} = useAssets()\r\n  const [page, setPage] = useState<number>(0)\r\n  const pageLimit = 20\r\n  const pageTotal = Math.floor(assets.length / pageLimit) + 1\r\n  const [editedAsset, setEditedAsset] = useState<VideoDetailsProps['asset'] | null>(null)\r\n  const freshEditedAsset = useMemo(\r\n    () => assets.find((a) => a._id === editedAsset?._id) || editedAsset,\r\n    [editedAsset, assets]\r\n  )\r\n\r\n  const pageStart = page * pageLimit\r\n  const pageEnd = pageStart + pageLimit\r\n\r\n  const placement = onSelect ? 'input' : 'tool'\r\n  return (\r\n    <DrmPlaybackWarningContextProvider config={config}>\r\n      <Stack padding={4} space={4} style={{minHeight: '50vh'}}>\r\n        <Flex justify=\"space-between\" align=\"center\">\r\n          <Flex align=\"center\" gap={3}>\r\n            <TextInput\r\n              value={searchQuery}\r\n              icon={SearchIcon}\r\n              onInput={(e: React.FormEvent<HTMLInputElement>) =>\r\n                setSearchQuery(e.currentTarget.value)\r\n              }\r\n              placeholder=\"Search videos\"\r\n            />\r\n            <SelectSortOptions setSort={setSort} sort={sort} />\r\n            <PageSelector page={page} setPage={setPage} total={pageTotal} />\r\n          </Flex>\r\n          {placement === 'tool' && (\r\n            <Inline space={2}>\r\n              <ImportVideosFromMux />\r\n              <ResyncMetadata />\r\n              <ConfigureApi />\r\n            </Inline>\r\n          )}\r\n        </Flex>\r\n        <Stack space={3}>\r\n          {assets?.length > 0 && (\r\n            <Label muted>\r\n              {assets.length} video{assets.length > 1 ? 's' : null}{' '}\r\n              {searchQuery ? `matching \"${searchQuery}\"` : 'found'}\r\n            </Label>\r\n          )}\r\n          <Grid\r\n            gap={2}\r\n            style={{\r\n              gridTemplateColumns: 'repeat(auto-fill, minmax(250px, 1fr))',\r\n            }}\r\n          >\r\n            {assets.slice(pageStart, pageEnd).map((asset) => (\r\n              <VideoInBrowser\r\n                key={asset._id}\r\n                asset={asset}\r\n                onEdit={setEditedAsset}\r\n                onSelect={onSelect}\r\n              />\r\n            ))}\r\n          </Grid>\r\n        </Stack>\r\n        {isLoading && <SpinnerBox />}\r\n\r\n        {!isLoading && assets.length === 0 && (\r\n          <Card marginY={4} paddingX={4} paddingY={6} border radius={2} tone=\"transparent\">\r\n            <Text align=\"center\" muted size={3}>\r\n              {searchQuery ? `No videos found for \"${searchQuery}\"` : 'No videos in this dataset'}\r\n            </Text>\r\n          </Card>\r\n        )}\r\n      </Stack>\r\n      {freshEditedAsset && (\r\n        <VideoDetails closeDialog={() => setEditedAsset(null)} asset={freshEditedAsset} />\r\n      )}\r\n    </DrmPlaybackWarningContextProvider>\r\n  )\r\n}\r\n","import type {Tool} from 'sanity'\r\n\r\nimport type {PluginConfig} from '../util/types'\r\nimport ToolIcon from './icons/ToolIcon'\r\nimport VideosBrowser from './VideosBrowser'\r\n\r\nconst StudioTool: React.FC<PluginConfig> = (config) => {\r\n  return <VideosBrowser config={config} />\r\n}\r\n\r\nexport const DEFAULT_TOOL_CONFIG = {\r\n  icon: ToolIcon,\r\n  title: 'Videos',\r\n}\r\n\r\nexport default function createStudioTool(config: PluginConfig): Tool {\r\n  const toolConfig = typeof config.tool === 'object' ? config.tool : DEFAULT_TOOL_CONFIG\r\n  return {\r\n    name: 'mux',\r\n    icon: toolConfig.icon || DEFAULT_TOOL_CONFIG.icon,\r\n    title: toolConfig.title || DEFAULT_TOOL_CONFIG.title,\r\n    component: (props: any) => <StudioTool {...config} {...props} />,\r\n  }\r\n}\r\n","import {useCurrentUser} from 'sanity'\r\n\r\nimport {PluginConfig} from '../util/types'\r\n\r\nexport const useAccessControl = (config: PluginConfig) => {\r\n  const user = useCurrentUser()\r\n\r\n  const hasConfigAccess =\r\n    !config?.allowedRolesForConfiguration?.length ||\r\n    user?.roles?.some((role) => config.allowedRolesForConfiguration.includes(role.name))\r\n\r\n  return {hasConfigAccess}\r\n}\r\n","import {isReference} from 'sanity'\r\nimport {useDocumentValues} from 'sanity'\r\n\r\nimport type {Reference, VideoAssetDocument} from '../util/types'\r\n\r\nconst path = ['assetId', 'data', 'playbackId', 'status', 'thumbTime', 'filename']\r\nexport const useAssetDocumentValues = (asset: Reference | null | undefined) =>\r\n  useDocumentValues<VideoAssetDocument | null | undefined>(\r\n    isReference(asset) ? asset._ref! : '',\r\n    path\r\n  )\r\n","import {useMemo} from 'react'\r\nimport {useDataset, useProjectId} from 'sanity'\r\nimport useSWR from 'swr'\r\n\r\nimport {useClient} from '../hooks/useClient'\r\nimport type {MuxAsset, VideoAssetDocument} from '../util/types'\r\n\r\n// Poll MUX if it's preparing the main document or its own static renditions\r\nexport const useMuxPolling = (asset?: VideoAssetDocument) => {\r\n  const client = useClient()\r\n  const projectId = useProjectId()\r\n  const dataset = useDataset()\r\n  const isPreparingStaticRenditions = useMemo(() => {\r\n    // Legacy: If static_renditions has a status field, it was created with mp4_support (deprecated)\r\n    // We don't process this old format, just return false\r\n    // Note: 'disabled' status is valid in the new format when no renditions were requested\r\n    if (\r\n      asset?.data?.static_renditions?.status &&\r\n      asset?.data?.static_renditions?.status !== 'disabled'\r\n    ) {\r\n      return false\r\n    }\r\n\r\n    const files = asset?.data?.static_renditions?.files\r\n    if (!files || files.length === 0) {\r\n      return false\r\n    }\r\n    return files.some((file) => file.status === 'preparing')\r\n  }, [asset?.data?.static_renditions?.status, asset?.data?.static_renditions?.files])\r\n\r\n  const shouldFetch = useMemo(\r\n    () => !!asset?.assetId && (asset?.status === 'preparing' || isPreparingStaticRenditions),\r\n    [asset?.assetId, asset?.status, isPreparingStaticRenditions]\r\n  )\r\n  return useSWR(\r\n    shouldFetch ? `/${projectId}/addons/mux/assets/${dataset}/data/${asset?.assetId}` : null,\r\n    async () => {\r\n      const {data} = await client.request<{data: MuxAsset}>({\r\n        url: `/addons/mux/assets/${dataset}/data/${asset!.assetId}`,\r\n        withCredentials: true,\r\n        method: 'GET',\r\n      })\r\n      client.patch(asset!._id!).set({status: data.status, data}).commit({returnDocuments: false})\r\n    },\r\n    {refreshInterval: 2000, refreshWhenHidden: true, dedupingInterval: 1000}\r\n  )\r\n}\r\n","import r,{PureComponent as t,useReducer as e,useRef as n,useCallback as o}from\"react\";var c=function(r){var t,e;function n(t){var e;return(e=r.call(this,t)||this).state={hasError:!1,error:null},e}e=r,(t=n).prototype=Object.create(e.prototype),t.prototype.constructor=t,t.__proto__=e,n.getDerivedStateFromError=function(r){return{hasError:!0,error:r}};var o=n.prototype;return o.componentDidCatch=function(r,t){return this.props.onDidCatch(r,t)},o.render=function(){var r=this.state,t=this.props,e=t.render,n=t.children,o=t.renderError;return r.hasError?o?o({error:r.error}):null:e?e():n||null},n}(t),u=function(r,t){switch(t.type){case\"catch\":return{didCatch:!0,error:t.error};case\"reset\":return{didCatch:!1,error:null};default:return r}};function a(t){var a=e(u,{didCatch:!1,error:null}),i=a[0],d=a[1],h=n(null);function l(){return e=function(r,e){d({type:\"catch\",error:r}),t&&t.onDidCatch&&t.onDidCatch(r,e)},function(t){return r.createElement(c,{onDidCatch:e,children:t.children,render:t.render,renderError:t.renderError})};var e}var p,s=o(function(){h.current=l(),d({type:\"reset\"})},[]);return{ErrorBoundary:(p=h.current,null!==p?p:(h.current=l(),h.current)),didCatch:i.didCatch,error:i.error,reset:s}}export default a;export{a as useErrorBoundary};\n//# sourceMappingURL=index.module.js.map\n","/* eslint-disable no-console */\r\nimport {Button, Card, Flex, Grid, Heading, Inline, Text, useToast} from '@sanity/ui'\r\nimport React, {memo, useCallback, useRef} from 'react'\r\nimport scrollIntoView from 'scroll-into-view-if-needed'\r\nimport {clear} from 'suspend-react'\r\nimport {useErrorBoundary} from 'use-error-boundary'\r\n\r\nimport {name} from '../util/constants'\r\nimport {type MuxInputProps} from '../util/types'\r\n\r\nexport interface Props extends Pick<MuxInputProps, 'schemaType'> {\r\n  children: React.ReactNode\r\n}\r\nfunction ErrorBoundaryCard(props: Props) {\r\n  const {children, schemaType} = props\r\n  const {push: pushToast} = useToast()\r\n  const errorRef = useRef(null)\r\n  const {ErrorBoundary, didCatch, error, reset} = useErrorBoundary({\r\n    onDidCatch: (err, errorInfo) => {\r\n      console.group(err.toString())\r\n      console.groupCollapsed('console.error')\r\n      console.error(err)\r\n      console.groupEnd()\r\n      if (err.stack) {\r\n        console.groupCollapsed('error.stack')\r\n        console.log(err.stack)\r\n        console.groupEnd()\r\n      }\r\n      if (errorInfo?.componentStack) {\r\n        console.groupCollapsed('errorInfo.componentStack')\r\n        console.log(errorInfo.componentStack)\r\n        console.groupEnd()\r\n      }\r\n      console.groupEnd()\r\n      pushToast({\r\n        status: 'error',\r\n        title: 'Plugin crashed',\r\n        description: (\r\n          <Flex align=\"center\">\r\n            <Inline space={1}>\r\n              An error happened while rendering\r\n              <Button\r\n                padding={1}\r\n                fontSize={1}\r\n                style={{transform: 'translateY(1px)'}}\r\n                mode=\"ghost\"\r\n                text={schemaType.title}\r\n                onClick={() => {\r\n                  if (errorRef.current) {\r\n                    scrollIntoView(errorRef.current, {\r\n                      behavior: 'smooth',\r\n                      scrollMode: 'if-needed',\r\n                      block: 'center',\r\n                    })\r\n                  }\r\n                }}\r\n              />\r\n            </Inline>\r\n          </Flex>\r\n        ),\r\n      })\r\n    },\r\n  })\r\n  const handleRetry = useCallback(() => {\r\n    // Purge request cache before retrying, otherwise the cached errors will rethrow\r\n    clear([name])\r\n\r\n    reset()\r\n  }, [reset])\r\n\r\n  if (didCatch) {\r\n    return (\r\n      <Card ref={errorRef} paddingX={[2, 3, 4, 4]} height=\"fill\" shadow={1} overflow=\"auto\">\r\n        <Flex justify=\"flex-start\" align=\"center\" height=\"fill\">\r\n          <Grid columns={1} gap={[2, 3, 4, 4]}>\r\n            <Heading as=\"h1\">\r\n              The <code>{name}</code> plugin crashed\r\n            </Heading>\r\n            {error?.message && (\r\n              <Card padding={3} tone=\"critical\" shadow={1} radius={2}>\r\n                <Text>{error.message}</Text>\r\n              </Card>\r\n            )}\r\n            <Inline>\r\n              <Button onClick={handleRetry} text=\"Retry\" />\r\n            </Inline>\r\n          </Grid>\r\n        </Flex>\r\n      </Card>\r\n    )\r\n  }\r\n\r\n  return <ErrorBoundary>{children}</ErrorBoundary>\r\n}\r\n\r\nexport default memo(ErrorBoundaryCard)\r\n","import {Box, Card, Flex, Spinner, Text} from '@sanity/ui'\r\n\r\nexport const InputFallback = () => {\r\n  return (\r\n    <div style={{padding: 1}}>\r\n      <Card\r\n        shadow={1}\r\n        sizing=\"border\"\r\n        style={{aspectRatio: '16/9', width: '100%', borderRadius: '1px'}}\r\n      >\r\n        <Flex align=\"center\" direction=\"column\" height=\"fill\" justify=\"center\">\r\n          <Spinner muted />\r\n          <Box marginTop={3}>\r\n            <Text align=\"center\" muted size={1}>\r\n              Loadingâ¦\r\n            </Text>\r\n          </Box>\r\n        </Flex>\r\n      </Card>\r\n    </div>\r\n  )\r\n}\r\n","import {PlugIcon} from '@sanity/icons'\r\nimport {Button, Card, Flex, Grid, Heading, Inline, Text} from '@sanity/ui'\r\nimport {useCallback} from 'react'\r\n\r\nimport {useAccessControl} from '../hooks/useAccessControl'\r\nimport type {SetDialogState} from '../hooks/useDialogState'\r\nimport {PluginConfig} from '../util/types'\r\nimport MuxLogo from './MuxLogo'\r\n\r\ninterface OnboardProps {\r\n  setDialogState: SetDialogState\r\n  config: PluginConfig\r\n}\r\n\r\nexport default function Onboard(props: OnboardProps) {\r\n  const {setDialogState} = props\r\n  const handleOpen = useCallback(() => setDialogState('secrets'), [setDialogState])\r\n  const {hasConfigAccess} = useAccessControl(props.config)\r\n\r\n  return (\r\n    <>\r\n      <div style={{padding: 2}}>\r\n        <Card\r\n          display=\"flex\"\r\n          sizing=\"border\"\r\n          style={{\r\n            aspectRatio: '16/9',\r\n            width: '100%',\r\n            boxShadow: 'var(--card-bg-color) 0 0 0 2px',\r\n          }}\r\n          paddingX={[2, 3, 4, 4]}\r\n          radius={1}\r\n          tone=\"transparent\"\r\n        >\r\n          <Flex justify=\"flex-start\" align=\"center\">\r\n            <Grid columns={1} gap={[2, 3, 4, 4]}>\r\n              <Inline paddingY={1}>\r\n                <div style={{height: '32px'}}>\r\n                  <MuxLogo />\r\n                </div>\r\n              </Inline>\r\n              <Inline paddingY={1}>\r\n                <Heading size={[0, 1, 2, 2]}>\r\n                  Upload and preview videos directly from your studio.\r\n                </Heading>\r\n              </Inline>\r\n              <Inline paddingY={1}>\r\n                {hasConfigAccess ? (\r\n                  <Button mode=\"ghost\" icon={PlugIcon} text=\"Configure API\" onClick={handleOpen} />\r\n                ) : (\r\n                  <Card padding={[3, 3, 3]} radius={2} shadow={1} tone=\"critical\">\r\n                    <Text>\r\n                      You do not have access to configure the Mux API. Please contact your\r\n                      administrator.\r\n                    </Text>\r\n                  </Card>\r\n                )}\r\n              </Inline>\r\n            </Grid>\r\n          </Flex>\r\n        </Card>\r\n      </div>\r\n    </>\r\n  )\r\n}\r\n","import {UpChunk} from '@mux/upchunk'\r\nimport {Observable} from 'rxjs'\r\n\r\nexport function createUpChunkObservable(uuid: string, uploadUrl: string, source: File) {\r\n  return new Observable<\r\n    | {type: 'pause' | 'resume'; id: string}\r\n    | {type: 'success'; id: string}\r\n    | {type: 'progress'; percent: number}\r\n  >((subscriber) => {\r\n    const upchunk = UpChunk.createUpload({\r\n      endpoint: uploadUrl,\r\n      file: source,\r\n      dynamicChunkSize: true, // changes the chunk size based on network speeds\r\n    })\r\n\r\n    const successHandler = () => {\r\n      subscriber.next({\r\n        type: 'success',\r\n        id: uuid,\r\n      })\r\n      subscriber.complete()\r\n    }\r\n\r\n    const errorHandler = (data: CustomEvent) => subscriber.error(new Error(data.detail.message))\r\n\r\n    const progressHandler = (data: CustomEvent) => {\r\n      return subscriber.next({type: 'progress', percent: data.detail})\r\n    }\r\n\r\n    const offlineHandler = () => {\r\n      upchunk.pause()\r\n      subscriber.next({\r\n        type: 'pause',\r\n        id: uuid,\r\n      })\r\n    }\r\n\r\n    const onlineHandler = () => {\r\n      upchunk.resume()\r\n      subscriber.next({\r\n        type: 'resume',\r\n        id: uuid,\r\n      })\r\n    }\r\n\r\n    upchunk.on('success', successHandler)\r\n    upchunk.on('error', errorHandler)\r\n    upchunk.on('progress', progressHandler)\r\n    upchunk.on('offline', offlineHandler)\r\n    upchunk.on('online', onlineHandler)\r\n\r\n    return () => upchunk.abort()\r\n  })\r\n}\r\n","/**\r\n * Format Google Drive share links as Google Drive export links.\r\n * Supported formats:\r\n *  - https://drive.google.com/uc?id=<ID>...\r\n *  - https://drive.google.com/open?id=<ID>...\r\n *  - https://drive.google.com/file/d/<ID>...\r\n *  - https://drive.google.com/folder/<ID>...\r\n * \r\n * @param url Google Drive share link to format.\r\n * @returns Google Drive export link (URL passthrough if not share link).\r\n */\r\nexport function formatDriveShareLink(url: string): string {\r\n\r\n  // Export link formatter.\r\n  const formatExportLink = (id: string) => {\r\n    return `https://drive.google.com/uc?export=download&id=${id}`\r\n  }\r\n\r\n  // URL formatting.\r\n  try {\r\n\r\n    // Parse URL.\r\n    const trimmed = url.trim()\r\n    const parsed = new URL(trimmed)\r\n\r\n    // Enforce strict host name.\r\n    if (parsed.hostname !== \"drive.google.com\") {\r\n      throw new Error(\"URL is not from Google Drive.\")\r\n    }\r\n\r\n    // Look for ID in search parameters.\r\n    const id = parsed.searchParams.get(\"id\") || \"\"\r\n    if (id.length) {\r\n      return formatExportLink(id)\r\n    }\r\n\r\n    // Look for ID in path name.\r\n    const path = parsed.pathname.split(\"/\") || []\r\n\r\n    // Path is /file/d/<ID>...\r\n    if (path.includes(\"file\") && path.includes(\"d\")) {\r\n      const index = path.findIndex((value: string) => { return value === \"d\" }) + 1\r\n      const id = path.at(index) || \"\"\r\n      return formatExportLink(id)\r\n    }\r\n\r\n    // Path is /folder/<ID>...\r\n    if (path.includes(\"folders\")) {\r\n      const index = path.findIndex((value: string) => { return value === \"folders\" }) + 1\r\n      const id = path.at(index) || \"\"\r\n      return formatExportLink(id)\r\n    }\r\n\r\n    // URL not recognized.\r\n    throw new Error(\"URL was not recognized.\")\r\n\r\n  } catch {\r\n\r\n    // URL passthrough by default.\r\n    return url\r\n  }\r\n}","import {uuid as generateUuid} from '@sanity/uuid'\r\nimport {concat, defer, from, type Observable, of, throwError} from 'rxjs'\r\nimport {catchError, mergeMap, mergeMapTo, switchMap} from 'rxjs/operators'\r\nimport type {SanityClient} from 'sanity'\r\n\r\nimport {createUpChunkObservable} from '../clients/upChunkObservable'\r\nimport type {MuxAsset, MuxNewAssetSettings} from '../util/types'\r\nimport {formatDriveShareLink} from '../util/formatDriveShareLink'\r\nimport {getAsset} from './assets'\r\nimport {testSecretsObservable} from './secrets'\r\n\r\nexport function cancelUpload(client: SanityClient, uuid: string) {\r\n  return client.observable.request({\r\n    url: `/addons/mux/uploads/${client.config().dataset}/${uuid}`,\r\n    withCredentials: true,\r\n    method: 'DELETE',\r\n  })\r\n}\r\n\r\nexport function uploadUrl({\r\n  url,\r\n  settings,\r\n  client,\r\n  assetName,\r\n}: {\r\n  url: string\r\n  settings: MuxNewAssetSettings\r\n  client: SanityClient\r\n  assetName?: string\r\n}) {\r\n  return testUrl(url).pipe(\r\n    switchMap((validUrl) => {\r\n      return concat(\r\n        of({type: 'url' as const, url: validUrl}),\r\n        testSecretsObservable(client).pipe(\r\n          switchMap((json) => {\r\n            if (!json || !json.status) {\r\n              return throwError(new Error('Invalid credentials'))\r\n            }\r\n            const uuid = generateUuid()\r\n            const muxBody = settings\r\n            if (!muxBody.input) muxBody.input = [{type: 'video'}]\r\n            muxBody.input[0].url = validUrl\r\n\r\n            const query = {\r\n              muxBody: JSON.stringify(muxBody),\r\n              filename: (assetName) ? assetName : validUrl.split('/').slice(-1)[0],\r\n            }\r\n\r\n            const dataset = client.config().dataset\r\n            return defer(() =>\r\n              client.observable.request({\r\n                url: `/addons/mux/assets/${dataset}`,\r\n                withCredentials: true,\r\n                method: 'POST',\r\n                headers: {\r\n                  'MUX-Proxy-UUID': uuid,\r\n                  'Content-Type': 'application/json',\r\n                },\r\n                query,\r\n              })\r\n            ).pipe(\r\n              mergeMap((result) => {\r\n                const asset =\r\n                  (result && result.results && result.results[0] && result.results[0].document) ||\r\n                  null\r\n\r\n                if (!asset) {\r\n                  return throwError(new Error('No asset document returned'))\r\n                }\r\n                return of({type: 'success' as const, id: uuid, asset})\r\n              })\r\n            )\r\n          })\r\n        )\r\n      )\r\n    })\r\n  )\r\n}\r\n\r\nexport function uploadFile({\r\n  settings,\r\n  client,\r\n  file,\r\n  assetName,\r\n}: {\r\n  settings: MuxNewAssetSettings\r\n  client: SanityClient\r\n  file: File\r\n  assetName?: string\r\n}) {\r\n  return testFile(file).pipe(\r\n    switchMap((fileOptions) => {\r\n      return concat(\r\n        of({type: 'file' as const, file: fileOptions}),\r\n        testSecretsObservable(client).pipe(\r\n          switchMap((json) => {\r\n            if (!json || !json.status) {\r\n              return throwError(() => new Error('Invalid credentials'))\r\n            }\r\n            const uuid = generateUuid()\r\n            const body = settings\r\n\r\n            return concat(\r\n              of({type: 'uuid' as const, uuid}),\r\n              defer(() =>\r\n                client.observable.request<{\r\n                  sanityAssetId: string\r\n                  upload: {\r\n                    cors_origin: string\r\n                    id: string\r\n                    new_asset_settings: MuxNewAssetSettings\r\n                    status: 'waiting'\r\n                    timeout: number\r\n                    url: string\r\n                  }\r\n                }>({\r\n                  url: `/addons/mux/uploads/${client.config().dataset}`,\r\n                  withCredentials: true,\r\n                  method: 'POST',\r\n                  headers: {\r\n                    'MUX-Proxy-UUID': uuid,\r\n                    'Content-Type': 'application/json',\r\n                  },\r\n                  body,\r\n                })\r\n              ).pipe(\r\n                mergeMap((result) => {\r\n                  return createUpChunkObservable(uuid, result.upload.url, file).pipe(\r\n                    // eslint-disable-next-line no-warning-comments\r\n                    // @TODO type the observable events\r\n                    // eslint-disable-next-line max-nested-callbacks\r\n                    mergeMap((event) => {\r\n                      if (event.type !== 'success') {\r\n                        return of(event)\r\n                      }\r\n                      return from(updateAssetDocumentFromUpload(client, uuid, assetName)).pipe(\r\n                        // eslint-disable-next-line max-nested-callbacks\r\n                        mergeMap((doc) => of({...event, asset: doc}))\r\n                      )\r\n                    }),\r\n                    // eslint-disable-next-line max-nested-callbacks\r\n                    catchError((err) => {\r\n                      // Delete asset document\r\n                      return cancelUpload(client, uuid).pipe(mergeMapTo(throwError(err)))\r\n                    })\r\n                  )\r\n                })\r\n              )\r\n            )\r\n          })\r\n        )\r\n      )\r\n    })\r\n  )\r\n}\r\n\r\ntype UploadResponse = {\r\n  data: {\r\n    asset_id: string\r\n    cors_origin: string\r\n    id: string\r\n    new_asset_settings: {\r\n      static_renditions?: {resolution: string}[]\r\n      passthrough: string\r\n      playback_policies: ['public' | 'signed' | 'drm']\r\n    }\r\n    status: string\r\n    timeout: number\r\n  }\r\n}\r\nexport function getUpload(client: SanityClient, assetId: string) {\r\n  const {dataset} = client.config()\r\n  return client.request<UploadResponse>({\r\n    url: `/addons/mux/uploads/${dataset}/${assetId}`,\r\n    withCredentials: true,\r\n    method: 'GET',\r\n  })\r\n}\r\n\r\nfunction pollUpload(client: SanityClient, uuid: string): Promise<UploadResponse> {\r\n  const maxTries = 10\r\n  let pollInterval: number\r\n  let tries = 0\r\n  let assetId: string\r\n  let upload: UploadResponse\r\n  return new Promise((resolve, reject) => {\r\n    pollInterval = (setInterval as typeof window.setInterval)(async () => {\r\n      try {\r\n        upload = await getUpload(client, uuid)\r\n      } catch (err) {\r\n        reject(err)\r\n        return\r\n      }\r\n      assetId = upload && upload.data && upload.data.asset_id\r\n      if (assetId) {\r\n        clearInterval(pollInterval)\r\n        resolve(upload)\r\n      }\r\n      if (tries > maxTries) {\r\n        clearInterval(pollInterval)\r\n        reject(new Error('Upload did not finish'))\r\n      }\r\n      tries++\r\n    }, 2000)\r\n  })\r\n}\r\n\r\nasync function updateAssetDocumentFromUpload(client: SanityClient, uuid: string, assetName?: string) {\r\n  let upload: UploadResponse\r\n  let asset: {data: MuxAsset}\r\n  try {\r\n    upload = await pollUpload(client, uuid)\r\n  } catch (err) {\r\n    return Promise.reject(err)\r\n  }\r\n  try {\r\n    asset = await getAsset(client, upload.data.asset_id)\r\n  } catch (err) {\r\n    return Promise.reject(err)\r\n  }\r\n\r\n  const doc = {\r\n    _id: uuid,\r\n    _type: 'mux.videoAsset',\r\n    status: asset.data.status,\r\n    data: asset.data,\r\n    assetId: asset.data.id,\r\n    playbackId: asset.data.playback_ids[0].id,\r\n    uploadId: upload.data.id,\r\n    filename: (assetName) ? assetName : undefined,\r\n  }\r\n  return client.createOrReplace(doc).then(() => {\r\n    return doc\r\n  })\r\n}\r\n\r\nexport function testFile(file: File) {\r\n  if (typeof window !== 'undefined' && file instanceof window.File) {\r\n    const fileOptions = optionsFromFile({}, file)\r\n    return of(fileOptions)\r\n  }\r\n  return throwError(new Error('Invalid file'))\r\n}\r\n\r\nexport function testUrl(url: string): Observable<string> {\r\n  const error = new Error('Invalid URL')\r\n  if (typeof url !== 'string') {\r\n    return throwError(error)\r\n  }\r\n  let formattedUrl = url.trim()\r\n  formattedUrl = formatDriveShareLink(formattedUrl)\r\n  let parsed\r\n  try {\r\n    parsed = new URL(formattedUrl)\r\n  } catch (err) {\r\n    return throwError(error)\r\n  }\r\n  if (parsed && !parsed.protocol.match(/http:|https:/)) {\r\n    return throwError(error)\r\n  }\r\n  return of(formattedUrl)\r\n}\r\n\r\nfunction optionsFromFile(opts: {preserveFilename?: boolean}, file: File) {\r\n  if (typeof window === 'undefined' || !(file instanceof window.File)) {\r\n    return undefined\r\n  }\r\n  return {\r\n    name: opts.preserveFilename === false ? undefined : file.name,\r\n    type: file.type,\r\n  }\r\n}\r\n","import {ServerError} from '@sanity/client'\r\nimport {type InputProps, isObjectInputProps, type PreviewLayoutKey, type PreviewProps} from 'sanity'\r\n\r\nimport type {MuxInputPreviewProps, MuxInputProps} from './types'\r\n\r\nexport function isMuxInputProps(props: InputProps): props is MuxInputProps {\r\n  return isObjectInputProps(props) && props.schemaType.type?.name === 'mux.video'\r\n}\r\n\r\nexport function isMuxInputPreviewProps(\r\n  props: PreviewProps<PreviewLayoutKey>\r\n): props is MuxInputPreviewProps {\r\n  return props.schemaType?.type?.name === 'mux.video'\r\n}\r\n\r\nexport function isValidUrl(url: string): boolean {\r\n  try {\r\n    const parsed = new URL(url)\r\n    return parsed && !!parsed.protocol.match(/http:|https:/)\r\n  } catch {\r\n    return false\r\n  }\r\n}\r\n\r\n/**\r\n * We consider a server error one with status code 5XX.\r\n * Used mainly to handle unknown Proxy issues.\r\n */\r\nexport function isServerError(error: Error): error is ServerError {\r\n  return (\r\n    'statusCode' in error &&\r\n    typeof error.statusCode === 'number' &&\r\n    500 <= error.statusCode &&\r\n    error.statusCode <= 600\r\n  )\r\n}\r\n","/**\r\n * Utilities for extracting files from dataTransfer in a predictable cross-browser fashion.\r\n * Also recursively extracts files from a directory\r\n * Inspired by https://github.com/component/normalized-upload\r\n */\r\n\r\nexport function extractDroppedFiles(dataTransfer: DataTransfer) {\r\n  const files = Array.from(dataTransfer.files || [])\r\n  const items = Array.from(dataTransfer.items || [])\r\n  if (files && files.length > 0) {\r\n    return Promise.resolve(files)\r\n  }\r\n  return normalizeItems(items).then((arr) => arr.flat())\r\n}\r\n\r\nfunction normalizeItems(items: DataTransferItem[]) {\r\n  return Promise.all(\r\n    items.map((item) => {\r\n      // directory\r\n      if (item.kind === 'file' && item.webkitGetAsEntry) {\r\n        let entry: FileSystemEntry | File[] | null\r\n        // Edge throws\r\n        try {\r\n          entry = item.webkitGetAsEntry()\r\n        } catch (err) {\r\n          return [item.getAsFile()]\r\n        }\r\n        if (!entry) {\r\n          return []\r\n        }\r\n        return entry.isDirectory ? walk(entry) : [item.getAsFile()]\r\n      }\r\n\r\n      // file\r\n      if (item.kind === 'file') {\r\n        const file = item.getAsFile()\r\n        return Promise.resolve(file ? [file] : [])\r\n      }\r\n\r\n      // others\r\n      return new Promise((resolve) => item.getAsString(resolve)).then((str?: any) =>\r\n        str ? [new File([str], 'unknown.txt', {type: item.type})] : []\r\n      )\r\n    })\r\n  )\r\n}\r\n\r\nfunction isFile(entry: FileSystemEntry): entry is FileSystemFileEntry {\r\n  return entry.isFile\r\n}\r\nfunction isDirectory(entry: FileSystemEntry): entry is FileSystemDirectoryEntry {\r\n  return entry.isDirectory\r\n}\r\n\r\nfunction walk(entry: FileSystemEntry): any {\r\n  if (isFile(entry)) {\r\n    return new Promise((resolve) => entry.file(resolve)).then((file) => [file])\r\n  }\r\n\r\n  if (isDirectory(entry)) {\r\n    const dir = entry.createReader()\r\n    return new Promise<any>((resolve) => dir.readEntries(resolve))\r\n      .then((entries: FileSystemEntry[]) => entries.filter((entr) => !entr.name.startsWith('.')))\r\n      .then((entries) => Promise.all(entries.map(walk)).then((arr) => arr.flat()))\r\n  }\r\n  return Promise.resolve([])\r\n}\r\n","// Sanity.\r\nimport {PatchEvent, set} from 'sanity'\r\nimport type {SanityClient} from 'sanity'\r\n\r\n// Hooks.\r\nimport {type DialogState, type SetDialogState} from '../hooks/useDialogState'\r\n\r\n// Utils.\r\nimport type {\r\n  MuxInputProps,\r\n  PluginConfig,\r\n  Secrets,\r\n  VideoAssetDocument,\r\n} from './types'\r\n\r\n// Props definition (derived from Uploader.tsx)\r\ninterface Props extends Pick<MuxInputProps, 'onChange' | 'readOnly'> {\r\n  config: PluginConfig\r\n  client: SanityClient\r\n  secrets: Secrets\r\n  asset: VideoAssetDocument | null | undefined\r\n  dialogState: DialogState\r\n  setDialogState: SetDialogState\r\n  needsSetup: boolean\r\n}\r\n\r\n/**\r\n * Watch when a Mux asset enters a 'ready' state on Sanity\r\n * and update the metadata field in the provided Sanity document.\r\n * \r\n * @param assetId Sanity ID of the Mux asset to be watched.\r\n * @param props Props of the Sanity document to be edited on update.\r\n */\r\nexport const watchAssetForMetadata = (assetId: string, props: Props) => {\r\n  const subscription = props.client\r\n    .listen(\r\n      `*[_id == $id]`,\r\n      {id: assetId},\r\n      {includeResult: true}\r\n    )\r\n    .subscribe((event) => {\r\n      if (event.type !== \"mutation\") return\r\n\r\n      const asset = event.result as VideoAssetDocument | null\r\n      const data = asset?.data\r\n      const status = asset?.status\r\n\r\n      if (!data) return\r\n      if (status !== \"ready\") return\r\n\r\n      props.onChange(\r\n        PatchEvent.from([\r\n          set({_type: \"metadata\", ...data}, [\"data\"]),\r\n        ])\r\n      )\r\n\r\n      subscription.unsubscribe()\r\n    })\r\n}","import {useCallback} from 'react'\r\nimport {PatchEvent, set, setIfMissing, unset} from 'sanity'\r\n\r\nimport type {SetDialogState} from '../hooks/useDialogState'\r\nimport type {MuxInputProps, PluginConfig, VideoAssetDocument} from '../util/types'\r\nimport VideosBrowser, {type VideosBrowserProps} from './VideosBrowser'\r\n\r\nexport interface Props extends Pick<MuxInputProps, 'onChange'> {\r\n  asset?: VideoAssetDocument | null | undefined\r\n  setDialogState: SetDialogState\r\n  config: PluginConfig\r\n}\r\n\r\nexport default function SelectAssets({\r\n  asset: selectedAsset,\r\n  onChange,\r\n  setDialogState,\r\n  config,\r\n}: Props) {\r\n  const handleSelect = useCallback<Required<VideosBrowserProps>['onSelect']>(\r\n    (chosenAsset) => {\r\n      if (!chosenAsset?._id) {\r\n        onChange(PatchEvent.from([unset(['asset'])]))\r\n      }\r\n      if (chosenAsset._id !== selectedAsset?._id) {\r\n        const patches = []\r\n        patches.push(setIfMissing({asset: {}, _type: 'mux.video'}))\r\n        patches.push(set({_type: 'reference', _weak: true, _ref: chosenAsset._id}, ['asset']))\r\n        if (config.inlineAssetMetadata) {\r\n          patches.push(setIfMissing({data: {}}))\r\n          patches.push(set({_type: 'metadata', ...(chosenAsset.data ?? {})}, ['data']))\r\n        }\r\n        onChange(PatchEvent.from(patches))\r\n      }\r\n      setDialogState(false)\r\n    },\r\n    [onChange, setDialogState, selectedAsset]\r\n  )\r\n\r\n  return <VideosBrowser onSelect={handleSelect} config={config} />\r\n}\r\n","import {Dialog} from '@sanity/ui'\r\nimport {useCallback, useId} from 'react'\r\nimport {styled} from 'styled-components'\r\n\r\nimport type {SetDialogState} from '../hooks/useDialogState'\r\nimport SelectAsset, {type Props as SelectAssetProps} from './SelectAsset'\r\nimport type {PluginConfig} from '../util/types'\r\n\r\n/** To prevent Content Layout Shift (CLS), ensure that the dialog always occupies the entire available height. */\r\nconst StyledDialog = styled(Dialog)`\r\n  > div[data-ui='DialogCard'] > div[data-ui='Card'] {\r\n    height: 100%;\r\n  }\r\n`\r\n\r\nexport default function InputBrowser({\r\n  setDialogState,\r\n  asset,\r\n  onChange,\r\n  config,\r\n}: Pick<SelectAssetProps, 'onChange' | 'asset' | 'config'> & {\r\n  setDialogState: SetDialogState\r\n  config: PluginConfig\r\n}) {\r\n  const id = `InputBrowser${useId()}`\r\n  const handleClose = useCallback(() => setDialogState(false), [setDialogState])\r\n  return (\r\n    <StyledDialog\r\n      __unstable_autoFocus\r\n      header=\"Select video\"\r\n      id={id}\r\n      onClose={handleClose}\r\n      width={2}\r\n    >\r\n      <SelectAsset\r\n        config={config}\r\n        asset={asset}\r\n        onChange={onChange}\r\n        setDialogState={setDialogState}\r\n      />\r\n    </StyledDialog>\r\n  )\r\n}\r\n","import {useCallback} from 'react'\r\nimport {PatchEvent, unset} from 'sanity'\r\n\r\nimport {deleteAssetOnMux} from '../actions/assets'\r\nimport {useClient} from '../hooks/useClient'\r\nimport type {MuxInputProps, VideoAssetDocument} from '../util/types'\r\n\r\nexport const useCancelUpload = (asset: VideoAssetDocument, onChange: MuxInputProps['onChange']) => {\r\n  const client = useClient()\r\n  return useCallback(() => {\r\n    if (!asset) {\r\n      return\r\n    }\r\n    onChange(PatchEvent.from(unset()))\r\n    if (asset.assetId) {\r\n      deleteAssetOnMux(client, asset.assetId)\r\n    }\r\n    if (asset._id) {\r\n      client.delete(asset._id)\r\n    }\r\n  }, [asset, client, onChange])\r\n}\r\n","import {Suspense, useState} from 'react'\r\nimport {styled} from 'styled-components'\r\n\r\nimport {useClient} from '../hooks/useClient'\r\nimport {getStoryboardSrc} from '../util/getStoryboardSrc'\r\nimport type {VideoAssetDocument} from '../util/types'\r\n\r\nexport const StyledCenterControls = styled.div`\r\n  && {\r\n    --media-background-color: transparent;\r\n    --media-button-icon-width: 100%;\r\n    --media-button-icon-height: auto;\r\n    pointer-events: none;\r\n    width: 100%;\r\n    display: flex;\r\n    flex-flow: row;\r\n    align-items: center;\r\n    justify-content: center;\r\n    media-play-button {\r\n      --media-control-background: transparent;\r\n      --media-control-hover-background: transparent;\r\n      padding: 0;\r\n      width: max(27px, min(9%, 90px));\r\n    }\r\n  }\r\n`\r\n\r\nexport const TopControls = styled.div`\r\n  position: absolute;\r\n  top: 0;\r\n  right: 0;\r\n  justify-content: flex-end;\r\n  button {\r\n    height: auto;\r\n  }\r\n`\r\n\r\nexport interface PosterImageProps {\r\n  asset: VideoAssetDocument\r\n}\r\nexport interface ThumbnailsMetadataTrackProps {\r\n  asset: VideoAssetDocument\r\n}\r\nexport function ThumbnailsMetadataTrack({asset}: ThumbnailsMetadataTrackProps) {\r\n  const client = useClient()\r\n  // Why useState instead of useMemo? Because we really really only want to run it exactly once and useMemo doesn't make that guarantee\r\n  const [src] = useState<string>(() => getStoryboardSrc({asset, client}))\r\n\r\n  return (\r\n    /* We use Suspense here because `getStoryboardSrc` uses suspend() under the hood */\r\n    <Suspense fallback={null}>\r\n      <track label=\"thumbnails\" default kind=\"metadata\" src={src} />\r\n    </Suspense>\r\n  )\r\n}\r\n","// Lifted from sanity/form/inputs/files/common/UploadProgress\r\n\r\nimport {Button, Card, Code, Flex, Inline, Stack, Text} from '@sanity/ui'\r\nimport {LinearProgress} from 'sanity'\r\nimport {styled} from 'styled-components'\r\n\r\nexport const CardWrapper = styled(Card)`\r\n  min-height: 82px;\r\n  box-sizing: border-box;\r\n`\r\n\r\nexport const FlexWrapper = styled(Flex)`\r\n  text-overflow: ellipsis;\r\n  overflow: hidden;\r\n`\r\n\r\nexport const LeftSection = styled(Stack)`\r\n  position: relative;\r\n  width: 60%;\r\n`\r\n\r\nexport const CodeWrapper = styled(Code)`\r\n  position: relative;\r\n  width: 100%;\r\n\r\n  code {\r\n    overflow: hidden;\r\n    text-overflow: ellipsis;\r\n    position: relative;\r\n    max-width: 200px;\r\n  }\r\n`\r\n\r\nexport const UploadProgress = ({\r\n  progress = 100,\r\n  onCancel,\r\n  filename,\r\n  text = 'Uploading',\r\n}: {\r\n  progress: number\r\n  filename?: React.ReactNode\r\n  onCancel?: React.MouseEventHandler<HTMLButtonElement>\r\n  text?: React.ReactNode\r\n}) => {\r\n  // Disable cancel button when upload is 90% or more complete\r\n  // to prevent inconsistency between Mux and Sanity\r\n  const isCancelDisabled = progress >= 90\r\n\r\n  return (\r\n    <CardWrapper tone=\"primary\" padding={4} border height=\"fill\">\r\n      <FlexWrapper align=\"center\" justify=\"space-between\" height=\"fill\" direction=\"row\" gap={2}>\r\n        <LeftSection>\r\n          <Flex justify=\"center\" gap={[3, 3, 2, 2]} direction={['column', 'column', 'row']}>\r\n            <Text size={1}>\r\n              <Inline space={2}>\r\n                {text}\r\n                <CodeWrapper size={1}>{filename ? filename : '...'}</CodeWrapper>\r\n              </Inline>\r\n            </Text>\r\n          </Flex>\r\n\r\n          <Card marginTop={3} radius={5} shadow={1}>\r\n            <LinearProgress value={progress} />\r\n          </Card>\r\n        </LeftSection>\r\n\r\n        {onCancel ? (\r\n          <Button\r\n            fontSize={2}\r\n            text=\"Cancel upload\"\r\n            mode=\"ghost\"\r\n            tone=\"critical\"\r\n            onClick={onCancel}\r\n            disabled={isCancelDisabled}\r\n          />\r\n        ) : null}\r\n      </FlexWrapper>\r\n    </CardWrapper>\r\n  )\r\n}\r\n","import {Card, Text} from '@sanity/ui'\r\nimport React, {useEffect, useMemo, useRef} from 'react'\r\n\r\nimport {useCancelUpload} from '../hooks/useCancelUpload'\r\nimport type {MuxInputProps, PluginConfig, VideoAssetDocument} from '../util/types'\r\nimport {TopControls} from './Player.styled'\r\nimport {UploadProgress} from './UploadProgress'\r\nimport VideoPlayer from './VideoPlayer'\r\n\r\ninterface Props extends Pick<MuxInputProps, 'onChange' | 'readOnly'> {\r\n  buttons?: React.ReactNode\r\n  asset: VideoAssetDocument\r\n  config?: PluginConfig\r\n}\r\n\r\nconst Player = ({asset, buttons, readOnly, onChange, config}: Props) => {\r\n  const isLoading = useMemo<boolean | string>(() => {\r\n    if (asset?.status === 'preparing') {\r\n      return 'Preparing the video'\r\n    }\r\n    if (asset?.status === 'waiting_for_upload') {\r\n      return 'Waiting for upload to start'\r\n    }\r\n    if (asset?.status === 'waiting') {\r\n      return 'Processing upload'\r\n    }\r\n    if (asset?.status === 'ready') {\r\n      return false\r\n    }\r\n    if (typeof asset?.status === 'undefined') {\r\n      return false\r\n    }\r\n\r\n    return true\r\n  }, [asset])\r\n  const isPreparingStaticRenditions = useMemo<boolean>(() => {\r\n    // Legacy: If static_renditions has a status field, it was created with mp4_support (deprecated)\r\n    // We don't process this old format, just return false\r\n    // Note: 'disabled' status is valid in the new format when no renditions were requested\r\n    if (\r\n      asset?.data?.static_renditions?.status &&\r\n      asset?.data?.static_renditions?.status !== 'disabled'\r\n    ) {\r\n      return false\r\n    }\r\n\r\n    // Check if any file in static_renditions is still preparing\r\n    const files = asset?.data?.static_renditions?.files\r\n    if (!files || files.length === 0) {\r\n      return false\r\n    }\r\n    return files.some((file) => file.status === 'preparing')\r\n  }, [asset?.data?.static_renditions?.status, asset?.data?.static_renditions?.files])\r\n  const playRef = useRef<HTMLDivElement>(null)\r\n  const muteRef = useRef<HTMLDivElement>(null)\r\n  const handleCancelUpload = useCancelUpload(asset, onChange)\r\n\r\n  useEffect(() => {\r\n    const style = document.createElement('style')\r\n    style.innerHTML = 'button svg { vertical-align: middle; }'\r\n\r\n    if (playRef.current?.shadowRoot) {\r\n      playRef.current.shadowRoot.appendChild(style)\r\n    }\r\n    if (muteRef?.current?.shadowRoot) {\r\n      muteRef.current.shadowRoot.appendChild(style.cloneNode(true))\r\n    }\r\n  }, [])\r\n\r\n  useEffect(() => {\r\n    if (asset?.status === 'errored') {\r\n      handleCancelUpload()\r\n      // eslint-disable-next-line no-warning-comments\r\n      // @TODO use better error handling\r\n      throw new Error(asset.data?.errors?.messages?.join(' '))\r\n    }\r\n  }, [asset.data?.errors?.messages, asset?.status, handleCancelUpload])\r\n\r\n  if (!asset || !asset.status) {\r\n    return null\r\n  }\r\n\r\n  if (isLoading) {\r\n    return (\r\n      <UploadProgress\r\n        progress={100}\r\n        filename={asset?.filename}\r\n        text={(isLoading !== true && isLoading) || 'Waiting for Mux to complete the upload'}\r\n        onCancel={readOnly ? undefined : () => handleCancelUpload()}\r\n      />\r\n    )\r\n  }\r\n\r\n  return (\r\n    <VideoPlayer asset={asset} hlsConfig={config?.hlsConfig}>\r\n      {buttons && <TopControls slot=\"top-chrome\">{buttons}</TopControls>}\r\n      {isPreparingStaticRenditions && (\r\n        <Card\r\n          padding={2}\r\n          radius={1}\r\n          style={{\r\n            background: 'var(--card-fg-color)',\r\n            position: 'absolute',\r\n            top: '0.5em',\r\n            left: '0.5em',\r\n          }}\r\n        >\r\n          <Text size={1} style={{color: 'var(--card-bg-color)'}}>\r\n            MUX is preparing static renditions, please stand by\r\n          </Text>\r\n        </Card>\r\n      )}\r\n    </VideoPlayer>\r\n  )\r\n}\r\n\r\nexport default Player\r\n","// todo: get these utils from @sanity/ui instead\r\nexport function focusRingBorderStyle(border: {color: string; width: number}): string {\r\n  return `inset 0 0 0 ${border.width}px ${border.color}`\r\n}\r\n\r\nexport function focusRingStyle(opts: {\r\n  base?: {bg: string}\r\n  border?: {color: string; width: number}\r\n  focusRing: {offset: number; width: number}\r\n}): string {\r\n  const {base, border, focusRing} = opts\r\n  const focusRingOutsetWidth = focusRing.offset + focusRing.width\r\n  const focusRingInsetWidth = 0 - focusRing.offset\r\n  const bgColor = base ? base.bg : 'var(--card-bg-color)'\r\n\r\n  return [\r\n    focusRingInsetWidth > 0 && `inset 0 0 0 ${focusRingInsetWidth}px var(--card-focus-ring-color)`,\r\n    border && focusRingBorderStyle(border),\r\n    focusRingInsetWidth < 0 && `0 0 0 ${0 - focusRingInsetWidth}px ${bgColor}`,\r\n    focusRingOutsetWidth > 0 && `0 0 0 ${focusRingOutsetWidth}px var(--card-focus-ring-color)`,\r\n  ]\r\n    .filter(Boolean)\r\n    .join(',')\r\n}\r\n","import {MenuItem} from '@sanity/ui'\r\nimport {css, styled} from 'styled-components'\r\n\r\nimport {focusRingStyle} from './withFocusRing/helpers'\r\n\r\nexport const FileButton = styled(MenuItem)(({theme}) => {\r\n  const {focusRing} = theme.sanity\r\n  const base = theme.sanity.color.base\r\n  const border = {width: 1, color: 'var(--card-border-color)'}\r\n\r\n  return css`\r\n    position: relative;\r\n\r\n    &:not([data-disabled='true']) {\r\n      &:focus-within {\r\n        box-shadow: ${focusRingStyle({base, border, focusRing})};\r\n      }\r\n    }\r\n\r\n    & input {\r\n      overflow: hidden;\r\n      top: 0;\r\n      left: 0;\r\n      width: 100%;\r\n      height: 100%;\r\n      position: absolute;\r\n      min-width: 0;\r\n      display: block;\r\n      appearance: none;\r\n      padding: 0;\r\n      margin: 0;\r\n      border: 0;\r\n      opacity: 0;\r\n    }\r\n  `\r\n})\r\n","import {Box, ButtonProps, Flex, Text} from '@sanity/ui'\r\nimport React, {createElement, isValidElement, useId} from 'react'\r\nimport {isValidElementType} from 'react-is'\r\n\r\nimport {FileButton} from './FileInputMenuItem.styled'\r\n\r\nexport interface FileInputMenuItemProps extends ButtonProps {\r\n  accept?: string\r\n  capture?: 'user' | 'environment'\r\n  multiple?: boolean\r\n  onSelect?: (files: File[]) => void\r\n  disabled?: boolean\r\n}\r\n\r\nexport const FileInputMenuItem = React.forwardRef(function FileInputMenuItem(\r\n  props: FileInputMenuItemProps &\r\n    Omit<React.HTMLProps<HTMLButtonElement>, 'as' | 'ref' | 'type' | 'value' | 'onSelect'>,\r\n  forwardedRef: React.ForwardedRef<HTMLInputElement>\r\n) {\r\n  const {\r\n    icon,\r\n    id: idProp,\r\n    accept,\r\n    capture,\r\n    fontSize,\r\n    multiple,\r\n    onSelect,\r\n    space = 3,\r\n    textAlign,\r\n    text,\r\n    disabled,\r\n    ...rest\r\n  } = props\r\n  const idHook = useId()\r\n  const id = idProp || idHook\r\n\r\n  const handleChange = React.useCallback(\r\n    (event: React.ChangeEvent<HTMLInputElement>) => {\r\n      if (onSelect && event.target.files) {\r\n        onSelect(Array.from(event.target.files))\r\n      }\r\n    },\r\n    [onSelect]\r\n  )\r\n\r\n  const content = (\r\n    <Flex align=\"center\" justify=\"flex-start\">\r\n      {/* Icon */}\r\n      {icon && (\r\n        <Box marginRight={text ? space : undefined}>\r\n          <Text size={fontSize}>\r\n            {isValidElement(icon) && icon}\r\n            {isValidElementType(icon) && createElement(icon)}\r\n          </Text>\r\n        </Box>\r\n      )}\r\n\r\n      {/* Text */}\r\n      {text && (\r\n        <Text align={textAlign} size={fontSize} textOverflow=\"ellipsis\">\r\n          {text}\r\n        </Text>\r\n      )}\r\n    </Flex>\r\n  )\r\n\r\n  return (\r\n    <FileButton {...rest} htmlFor={id} disabled={disabled} ref={forwardedRef}>\r\n      {content}\r\n\r\n      {/* Visibly hidden input */}\r\n      <input\r\n        data-testid=\"file-button-input\"\r\n        accept={accept}\r\n        capture={capture}\r\n        id={id}\r\n        multiple={multiple}\r\n        onChange={handleChange}\r\n        type=\"file\"\r\n        value=\"\"\r\n        disabled={disabled}\r\n      />\r\n    </FileButton>\r\n  )\r\n})\r\n","import {\r\n  DownloadIcon,\r\n  EllipsisHorizontalIcon,\r\n  ImageIcon,\r\n  LockIcon,\r\n  PlugIcon,\r\n  ResetIcon,\r\n  SearchIcon,\r\n  SyncIcon,\r\n  TranslateIcon,\r\n  UploadIcon,\r\n} from '@sanity/icons'\r\nimport {\r\n  Box,\r\n  Button,\r\n  Card,\r\n  Inline,\r\n  Label,\r\n  Menu,\r\n  MenuDivider,\r\n  MenuItem,\r\n  Popover,\r\n  Text,\r\n  Tooltip,\r\n  useClickOutsideEvent,\r\n} from '@sanity/ui'\r\nimport {memo, useCallback, useEffect, useMemo, useState} from 'react'\r\nimport {PatchEvent, unset} from 'sanity'\r\nimport {styled} from 'styled-components'\r\n\r\nimport {useAccessControl} from '../hooks/useAccessControl'\r\nimport {type DialogState, type SetDialogState} from '../hooks/useDialogState'\r\nimport {useResyncAsset} from '../hooks/useResyncAsset'\r\nimport {getPlaybackPolicy} from '../util/getPlaybackPolicy'\r\nimport type {MuxInputProps, PluginConfig, VideoAssetDocument} from '../util/types'\r\nimport {FileInputMenuItem} from './FileInputMenuItem'\r\n\r\nconst LockCard = styled(Card)`\r\n  position: absolute;\r\n  top: 0;\r\n  left: 0;\r\n  opacity: 0.6;\r\n  mix-blend-mode: screen;\r\n  background: transparent;\r\n`\r\n\r\nconst LockButton = styled(Button)`\r\n  background: transparent;\r\n  color: white;\r\n`\r\n\r\n// @TODO: add support for audio type (asset._type) when uploading an audio file so we can hide the thumbnail option.\r\nconst isVideoAsset = (asset: VideoAssetDocument) => {\r\n  return asset._type === 'mux.videoAsset'\r\n}\r\n\r\nfunction PlayerActionsMenu(\r\n  props: Pick<MuxInputProps, 'onChange' | 'readOnly'> & {\r\n    asset: VideoAssetDocument\r\n    onSelect: (files: File[]) => void\r\n    dialogState: DialogState\r\n    setDialogState: SetDialogState\r\n    config: PluginConfig\r\n    accept: string\r\n  }\r\n) {\r\n  const {asset, readOnly, dialogState, setDialogState, onChange, onSelect, accept} = props\r\n  const [open, setOpen] = useState(false)\r\n  const [menuElement, setMenuRef] = useState<HTMLDivElement | null>(null)\r\n  const isSigned = useMemo(() => getPlaybackPolicy(asset)?.policy === 'signed', [asset])\r\n  const {hasConfigAccess} = useAccessControl(props.config)\r\n  const {resyncAsset, isResyncing} = useResyncAsset({showToast: true})\r\n\r\n  const onReset = useCallback(() => onChange(PatchEvent.from(unset([]))), [onChange])\r\n\r\n  const handleResync = useCallback(async () => {\r\n    setOpen(false)\r\n    await resyncAsset(asset)\r\n  }, [resyncAsset, asset])\r\n\r\n  useEffect(() => {\r\n    if (open && dialogState) {\r\n      setOpen(false)\r\n    }\r\n  }, [dialogState, open])\r\n\r\n  useClickOutsideEvent(\r\n    () => setOpen(false),\r\n    () => [menuElement]\r\n  )\r\n\r\n  return (\r\n    <Inline space={1} padding={2}>\r\n      {isSigned && (\r\n        <Tooltip\r\n          animate\r\n          content={\r\n            <Box padding={2}>\r\n              <Text muted size={1}>\r\n                Signed playback policy\r\n              </Text>\r\n            </Box>\r\n          }\r\n          placement=\"right\"\r\n          portal\r\n        >\r\n          <LockCard radius={2} margin={2} scheme=\"dark\" tone=\"positive\">\r\n            <LockButton icon={LockIcon} mode=\"bleed\" tone=\"positive\" />\r\n          </LockCard>\r\n        </Tooltip>\r\n      )}\r\n      <Popover\r\n        animate\r\n        content={\r\n          <Menu ref={setMenuRef}>\r\n            <Box padding={2}>\r\n              <Label muted size={1}>\r\n                Replace\r\n              </Label>\r\n            </Box>\r\n            <FileInputMenuItem\r\n              accept={accept}\r\n              icon={UploadIcon}\r\n              onSelect={onSelect}\r\n              text=\"Upload\"\r\n              disabled={readOnly}\r\n              fontSize={1}\r\n            />\r\n            <MenuItem\r\n              icon={SearchIcon}\r\n              text=\"Browse\"\r\n              onClick={() => setDialogState('select-video')}\r\n            />\r\n            {isVideoAsset(asset) && (\r\n              <>\r\n                <MenuItem\r\n                  icon={ImageIcon}\r\n                  text=\"Thumbnail\"\r\n                  onClick={() => setDialogState('edit-thumbnail')}\r\n                />\r\n                <MenuItem\r\n                  icon={TranslateIcon}\r\n                  text=\"Captions\"\r\n                  onClick={() => setDialogState('edit-captions')}\r\n                />\r\n                <MenuItem\r\n                  icon={SyncIcon}\r\n                  text=\"Resync from Mux\"\r\n                  onClick={handleResync}\r\n                  disabled={readOnly || isResyncing}\r\n                />\r\n              </>\r\n            )}\r\n            <MenuDivider />\r\n            <MenuItem\r\n              icon={DownloadIcon}\r\n              text=\"Download\"\r\n              onClick={() => setDialogState('download-asset')}\r\n            />\r\n            <MenuDivider />\r\n            {hasConfigAccess && (\r\n              <>\r\n                <MenuItem\r\n                  icon={PlugIcon}\r\n                  text=\"Configure API\"\r\n                  onClick={() => setDialogState('secrets')}\r\n                />\r\n                <MenuDivider />\r\n              </>\r\n            )}\r\n            <MenuItem\r\n              tone=\"critical\"\r\n              icon={ResetIcon}\r\n              text=\"Clear field\"\r\n              onClick={onReset}\r\n              disabled={readOnly}\r\n            />\r\n          </Menu>\r\n        }\r\n        portal\r\n        open={open}\r\n      >\r\n        <Button\r\n          icon={EllipsisHorizontalIcon}\r\n          mode=\"ghost\"\r\n          fontSize={1}\r\n          onClick={() => {\r\n            setDialogState(false)\r\n            setOpen(true)\r\n          }}\r\n        />\r\n      </Popover>\r\n    </Inline>\r\n  )\r\n}\r\n\r\nexport default memo(PlayerActionsMenu)\r\n","import {useEffect, useState} from 'react'\r\n\r\nimport {StagedUpload} from '../components/Uploader'\r\n\r\nexport function useFetchFileSize(stagedUpload: StagedUpload, maxFileSize?: number) {\r\n  const [fileSize, setFileSize] = useState<number | null>(null)\r\n  const [isLoadingFileSize, setIsLoadingFileSize] = useState(false)\r\n  const [canSkipFileSizeValidation, setCanSkipFileSizeValidation] = useState(false)\r\n\r\n  useEffect(() => {\r\n    // Fetch URL Upload file size\r\n    if (stagedUpload.type === 'url') {\r\n      setIsLoadingFileSize(false)\r\n      setCanSkipFileSizeValidation(false)\r\n      setFileSize(null)\r\n      const url = stagedUpload.url\r\n\r\n      // Get file size from URL\r\n      const fetchFileSize = async () => {\r\n        setIsLoadingFileSize(true)\r\n        try {\r\n          const response = await fetch(url, {method: 'HEAD'})\r\n          const contentLength = response.headers.get('content-length')\r\n          const newFileSize = contentLength ? parseInt(contentLength, 10) : null\r\n\r\n          setIsLoadingFileSize(false)\r\n          if (newFileSize) {\r\n            setFileSize(newFileSize)\r\n          }\r\n          if (newFileSize === null && maxFileSize !== undefined) {\r\n            // Size unknown but size limit is configured - skip file size validation\r\n            setCanSkipFileSizeValidation(true)\r\n          }\r\n        } catch {\r\n          console.warn('Could not validate file size from URL')\r\n          // Skip validation of file size, but still validate duration\r\n          setCanSkipFileSizeValidation(true)\r\n          setIsLoadingFileSize(false)\r\n        }\r\n      }\r\n\r\n      fetchFileSize()\r\n    }\r\n    if (stagedUpload.type === 'file') {\r\n      setFileSize(stagedUpload.files[0].size)\r\n    }\r\n  }, [maxFileSize, stagedUpload, stagedUpload.type])\r\n\r\n  return {\r\n    fileSize,\r\n    isLoadingFileSize,\r\n    canSkipFileSizeValidation,\r\n  }\r\n}\r\n","import {useEffect, useState} from 'react'\r\n\r\nimport {StagedUpload} from '../components/Uploader'\r\n\r\nexport interface VideoAssetMetadata {\r\n  width?: number\r\n  height?: number\r\n  isAudioOnly?: boolean\r\n  duration?: number\r\n  size?: number\r\n}\r\n\r\nexport function useMediaMetadata(stagedUpload: StagedUpload) {\r\n  const [videoAssetMetadata, setVideoAssetMetadata] = useState<VideoAssetMetadata | null>(null)\r\n  const [isLoadingMetadata, setIsLoadingMetadata] = useState(false)\r\n  useEffect(() => {\r\n    let videoSrc = null\r\n    // Validate file uploads\r\n    if (stagedUpload.type === 'file') {\r\n      const file = stagedUpload.files[0]\r\n      videoSrc = URL.createObjectURL(file)\r\n    }\r\n\r\n    // Validate URL uploads\r\n    if (stagedUpload.type === 'url') {\r\n      videoSrc = stagedUpload.url\r\n    }\r\n\r\n    setVideoAssetMetadata((old) => ({\r\n      ...old,\r\n      duration: undefined,\r\n      width: undefined,\r\n      height: undefined,\r\n    }))\r\n\r\n    if (!videoSrc) return () => null\r\n\r\n    setIsLoadingMetadata(true)\r\n    const videoElement = document.createElement('video')\r\n    videoElement.preload = 'metadata'\r\n\r\n    const metadataListeners = [\r\n      () => {\r\n        setIsLoadingMetadata(false)\r\n      },\r\n      () => {\r\n        const duration = videoElement.duration\r\n        const width = videoElement.videoWidth\r\n        const height = videoElement.videoHeight\r\n        const isAudioOnly = width <= 0 && height <= 0\r\n        setVideoAssetMetadata((old) => {\r\n          return {\r\n            ...old,\r\n            duration: duration,\r\n            width: width,\r\n            height: height,\r\n            isAudioOnly: isAudioOnly,\r\n          }\r\n        })\r\n      },\r\n    ]\r\n\r\n    const cleanupVideo = (videoEl: HTMLVideoElement) => {\r\n      const currentVideoSrc = videoEl?.src\r\n      if (videoEl) {\r\n        metadataListeners.forEach((listener) =>\r\n          videoEl.removeEventListener('loadedmetadata', listener)\r\n        )\r\n        videoEl.onerror = null\r\n        videoEl.src = ''\r\n        videoEl.load()\r\n      }\r\n      if (currentVideoSrc?.startsWith('blob:')) {\r\n        URL.revokeObjectURL(currentVideoSrc)\r\n      }\r\n    }\r\n    metadataListeners.push(() => setTimeout(() => cleanupVideo(videoElement), 0))\r\n\r\n    videoElement.onerror = () => {\r\n      setIsLoadingMetadata(false)\r\n      console.warn('Could not read video metadata for validation')\r\n      cleanupVideo(videoElement)\r\n    }\r\n\r\n    metadataListeners.forEach((listener) =>\r\n      videoElement.addEventListener('loadedmetadata', listener)\r\n    )\r\n    videoElement.src = videoSrc\r\n\r\n    return () => {\r\n      cleanupVideo(videoElement)\r\n    }\r\n  }, [stagedUpload.type, stagedUpload])\r\n\r\n  return {\r\n    videoAssetMetadata,\r\n    setVideoAssetMetadata,\r\n    isLoadingMetadata,\r\n  }\r\n}\r\n","/* eslint-disable */\r\n// From: https://stackoverflow.com/questions/10420352/converting-file-size-in-bytes-to-human-readable-string\r\n/**\r\n * Format bytes as human-readable text.\r\n *\r\n * @param bytes Number of bytes.\r\n * @param si True to use metric (SI) units, aka powers of 1000. False to use\r\n *           binary (IEC), aka powers of 1024.\r\n * @param dp Number of decimal places to display.\r\n *\r\n * @return Formatted string.\r\n */\r\nexport default function formatBytes(bytes: number, si = false, dp = 1) {\r\n  const thresh = si ? 1000 : 1024\r\n\r\n  if (Math.abs(bytes) < thresh) {\r\n    return bytes + ' B'\r\n  }\r\n\r\n  const units = si\r\n    ? ['kB', 'MB', 'GB', 'TB', 'PB', 'EB', 'ZB', 'YB']\r\n    : ['KiB', 'MiB', 'GiB', 'TiB', 'PiB', 'EiB', 'ZiB', 'YiB']\r\n  let u = -1\r\n  const r = 10 ** dp\r\n\r\n  do {\r\n    bytes /= thresh\r\n    ++u\r\n  } while (Math.round(Math.abs(bytes) * r) / r >= thresh && u < units.length - 1)\r\n\r\n  return bytes.toFixed(dp) + ' ' + units[u]\r\n}\r\n","import {TranslateIcon} from '@sanity/icons'\r\nimport {Autocomplete, Box, Card, Checkbox, Flex, Stack, Text} from '@sanity/ui'\r\nimport {uuid} from '@sanity/uuid'\r\nimport LanguagesList from 'iso-639-1'\r\nimport {Dispatch} from 'react'\r\nimport {FormField} from 'sanity'\r\n\r\nimport {type PluginConfig, SUPPORTED_MUX_LANGUAGES, UploadTextTrack} from '../util/types'\r\n\r\nconst ALL_LANGUAGE_CODES = LanguagesList.getAllCodes().map((code) => ({\r\n  value: code,\r\n  label: LanguagesList.getNativeName(code),\r\n}))\r\n\r\nconst SUBTITLE_LANGUAGES: Record<\r\n  Extract<UploadTextTrack, {language_code: any}>['type'],\r\n  {value: string; label: string}[]\r\n> = {\r\n  autogenerated: SUPPORTED_MUX_LANGUAGES.map((lang) => ({\r\n    value: lang.code,\r\n    label: lang.label,\r\n  })),\r\n  subtitles: ALL_LANGUAGE_CODES,\r\n  captions: ALL_LANGUAGE_CODES,\r\n}\r\n\r\ntype TrackSubAction =\r\n  | {subAction: 'add'; value: Partial<UploadTextTrack>}\r\n  | {subAction: 'update'; value: Partial<UploadTextTrack>}\r\n  | {subAction: 'delete'}\r\n\r\nexport type TrackAction = {action: 'track'; id: string} & TrackSubAction\r\n\r\nexport default function TextTracksEditor({\r\n  tracks,\r\n  dispatch,\r\n  defaultLang,\r\n}: {\r\n  /**\r\n   * Although the schema for tracks is an array, which we'll eventually support to allow uploading\r\n   * multiple custom subtitles, for now we only support a single auto-generated track.\r\n   */\r\n  tracks: (Partial<UploadTextTrack> & {_id: string})[]\r\n  dispatch: Dispatch<TrackAction>\r\n  defaultLang: PluginConfig['defaultAutogeneratedSubtitleLang']\r\n}) {\r\n  const track = tracks[0]\r\n  return (\r\n    <FormField title=\"Auto-generated subtitle or caption\">\r\n      <Stack space={2}>\r\n        <Flex align=\"center\">\r\n          <Checkbox\r\n            id=\"include-autogenerated-track\"\r\n            style={{display: 'block'}}\r\n            checked={!!track?.language_code}\r\n            onChange={() => {\r\n              if (track) {\r\n                dispatch({action: 'track', id: track._id, subAction: 'delete'})\r\n              } else {\r\n                dispatch({\r\n                  action: 'track',\r\n                  id: uuid(),\r\n                  subAction: 'add',\r\n                  value: {\r\n                    type: 'autogenerated',\r\n                    name: defaultLang || undefined,\r\n                    language_code: defaultLang || undefined,\r\n                  },\r\n                })\r\n              }\r\n            }}\r\n          />\r\n          <Box flex={1} paddingLeft={3}>\r\n            <Text>\r\n              <label htmlFor=\"checkbox\">Generate captions</label>\r\n            </Text>\r\n          </Box>\r\n        </Flex>\r\n        {track && (\r\n          <Autocomplete\r\n            id={`text-tract-editor--language`}\r\n            value={track.language_code}\r\n            onChange={(newValue) =>\r\n              dispatch({\r\n                action: 'track',\r\n                id: track._id,\r\n                subAction: 'update',\r\n                value: {\r\n                  language_code: newValue,\r\n                  name: LanguagesList.getNativeName(newValue),\r\n                },\r\n              })\r\n            }\r\n            options={SUBTITLE_LANGUAGES[track.type!]}\r\n            icon={TranslateIcon}\r\n            placeholder=\"Select language\"\r\n            filterOption={(query, option) =>\r\n              option.label.toLowerCase().indexOf(query.toLowerCase()) > -1 ||\r\n              option.value.toLowerCase().indexOf(query.toLowerCase()) > -1\r\n            }\r\n            openButton\r\n            renderValue={(value) =>\r\n              SUBTITLE_LANGUAGES[track.type!].find((l) => l.value === value)?.label || value\r\n            }\r\n            renderOption={(option) => (\r\n              <Card data-as=\"button\" padding={3} radius={2} tone=\"inherit\">\r\n                <Text size={2} textOverflow=\"ellipsis\">\r\n                  {option.label} ({option.value})\r\n                </Text>\r\n              </Card>\r\n            )}\r\n          />\r\n        )}\r\n      </Stack>\r\n    </FormField>\r\n  )\r\n}\r\n","import {Checkbox, Flex, Grid, Text} from '@sanity/ui'\r\nimport {ActionDispatch, CSSProperties, ReactNode, useState} from 'react'\r\n\r\nimport {UploadConfigurationStateAction} from '../UploadConfiguration'\r\n\r\nexport default function PlaybackPolicyOption({\r\n  id,\r\n  checked,\r\n  optionName,\r\n  description,\r\n  dispatch,\r\n  action,\r\n  disabled,\r\n}: {\r\n  id: string\r\n  checked: boolean\r\n  optionName: string\r\n  description: string | ReactNode\r\n  dispatch: ActionDispatch<[action: UploadConfigurationStateAction]>\r\n  action?: 'public_policy' | 'signed_policy' | 'drm_policy'\r\n  disabled?: boolean\r\n}) {\r\n  const [scale, setScale] = useState(1)\r\n\r\n  const boxStyle: CSSProperties = {\r\n    outline: '0.01rem solid grey',\r\n    transform: `scale(${scale})`,\r\n    transition: 'transform 0.1s ease-in-out',\r\n    cursor: disabled ? 'not-allowed' : 'pointer',\r\n    borderRadius: '0.25rem',\r\n  }\r\n\r\n  const triggerAnimation = () => {\r\n    setScale(0.98)\r\n    setTimeout(() => {\r\n      setScale(1)\r\n    }, 100)\r\n  }\r\n\r\n  const handleBoxClick = () => {\r\n    if (!action) return\r\n    triggerAnimation()\r\n    dispatch({\r\n      action,\r\n      value: !checked,\r\n    })\r\n  }\r\n\r\n  const descriptionJsx =\r\n    typeof description === 'string' ? (\r\n      <Text size={2} muted>\r\n        {description}\r\n      </Text>\r\n    ) : (\r\n      description\r\n    )\r\n  return (\r\n    <label>\r\n      <Flex gap={3} padding={3} style={boxStyle}>\r\n        <Checkbox\r\n          id={id}\r\n          required\r\n          checked={checked}\r\n          onChange={handleBoxClick}\r\n          disabled={disabled}\r\n        />\r\n        <Grid gap={3}>\r\n          <Text size={3} weight=\"bold\">\r\n            {optionName}\r\n          </Text>\r\n          {descriptionJsx}\r\n        </Grid>\r\n      </Flex>\r\n    </label>\r\n  )\r\n}\r\n","import {WarningFilledIcon} from '@sanity/icons'\r\nimport {Box, Flex, Text} from '@sanity/ui'\r\nimport {CSSProperties} from 'react'\r\n\r\nexport default function PlaybackPolicyWarning() {\r\n  const textStyle: CSSProperties = {\r\n    color: '#13141A',\r\n    fontWeight: 500,\r\n  }\r\n\r\n  const boxStyle: CSSProperties = {\r\n    outline: '0.01rem solid grey',\r\n    backgroundColor: '#979cb0',\r\n    borderRadius: '0.5rem',\r\n    width: 'max-content',\r\n    color: '#13141A',\r\n  }\r\n\r\n  return (\r\n    <Box padding={2} style={boxStyle}>\r\n      <Flex align=\"center\" gap={2}>\r\n        <WarningFilledIcon />\r\n        <Text size={1} style={textStyle}>\r\n          Please select at least one Playback Policy\r\n        </Text>\r\n      </Flex>\r\n    </Box>\r\n  )\r\n}\r\n","import {Code, Grid, Text} from '@sanity/ui'\r\nimport {ActionDispatch} from 'react'\r\n\r\nimport {Secrets, UploadConfig} from '../../util/types'\r\nimport {UploadConfigurationStateAction} from '../UploadConfiguration'\r\nimport PlaybackPolicyOption from './PlaybackPolicyOption'\r\nimport PlaybackPolicyWarning from './PlaybackPolicyWarning'\r\n\r\nexport default function PlaybackPolicy({\r\n  id,\r\n  config,\r\n  secrets,\r\n  dispatch,\r\n}: {\r\n  id: string\r\n  config: UploadConfig\r\n  secrets: Secrets\r\n  dispatch: ActionDispatch<[action: UploadConfigurationStateAction]>\r\n}) {\r\n  const noPolicySelected = !(config.public_policy || config.signed_policy || config.drm_policy)\r\n  const drmPolicyDisabled = !secrets.drmConfigId\r\n  return (\r\n    <Grid gap={3}>\r\n      <Text weight=\"bold\">Advanced Playback Policies</Text>\r\n      <PlaybackPolicyOption\r\n        id={`${id}--public`}\r\n        checked={config.public_policy}\r\n        optionName=\"Public\"\r\n        description={\r\n          <>\r\n            <Text size={2} muted>\r\n              Playback IDs are accessible by constructing an HLS URL like\r\n            </Text>\r\n            <Code>{'https://stream.mux.com/{PLAYBACK_ID}'}</Code>\r\n          </>\r\n        }\r\n        dispatch={dispatch}\r\n        action=\"public_policy\"\r\n      />\r\n      {secrets.enableSignedUrls && (\r\n        <PlaybackPolicyOption\r\n          id={`${id}--signed`}\r\n          checked={config.signed_policy}\r\n          optionName=\"Signed\"\r\n          description={\r\n            <>\r\n              <Text size={2} muted>\r\n                Playback IDs should be used with tokens\r\n              </Text>\r\n              <Code>{'https://stream.mux.com/{PLAYBACK_ID}?token={TOKEN}'}</Code>\r\n              <Text size={2} muted>\r\n                See{' '}\r\n                <a\r\n                  href=\"https://www.mux.com/docs/guides/secure-video-playback\"\r\n                  target=\"_blank\"\r\n                  rel=\"noopener noreferrer\"\r\n                >\r\n                  Secure video playback\r\n                </a>{' '}\r\n                for details about creating tokens.\r\n              </Text>\r\n            </>\r\n          }\r\n          // See Secure video playback for details about creating tokens.\"\r\n          dispatch={dispatch}\r\n          action=\"signed_policy\"\r\n        />\r\n      )}\r\n      {drmPolicyDisabled ? (\r\n        <PlaybackPolicyOption\r\n          id={`${id}--drm`}\r\n          checked={false}\r\n          optionName=\"DRM - Disabled\"\r\n          description={\r\n            <>\r\n              <Text size={2} muted>\r\n                To enable DRM add your DRM Configuration Id to your plugin configuration in the API\r\n                Credentials view.{' '}\r\n                <a\r\n                  href=\"https://www.mux.com/support/human\"\r\n                  target=\"_blank\"\r\n                  rel=\"noopener noreferrer\"\r\n                >\r\n                  Contact us\r\n                </a>{' '}\r\n                to get started using DRM.\r\n              </Text>\r\n            </>\r\n          }\r\n          dispatch={dispatch}\r\n          disabled\r\n        />\r\n      ) : (\r\n        <PlaybackPolicyOption\r\n          id={`${id}--drm`}\r\n          checked={config.drm_policy}\r\n          optionName=\"DRM\"\r\n          description={\r\n            <>\r\n              <Text size={2} muted>\r\n                Playback IDs should be used with tokens as with Signed playback, but require extra\r\n                configuration.\r\n              </Text>\r\n              <Code>{'https://stream.mux.com/{PLAYBACK_ID}?token={TOKEN}'}</Code>\r\n              <Text size={2} muted>\r\n                See{' '}\r\n                <a\r\n                  href=\"https://www.mux.com/docs/guides/protect-videos-with-drm#play-drm-protected-videos\"\r\n                  target=\"_blank\"\r\n                  rel=\"noopener noreferrer\"\r\n                >\r\n                  Protect videos with DRM\r\n                </a>{' '}\r\n                for details about configuring your player for DRM playback and{' '}\r\n                <a\r\n                  href=\"https://www.mux.com/docs/guides/secure-video-playback\"\r\n                  target=\"_blank\"\r\n                  rel=\"noopener noreferrer\"\r\n                >\r\n                  Secure video playback\r\n                </a>{' '}\r\n                for details about creating tokens.\r\n              </Text>\r\n            </>\r\n          }\r\n          dispatch={dispatch}\r\n          action=\"drm_policy\"\r\n        />\r\n      )}\r\n      {noPolicySelected && <PlaybackPolicyWarning />}\r\n    </Grid>\r\n  )\r\n}\r\n","import {Flex, Radio, Text} from '@sanity/ui'\r\nimport {ActionDispatch} from 'react'\r\nimport {FormField} from 'sanity'\r\n\r\nimport {type UploadConfig} from '../../util/types'\r\nimport {UploadConfigurationStateAction} from '../UploadConfiguration'\r\n\r\nexport const RESOLUTION_TIERS = [\r\n  {value: '1080p', label: '1080p'},\r\n  {value: '1440p', label: '1440p (2k)'},\r\n  {value: '2160p', label: '2160p (4k)'},\r\n] as const satisfies {value: UploadConfig['max_resolution_tier']; label: string}[]\r\n\r\nexport const ResolutionTierSelector = ({\r\n  id,\r\n  config,\r\n  dispatch,\r\n  maxSupportedResolution,\r\n}: {\r\n  id: string\r\n  config: UploadConfig\r\n  dispatch: ActionDispatch<[action: UploadConfigurationStateAction]>\r\n  maxSupportedResolution: number\r\n}) => {\r\n  return (\r\n    <FormField\r\n      title=\"Resolution Tier\"\r\n      description={\r\n        <>\r\n          The maximum{' '}\r\n          <a\r\n            href=\"https://docs.mux.com/api-reference#video/operation/create-direct-upload\"\r\n            target=\"_blank\"\r\n            rel=\"noopener noreferrer\"\r\n          >\r\n            resolution_tier\r\n          </a>{' '}\r\n          your asset is encoded, stored, and streamed at.\r\n        </>\r\n      }\r\n    >\r\n      <Flex gap={3} wrap={'wrap'}>\r\n        {RESOLUTION_TIERS.map(({value, label}, index) => {\r\n          const inputId = `${id}--type-${value}`\r\n\r\n          if (index > maxSupportedResolution) return null\r\n\r\n          return (\r\n            <Flex key={value} align=\"center\" gap={2}>\r\n              <Radio\r\n                checked={config.max_resolution_tier === value}\r\n                name=\"asset-resolutiontier\"\r\n                onChange={(e) =>\r\n                  dispatch({\r\n                    action: 'max_resolution_tier',\r\n                    value: e.currentTarget.value as UploadConfig['max_resolution_tier'],\r\n                  })\r\n                }\r\n                value={value}\r\n                id={inputId}\r\n              />\r\n              <Text as=\"label\" htmlFor={inputId}>\r\n                {label}\r\n              </Text>\r\n            </Flex>\r\n          )\r\n        })}\r\n      </Flex>\r\n    </FormField>\r\n  )\r\n}\r\n","import {Checkbox, Flex, Label, Radio, Stack, Text} from '@sanity/ui'\r\nimport {ActionDispatch, useMemo, useState} from 'react'\r\nimport {FormField} from 'sanity'\r\n\r\nimport {type StaticRenditionResolution, type UploadConfig} from '../../util/types'\r\nimport {UploadConfigurationStateAction} from '../UploadConfiguration'\r\n\r\nconst ADVANCED_RESOLUTIONS: {value: StaticRenditionResolution; label: string}[] = [\r\n  {value: '270p', label: '270p'},\r\n  {value: '360p', label: '360p'},\r\n  {value: '480p', label: '480p'},\r\n  {value: '540p', label: '540p'},\r\n  {value: '720p', label: '720p'},\r\n  {value: '1080p', label: '1080p'},\r\n  {value: '1440p', label: '1440p'},\r\n  {value: '2160p', label: '2160p'},\r\n]\r\n\r\nexport const StaticRenditionSelector = ({\r\n  id,\r\n  config,\r\n  dispatch,\r\n}: {\r\n  id: string\r\n  config: UploadConfig\r\n  dispatch: ActionDispatch<[action: UploadConfigurationStateAction]>\r\n}) => {\r\n  // Determine if user is in advanced mode based on selected renditions\r\n  const isAdvancedMode = useMemo(() => {\r\n    const specificResolutions = config.static_renditions.filter(\r\n      (r) => r !== 'highest' && r !== 'audio-only'\r\n    )\r\n    return specificResolutions.length > 0\r\n  }, [config.static_renditions])\r\n\r\n  const [renditionMode, setRenditionMode] = useState<'standard' | 'advanced'>(\r\n    isAdvancedMode ? 'advanced' : 'standard'\r\n  )\r\n\r\n  // Helper to toggle a rendition\r\n  const toggleRendition = (rendition: StaticRenditionResolution) => {\r\n    const current = config.static_renditions\r\n    const hasRendition = current.includes(rendition)\r\n\r\n    if (hasRendition) {\r\n      dispatch({\r\n        action: 'static_renditions',\r\n        value: current.filter((r) => r !== rendition),\r\n      })\r\n    } else {\r\n      dispatch({\r\n        action: 'static_renditions',\r\n        value: [...current, rendition],\r\n      })\r\n    }\r\n  }\r\n\r\n  // When switching modes, clear renditions that don't apply\r\n  const handleModeChange = (mode: 'standard' | 'advanced') => {\r\n    setRenditionMode(mode)\r\n    if (mode === 'standard') {\r\n      // Remove specific resolutions, keep only highest and audio-only\r\n      dispatch({\r\n        action: 'static_renditions',\r\n        value: config.static_renditions.filter((r) => r === 'highest' || r === 'audio-only'),\r\n      })\r\n    } else {\r\n      // Remove highest, keep specific resolutions and audio-only\r\n      dispatch({\r\n        action: 'static_renditions',\r\n        value: config.static_renditions.filter((r) => r !== 'highest'),\r\n      })\r\n    }\r\n  }\r\n  return (\r\n    <Stack space={3}>\r\n      <FormField\r\n        title=\"Static Renditions\"\r\n        description=\"Generate downloadable MP4 or M4A files. Note: Mux will not upscale to produce MP4 renditions - renditions that would cause upscaling are skipped.\"\r\n      >\r\n        <Stack space={3}>\r\n          {/* Mode Selector */}\r\n          <Flex gap={3}>\r\n            <Flex align=\"center\" gap={2}>\r\n              <Radio\r\n                checked={renditionMode === 'standard'}\r\n                name=\"rendition-mode\"\r\n                onChange={() => handleModeChange('standard')}\r\n                value=\"standard\"\r\n                id={`${id}--mode-standard`}\r\n              />\r\n              <Text as=\"label\" htmlFor={`${id}--mode-standard`}>\r\n                Standard\r\n              </Text>\r\n            </Flex>\r\n            <Flex align=\"center\" gap={2}>\r\n              <Radio\r\n                checked={renditionMode === 'advanced'}\r\n                name=\"rendition-mode\"\r\n                onChange={() => handleModeChange('advanced')}\r\n                value=\"advanced\"\r\n                id={`${id}--mode-advanced`}\r\n              />\r\n              <Text as=\"label\" htmlFor={`${id}--mode-advanced`}>\r\n                Advanced\r\n              </Text>\r\n            </Flex>\r\n          </Flex>\r\n\r\n          {/* Standard Mode Options */}\r\n          {renditionMode === 'standard' && (\r\n            <Stack space={2}>\r\n              <Flex align=\"center\" gap={2} padding={[0, 2]}>\r\n                <Checkbox\r\n                  id={`${id}--highest`}\r\n                  style={{display: 'block'}}\r\n                  checked={config.static_renditions.includes('highest')}\r\n                  onChange={() => toggleRendition('highest')}\r\n                />\r\n                <Text as=\"label\" htmlFor={`${id}--highest`}>\r\n                  Highest Resolution (up to 4K)\r\n                </Text>\r\n              </Flex>\r\n              <Flex align=\"center\" gap={2} padding={[0, 2]}>\r\n                <Checkbox\r\n                  id={`${id}--audio-only-standard`}\r\n                  style={{display: 'block'}}\r\n                  checked={config.static_renditions.includes('audio-only')}\r\n                  onChange={() => toggleRendition('audio-only')}\r\n                />\r\n                <Text as=\"label\" htmlFor={`${id}--audio-only-standard`}>\r\n                  Audio Only (M4A)\r\n                </Text>\r\n              </Flex>\r\n            </Stack>\r\n          )}\r\n\r\n          {/* Advanced Mode Options */}\r\n          {renditionMode === 'advanced' && (\r\n            <Stack space={2}>\r\n              <Label size={1} muted>\r\n                Select specific resolutions:\r\n              </Label>\r\n              <Flex gap={2} wrap=\"wrap\">\r\n                {ADVANCED_RESOLUTIONS.map(({value, label}) => {\r\n                  const inputId = `${id}--resolution-${value}`\r\n                  return (\r\n                    <Flex key={value} align=\"center\" gap={2}>\r\n                      <Checkbox\r\n                        id={inputId}\r\n                        style={{display: 'block'}}\r\n                        checked={config.static_renditions.includes(value)}\r\n                        onChange={() => toggleRendition(value)}\r\n                      />\r\n                      <Text as=\"label\" htmlFor={inputId} size={1}>\r\n                        {label}\r\n                      </Text>\r\n                    </Flex>\r\n                  )\r\n                })}\r\n              </Flex>\r\n              <Flex align=\"center\" gap={2} padding={[2, 2, 0, 2]}>\r\n                <Checkbox\r\n                  id={`${id}--audio-only-advanced`}\r\n                  style={{display: 'block'}}\r\n                  checked={config.static_renditions.includes('audio-only')}\r\n                  onChange={() => toggleRendition('audio-only')}\r\n                />\r\n                <Text as=\"label\" htmlFor={`${id}--audio-only-advanced`}>\r\n                  Audio Only (M4A)\r\n                </Text>\r\n              </Flex>\r\n            </Stack>\r\n          )}\r\n        </Stack>\r\n      </FormField>\r\n    </Stack>\r\n  )\r\n}\r\n","import {DocumentVideoIcon, ErrorOutlineIcon, UploadIcon} from '@sanity/icons'\r\nimport {Box, Button, Card, Checkbox, Dialog, Flex, Label, Radio, Stack, Text, TextInput} from '@sanity/ui'\r\nimport {uuid} from '@sanity/uuid'\r\nimport LanguagesList from 'iso-639-1'\r\nimport {useEffect, useId, useReducer, useRef, useState} from 'react'\r\nimport {FormField} from 'sanity'\r\n\r\nimport {useFetchFileSize} from '../hooks/useFetchFileSize'\r\nimport {useMediaMetadata} from '../hooks/useMediaMetadata'\r\nimport formatBytes from '../util/formatBytes'\r\nimport {formatSeconds} from '../util/formatSeconds'\r\nimport {\r\n  type AutogeneratedTextTrack,\r\n  type CustomTextTrack,\r\n  isAutogeneratedTrack,\r\n  isCustomTextTrack,\r\n  type MuxNewAssetSettings,\r\n  type PluginConfig,\r\n  type Secrets,\r\n  type StaticRenditionResolution,\r\n  type SupportedMuxLanguage,\r\n  type UploadConfig,\r\n  type UploadTextTrack,\r\n} from '../util/types'\r\nimport TextTracksEditor, {type TrackAction} from './TextTracksEditor'\r\nimport PlaybackPolicy from './uploadConfiguration/PlaybackPolicy'\r\nimport {\r\n  RESOLUTION_TIERS,\r\n  ResolutionTierSelector,\r\n} from './uploadConfiguration/ResolutionTierSelector'\r\nimport {StaticRenditionSelector} from './uploadConfiguration/StaticRenditionSelector'\r\nimport type {StagedUpload} from './Uploader'\r\n\r\nexport type UploadConfigurationStateAction =\r\n  | {action: 'video_quality'; value: UploadConfig['video_quality']}\r\n  | {action: 'max_resolution_tier'; value: UploadConfig['max_resolution_tier']}\r\n  | {action: 'static_renditions'; value: UploadConfig['static_renditions']}\r\n  | {action: 'normalize_audio'; value: UploadConfig['normalize_audio']}\r\n  | {action: 'signed_policy'; value: UploadConfig['signed_policy']}\r\n  | {action: 'public_policy'; value: UploadConfig['public_policy']}\r\n  | {action: 'drm_policy'; value: UploadConfig['drm_policy']}\r\n  | {action: 'asset_name'; value: string}\r\n  | TrackAction\r\n\r\nconst VIDEO_QUALITY_LEVELS = [\r\n  {value: 'basic', label: 'Basic'},\r\n  {value: 'plus', label: 'Plus'},\r\n  {value: 'premium', label: 'Premium'},\r\n] as const satisfies {value: UploadConfig['video_quality']; label: string}[]\r\n\r\n/**\r\n * Sanitizes static renditions configuration to ensure 'highest' is not mixed with specific resolutions.\r\n * If both are present, only 'highest' (and 'audio-only' if present) will be kept.\r\n */\r\nfunction sanitizeStaticRenditions(\r\n  renditions: StaticRenditionResolution[]\r\n): StaticRenditionResolution[] {\r\n  const hasHighest = renditions.includes('highest')\r\n  const hasSpecificResolutions = renditions.some((r) => r !== 'highest' && r !== 'audio-only')\r\n\r\n  if (hasHighest && hasSpecificResolutions) {\r\n    return renditions.filter((r) => r === 'highest' || r === 'audio-only')\r\n  }\r\n\r\n  return renditions\r\n}\r\n\r\n/**\r\n * The modal for configuring a staged upload. Handles triggering of the asset\r\n * upload, even if no modal needs to be shown.\r\n *\r\n * @returns\r\n */\r\nexport default function UploadConfiguration({\r\n  stagedUpload,\r\n  secrets,\r\n  pluginConfig,\r\n  startUpload,\r\n  onClose,\r\n}: {\r\n  stagedUpload: StagedUpload\r\n  secrets: Secrets\r\n  pluginConfig: PluginConfig\r\n  startUpload: (settings: MuxNewAssetSettings, assetName?: string) => void\r\n  onClose: () => void\r\n}) {\r\n  const id = useId()\r\n  const autoTextTracks = useRef<NonNullable<UploadConfig['text_tracks']>>(\r\n    pluginConfig.video_quality === 'plus' && pluginConfig.defaultAutogeneratedSubtitleLang\r\n      ? [\r\n          {\r\n            _id: uuid(),\r\n            type: 'autogenerated',\r\n            language_code: pluginConfig.defaultAutogeneratedSubtitleLang,\r\n            name: LanguagesList.getNativeName(pluginConfig.defaultAutogeneratedSubtitleLang),\r\n          } satisfies AutogeneratedTextTrack,\r\n        ]\r\n      : []\r\n  ).current\r\n\r\n  const [config, dispatch] = useReducer(\r\n    (prev: UploadConfig, action: UploadConfigurationStateAction) => {\r\n      switch (action.action) {\r\n        case 'video_quality':\r\n          // If video quality level switches to basic, remove plus-only features\r\n          if (action.value === 'basic') {\r\n            return Object.assign({}, prev, {\r\n              video_quality: action.value,\r\n              static_renditions: [],\r\n              max_resolution_tier: '1080p',\r\n              text_tracks: prev.text_tracks?.filter(({type}) => type !== 'autogenerated'),\r\n              public_policy: true,\r\n              signed_policy: false,\r\n              drm_policy: false,\r\n            })\r\n            // If video quality level switches to plus, add back in default plus features\r\n          }\r\n          return Object.assign({}, prev, {\r\n            video_quality: action.value,\r\n            static_renditions: sanitizeStaticRenditions(pluginConfig.static_renditions || []),\r\n            max_resolution_tier: pluginConfig.max_resolution_tier,\r\n            text_tracks: [...autoTextTracks, ...(prev.text_tracks || [])],\r\n          })\r\n\r\n        case 'static_renditions':\r\n        case 'max_resolution_tier':\r\n        case 'normalize_audio':\r\n        case 'signed_policy':\r\n          return Object.assign({}, prev, {[action.action]: action.value})\r\n        case 'public_policy':\r\n          return Object.assign({}, prev, {[action.action]: action.value})\r\n        case 'drm_policy':\r\n          return Object.assign({}, prev, {[action.action]: action.value})\r\n        case 'asset_name':\r\n          return Object.assign({}, prev, {[action.action]: action.value})\r\n        // Updating individual tracks\r\n        case 'track': {\r\n          const text_tracks = [...prev.text_tracks]\r\n          const target_track_i = text_tracks.findIndex(({_id}) => _id === action.id)\r\n          // eslint-disable-next-line default-case\r\n          switch (action.subAction) {\r\n            case 'add':\r\n              // Exit early if track already exists\r\n              if (target_track_i !== -1) break\r\n              text_tracks.push({\r\n                _id: action.id,\r\n                ...action.value,\r\n              } as AutogeneratedTextTrack)\r\n              break\r\n            case 'update':\r\n              if (target_track_i === -1) break\r\n              text_tracks[target_track_i] = {\r\n                ...text_tracks[target_track_i],\r\n                ...action.value,\r\n              } as UploadTextTrack\r\n              break\r\n            case 'delete':\r\n              if (target_track_i === -1) break\r\n              text_tracks.splice(target_track_i, 1)\r\n              break\r\n          }\r\n          return Object.assign({}, prev, {text_tracks})\r\n        }\r\n        default:\r\n          return prev\r\n      }\r\n    },\r\n    {\r\n      video_quality: pluginConfig.video_quality,\r\n      max_resolution_tier: pluginConfig.max_resolution_tier,\r\n      static_renditions: sanitizeStaticRenditions(pluginConfig.static_renditions || []),\r\n      signed_policy: secrets.enableSignedUrls && pluginConfig.defaultSigned,\r\n      public_policy: pluginConfig.defaultPublic,\r\n      drm_policy: pluginConfig.defaultDrm && !!secrets.drmConfigId,\r\n      normalize_audio: pluginConfig.normalize_audio,\r\n      text_tracks: autoTextTracks,\r\n      asset_name: stagedUpload.type === 'file' ? stagedUpload.files[0].name : stagedUpload.url,\r\n    } as UploadConfig\r\n  )\r\n\r\n  // Video validations\r\n  const [validationError, setValidationError] = useState<string | null>(null)\r\n  const MAX_FILE_SIZE = pluginConfig.maxAssetFileSize\r\n  const MAX_DURATION_SECONDS = pluginConfig.maxAssetDuration\r\n\r\n  const {fileSize, isLoadingFileSize, canSkipFileSizeValidation} = useFetchFileSize(\r\n    stagedUpload,\r\n    MAX_FILE_SIZE\r\n  )\r\n  const {videoAssetMetadata, setVideoAssetMetadata, isLoadingMetadata} =\r\n    useMediaMetadata(stagedUpload)\r\n\r\n  useEffect(() => {\r\n    if (fileSize) {\r\n      setVideoAssetMetadata((old) => ({...old, size: fileSize}))\r\n    }\r\n  }, [fileSize, setVideoAssetMetadata])\r\n\r\n  useEffect(() => {\r\n    const validateDuration = (duration: number) => {\r\n      if (MAX_DURATION_SECONDS && duration > MAX_DURATION_SECONDS) {\r\n        setValidationError(\r\n          `Video duration (${formatSeconds(duration)}) exceeds maximum allowed duration of ${formatSeconds(MAX_DURATION_SECONDS)}`\r\n        )\r\n        return false\r\n      }\r\n      return true\r\n    }\r\n\r\n    const validateFileSize = (size: number): boolean => {\r\n      if (MAX_FILE_SIZE === undefined || size <= MAX_FILE_SIZE) {\r\n        return true\r\n      }\r\n\r\n      setValidationError(\r\n        `File size (${formatBytes(size)}) exceeds maximum allowed size of ${formatBytes(MAX_FILE_SIZE)}`\r\n      )\r\n      return false\r\n    }\r\n\r\n    const validateDrmAvailability = (isAudioOnly: boolean) => {\r\n      if (config.drm_policy && isAudioOnly) {\r\n        setValidationError('Audio-only asset cannot be DRM protected')\r\n        return false\r\n      }\r\n      return true\r\n    }\r\n\r\n    let valid = true\r\n    if (videoAssetMetadata?.size) {\r\n      valid = valid && (canSkipFileSizeValidation || validateFileSize(videoAssetMetadata.size))\r\n    }\r\n    if (videoAssetMetadata?.duration) {\r\n      valid = valid && validateDuration(videoAssetMetadata.duration)\r\n    }\r\n    if (videoAssetMetadata?.isAudioOnly != undefined) {\r\n      valid = valid && validateDrmAvailability(videoAssetMetadata.isAudioOnly)\r\n    }\r\n    if (valid) {\r\n      setValidationError(null)\r\n    }\r\n  }, [\r\n    MAX_FILE_SIZE,\r\n    MAX_DURATION_SECONDS,\r\n    canSkipFileSizeValidation,\r\n    videoAssetMetadata?.duration,\r\n    videoAssetMetadata?.size,\r\n    videoAssetMetadata?.height,\r\n    videoAssetMetadata?.width,\r\n    videoAssetMetadata,\r\n    config.drm_policy,\r\n    validationError,\r\n  ])\r\n\r\n  // If user-provided config is disabled, begin the upload immediately with\r\n  // the developer-specified values from the schema or config or defaults.\r\n  // This can include auto-generated subtitles!\r\n  const {disableTextTrackConfig, disableUploadConfig, disableAssetNameConfig} = pluginConfig\r\n  const skipConfig = disableTextTrackConfig && disableUploadConfig && disableAssetNameConfig\r\n  useEffect(() => {\r\n    if (skipConfig) startUpload(formatUploadConfig(config, secrets), config.asset_name)\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [])\r\n  if (skipConfig) return null\r\n\r\n  const basicConfig = config.video_quality !== 'plus' && config.video_quality !== 'premium'\r\n  const playbackPolicySelected = config.public_policy || config.signed_policy || config.drm_policy\r\n  const maxSupportedResolution = RESOLUTION_TIERS.findIndex(\r\n    (rt) => rt.value === pluginConfig.max_resolution_tier\r\n  )\r\n  return (\r\n    <Dialog\r\n      animate\r\n      open\r\n      id=\"upload-configuration\"\r\n      zOffset={1000}\r\n      width={1}\r\n      header=\"Configure Mux Upload\"\r\n      onClose={onClose}\r\n    >\r\n      <Stack padding={4} space={2}>\r\n        {validationError && (\r\n          <Card padding={3} tone=\"critical\" radius={2} marginBottom={2}>\r\n            <Flex gap={2} align=\"flex-start\">\r\n              <ErrorOutlineIcon width={20} height={20} />\r\n              <Stack space={2}>\r\n                <Text size={1} weight=\"semibold\">\r\n                  Validation Error\r\n                </Text>\r\n                <Text size={1}>{validationError}</Text>\r\n              </Stack>\r\n            </Flex>\r\n          </Card>\r\n        )}\r\n        <Label size={3}>FILE TO UPLOAD</Label>\r\n        <Card\r\n          tone=\"transparent\"\r\n          border\r\n          padding={3}\r\n          paddingY={4}\r\n          style={{borderRadius: '0.1865rem'}}\r\n        >\r\n          <Flex gap={2}>\r\n            <DocumentVideoIcon fontSize=\"2em\" />\r\n            <Stack space={2}>\r\n              <Text textOverflow=\"ellipsis\" as=\"h2\" size={3}>\r\n                {stagedUpload.type === 'file' ? stagedUpload.files[0].name : stagedUpload.url}\r\n              </Text>\r\n              <Text as=\"p\" size={1} muted>\r\n                {stagedUpload.type === 'file'\r\n                  ? `Direct File Upload (${formatBytes(stagedUpload.files[0].size)})`\r\n                  : (() => {\r\n                      if (videoAssetMetadata?.size) {\r\n                        return `File From URL (${formatBytes(videoAssetMetadata.size)})`\r\n                      }\r\n                      if (isLoadingFileSize) {\r\n                        return 'File From URL (Loading size...)'\r\n                      }\r\n                      return 'File From URL (Unknown size)'\r\n                    })()}\r\n              </Text>\r\n              {stagedUpload.type === 'file' && (\r\n                <Stack space={1}>\r\n                  {isLoadingMetadata && (\r\n                    <Text as=\"p\" size={1} muted>\r\n                      Reading video metadata...\r\n                    </Text>\r\n                  )}\r\n                  {videoAssetMetadata?.duration && !validationError && (\r\n                    <Text as=\"p\" size={1} muted>\r\n                      Duration: {formatSeconds(videoAssetMetadata.duration)}\r\n                    </Text>\r\n                  )}\r\n                </Stack>\r\n              )}\r\n            </Stack>\r\n          </Flex>\r\n        </Card>\r\n\r\n        {!disableAssetNameConfig && (\r\n          <FormField\r\n            title=\"Asset Name\"\r\n            inputId={\"upload-config-set-asset-name\"}\r\n            description=\"Give a friendly name to your asset. This name will be displayed in the asset library on Sanity.\"\r\n          >\r\n            <TextInput\r\n              id={\"upload-config-set-asset-name\"}\r\n              value={config.asset_name ?? \"\"}\r\n              placeholder=\"[Notion ID] - Name of the asset (recommended format)\"\r\n              onChange={(e: React.ChangeEvent<HTMLInputElement>) =>\r\n                dispatch({action: \"asset_name\", value: e.currentTarget.value})\r\n              }\r\n            />\r\n          </FormField>\r\n        )}\r\n\r\n        {!disableUploadConfig && (\r\n          <Stack space={3} paddingBottom={2}>\r\n            <FormField\r\n              title=\"Video Quality Level\"\r\n              description={\r\n                <>\r\n                  The video quality level informs the cost, quality, and available platform features\r\n                  for the asset.{' '}\r\n                  <a\r\n                    href=\"https://docs.mux.com/guides/use-encoding-tiers\"\r\n                    target=\"_blank\"\r\n                    rel=\"noopener noreferrer\"\r\n                  >\r\n                    See the Mux guide for more details.\r\n                  </a>\r\n                </>\r\n              }\r\n            >\r\n              <Flex gap={3}>\r\n                {VIDEO_QUALITY_LEVELS.map(({value, label}) => {\r\n                  const inputId = `${id}--encodingtier-${value}`\r\n                  return (\r\n                    <Flex key={value} align=\"center\" gap={2}>\r\n                      <Radio\r\n                        checked={config.video_quality === value}\r\n                        name=\"asset-encodingtier\"\r\n                        onChange={(e) =>\r\n                          dispatch({\r\n                            action: 'video_quality' as const,\r\n                            value: e.currentTarget.value as UploadConfig['video_quality'],\r\n                          })\r\n                        }\r\n                        value={value}\r\n                        id={inputId}\r\n                      />\r\n                      <Text as=\"label\" htmlFor={inputId}>\r\n                        {label}\r\n                      </Text>\r\n                    </Flex>\r\n                  )\r\n                })}\r\n              </Flex>\r\n            </FormField>\r\n\r\n            {!basicConfig && (\r\n              <FormField title=\"Additional Configuration\">\r\n                <Stack space={3}>\r\n                  <PlaybackPolicy id={id} config={config} secrets={secrets} dispatch={dispatch} />\r\n                  {maxSupportedResolution > 0 && (\r\n                    <ResolutionTierSelector\r\n                      id={id}\r\n                      config={config}\r\n                      dispatch={dispatch}\r\n                      maxSupportedResolution={maxSupportedResolution}\r\n                    />\r\n                  )}\r\n                  <StaticRenditionSelector id={id} config={config} dispatch={dispatch} />\r\n                  {!disableTextTrackConfig && (\r\n                    <TextTracksEditor\r\n                      tracks={config.text_tracks}\r\n                      dispatch={dispatch}\r\n                      defaultLang={pluginConfig.defaultAutogeneratedSubtitleLang}\r\n                    />\r\n                  )}\r\n                </Stack>\r\n              </FormField>\r\n            )}\r\n          </Stack>\r\n        )}\r\n\r\n        <Box marginTop={4}>\r\n          <Button\r\n            disabled={\r\n              (!basicConfig && !playbackPolicySelected) ||\r\n              validationError !== null ||\r\n              isLoadingMetadata ||\r\n              (isLoadingFileSize && !canSkipFileSizeValidation)\r\n            }\r\n            icon={UploadIcon}\r\n            text=\"Upload\"\r\n            tone=\"positive\"\r\n            onClick={() => {\r\n              if (!validationError) {\r\n                startUpload(formatUploadConfig(config, secrets), config.asset_name)\r\n              }\r\n            }}\r\n          />\r\n        </Box>\r\n      </Stack>\r\n    </Dialog>\r\n  )\r\n}\r\n\r\nfunction setAdvancedPlaybackPolicy(\r\n  config: UploadConfig,\r\n  secrets: Secrets\r\n): MuxNewAssetSettings['advanced_playback_policies'] {\r\n  const advanced_playback_policies: MuxNewAssetSettings['advanced_playback_policies'] = []\r\n  if (config.public_policy) {\r\n    advanced_playback_policies.push({policy: 'public'})\r\n  }\r\n  if (config.signed_policy) {\r\n    advanced_playback_policies.push({policy: 'signed'})\r\n  }\r\n  if (config.drm_policy) {\r\n    if (secrets.drmConfigId)\r\n      advanced_playback_policies.push({\r\n        policy: 'drm',\r\n        drm_configuration_id: secrets.drmConfigId ?? undefined,\r\n      })\r\n    else {\r\n      console.error('Selected DRM Policy but missing DRM Configuration Id')\r\n    }\r\n  }\r\n  return advanced_playback_policies\r\n}\r\n\r\nfunction formatUploadConfig(config: UploadConfig, secrets: Secrets): MuxNewAssetSettings {\r\n  const generated_subtitles = config.text_tracks\r\n    .filter<AutogeneratedTextTrack>(isAutogeneratedTrack)\r\n    .map<{name: string; language_code: SupportedMuxLanguage}>((track) => ({\r\n      name: track.name,\r\n      language_code: track.language_code,\r\n    }))\r\n\r\n  return {\r\n    input: [\r\n      {\r\n        type: 'video',\r\n        generated_subtitles: generated_subtitles.length > 0 ? generated_subtitles : undefined,\r\n      },\r\n      ...config.text_tracks.filter<CustomTextTrack>(isCustomTextTrack).reduce(\r\n        (acc, track) => {\r\n          if (track.language_code && track.file && track.name) {\r\n            acc.push({\r\n              url: track.file.contents,\r\n              type: 'text',\r\n              text_type: track.type === 'subtitles' ? 'subtitles' : undefined,\r\n              language_code: track.language_code,\r\n              name: track.name,\r\n              closed_captions: track.type === 'captions',\r\n            })\r\n          }\r\n          return acc\r\n        },\r\n        [] as NonNullable<MuxNewAssetSettings['input']>\r\n      ),\r\n    ],\r\n    static_renditions:\r\n      config.static_renditions.length > 0\r\n        ? config.static_renditions.map((resolution) => ({resolution}))\r\n        : undefined,\r\n    advanced_playback_policies: setAdvancedPlaybackPolicy(config, secrets),\r\n    max_resolution_tier: config.max_resolution_tier,\r\n    video_quality: config.video_quality,\r\n    normalize_audio: config.normalize_audio,\r\n  }\r\n}\r\n","import {rem} from '@sanity/ui'\r\nimport type {ComponentType} from 'react'\r\nimport {css, styled} from 'styled-components'\r\n\r\nimport {focusRingBorderStyle, focusRingStyle} from './helpers'\r\n\r\nexport function withFocusRing<Props>(component: ComponentType<Props>) {\r\n  return styled(component as unknown as any)<Props & {$border?: boolean}>((props) => {\r\n    const border = {\r\n      width: props.$border ? 1 : 0,\r\n      color: 'var(--card-border-color)',\r\n    }\r\n\r\n    return css`\r\n      --card-focus-box-shadow: ${focusRingBorderStyle(border)};\r\n\r\n      border-radius: ${rem(props.theme.sanity.radius[1])};\r\n      outline: none;\r\n      box-shadow: var(--card-focus-box-shadow);\r\n\r\n      &:focus {\r\n        --card-focus-box-shadow: ${focusRingStyle({\r\n          base: props.theme.sanity.color.base,\r\n          border,\r\n          focusRing: props.theme.sanity.focusRing,\r\n        })};\r\n      }\r\n    `\r\n  })\r\n}\r\n","/* eslint-disable no-nested-ternary */\r\nimport {Card, type CardTone} from '@sanity/ui'\r\nimport React, {forwardRef, useCallback, useRef} from 'react'\r\nimport {styled} from 'styled-components'\r\n\r\nimport {withFocusRing} from './withFocusRing'\r\n\r\nconst UploadCardWithFocusRing = withFocusRing(Card)\r\n\r\ninterface UploadCardProps {\r\n  tone?: CardTone\r\n  children: React.ReactNode\r\n  onPaste: React.ClipboardEventHandler<HTMLInputElement>\r\n  onDrop: React.DragEventHandler<HTMLDivElement>\r\n  onDragOver: React.DragEventHandler<HTMLDivElement>\r\n  onDragLeave: React.DragEventHandler<HTMLDivElement>\r\n  onDragEnter: React.DragEventHandler<HTMLDivElement>\r\n}\r\nexport const UploadCard = forwardRef<HTMLDivElement, UploadCardProps>(\r\n  ({children, tone, onPaste, onDrop, onDragEnter, onDragLeave, onDragOver}, forwardedRef) => {\r\n    const inputRef = useRef<HTMLInputElement>(null)\r\n    const handleKeyDown = useCallback<React.KeyboardEventHandler<HTMLDivElement>>((event) => {\r\n      const target = event.target as HTMLElement\r\n\r\n      // Don't steal focus when pasting into the VTT input\r\n      if (target.closest('#vtt-url')) {\r\n        return\r\n      }\r\n\r\n      if ((event.ctrlKey || event.metaKey) && event.key === 'v') {\r\n        inputRef.current!.focus()\r\n      }\r\n    }, [])\r\n\r\n    return (\r\n      <UploadCardWithFocusRing\r\n        tone={tone}\r\n        ref={forwardedRef}\r\n        padding={0}\r\n        radius={2}\r\n        shadow={0}\r\n        tabIndex={0}\r\n        onKeyDown={handleKeyDown}\r\n        onPaste={onPaste}\r\n        onDrop={onDrop}\r\n        onDragEnter={onDragEnter}\r\n        onDragLeave={onDragLeave}\r\n        onDragOver={onDragOver}\r\n      >\r\n        <HiddenInput ref={inputRef} />\r\n        {children}\r\n      </UploadCardWithFocusRing>\r\n    )\r\n  }\r\n)\r\n\r\nconst HiddenInput = styled.input.attrs({type: 'text'})`\r\n  position: absolute;\r\n  border: 0;\r\n  color: white;\r\n  opacity: 0;\r\n\r\n  &:focus {\r\n    outline: none;\r\n  }\r\n`\r\n","import {Button, type ButtonProps} from '@sanity/ui'\r\nimport React, {useCallback, useId, useRef} from 'react'\r\nimport {styled} from 'styled-components'\r\n\r\nconst HiddenInput = styled.input`\r\n  overflow: hidden;\r\n  width: 0.1px;\r\n  height: 0.1px;\r\n  opacity: 0;\r\n  position: absolute;\r\n  z-index: -1;\r\n`\r\n\r\nconst Label = styled.label`\r\n  position: relative;\r\n`\r\n\r\nexport interface FileInputButtonProps extends ButtonProps {\r\n  onSelect: (files: FileList) => void\r\n  accept: string\r\n}\r\nexport const FileInputButton = ({onSelect, accept, ...props}: FileInputButtonProps) => {\r\n  const inputId = `FileSelect${useId()}`\r\n  const inputRef = useRef<HTMLInputElement>(null)\r\n  const handleSelect = useCallback<React.ChangeEventHandler<HTMLInputElement>>(\r\n    (event) => {\r\n      if (onSelect) {\r\n        onSelect(event.target.files!)\r\n      }\r\n    },\r\n    [onSelect]\r\n  )\r\n  const handleButtonClick = useCallback(() => inputRef.current?.click(), [])\r\n  return (\r\n    <Label htmlFor={inputId}>\r\n      <HiddenInput\r\n        accept={accept}\r\n        ref={inputRef}\r\n        tabIndex={0}\r\n        type=\"file\"\r\n        id={inputId}\r\n        onChange={handleSelect}\r\n        value=\"\"\r\n      />\r\n      <Button\r\n        onClick={handleButtonClick}\r\n        mode=\"default\"\r\n        tone=\"primary\"\r\n        style={{width: '100%'}}\r\n        {...props}\r\n      />\r\n    </Label>\r\n  )\r\n}\r\n","import {DocumentVideoIcon, PlugIcon, SearchIcon, UploadIcon} from '@sanity/icons'\r\nimport {Button, Card, Flex, Inline, Text} from '@sanity/ui'\r\nimport {useCallback} from 'react'\r\n\r\nimport {useAccessControl} from '../hooks/useAccessControl'\r\nimport type {SetDialogState} from '../hooks/useDialogState'\r\nimport {PluginConfig} from '../util/types'\r\nimport {FileInputButton, type FileInputButtonProps} from './FileInputButton'\r\n\r\nfunction formatAcceptString(accept: string): string {\r\n  return accept\r\n    .split(',')\r\n    .map((type) => type.trim().replace('/*', ''))\r\n    .join(' or ')\r\n}\r\n\r\ninterface UploadPlaceholderProps {\r\n  setDialogState: SetDialogState\r\n  readOnly: boolean\r\n  hovering: boolean\r\n  needsSetup: boolean\r\n  onSelect: FileInputButtonProps['onSelect']\r\n  config: PluginConfig\r\n  accept: string\r\n}\r\nexport default function UploadPlaceholder(props: UploadPlaceholderProps) {\r\n  const {setDialogState, readOnly, onSelect, hovering, needsSetup, accept} = props\r\n  const handleBrowse = useCallback(() => setDialogState('select-video'), [setDialogState])\r\n  const handleConfigureApi = useCallback(() => setDialogState('secrets'), [setDialogState])\r\n  const {hasConfigAccess} = useAccessControl(props.config)\r\n\r\n  return (\r\n    <Card\r\n      sizing=\"border\"\r\n      tone={readOnly ? 'transparent' : 'inherit'}\r\n      border\r\n      radius={2}\r\n      paddingX={3}\r\n      paddingY={1}\r\n      style={hovering ? {borderColor: 'transparent'} : undefined}\r\n    >\r\n      <Flex\r\n        align=\"center\"\r\n        justify=\"space-between\"\r\n        gap={4}\r\n        direction={['column', 'column', 'row']}\r\n        paddingY={2}\r\n        sizing=\"border\"\r\n      >\r\n        <Flex align=\"center\" justify=\"flex-start\" gap={2} flex={1}>\r\n          <Flex justify=\"center\">\r\n            <Text muted>\r\n              <DocumentVideoIcon />\r\n            </Text>\r\n          </Flex>\r\n          <Flex justify=\"center\">\r\n            <Text size={1} muted>\r\n              Drag {formatAcceptString(accept)} file or paste URL here\r\n            </Text>\r\n          </Flex>\r\n        </Flex>\r\n        <Inline space={2}>\r\n          <FileInputButton\r\n            accept={accept}\r\n            mode=\"bleed\"\r\n            tone=\"default\"\r\n            icon={UploadIcon}\r\n            text=\"Upload\"\r\n            onSelect={onSelect}\r\n          />\r\n          <Button mode=\"bleed\" icon={SearchIcon} text=\"Select\" onClick={handleBrowse} />\r\n\r\n          {hasConfigAccess && (\r\n            <Button\r\n              padding={3}\r\n              radius={3}\r\n              tone={needsSetup ? 'critical' : undefined}\r\n              onClick={handleConfigureApi}\r\n              icon={PlugIcon}\r\n              mode=\"bleed\"\r\n              title=\"Configure plugin credentials\"\r\n            />\r\n          )}\r\n        </Inline>\r\n      </Flex>\r\n    </Card>\r\n  )\r\n}\r\n","import {ErrorOutlineIcon} from '@sanity/icons'\r\nimport {Button, CardTone, Flex, Text, useToast} from '@sanity/ui'\r\nimport React, {useCallback, useEffect, useReducer, useRef, useState} from 'react'\r\nimport {type Observable, Subject, Subscription} from 'rxjs'\r\nimport {takeUntil, tap} from 'rxjs/operators'\r\nimport type {SanityClient} from 'sanity'\r\nimport {PatchEvent, set, setIfMissing} from 'sanity'\r\n\r\nimport {uploadFile, uploadUrl} from '../actions/upload'\r\nimport {DialogStateProvider} from '../context/DialogStateContext'\r\nimport {type DialogState, type SetDialogState} from '../hooks/useDialogState'\r\nimport {isServerError, isValidUrl} from '../util/asserters'\r\nimport {extractDroppedFiles} from '../util/extractFiles'\r\nimport {hasPlaybackPolicy} from '../util/getPlaybackPolicy'\r\nimport {watchAssetForMetadata} from '../util/watchAssetUpdates'\r\nimport type {\r\n  MuxInputProps,\r\n  MuxNewAssetSettings,\r\n  PluginConfig,\r\n  Secrets,\r\n  VideoAssetDocument,\r\n} from '../util/types'\r\nimport InputBrowser from './InputBrowser'\r\nimport Player from './Player'\r\nimport PlayerActionsMenu from './PlayerActionsMenu'\r\nimport UploadConfiguration from './UploadConfiguration'\r\nimport {UploadCard} from './Uploader.styled'\r\nimport UploadPlaceholder from './UploadPlaceholder'\r\nimport {UploadProgress} from './UploadProgress'\r\n\r\ninterface Props extends Pick<MuxInputProps, 'onChange' | 'readOnly'> {\r\n  config: PluginConfig\r\n  client: SanityClient\r\n  secrets: Secrets\r\n  asset: VideoAssetDocument | null | undefined\r\n  dialogState: DialogState\r\n  setDialogState: SetDialogState\r\n  needsSetup: boolean\r\n}\r\n\r\nexport type StagedUpload = {type: 'file'; files: FileList | File[]} | {type: 'url'; url: string}\r\ntype UploadStatus = {\r\n  progress: number\r\n  file?: {name: string | undefined; type: string}\r\n  uuid?: string\r\n  url?: string\r\n}\r\n\r\ninterface State {\r\n  stagedUpload: StagedUpload | null\r\n  uploadStatus: UploadStatus | null\r\n  error: Error | null\r\n}\r\n\r\nconst INITIAL_STATE: State = {\r\n  stagedUpload: null,\r\n  uploadStatus: null,\r\n  error: null,\r\n}\r\n\r\ntype UploadFileEvent = ReturnType<typeof uploadFile> extends Observable<infer T> ? T : never\r\ntype UploadUrlEvent = ReturnType<typeof uploadUrl> extends Observable<infer T> ? T : never\r\ntype UploaderStateAction =\r\n  | {action: 'stageUpload'; input: NonNullable<State['stagedUpload']>}\r\n  | {action: 'commitUpload'}\r\n  | ({action: 'progressInfo'} & (\r\n      | Extract<UploadFileEvent, {type: 'uuid' | 'file'}>\r\n      | Extract<UploadUrlEvent, {type: 'url'}>\r\n    ))\r\n  | {action: 'progress'; percent: number}\r\n  | {action: 'error'; error: Error; settings: MuxNewAssetSettings}\r\n  | {action: 'complete' | 'reset'}\r\n\r\n/**\r\n * The main interface for inputting a Mux Video. It handles staging an upload\r\n * file, setting its configuration, displaying upload progress, and showing\r\n * the preview player.\r\n */\r\nexport default function Uploader(props: Props) {\r\n  const toast = useToast()\r\n  const containerRef = useRef<HTMLDivElement>(null)\r\n\r\n  const dragEnteredEls = useRef<EventTarget[]>([])\r\n  const [dragState, setDragState] = useState<'valid' | 'invalid' | null>(null)\r\n\r\n  const cancelUploadButton = useRef(\r\n    (() => {\r\n      const events$ = new Subject()\r\n      return {\r\n        observable: events$.asObservable(),\r\n        handleClick: ((event) => events$.next(event)) as React.MouseEventHandler<HTMLButtonElement>,\r\n      }\r\n    })()\r\n  ).current\r\n\r\n  const uploadRef = useRef<Subscription | null>(null)\r\n  const uploadingDocumentId = useRef<string | null>(null)\r\n  const [state, dispatch] = useReducer(\r\n    (prev: State, action: UploaderStateAction) => {\r\n      switch (action.action) {\r\n        case 'stageUpload':\r\n          return Object.assign({}, INITIAL_STATE, {stagedUpload: action.input})\r\n        case 'commitUpload':\r\n          return Object.assign({}, prev, {uploadStatus: {progress: 0}})\r\n        case 'progressInfo': {\r\n          // eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n          const {type, action: _, ...payload} = action\r\n          return Object.assign({}, prev, {\r\n            uploadStatus: {\r\n              ...prev.uploadStatus,\r\n              progress: prev.uploadStatus!.progress,\r\n              ...payload,\r\n            },\r\n          } satisfies Pick<typeof prev, 'uploadStatus'>)\r\n        }\r\n        case 'progress':\r\n          return Object.assign({}, prev, {\r\n            uploadStatus: {\r\n              ...prev.uploadStatus,\r\n              progress: action.percent,\r\n            },\r\n          } satisfies Pick<typeof prev, 'uploadStatus'>)\r\n        case 'reset':\r\n        case 'complete':\r\n          // Clear upload observable on completion\r\n          uploadRef.current?.unsubscribe()\r\n          uploadRef.current = null\r\n          uploadingDocumentId.current = null\r\n          return INITIAL_STATE\r\n        case 'error': {\r\n          // Clear upload observable on error\r\n          uploadRef.current?.unsubscribe()\r\n          uploadRef.current = null\r\n          uploadingDocumentId.current = null\r\n\r\n          let error = action.error\r\n          if (isServerError(action.error) && hasPlaybackPolicy(action.settings, 'drm')) {\r\n            error = new Error(\r\n              'Unknown Error while uploading DRM protected content. Make sure your DRM configuration ID is valid and set correctly'\r\n            )\r\n          }\r\n\r\n          return Object.assign({}, INITIAL_STATE, {error: error})\r\n        }\r\n        default:\r\n          return prev\r\n      }\r\n    },\r\n    {\r\n      stagedUpload: null,\r\n      uploadStatus: null,\r\n      error: null,\r\n    }\r\n  )\r\n\r\n  // Make sure we close out the upload observer on dismount\r\n  // and cleanup orphaned documents if upload was in progress\r\n  useEffect(() => {\r\n    const cleanup = () => {\r\n      // Cancel subscription\r\n      if (uploadRef.current && !uploadRef.current.closed) {\r\n        uploadRef.current.unsubscribe()\r\n      }\r\n\r\n      // Delete orphaned document if upload was in progress and document is different from the saved asset\r\n      if (uploadingDocumentId.current && props.asset?._id !== uploadingDocumentId.current) {\r\n        const docId = uploadingDocumentId.current\r\n        uploadingDocumentId.current = null\r\n\r\n        props.client.delete(docId).catch((err) => {\r\n          console.warn('Failed to cleanup orphaned upload document:', err)\r\n        })\r\n      }\r\n    }\r\n\r\n    const handleBeforeUnload = () => {\r\n      cleanup()\r\n    }\r\n\r\n    window.addEventListener('beforeunload', handleBeforeUnload)\r\n    window.addEventListener('pagehide', handleBeforeUnload)\r\n\r\n    return () => {\r\n      window.removeEventListener('beforeunload', handleBeforeUnload)\r\n      window.removeEventListener('pagehide', handleBeforeUnload)\r\n      cleanup()\r\n    }\r\n  }, [props.client, props.asset?._id])\r\n\r\n  /* -------------------------------------------------------------------------- */\r\n  /*                                  Uploading                                 */\r\n  /* -------------------------------------------------------------------------- */\r\n\r\n  /**\r\n   * Begins a file or URL upload with the staged files or URL.\r\n   *\r\n   * Should only be called from the UploadConfiguration component, which provides\r\n   * the Mux configuration for the direct asset upload.\r\n   *\r\n   * @param settings The Mux new_asset_settings object to send to Sanity\r\n   * @returns\r\n   */\r\n  const startUpload = (settings: MuxNewAssetSettings, assetName?: string) => {\r\n    const {stagedUpload} = state\r\n    if (!stagedUpload || uploadRef.current) return\r\n    dispatch({action: 'commitUpload'})\r\n    let uploadObservable: Observable<UploadFileEvent | UploadUrlEvent>\r\n    // eslint-disable-next-line default-case\r\n    switch (stagedUpload.type) {\r\n      case 'url':\r\n        uploadObservable = uploadUrl({\r\n          client: props.client,\r\n          url: stagedUpload.url,\r\n          settings,\r\n          assetName: (assetName) ? assetName : undefined,\r\n        })\r\n        break\r\n      case 'file':\r\n        uploadObservable = uploadFile({\r\n          client: props.client,\r\n          file: stagedUpload.files[0],\r\n          settings,\r\n          assetName: (assetName) ? assetName : undefined,\r\n        }).pipe(\r\n          takeUntil(\r\n            cancelUploadButton.observable.pipe(\r\n              tap(() => {\r\n                if (uploadingDocumentId.current) {\r\n                  props.client.delete(uploadingDocumentId.current)\r\n                  uploadingDocumentId.current = null\r\n                }\r\n              })\r\n            )\r\n          )\r\n        )\r\n        break\r\n    }\r\n    uploadRef.current = uploadObservable.subscribe({\r\n      next: (event) => {\r\n        switch (event.type) {\r\n          case 'uuid':\r\n            // Track the document ID for cleanup on unmount\r\n            uploadingDocumentId.current = event.uuid\r\n            dispatch({action: 'progressInfo', ...event})\r\n            break\r\n          case 'file':\r\n          case 'url':\r\n            dispatch({action: 'progressInfo', ...event})\r\n            break\r\n          case 'progress':\r\n            dispatch({action: 'progress', percent: event.percent})\r\n            break\r\n          case 'success':\r\n            dispatch({action: 'progress', percent: 100})\r\n            uploadingDocumentId.current = null\r\n            const patches = []\r\n            patches.push(setIfMissing({asset: {}, _type: 'mux.video'}))\r\n            patches.push(set({_type: 'reference', _weak: true, _ref: event.asset._id}, ['asset']))\r\n            if (props.config.inlineAssetMetadata) {\r\n              patches.push(setIfMissing({data: {}}))\r\n              patches.push(set({_type: 'metadata', ...(event.asset.data ?? {})}, ['data']))\r\n            }\r\n            props.onChange(PatchEvent.from(patches))\r\n            if (props.config.inlineAssetMetadata) {\r\n              watchAssetForMetadata(event.asset._id, props);\r\n            }\r\n            break\r\n          case 'pause':\r\n          case 'resume':\r\n          default:\r\n            break\r\n        }\r\n      },\r\n      complete: () => dispatch({action: 'complete'}),\r\n      error: (error) => dispatch({action: 'error', error, settings}),\r\n    })\r\n  }\r\n\r\n  const invalidFileToast = useCallback(() => {\r\n    toast.push({\r\n      status: 'error',\r\n      title: `Invalid file type. Accepted types: ${props.config.acceptedMimeTypes?.join(', ')}`,\r\n    })\r\n  }, [props.config.acceptedMimeTypes, toast])\r\n\r\n  /**\r\n   * Validates if any file in the provided FileList or File array has an unsupported MIME type\r\n   * @param files - FileList or File array to validate\r\n   * @returns true if any file has an invalid MIME type, false if all files are valid\r\n   */\r\n  const isInvalidFile = (files: FileList | File[]) => {\r\n    const isInvalid = Array.from(files).some((file) => {\r\n      return !props.config.acceptedMimeTypes?.some((acceptedType) => {\r\n        // Convert mime type pattern to regex (e.g., 'audio/*' -> /^audio\\/.*$/)\r\n        const pattern = `^${acceptedType.replace('*', '.*')}$`\r\n        return new RegExp(pattern).test(file.type)\r\n      })\r\n    })\r\n\r\n    return isInvalid\r\n  }\r\n\r\n  /* -------------------------- Upload Initialization ------------------------- */\r\n  // The below populate the uploadInput state field, which then triggers the\r\n  // upload configuration, or the startUpload function if no config is required.\r\n\r\n  // Stages an upload from the file selector\r\n  const handleUpload = (files: FileList | File[]) => {\r\n    if (isInvalidFile(files)) return\r\n    dispatch({\r\n      action: 'stageUpload',\r\n      input: {type: 'file', files},\r\n    })\r\n  }\r\n\r\n  // Stages and validates an upload from pasting an asset URL\r\n  const handlePaste: React.ClipboardEventHandler<HTMLInputElement> = (event) => {\r\n    const target = event.target as HTMLElement\r\n\r\n    // Ignore paste coming from the VTT URL input\r\n    if (target.closest('#vtt-url')) {\r\n      return\r\n    }\r\n\r\n    event.preventDefault()\r\n    event.stopPropagation()\r\n    const clipboardData =\r\n      event.clipboardData || (window as Window & {clipboardData?: DataTransfer}).clipboardData\r\n    const url = clipboardData?.getData('text')?.trim()\r\n    if (!isValidUrl(url)) {\r\n      toast.push({status: 'error', title: 'Invalid URL for Mux video input.'})\r\n      return\r\n    }\r\n    dispatch({action: 'stageUpload', input: {type: 'url', url: url}})\r\n  }\r\n\r\n  // Stages and validates an upload from dragging+dropping files or folders\r\n  const handleDrop: React.DragEventHandler<HTMLDivElement> = (event) => {\r\n    event.preventDefault()\r\n    event.stopPropagation()\r\n    if (dragState === 'invalid') {\r\n      invalidFileToast()\r\n      setDragState(null)\r\n      return\r\n    }\r\n    setDragState(null)\r\n    extractDroppedFiles(event.nativeEvent.dataTransfer!).then((files) => {\r\n      dispatch({\r\n        action: 'stageUpload',\r\n        input: {type: 'file', files},\r\n      })\r\n    })\r\n  }\r\n\r\n  /* ------------------------------- Drag State ------------------------------- */\r\n\r\n  const handleDragOver: React.DragEventHandler<HTMLDivElement> = (event) => {\r\n    event.preventDefault()\r\n    event.stopPropagation()\r\n  }\r\n\r\n  const handleDragEnter: React.DragEventHandler<HTMLDivElement> = (event) => {\r\n    event.stopPropagation()\r\n    dragEnteredEls.current.push(event.target)\r\n    const type = event.dataTransfer.items?.[0]?.type\r\n    const mimeTypes = props.config.acceptedMimeTypes\r\n\r\n    // Check if the dragged file type matches any of the accepted mime types\r\n    const isValidType = mimeTypes?.some((acceptedType) => {\r\n      // Convert mime type pattern to regex (e.g., 'video/*' -> /^video\\/.*$/)\r\n      const pattern = `^${acceptedType.replace('*', '.*')}$`\r\n      return new RegExp(pattern).test(type)\r\n    })\r\n\r\n    setDragState(isValidType ? 'valid' : 'invalid')\r\n  }\r\n\r\n  const handleDragLeave: React.DragEventHandler<HTMLDivElement> = (event) => {\r\n    event.stopPropagation()\r\n    const idx = dragEnteredEls.current.indexOf(event.target)\r\n    if (idx > -1) {\r\n      dragEnteredEls.current.splice(idx, 1)\r\n    }\r\n    if (dragEnteredEls.current.length === 0) {\r\n      setDragState(null)\r\n    }\r\n  }\r\n\r\n  /* -------------------------------- Rendering ------------------------------- */\r\n\r\n  // Upload has errored\r\n  if (state.error !== null) {\r\n    const error = state.error\r\n    return (\r\n      <Flex gap={3} direction=\"column\" justify=\"center\" align=\"center\">\r\n        <Text size={5} muted>\r\n          <ErrorOutlineIcon />\r\n        </Text>\r\n        <Text>Something went wrong</Text>\r\n        {error instanceof Error && error.message && (\r\n          <Text size={1} muted weight=\"semibold\" style={{textAlign: 'center'}}>\r\n            {error.message}\r\n          </Text>\r\n        )}\r\n        <Button text=\"Upload another file\" onClick={() => dispatch({action: 'reset'})} />\r\n      </Flex>\r\n    )\r\n  }\r\n\r\n  // Upload is in progress\r\n  if (state.uploadStatus !== null) {\r\n    const {uploadStatus} = state\r\n    return (\r\n      <UploadProgress\r\n        onCancel={cancelUploadButton.handleClick}\r\n        progress={uploadStatus.progress}\r\n        filename={uploadStatus.file?.name || uploadStatus.url}\r\n      />\r\n    )\r\n  }\r\n\r\n  // Upload needs configuration\r\n  if (state.stagedUpload !== null) {\r\n    return (\r\n      <UploadConfiguration\r\n        stagedUpload={state.stagedUpload}\r\n        pluginConfig={props.config}\r\n        secrets={props.secrets}\r\n        startUpload={startUpload}\r\n        onClose={() => dispatch({action: 'reset'})}\r\n      />\r\n    )\r\n  }\r\n\r\n  // Default: No staged upload\r\n  let tone: CardTone | undefined\r\n  if (dragState) tone = dragState === 'valid' ? 'positive' : 'critical'\r\n\r\n  const acceptMimeString = props.config?.acceptedMimeTypes?.length\r\n    ? props.config.acceptedMimeTypes.join(',')\r\n    : 'video/*, audio/*'\r\n\r\n  return (\r\n    <>\r\n      <UploadCard\r\n        tone={tone}\r\n        onDrop={handleDrop}\r\n        onDragOver={handleDragOver}\r\n        onDragLeave={handleDragLeave}\r\n        onDragEnter={handleDragEnter}\r\n        onPaste={handlePaste}\r\n        ref={containerRef}\r\n      >\r\n        {props.asset ? (\r\n          <DialogStateProvider\r\n            dialogState={props.dialogState}\r\n            setDialogState={props.setDialogState}\r\n          >\r\n            <Player\r\n              readOnly={props.readOnly}\r\n              asset={props.asset}\r\n              onChange={props.onChange}\r\n              config={props.config}\r\n              buttons={\r\n                <PlayerActionsMenu\r\n                  accept={acceptMimeString}\r\n                  asset={props.asset}\r\n                  dialogState={props.dialogState}\r\n                  setDialogState={props.setDialogState}\r\n                  onChange={props.onChange}\r\n                  onSelect={handleUpload}\r\n                  readOnly={props.readOnly}\r\n                  config={props.config}\r\n                />\r\n              }\r\n            />\r\n          </DialogStateProvider>\r\n        ) : (\r\n          <UploadPlaceholder\r\n            accept={acceptMimeString}\r\n            hovering={dragState !== null}\r\n            onSelect={handleUpload}\r\n            readOnly={!!props.readOnly}\r\n            setDialogState={props.setDialogState}\r\n            needsSetup={props.needsSetup}\r\n            config={props.config}\r\n          />\r\n        )}\r\n      </UploadCard>\r\n      {props.dialogState === 'select-video' && (\r\n        <InputBrowser\r\n          config={props.config}\r\n          asset={props.asset}\r\n          onChange={props.onChange}\r\n          setDialogState={props.setDialogState}\r\n        />\r\n      )}\r\n    </>\r\n  )\r\n}\r\n","import {Card} from '@sanity/ui'\r\nimport {memo, Suspense} from 'react'\r\n\r\nimport {useAccessControl} from '../hooks/useAccessControl'\r\nimport {useAssetDocumentValues} from '../hooks/useAssetDocumentValues'\r\nimport {useClient} from '../hooks/useClient'\r\nimport {useDialogState} from '../hooks/useDialogState'\r\nimport {useMuxPolling} from '../hooks/useMuxPolling'\r\nimport {useSecretsDocumentValues} from '../hooks/useSecretsDocumentValues'\r\nimport type {MuxInputProps, PluginConfig} from '../util/types'\r\nimport {ConfigureApiDialog} from './ConfigureApi'\r\nimport ErrorBoundaryCard from './ErrorBoundaryCard'\r\nimport {InputFallback} from './Input.styled'\r\nimport Onboard from './Onboard'\r\nimport Uploader from './Uploader'\r\n\r\nexport interface InputProps extends MuxInputProps {\r\n  config: PluginConfig\r\n}\r\nconst Input = (props: InputProps) => {\r\n  const client = useClient()\r\n  const secretDocumentValues = useSecretsDocumentValues()\r\n  const assetDocumentValues = useAssetDocumentValues(props.value?.asset)\r\n  const poll = useMuxPolling(props.readOnly ? undefined : assetDocumentValues?.value || undefined)\r\n  const [dialogState, setDialogState] = useDialogState()\r\n  const {hasConfigAccess} = useAccessControl(props.config)\r\n\r\n  const error = secretDocumentValues.error || assetDocumentValues.error || poll.error /*||\r\n    // @TODO move errored logic to Uploader, where handleRemoveVideo can be called\r\n    (assetDocumentValues.value?.status === 'errored'\r\n      ? new Error(assetDocumentValues.value.data?.errors?.messages?.join(' '))\r\n      : undefined)\r\n      // */\r\n  if (error) {\r\n    // @TODO deal with it more gracefully\r\n    throw error\r\n  }\r\n  const isLoading = secretDocumentValues.isLoading || assetDocumentValues.isLoading\r\n\r\n  return (\r\n    <Card>\r\n      <ErrorBoundaryCard schemaType={props.schemaType}>\r\n        <Suspense fallback={<InputFallback />}>\r\n          {isLoading ? (\r\n            <InputFallback />\r\n          ) : (\r\n            <>\r\n              {secretDocumentValues.value.needsSetup && !assetDocumentValues.value ? (\r\n                <Onboard setDialogState={setDialogState} config={props.config} />\r\n              ) : (\r\n                <Uploader\r\n                  {...props}\r\n                  config={props.config}\r\n                  onChange={props.onChange}\r\n                  client={client}\r\n                  secrets={secretDocumentValues.value.secrets}\r\n                  asset={assetDocumentValues.value}\r\n                  dialogState={dialogState}\r\n                  setDialogState={setDialogState}\r\n                  needsSetup={secretDocumentValues.value.needsSetup}\r\n                />\r\n              )}\r\n\r\n              {dialogState === 'secrets' && hasConfigAccess && (\r\n                <ConfigureApiDialog\r\n                  setDialogState={setDialogState}\r\n                  secrets={secretDocumentValues.value.secrets}\r\n                />\r\n              )}\r\n            </>\r\n          )}\r\n        </Suspense>\r\n      </ErrorBoundaryCard>\r\n    </Card>\r\n  )\r\n}\r\n\r\nexport default memo(Input)\r\n","import Input from './components/Input'\r\nimport VideoThumbnail from './components/VideoThumbnail'\r\nimport type {MuxInputProps, PluginConfig, VideoAssetDocument} from './util/types'\r\n\r\nexport function muxVideoCustomRendering(config: PluginConfig) {\r\n  return {\r\n    components: {\r\n      input: (props: MuxInputProps) => (\r\n        <Input config={{...config, ...props.schemaType.options}} {...props} />\r\n      ),\r\n    },\r\n    preview: {\r\n      select: {\r\n        filename: 'asset.filename',\r\n        playbackId: 'asset.playbackId',\r\n        status: 'asset.status',\r\n        assetId: 'asset.assetId',\r\n        thumbTime: 'asset.thumbTime',\r\n        data: 'asset.data',\r\n      },\r\n      prepare: (asset: Partial<VideoAssetDocument>) => {\r\n        const {filename, playbackId, status} = asset\r\n        return {\r\n          title: filename || playbackId || '',\r\n          subtitle: status ? `status: ${status}` : null,\r\n          media: asset.playbackId ? <VideoThumbnail asset={asset} width={64} /> : null,\r\n        }\r\n      },\r\n    },\r\n  }\r\n}\r\n","export const muxVideoSchema = {\r\n  name: 'mux.video',\r\n  type: 'object',\r\n  title: 'Video asset reference',\r\n  fields: [\r\n    {\r\n      title: 'Video',\r\n      name: 'asset',\r\n      type: 'reference',\r\n      weak: true,\r\n      to: [{type: 'mux.videoAsset'}],\r\n    },\r\n  ],\r\n}\r\n\r\nconst muxTrack = {\r\n  name: 'mux.track',\r\n  type: 'object',\r\n  fields: [\r\n    {type: 'string', name: 'id'},\r\n    {type: 'string', name: 'type'},\r\n    {type: 'number', name: 'max_width'},\r\n    {type: 'number', name: 'max_frame_rate'},\r\n    {type: 'number', name: 'duration'},\r\n    {type: 'number', name: 'max_height'},\r\n    {type: 'string', name: 'language_code'},\r\n    {type: 'string', name: 'name'},\r\n    {type: 'string', name: 'status'},\r\n    {type: 'string', name: 'text_source'},\r\n    {type: 'string', name: 'text_type'},\r\n  ],\r\n}\r\n\r\nconst muxPlaybackId = {\r\n  name: 'mux.playbackId',\r\n  type: 'object',\r\n  fields: [\r\n    {type: 'string', name: 'id'},\r\n    {type: 'string', name: 'policy'},\r\n  ],\r\n}\r\n\r\nconst muxStaticRenditionFile = {\r\n  name: 'mux.staticRenditionFile',\r\n  type: 'object',\r\n  fields: [\r\n    {type: 'string', name: 'name'},\r\n    {type: 'string', name: 'ext'},\r\n    {type: 'number', name: 'height'},\r\n    {type: 'number', name: 'width'},\r\n    {type: 'number', name: 'bitrate'},\r\n    {type: 'string', name: 'filesize'},\r\n    {type: 'string', name: 'type'},\r\n    {type: 'string', name: 'status'},\r\n    {type: 'string', name: 'resolution_tier'},\r\n    {type: 'string', name: 'resolution'},\r\n    {type: 'string', name: 'id'},\r\n    {type: 'string', name: 'passthrough'},\r\n  ],\r\n}\r\n\r\nconst muxStaticRenditions = {\r\n  name: 'mux.staticRenditions',\r\n  type: 'object',\r\n  fields: [\r\n    {type: 'string', name: 'status'},\r\n    {\r\n      name: 'files',\r\n      type: 'array',\r\n      of: [{type: 'mux.staticRenditionFile'}],\r\n    },\r\n  ],\r\n}\r\n\r\nconst muxAssetData = {\r\n  name: 'mux.assetData',\r\n  title: 'Mux asset data',\r\n  type: 'object',\r\n  fields: [\r\n    {\r\n      type: 'string',\r\n      name: 'resolution_tier',\r\n    },\r\n    {\r\n      type: 'string',\r\n      name: 'upload_id',\r\n    },\r\n    {\r\n      type: 'string',\r\n      name: 'created_at',\r\n    },\r\n    {\r\n      type: 'string',\r\n      name: 'id',\r\n    },\r\n    {\r\n      type: 'string',\r\n      name: 'status',\r\n    },\r\n    {\r\n      type: 'string',\r\n      name: 'max_stored_resolution',\r\n    },\r\n    {\r\n      type: 'string',\r\n      name: 'passthrough',\r\n    },\r\n    {\r\n      type: 'string',\r\n      name: 'encoding_tier',\r\n    },\r\n    {\r\n      type: 'string',\r\n      name: 'video_quality',\r\n    },\r\n    {\r\n      type: 'string',\r\n      name: 'master_access',\r\n    },\r\n    {\r\n      type: 'string',\r\n      name: 'aspect_ratio',\r\n    },\r\n    {\r\n      type: 'number',\r\n      name: 'duration',\r\n    },\r\n    {\r\n      type: 'number',\r\n      name: 'max_stored_frame_rate',\r\n    },\r\n    {\r\n      type: 'string',\r\n      name: 'mp4_support',\r\n    },\r\n    {\r\n      type: 'string',\r\n      name: 'max_resolution_tier',\r\n    },\r\n    {\r\n      name: 'tracks',\r\n      type: 'array',\r\n      of: [{type: 'mux.track'}],\r\n    },\r\n    {\r\n      name: 'playback_ids',\r\n      type: 'array',\r\n      of: [{type: 'mux.playbackId'}],\r\n    },\r\n    {\r\n      name: 'static_renditions',\r\n      type: 'mux.staticRenditions',\r\n    },\r\n  ],\r\n}\r\n\r\nconst muxVideoAsset = {\r\n  name: 'mux.videoAsset',\r\n  type: 'document',\r\n  title: 'Video asset',\r\n  fields: [\r\n    {\r\n      type: 'string',\r\n      name: 'status',\r\n    },\r\n    {\r\n      type: 'string',\r\n      name: 'assetId',\r\n    },\r\n    {\r\n      type: 'string',\r\n      name: 'playbackId',\r\n    },\r\n    {\r\n      type: 'string',\r\n      name: 'filename',\r\n    },\r\n    {\r\n      type: 'number',\r\n      name: 'thumbTime',\r\n    },\r\n    {\r\n      type: 'mux.assetData',\r\n      name: 'data',\r\n    },\r\n  ],\r\n}\r\n\r\nexport const schemaTypes = [\r\n  muxTrack,\r\n  muxPlaybackId,\r\n  muxStaticRenditionFile,\r\n  muxStaticRenditions,\r\n  muxAssetData,\r\n  muxVideoAsset,\r\n]\r\n","import {definePlugin} from 'sanity'\r\n\r\nimport createStudioTool, {DEFAULT_TOOL_CONFIG} from '../components/StudioTool'\r\nimport {muxVideoCustomRendering} from '../plugin'\r\nimport {muxVideoSchema, schemaTypes} from '../schema'\r\nimport type {PluginConfig, StaticRenditionResolution} from '../util/types'\r\nexport type {VideoAssetDocument} from '../util/types'\r\n\r\nexport const defaultConfig: PluginConfig = {\r\n  static_renditions: [],\r\n  mp4_support: 'none',\r\n  video_quality: 'plus',\r\n  max_resolution_tier: '1080p',\r\n  normalize_audio: false,\r\n  defaultPublic: true,\r\n  defaultSigned: false,\r\n  defaultDrm: false,\r\n  inlineAssetMetadata: false,\r\n  tool: DEFAULT_TOOL_CONFIG,\r\n  allowedRolesForConfiguration: [],\r\n  acceptedMimeTypes: ['video/*', 'audio/*'],\r\n}\r\n\r\n/**\r\n * Converts legacy mp4_support configuration to static_renditions format\r\n */\r\nfunction convertLegacyConfig(config: Partial<PluginConfig>): {\r\n  static_renditions: StaticRenditionResolution[]\r\n} {\r\n  // If static_renditions is already provided, use it\r\n  if (config.static_renditions && config.static_renditions.length > 0) {\r\n    return {static_renditions: config.static_renditions}\r\n  }\r\n\r\n  // Convert legacy mp4_support to static_renditions\r\n  if (config.mp4_support === 'standard') {\r\n    return {static_renditions: ['highest']}\r\n  }\r\n\r\n  return {static_renditions: []}\r\n}\r\n\r\nexport const muxInput = definePlugin<Partial<PluginConfig> | void>((userConfig) => {\r\n  // TODO: Remove this on next major version when we end support for encoding_tier\r\n  if (typeof userConfig === 'object' && 'encoding_tier' in userConfig) {\r\n    const deprecated_encoding_tier = userConfig.encoding_tier\r\n    if (!userConfig.video_quality) {\r\n      if (deprecated_encoding_tier === 'baseline') {\r\n        userConfig.video_quality = 'basic'\r\n      }\r\n      if (deprecated_encoding_tier === 'smart') {\r\n        userConfig.video_quality = 'plus'\r\n      }\r\n    }\r\n  }\r\n  const config: PluginConfig = {\r\n    ...defaultConfig,\r\n    ...(userConfig || {}),\r\n    ...convertLegacyConfig(userConfig || {}),\r\n  }\r\n  return {\r\n    name: 'mux-input',\r\n    schema: {\r\n      types: [\r\n        ...schemaTypes,\r\n        {\r\n          ...muxVideoSchema,\r\n          ...muxVideoCustomRendering(config),\r\n        },\r\n      ],\r\n    },\r\n    tools: config.tool === false ? undefined : [createStudioTool(config)],\r\n  }\r\n})\r\n"],"names":["jsx","createContext","useState","useContext","Dialog","Stack","Button","jsxs","Card","Text","useSanityClient","words","trim","toLower","uniq","compact","createHookFromObservableFactory","useDocumentStore","useMemo","collate","defer","useCallback","path","useDocumentValues","useReducer","suspend","useId","useTheme_v2","styled","Fragment","Flex","Box","memo","useRef","clear","secretsId","preload","useEffect","FormField","TextInput","Checkbox","Code","Inline","truncateString","a","expand","timer","concatMap","of","tap","useClient","uuid","Suspense","Spinner","ErrorOutlineIcon","useFormattedDuration","RetrieveIcon","InfoOutlineIcon","RetryIcon","CheckmarkCircleIcon","Heading","ChevronLeftIcon","Label","ChevronRightIcon","Radio","SyncIcon","MenuButton","SortIcon","Menu","MenuItem","name","DownloadIcon","ResetIcon","useToast","LANGUAGE_OPTIONS","LanguagesList","UploadIcon","Autocomplete","TranslateIcon","EditIcon","TrashIcon","AddIcon","ChevronUpIcon","ChevronDownIcon","muxPlaybackId","MuxPlayer","WarningOutlineIcon","SanityDefaultPreview","useTimeAgo","document","Tooltip","TextWithTone","PublishIcon","isRecord","isValidElement","isString","isNumber","getPreviewStateObservable","useObservable","DocumentPreviewPresence","getPreviewValueWithFallback","IntentLink","useDocumentPreviewStore","useSchema","useDocumentPresence","DocumentIcon","PreviewCard","React","CheckmarkIcon","RevertIcon","TabList","Tab","SearchIcon","TabPanel","ClockIcon","CropIcon","CalendarIcon","TagIcon","LockIcon","PlayIcon","Grid","useCurrentUser","isReference","useProjectId","useDataset","useSWR","t","e","r","n","o","useErrorBoundary","scrollIntoView","PlugIcon","uploadUrl","Observable","upchunk","UpChunk","id","switchMap","concat","throwError","generateUuid","mergeMap","from","catchError","mergeMapTo","PatchEvent","set","unset","setIfMissing","SelectAsset","LinearProgress","css","isValidElementType","createElement","useClickOutsideEvent","Popover","ImageIcon","MenuDivider","EllipsisHorizontalIcon","u","WarningFilledIcon","_id","DocumentVideoIcon","rem","forwardRef","HiddenInput","Subject","takeUntil","PlayerActionsMenu","ErrorBoundaryCard","Input","definePlugin"],"mappings":"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","x_google_ignoreList":[52,76]}